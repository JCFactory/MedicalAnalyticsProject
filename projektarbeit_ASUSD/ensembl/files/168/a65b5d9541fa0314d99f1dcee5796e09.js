/*! jQuery v1.11.0 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k="".trim,l={},m="1.11.0",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(n.isPlainObject(c)||(b=n.isArray(c)))?(b?(b=!1,f=a&&n.isArray(a)?a:[]):f=a&&n.isPlainObject(a)?a:{},g[d]=n.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray||function(a){return"array"===n.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return a-parseFloat(a)>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;try{if(a.constructor&&!j.call(a,"constructor")&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(l.ownLast)for(b in a)return j.call(a,b);for(b in a);return void 0===b||j.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(b){b&&n.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:k&&!k.call("\ufeff\xa0")?function(a){return null==a?"":k.call(a)}:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(g)return g.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(f=a[b],b=a,a=f),n.isFunction(a)?(c=d.call(arguments,2),e=function(){return a.apply(b||this,c.concat(d.call(arguments)))},e.guid=a.guid=a.guid||n.guid++,e):void 0},now:function(){return+new Date},support:l}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s="sizzle"+-new Date,t=a.document,u=0,v=0,w=eb(),x=eb(),y=eb(),z=function(a,b){return a===b&&(j=!0),0},A="undefined",B=1<<31,C={}.hasOwnProperty,D=[],E=D.pop,F=D.push,G=D.push,H=D.slice,I=D.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",K="[\\x20\\t\\r\\n\\f]",L="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",M=L.replace("w","w#"),N="\\["+K+"*("+L+")"+K+"*(?:([*^$|!~]?=)"+K+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+M+")|)|)"+K+"*\\]",O=":("+L+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+N.replace(3,8)+")*)|.*)\\)|)",P=new RegExp("^"+K+"+|((?:^|[^\\\\])(?:\\\\.)*)"+K+"+$","g"),Q=new RegExp("^"+K+"*,"+K+"*"),R=new RegExp("^"+K+"*([>+~]|"+K+")"+K+"*"),S=new RegExp("="+K+"*([^\\]'\"]*?)"+K+"*\\]","g"),T=new RegExp(O),U=new RegExp("^"+M+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\.("+L+")"),TAG:new RegExp("^("+L.replace("w","w*")+")"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+K+"*(even|odd|(([+-]|)(\\d*)n|)"+K+"*(?:([+-]|)"+K+"*(\\d+)|))"+K+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+K+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+K+"*((?:-\\d)?\\d*)"+K+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,_=/'|\\/g,ab=new RegExp("\\\\([\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),bb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{G.apply(D=H.call(t.childNodes),t.childNodes),D[t.childNodes.length].nodeType}catch(cb){G={apply:D.length?function(a,b){F.apply(a,H.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function db(a,b,d,e){var f,g,h,i,j,m,p,q,u,v;if((b?b.ownerDocument||b:t)!==l&&k(b),b=b||l,d=d||[],!a||"string"!=typeof a)return d;if(1!==(i=b.nodeType)&&9!==i)return[];if(n&&!e){if(f=Z.exec(a))if(h=f[1]){if(9===i){if(g=b.getElementById(h),!g||!g.parentNode)return d;if(g.id===h)return d.push(g),d}else if(b.ownerDocument&&(g=b.ownerDocument.getElementById(h))&&r(b,g)&&g.id===h)return d.push(g),d}else{if(f[2])return G.apply(d,b.getElementsByTagName(a)),d;if((h=f[3])&&c.getElementsByClassName&&b.getElementsByClassName)return G.apply(d,b.getElementsByClassName(h)),d}if(c.qsa&&(!o||!o.test(a))){if(q=p=s,u=b,v=9===i&&a,1===i&&"object"!==b.nodeName.toLowerCase()){m=ob(a),(p=b.getAttribute("id"))?q=p.replace(_,"\\$&"):b.setAttribute("id",q),q="[id='"+q+"'] ",j=m.length;while(j--)m[j]=q+pb(m[j]);u=$.test(a)&&mb(b.parentNode)||b,v=m.join(",")}if(v)try{return G.apply(d,u.querySelectorAll(v)),d}catch(w){}finally{p||b.removeAttribute("id")}}}return xb(a.replace(P,"$1"),b,d,e)}function eb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function fb(a){return a[s]=!0,a}function gb(a){var b=l.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function hb(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function ib(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||B)-(~a.sourceIndex||B);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function jb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function kb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function lb(a){return fb(function(b){return b=+b,fb(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function mb(a){return a&&typeof a.getElementsByTagName!==A&&a}c=db.support={},f=db.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},k=db.setDocument=function(a){var b,e=a?a.ownerDocument||a:t,g=e.defaultView;return e!==l&&9===e.nodeType&&e.documentElement?(l=e,m=e.documentElement,n=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){k()},!1):g.attachEvent&&g.attachEvent("onunload",function(){k()})),c.attributes=gb(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=gb(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Y.test(e.getElementsByClassName)&&gb(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=gb(function(a){return m.appendChild(a).id=s,!e.getElementsByName||!e.getElementsByName(s).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==A&&n){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ab,bb);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ab,bb);return function(a){var c=typeof a.getAttributeNode!==A&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==A?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==A&&n?b.getElementsByClassName(a):void 0},p=[],o=[],(c.qsa=Y.test(e.querySelectorAll))&&(gb(function(a){a.innerHTML="<select t=''><option selected=''></option></select>",a.querySelectorAll("[t^='']").length&&o.push("[*^$]="+K+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||o.push("\\["+K+"*(?:value|"+J+")"),a.querySelectorAll(":checked").length||o.push(":checked")}),gb(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&o.push("name"+K+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||o.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),o.push(",.*:")})),(c.matchesSelector=Y.test(q=m.webkitMatchesSelector||m.mozMatchesSelector||m.oMatchesSelector||m.msMatchesSelector))&&gb(function(a){c.disconnectedMatch=q.call(a,"div"),q.call(a,"[s!='']:x"),p.push("!=",O)}),o=o.length&&new RegExp(o.join("|")),p=p.length&&new RegExp(p.join("|")),b=Y.test(m.compareDocumentPosition),r=b||Y.test(m.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},z=b?function(a,b){if(a===b)return j=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===t&&r(t,a)?-1:b===e||b.ownerDocument===t&&r(t,b)?1:i?I.call(i,a)-I.call(i,b):0:4&d?-1:1)}:function(a,b){if(a===b)return j=!0,0;var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],k=[b];if(!f||!g)return a===e?-1:b===e?1:f?-1:g?1:i?I.call(i,a)-I.call(i,b):0;if(f===g)return ib(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)k.unshift(c);while(h[d]===k[d])d++;return d?ib(h[d],k[d]):h[d]===t?-1:k[d]===t?1:0},e):l},db.matches=function(a,b){return db(a,null,null,b)},db.matchesSelector=function(a,b){if((a.ownerDocument||a)!==l&&k(a),b=b.replace(S,"='$1']"),!(!c.matchesSelector||!n||p&&p.test(b)||o&&o.test(b)))try{var d=q.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return db(b,l,null,[a]).length>0},db.contains=function(a,b){return(a.ownerDocument||a)!==l&&k(a),r(a,b)},db.attr=function(a,b){(a.ownerDocument||a)!==l&&k(a);var e=d.attrHandle[b.toLowerCase()],f=e&&C.call(d.attrHandle,b.toLowerCase())?e(a,b,!n):void 0;return void 0!==f?f:c.attributes||!n?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},db.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},db.uniqueSort=function(a){var b,d=[],e=0,f=0;if(j=!c.detectDuplicates,i=!c.sortStable&&a.slice(0),a.sort(z),j){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return i=null,a},e=db.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=db.selectors={cacheLength:50,createPseudo:fb,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ab,bb),a[3]=(a[4]||a[5]||"").replace(ab,bb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||db.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&db.error(a[0]),a},PSEUDO:function(a){var b,c=!a[5]&&a[2];return V.CHILD.test(a[0])?null:(a[3]&&void 0!==a[4]?a[2]=a[4]:c&&T.test(c)&&(b=ob(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ab,bb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=w[a+" "];return b||(b=new RegExp("(^|"+K+")"+a+"("+K+"|$)"))&&w(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==A&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=db.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),t=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&t){k=q[s]||(q[s]={}),j=k[a]||[],n=j[0]===u&&j[1],m=j[0]===u&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[u,n,m];break}}else if(t&&(j=(b[s]||(b[s]={}))[a])&&j[0]===u)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(t&&((l[s]||(l[s]={}))[a]=[u,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||db.error("unsupported pseudo: "+a);return e[s]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?fb(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=I.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:fb(function(a){var b=[],c=[],d=g(a.replace(P,"$1"));return d[s]?fb(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:fb(function(a){return function(b){return db(a,b).length>0}}),contains:fb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:fb(function(a){return U.test(a||"")||db.error("unsupported lang: "+a),a=a.replace(ab,bb).toLowerCase(),function(b){var c;do if(c=n?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===m},focus:function(a){return a===l.activeElement&&(!l.hasFocus||l.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return X.test(a.nodeName)},input:function(a){return W.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:lb(function(){return[0]}),last:lb(function(a,b){return[b-1]}),eq:lb(function(a,b,c){return[0>c?c+b:c]}),even:lb(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:lb(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:lb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:lb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=jb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=kb(b);function nb(){}nb.prototype=d.filters=d.pseudos,d.setFilters=new nb;function ob(a,b){var c,e,f,g,h,i,j,k=x[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=Q.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=R.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(P," ")}),h=h.slice(c.length));for(g in d.filter)!(e=V[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?db.error(a):x(a,i).slice(0)}function pb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function qb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=v++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[u,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[s]||(b[s]={}),(h=i[d])&&h[0]===u&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function rb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function sb(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function tb(a,b,c,d,e,f){return d&&!d[s]&&(d=tb(d)),e&&!e[s]&&(e=tb(e,f)),fb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||wb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:sb(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=sb(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?I.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=sb(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):G.apply(g,r)})}function ub(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],i=g||d.relative[" "],j=g?1:0,k=qb(function(a){return a===b},i,!0),l=qb(function(a){return I.call(b,a)>-1},i,!0),m=[function(a,c,d){return!g&&(d||c!==h)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>j;j++)if(c=d.relative[a[j].type])m=[qb(rb(m),c)];else{if(c=d.filter[a[j].type].apply(null,a[j].matches),c[s]){for(e=++j;f>e;e++)if(d.relative[a[e].type])break;return tb(j>1&&rb(m),j>1&&pb(a.slice(0,j-1).concat({value:" "===a[j-2].type?"*":""})).replace(P,"$1"),c,e>j&&ub(a.slice(j,e)),f>e&&ub(a=a.slice(e)),f>e&&pb(a))}m.push(c)}return rb(m)}function vb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,i,j,k){var m,n,o,p=0,q="0",r=f&&[],s=[],t=h,v=f||e&&d.find.TAG("*",k),w=u+=null==t?1:Math.random()||.1,x=v.length;for(k&&(h=g!==l&&g);q!==x&&null!=(m=v[q]);q++){if(e&&m){n=0;while(o=a[n++])if(o(m,g,i)){j.push(m);break}k&&(u=w)}c&&((m=!o&&m)&&p--,f&&r.push(m))}if(p+=q,c&&q!==p){n=0;while(o=b[n++])o(r,s,g,i);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=E.call(j));s=sb(s)}G.apply(j,s),k&&!f&&s.length>0&&p+b.length>1&&db.uniqueSort(j)}return k&&(u=w,h=t),r};return c?fb(f):f}g=db.compile=function(a,b){var c,d=[],e=[],f=y[a+" "];if(!f){b||(b=ob(a)),c=b.length;while(c--)f=ub(b[c]),f[s]?d.push(f):e.push(f);f=y(a,vb(e,d))}return f};function wb(a,b,c){for(var d=0,e=b.length;e>d;d++)db(a,b[d],c);return c}function xb(a,b,e,f){var h,i,j,k,l,m=ob(a);if(!f&&1===m.length){if(i=m[0]=m[0].slice(0),i.length>2&&"ID"===(j=i[0]).type&&c.getById&&9===b.nodeType&&n&&d.relative[i[1].type]){if(b=(d.find.ID(j.matches[0].replace(ab,bb),b)||[])[0],!b)return e;a=a.slice(i.shift().value.length)}h=V.needsContext.test(a)?0:i.length;while(h--){if(j=i[h],d.relative[k=j.type])break;if((l=d.find[k])&&(f=l(j.matches[0].replace(ab,bb),$.test(i[0].type)&&mb(b.parentNode)||b))){if(i.splice(h,1),a=f.length&&pb(i),!a)return G.apply(e,f),e;break}}}return g(a,m)(f,b,!n,e,$.test(a)&&mb(b.parentNode)||b),e}return c.sortStable=s.split("").sort(z).join("")===s,c.detectDuplicates=!!j,k(),c.sortDetached=gb(function(a){return 1&a.compareDocumentPosition(l.createElement("div"))}),gb(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||hb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&gb(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||hb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),gb(function(a){return null==a.getAttribute("disabled")})||hb(J,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),db}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(w.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return n.inArray(a,b)>=0!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;e>b;b++)if(n.contains(d[b],this))return!0}));for(b=0;e>b;b++)n.find(a,d[b],c);return c=this.pushStack(e>1?n.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,"string"==typeof a&&u.test(a)?n(a):a||[],!1).length}});var y,z=a.document,A=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,B=n.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:A.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:z,!0)),v.test(c[1])&&n.isPlainObject(b))for(c in b)n.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}if(d=z.getElementById(c[2]),d&&d.parentNode){if(d.id!==c[2])return y.find(a);this.length=1,this[0]=d}return this.context=z,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};B.prototype=n.fn,y=n(z);var C=/^(?:parents|prev(?:Until|All))/,D={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(a,b,c){var d=[],e=a[b];while(e&&9!==e.nodeType&&(void 0===c||1!==e.nodeType||!n(e).is(c)))1===e.nodeType&&d.push(e),e=e[b];return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),n.fn.extend({has:function(a){var b,c=n(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(n.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.unique(f):f)},index:function(a){return a?"string"==typeof a?n.inArray(this[0],n(a)):n.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.unique(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function E(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return n.dir(a,"parentNode")},parentsUntil:function(a,b,c){return n.dir(a,"parentNode",c)},next:function(a){return E(a,"nextSibling")},prev:function(a){return E(a,"previousSibling")},nextAll:function(a){return n.dir(a,"nextSibling")},prevAll:function(a){return n.dir(a,"previousSibling")},nextUntil:function(a,b,c){return n.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return n.dir(a,"previousSibling",c)},siblings:function(a){return n.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return n.sibling(a.firstChild)},contents:function(a){return n.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(D[a]||(e=n.unique(e)),C.test(a)&&(e=e.reverse())),this.pushStack(e)}});var F=/\S+/g,G={};function H(a){var b=G[a]={};return n.each(a.match(F)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?G[a]||H(a):n.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(c=a.memory&&l,d=!0,f=g||0,g=0,e=h.length,b=!0;h&&e>f;f++)if(h[f].apply(l[0],l[1])===!1&&a.stopOnFalse){c=!1;break}b=!1,h&&(i?i.length&&j(i.shift()):c?h=[]:k.disable())},k={add:function(){if(h){var d=h.length;!function f(b){n.each(b,function(b,c){var d=n.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),b?e=h.length:c&&(g=d,j(c))}return this},remove:function(){return h&&n.each(arguments,function(a,c){var d;while((d=n.inArray(c,h,d))>-1)h.splice(d,1),b&&(e>=d&&e--,f>=d&&f--)}),this},has:function(a){return a?n.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],e=0,this},disable:function(){return h=i=c=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,c||k.disable(),this},locked:function(){return!i},fireWith:function(a,c){return!h||d&&!i||(c=c||[],c=[a,c.slice?c.slice():c],b?i.push(c):j(c)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&n.isFunction(a.promise)?e:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var I;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){if(a===!0?!--n.readyWait:!n.isReady){if(!z.body)return setTimeout(n.ready);n.isReady=!0,a!==!0&&--n.readyWait>0||(I.resolveWith(z,[n]),n.fn.trigger&&n(z).trigger("ready").off("ready"))}}});function J(){z.addEventListener?(z.removeEventListener("DOMContentLoaded",K,!1),a.removeEventListener("load",K,!1)):(z.detachEvent("onreadystatechange",K),a.detachEvent("onload",K))}function K(){(z.addEventListener||"load"===event.type||"complete"===z.readyState)&&(J(),n.ready())}n.ready.promise=function(b){if(!I)if(I=n.Deferred(),"complete"===z.readyState)setTimeout(n.ready);else if(z.addEventListener)z.addEventListener("DOMContentLoaded",K,!1),a.addEventListener("load",K,!1);else{z.attachEvent("onreadystatechange",K),a.attachEvent("onload",K);var c=!1;try{c=null==a.frameElement&&z.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!n.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}J(),n.ready()}}()}return I.promise(b)};var L="undefined",M;for(M in n(l))break;l.ownLast="0"!==M,l.inlineBlockNeedsLayout=!1,n(function(){var a,b,c=z.getElementsByTagName("body")[0];c&&(a=z.createElement("div"),a.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",b=z.createElement("div"),c.appendChild(a).appendChild(b),typeof b.style.zoom!==L&&(b.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1",(l.inlineBlockNeedsLayout=3===b.offsetWidth)&&(c.style.zoom=1)),c.removeChild(a),a=b=null)}),function(){var a=z.createElement("div");if(null==l.deleteExpando){l.deleteExpando=!0;try{delete a.test}catch(b){l.deleteExpando=!1}}a=null}(),n.acceptData=function(a){var b=n.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b};var N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(O,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}n.data(a,b,c)}else c=void 0}return c}function Q(a){var b;for(b in a)if(("data"!==b||!n.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function R(a,b,d,e){if(n.acceptData(a)){var f,g,h=n.expando,i=a.nodeType,j=i?n.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||n.guid++:h),j[k]||(j[k]=i?{}:{toJSON:n.noop}),("object"==typeof b||"function"==typeof b)&&(e?j[k]=n.extend(j[k],b):j[k].data=n.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[n.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[n.camelCase(b)])):f=g,f
}}function S(a,b,c){if(n.acceptData(a)){var d,e,f=a.nodeType,g=f?n.cache:a,h=f?a[n.expando]:n.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){n.isArray(b)?b=b.concat(n.map(b,n.camelCase)):b in d?b=[b]:(b=n.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!Q(d):!n.isEmptyObject(d))return}(c||(delete g[h].data,Q(g[h])))&&(f?n.cleanData([a],!0):l.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}n.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?n.cache[a[n.expando]]:a[n.expando],!!a&&!Q(a)},data:function(a,b,c){return R(a,b,c)},removeData:function(a,b){return S(a,b)},_data:function(a,b,c){return R(a,b,c,!0)},_removeData:function(a,b){return S(a,b,!0)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=n.data(f),1===f.nodeType&&!n._data(f,"parsedAttrs"))){c=g.length;while(c--)d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d]));n._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){n.data(this,a)}):arguments.length>1?this.each(function(){n.data(this,a,b)}):f?P(f,a,n.data(f,a)):void 0},removeData:function(a){return this.each(function(){n.removeData(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=n._data(a,b),c&&(!d||n.isArray(c)?d=n._data(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return n._data(a,c)||n._data(a,c,{empty:n.Callbacks("once memory").add(function(){n._removeData(a,b+"queue"),n._removeData(a,c)})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=n._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var T=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,U=["Top","Right","Bottom","Left"],V=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)},W=n.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)n.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},X=/^(?:checkbox|radio)$/i;!function(){var a=z.createDocumentFragment(),b=z.createElement("div"),c=z.createElement("input");if(b.setAttribute("className","t"),b.innerHTML="  <link/><table></table><a href='/a'>a</a>",l.leadingWhitespace=3===b.firstChild.nodeType,l.tbody=!b.getElementsByTagName("tbody").length,l.htmlSerialize=!!b.getElementsByTagName("link").length,l.html5Clone="<:nav></:nav>"!==z.createElement("nav").cloneNode(!0).outerHTML,c.type="checkbox",c.checked=!0,a.appendChild(c),l.appendChecked=c.checked,b.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,a.appendChild(b),b.innerHTML="<input type='radio' checked='checked' name='t'/>",l.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!0,b.attachEvent&&(b.attachEvent("onclick",function(){l.noCloneEvent=!1}),b.cloneNode(!0).click()),null==l.deleteExpando){l.deleteExpando=!0;try{delete b.test}catch(d){l.deleteExpando=!1}}a=b=c=null}(),function(){var b,c,d=z.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(l[b+"Bubbles"]=c in a)||(d.setAttribute(c,"t"),l[b+"Bubbles"]=d.attributes[c].expando===!1);d=null}();var Y=/^(?:input|select|textarea)$/i,Z=/^key/,$=/^(?:mouse|contextmenu)|click/,_=/^(?:focusinfocus|focusoutblur)$/,ab=/^([^.]*)(?:\.(.+)|)$/;function bb(){return!0}function cb(){return!1}function db(){try{return z.activeElement}catch(a){}}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=n.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return typeof n===L||a&&n.event.triggered===a.type?void 0:n.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(F)||[""],h=b.length;while(h--)f=ab.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=n.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=n.event.special[o]||{},l=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},i),(m=g[o])||(m=g[o]=[],m.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,l):m.push(l),n.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n.hasData(a)&&n._data(a);if(r&&(k=r.events)){b=(b||"").match(F)||[""],j=b.length;while(j--)if(h=ab.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;while(f--)g=m[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(k)&&(delete r.handle,n._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,m,o=[d||z],p=j.call(b,"type")?b.type:b,q=j.call(b,"namespace")?b.namespace.split("."):[];if(h=l=d=d||z,3!==d.nodeType&&8!==d.nodeType&&!_.test(p+n.event.triggered)&&(p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),g=p.indexOf(":")<0&&"on"+p,b=b[n.expando]?b:new n.Event(p,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=q.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:n.makeArray(c,[b]),k=n.event.special[p]||{},e||!k.trigger||k.trigger.apply(d,c)!==!1)){if(!e&&!k.noBubble&&!n.isWindow(d)){for(i=k.delegateType||p,_.test(i+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),l=h;l===(d.ownerDocument||z)&&o.push(l.defaultView||l.parentWindow||a)}m=0;while((h=o[m++])&&!b.isPropagationStopped())b.type=m>1?i:k.bindType||p,f=(n._data(h,"events")||{})[b.type]&&n._data(h,"handle"),f&&f.apply(h,c),f=g&&h[g],f&&f.apply&&n.acceptData(h)&&(b.result=f.apply(h,c),b.result===!1&&b.preventDefault());if(b.type=p,!e&&!b.isDefaultPrevented()&&(!k._default||k._default.apply(o.pop(),c)===!1)&&n.acceptData(d)&&g&&d[p]&&!n.isWindow(d)){l=d[g],l&&(d[g]=null),n.event.triggered=p;try{d[p]()}catch(r){}n.event.triggered=void 0,l&&(d[g]=l)}return b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(n._data(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,g=0;while((e=f.handlers[g++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,c=((n.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),void 0!==c&&(a.result=c)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(e=[],f=0;h>f;f++)d=b[f],c=d.selector+" ",void 0===e[c]&&(e[c]=d.needsContext?n(c,this).index(i)>=0:n.find(c,this,null,[i]).length),e[c]&&e.push(d);e.length&&g.push({elem:i,handlers:e})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[n.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=$.test(e)?this.mouseHooks:Z.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new n.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||z),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||z,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==db()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===db()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return n.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=n.extend(new n.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?n.event.trigger(e,null,b):n.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=z.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===L&&(a[d]=null),a.detachEvent(d,c))},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&(a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault())?bb:cb):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={isDefaultPrevented:cb,isPropagationStopped:cb,isImmediatePropagationStopped:cb,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=bb,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=bb,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=bb,this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),l.submitBubbles||(n.event.special.submit={setup:function(){return n.nodeName(this,"form")?!1:void n.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=n.nodeName(b,"input")||n.nodeName(b,"button")?b.form:void 0;c&&!n._data(c,"submitBubbles")&&(n.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),n._data(c,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&n.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return n.nodeName(this,"form")?!1:void n.event.remove(this,"._submit")}}),l.changeBubbles||(n.event.special.change={setup:function(){return Y.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(n.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),n.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),n.event.simulate("change",this,a,!0)})),!1):void n.event.add(this,"beforeactivate._change",function(a){var b=a.target;Y.test(b.nodeName)&&!n._data(b,"changeBubbles")&&(n.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||n.event.simulate("change",this.parentNode,a,!0)}),n._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return n.event.remove(this,"._change"),!Y.test(this.nodeName)}}),l.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a),!0)};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=n._data(d,b);e||d.addEventListener(a,c,!0),n._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=n._data(d,b)-1;e?n._data(d,b,e):(d.removeEventListener(a,c,!0),n._removeData(d,b))}}}),n.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(f in a)this.on(f,b,c,a[f],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=cb;else if(!d)return this;return 1===e&&(g=d,d=function(a){return n().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=n.guid++)),this.each(function(){n.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=cb),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});function eb(a){var b=fb.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}var fb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gb=/ jQuery\d+="(?:null|\d+)"/g,hb=new RegExp("<(?:"+fb+")[\\s/>]","i"),ib=/^\s+/,jb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,kb=/<([\w:]+)/,lb=/<tbody/i,mb=/<|&#?\w+;/,nb=/<(?:script|style|link)/i,ob=/checked\s*(?:[^=]|=\s*.checked.)/i,pb=/^$|\/(?:java|ecma)script/i,qb=/^true\/(.*)/,rb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,sb={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},tb=eb(z),ub=tb.appendChild(z.createElement("div"));sb.optgroup=sb.option,sb.tbody=sb.tfoot=sb.colgroup=sb.caption=sb.thead,sb.th=sb.td;function vb(a,b){var c,d,e=0,f=typeof a.getElementsByTagName!==L?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==L?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||n.nodeName(d,b)?f.push(d):n.merge(f,vb(d,b));return void 0===b||b&&n.nodeName(a,b)?n.merge([a],f):f}function wb(a){X.test(a.type)&&(a.defaultChecked=a.checked)}function xb(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function yb(a){return a.type=(null!==n.find.attr(a,"type"))+"/"+a.type,a}function zb(a){var b=qb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Ab(a,b){for(var c,d=0;null!=(c=a[d]);d++)n._data(c,"globalEval",!b||n._data(b[d],"globalEval"))}function Bb(a,b){if(1===b.nodeType&&n.hasData(a)){var c,d,e,f=n._data(a),g=n._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)n.event.add(b,c,h[c][d])}g.data&&(g.data=n.extend({},g.data))}}function Cb(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!l.noCloneEvent&&b[n.expando]){e=n._data(b);for(d in e.events)n.removeEvent(b,d,e.handle);b.removeAttribute(n.expando)}"script"===c&&b.text!==a.text?(yb(b).text=a.text,zb(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),l.html5Clone&&a.innerHTML&&!n.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&X.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}n.extend({clone:function(a,b,c){var d,e,f,g,h,i=n.contains(a.ownerDocument,a);if(l.html5Clone||n.isXMLDoc(a)||!hb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(ub.innerHTML=a.outerHTML,ub.removeChild(f=ub.firstChild)),!(l.noCloneEvent&&l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(d=vb(f),h=vb(a),g=0;null!=(e=h[g]);++g)d[g]&&Cb(e,d[g]);if(b)if(c)for(h=h||vb(a),d=d||vb(f),g=0;null!=(e=h[g]);g++)Bb(e,d[g]);else Bb(a,f);return d=vb(f,"script"),d.length>0&&Ab(d,!i&&vb(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k,m=a.length,o=eb(b),p=[],q=0;m>q;q++)if(f=a[q],f||0===f)if("object"===n.type(f))n.merge(p,f.nodeType?[f]:f);else if(mb.test(f)){h=h||o.appendChild(b.createElement("div")),i=(kb.exec(f)||["",""])[1].toLowerCase(),k=sb[i]||sb._default,h.innerHTML=k[1]+f.replace(jb,"<$1></$2>")+k[2],e=k[0];while(e--)h=h.lastChild;if(!l.leadingWhitespace&&ib.test(f)&&p.push(b.createTextNode(ib.exec(f)[0])),!l.tbody){f="table"!==i||lb.test(f)?"<table>"!==k[1]||lb.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;while(e--)n.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j)}n.merge(p,h.childNodes),h.textContent="";while(h.firstChild)h.removeChild(h.firstChild);h=o.lastChild}else p.push(b.createTextNode(f));h&&o.removeChild(h),l.appendChecked||n.grep(vb(p,"input"),wb),q=0;while(f=p[q++])if((!d||-1===n.inArray(f,d))&&(g=n.contains(f.ownerDocument,f),h=vb(o.appendChild(f),"script"),g&&Ab(h),c)){e=0;while(f=h[e++])pb.test(f.type||"")&&c.push(f)}return h=null,o},cleanData:function(a,b){for(var d,e,f,g,h=0,i=n.expando,j=n.cache,k=l.deleteExpando,m=n.event.special;null!=(d=a[h]);h++)if((b||n.acceptData(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)m[e]?n.event.remove(d,e):n.removeEvent(d,e,g.handle);j[f]&&(delete j[f],k?delete d[i]:typeof d.removeAttribute!==L?d.removeAttribute(i):d[i]=null,c.push(f))}}}),n.fn.extend({text:function(a){return W(this,function(a){return void 0===a?n.text(this):this.empty().append((this[0]&&this[0].ownerDocument||z).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=xb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=xb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?n.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||n.cleanData(vb(c)),c.parentNode&&(b&&n.contains(c.ownerDocument,c)&&Ab(vb(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&n.cleanData(vb(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&n.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return W(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(gb,""):void 0;if(!("string"!=typeof a||nb.test(a)||!l.htmlSerialize&&hb.test(a)||!l.leadingWhitespace&&ib.test(a)||sb[(kb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(jb,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(vb(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,n.cleanData(vb(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,k=this.length,m=this,o=k-1,p=a[0],q=n.isFunction(p);if(q||k>1&&"string"==typeof p&&!l.checkClone&&ob.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(k&&(i=n.buildFragment(a,this[0].ownerDocument,!1,this),c=i.firstChild,1===i.childNodes.length&&(i=c),c)){for(g=n.map(vb(i,"script"),yb),f=g.length;k>j;j++)d=i,j!==o&&(d=n.clone(d,!0,!0),f&&n.merge(g,vb(d,"script"))),b.call(this[j],d,j);if(f)for(h=g[g.length-1].ownerDocument,n.map(g,zb),j=0;f>j;j++)d=g[j],pb.test(d.type||"")&&!n._data(d,"globalEval")&&n.contains(h,d)&&(d.src?n._evalUrl&&n._evalUrl(d.src):n.globalEval((d.text||d.textContent||d.innerHTML||"").replace(rb,"")));i=c=null}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=0,e=[],g=n(a),h=g.length-1;h>=d;d++)c=d===h?this:this.clone(!0),n(g[d])[b](c),f.apply(e,c.get());return this.pushStack(e)}});var Db,Eb={};function Fb(b,c){var d=n(c.createElement(b)).appendTo(c.body),e=a.getDefaultComputedStyle?a.getDefaultComputedStyle(d[0]).display:n.css(d[0],"display");return d.detach(),e}function Gb(a){var b=z,c=Eb[a];return c||(c=Fb(a,b),"none"!==c&&c||(Db=(Db||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Db[0].contentWindow||Db[0].contentDocument).document,b.write(),b.close(),c=Fb(a,b),Db.detach()),Eb[a]=c),c}!function(){var a,b,c=z.createElement("div"),d="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=c.getElementsByTagName("a")[0],a.style.cssText="float:left;opacity:.5",l.opacity=/^0.5/.test(a.style.opacity),l.cssFloat=!!a.style.cssFloat,c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===c.style.backgroundClip,a=c=null,l.shrinkWrapBlocks=function(){var a,c,e,f;if(null==b){if(a=z.getElementsByTagName("body")[0],!a)return;f="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",c=z.createElement("div"),e=z.createElement("div"),a.appendChild(c).appendChild(e),b=!1,typeof e.style.zoom!==L&&(e.style.cssText=d+";width:1px;padding:1px;zoom:1",e.innerHTML="<div></div>",e.firstChild.style.width="5px",b=3!==e.offsetWidth),a.removeChild(c),a=c=e=null}return b}}();var Hb=/^margin/,Ib=new RegExp("^("+T+")(?!px)[a-z%]+$","i"),Jb,Kb,Lb=/^(top|right|bottom|left)$/;a.getComputedStyle?(Jb=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)},Kb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Jb(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),Ib.test(g)&&Hb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):z.documentElement.currentStyle&&(Jb=function(a){return a.currentStyle},Kb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Jb(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Ib.test(g)&&!Lb.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function Mb(a,b){return{get:function(){var c=a();if(null!=c)return c?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d,e,f,g,h=z.createElement("div"),i="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",j="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";h.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",b=h.getElementsByTagName("a")[0],b.style.cssText="float:left;opacity:.5",l.opacity=/^0.5/.test(b.style.opacity),l.cssFloat=!!b.style.cssFloat,h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===h.style.backgroundClip,b=h=null,n.extend(l,{reliableHiddenOffsets:function(){if(null!=c)return c;var a,b,d,e=z.createElement("div"),f=z.getElementsByTagName("body")[0];if(f)return e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=z.createElement("div"),a.style.cssText=i,f.appendChild(a).appendChild(e),e.innerHTML="<table><tr><td></td><td>t</td></tr></table>",b=e.getElementsByTagName("td"),b[0].style.cssText="padding:0;margin:0;border:0;display:none",d=0===b[0].offsetHeight,b[0].style.display="",b[1].style.display="none",c=d&&0===b[0].offsetHeight,f.removeChild(a),e=f=null,c},boxSizing:function(){return null==d&&k(),d},boxSizingReliable:function(){return null==e&&k(),e},pixelPosition:function(){return null==f&&k(),f},reliableMarginRight:function(){var b,c,d,e;if(null==g&&a.getComputedStyle){if(b=z.getElementsByTagName("body")[0],!b)return;c=z.createElement("div"),d=z.createElement("div"),c.style.cssText=i,b.appendChild(c).appendChild(d),e=d.appendChild(z.createElement("div")),e.style.cssText=d.style.cssText=j,e.style.marginRight=e.style.width="0",d.style.width="1px",g=!parseFloat((a.getComputedStyle(e,null)||{}).marginRight),b.removeChild(c)}return g}});function k(){var b,c,h=z.getElementsByTagName("body")[0];h&&(b=z.createElement("div"),c=z.createElement("div"),b.style.cssText=i,h.appendChild(b).appendChild(c),c.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",n.swap(h,null!=h.style.zoom?{zoom:1}:{},function(){d=4===c.offsetWidth}),e=!0,f=!1,g=!0,a.getComputedStyle&&(f="1%"!==(a.getComputedStyle(c,null)||{}).top,e="4px"===(a.getComputedStyle(c,null)||{width:"4px"}).width),h.removeChild(b),c=h=null)}}(),n.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Nb=/alpha\([^)]*\)/i,Ob=/opacity\s*=\s*([^)]*)/,Pb=/^(none|table(?!-c[ea]).+)/,Qb=new RegExp("^("+T+")(.*)$","i"),Rb=new RegExp("^([+-])=("+T+")","i"),Sb={position:"absolute",visibility:"hidden",display:"block"},Tb={letterSpacing:0,fontWeight:400},Ub=["Webkit","O","Moz","ms"];function Vb(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Ub.length;while(e--)if(b=Ub[e]+c,b in a)return b;return d}function Wb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=n._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&V(d)&&(f[g]=n._data(d,"olddisplay",Gb(d.nodeName)))):f[g]||(e=V(d),(c&&"none"!==c||!e)&&n._data(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function Xb(a,b,c){var d=Qb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Yb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+U[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+U[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+U[f]+"Width",!0,e))):(g+=n.css(a,"padding"+U[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+U[f]+"Width",!0,e)));return g}function Zb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Jb(a),g=l.boxSizing()&&"border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Kb(a,b,f),(0>e||null==e)&&(e=a.style[b]),Ib.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Yb(a,b,c||(g?"border":"content"),d,f)+"px"}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Kb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":l.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;if(b=n.cssProps[h]||(n.cssProps[h]=Vb(i,h)),g=n.cssHooks[b]||n.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=Rb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(n.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||n.cssNumber[h]||(c+="px"),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]="",i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Vb(a.style,h)),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Kb(a,b,d)),"normal"===f&&b in Tb&&(f=Tb[b]),""===c||c?(e=parseFloat(f),c===!0||n.isNumeric(e)?e||0:f):f}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&Pb.test(n.css(a,"display"))?n.swap(a,Sb,function(){return Zb(a,b,d)}):Zb(a,b,d):void 0},set:function(a,c,d){var e=d&&Jb(a);return Xb(a,c,d?Yb(a,b,d,l.boxSizing()&&"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),l.opacity||(n.cssHooks.opacity={get:function(a,b){return Ob.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=n.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===n.trim(f.replace(Nb,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Nb.test(f)?f.replace(Nb,e):f+" "+e)}}),n.cssHooks.marginRight=Mb(l.reliableMarginRight,function(a,b){return b?n.swap(a,{display:"inline-block"},Kb,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+U[d]+b]=f[d]||f[d-2]||f[0];return e}},Hb.test(a)||(n.cssHooks[a+b].set=Xb)}),n.fn.extend({css:function(a,b){return W(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Jb(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)
},a,b,arguments.length>1)},show:function(){return Wb(this,!0)},hide:function(){return Wb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){V(this)?n(this).show():n(this).hide()})}});function $b(a,b,c,d,e){return new $b.prototype.init(a,b,c,d,e)}n.Tween=$b,$b.prototype={constructor:$b,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=$b.propHooks[this.prop];return a&&a.get?a.get(this):$b.propHooks._default.get(this)},run:function(a){var b,c=$b.propHooks[this.prop];return this.pos=b=this.options.duration?n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):$b.propHooks._default.set(this),this}},$b.prototype.init.prototype=$b.prototype,$b.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[n.cssProps[a.prop]]||n.cssHooks[a.prop])?n.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},$b.propHooks.scrollTop=$b.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},n.fx=$b.prototype.init,n.fx.step={};var _b,ac,bc=/^(?:toggle|show|hide)$/,cc=new RegExp("^(?:([+-])=|)("+T+")([a-z%]*)$","i"),dc=/queueHooks$/,ec=[jc],fc={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=cc.exec(b),f=e&&e[3]||(n.cssNumber[a]?"":"px"),g=(n.cssNumber[a]||"px"!==f&&+d)&&cc.exec(n.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,n.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function gc(){return setTimeout(function(){_b=void 0}),_b=n.now()}function hc(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=U[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function ic(a,b,c){for(var d,e=(fc[b]||[]).concat(fc["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function jc(a,b,c){var d,e,f,g,h,i,j,k,m=this,o={},p=a.style,q=a.nodeType&&V(a),r=n._data(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,m.always(function(){m.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=n.css(a,"display"),k=Gb(a.nodeName),"none"===j&&(j=k),"inline"===j&&"none"===n.css(a,"float")&&(l.inlineBlockNeedsLayout&&"inline"!==k?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",l.shrinkWrapBlocks()||m.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],bc.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||n.style(a,d)}if(!n.isEmptyObject(o)){r?"hidden"in r&&(q=r.hidden):r=n._data(a,"fxshow",{}),f&&(r.hidden=!q),q?n(a).show():m.done(function(){n(a).hide()}),m.done(function(){var b;n._removeData(a,"fxshow");for(b in o)n.style(a,b,o[b])});for(d in o)g=ic(q?r[d]:0,d,m),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function kc(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function lc(a,b,c){var d,e,f=0,g=ec.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=_b||gc(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:_b||gc(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(kc(k,j.opts.specialEasing);g>f;f++)if(d=ec[f].call(j,a,k,j.opts))return d;return n.map(k,ic,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(lc,{tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],fc[c]=fc[c]||[],fc[c].unshift(b)},prefilter:function(a,b){b?ec.unshift(a):ec.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(V).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=lc(this,n.extend({},a),f);(e||n._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=n._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&dc.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=n._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(hc(b,!0),a,d,e)}}),n.each({slideDown:hc("show"),slideUp:hc("hide"),slideToggle:hc("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=n.timers,c=0;for(_b=n.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||n.fx.stop(),_b=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){ac||(ac=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(ac),ac=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(a,b){return a=n.fx?n.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a,b,c,d,e=z.createElement("div");e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=e.getElementsByTagName("a")[0],c=z.createElement("select"),d=c.appendChild(z.createElement("option")),b=e.getElementsByTagName("input")[0],a.style.cssText="top:1px",l.getSetAttribute="t"!==e.className,l.style=/top/.test(a.getAttribute("style")),l.hrefNormalized="/a"===a.getAttribute("href"),l.checkOn=!!b.value,l.optSelected=d.selected,l.enctype=!!z.createElement("form").enctype,c.disabled=!0,l.optDisabled=!d.disabled,b=z.createElement("input"),b.setAttribute("value",""),l.input=""===b.getAttribute("value"),b.value="t",b.setAttribute("type","radio"),l.radioValue="t"===b.value,a=b=c=d=e=null}();var mc=/\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(mc,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.text(a)}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(l.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)if(d=e[g],n.inArray(n.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>=0:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var nc,oc,pc=n.expr.attrHandle,qc=/^(?:checked|selected)$/i,rc=l.getSetAttribute,sc=l.input;n.fn.extend({attr:function(a,b){return W(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===L?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),d=n.attrHooks[b]||(n.expr.match.bool.test(b)?oc:nc)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=n.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void n.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(F);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)?sc&&rc||!qc.test(c)?a[d]=!1:a[n.camelCase("default-"+c)]=a[d]=!1:n.attr(a,c,""),a.removeAttribute(rc?c:d)},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),oc={set:function(a,b,c){return b===!1?n.removeAttr(a,c):sc&&rc||!qc.test(c)?a.setAttribute(!rc&&n.propFix[c]||c,c):a[n.camelCase("default-"+c)]=a[c]=!0,c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=pc[b]||n.find.attr;pc[b]=sc&&rc||!qc.test(b)?function(a,b,d){var e,f;return d||(f=pc[b],pc[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,pc[b]=f),e}:function(a,b,c){return c?void 0:a[n.camelCase("default-"+b)]?b.toLowerCase():null}}),sc&&rc||(n.attrHooks.value={set:function(a,b,c){return n.nodeName(a,"input")?void(a.defaultValue=b):nc&&nc.set(a,b,c)}}),rc||(nc={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},pc.id=pc.name=pc.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},n.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:nc.set},n.attrHooks.contenteditable={set:function(a,b,c){nc.set(a,""===b?!1:b,c)}},n.each(["width","height"],function(a,b){n.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),l.style||(n.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var tc=/^(?:input|select|textarea|button|object)$/i,uc=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return W(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return a=n.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!n.isXMLDoc(a),f&&(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):tc.test(a.nodeName)||uc.test(a.nodeName)&&a.href?0:-1}}}}),l.hrefNormalized||n.each(["href","src"],function(a,b){n.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this}),l.enctype||(n.propFix.enctype="encoding");var vc=/[\t\r\n\f]/g;n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j="string"==typeof a&&a;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(F)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(vc," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=n.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j=0===arguments.length||"string"==typeof a&&a;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(F)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(vc," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?n.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(n.isFunction(a)?function(c){n(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=n(this),f=a.match(F)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===L||"boolean"===c)&&(this.className&&n._data(this,"__className__",this.className),this.className=this.className||a===!1?"":n._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(vc," ").indexOf(b)>=0)return!0;return!1}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var wc=n.now(),xc=/\?/,yc=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;n.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=n.trim(b+"");return e&&!n.trim(e.replace(yc,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():n.error("Invalid JSON: "+b)},n.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var zc,Ac,Bc=/#.*$/,Cc=/([?&])_=[^&]*/,Dc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ec=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Fc=/^(?:GET|HEAD)$/,Gc=/^\/\//,Hc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ic={},Jc={},Kc="*/".concat("*");try{Ac=location.href}catch(Lc){Ac=z.createElement("a"),Ac.href="",Ac=Ac.href}zc=Hc.exec(Ac.toLowerCase())||[];function Mc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(F)||[];if(n.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Nc(a,b,c,d){var e={},f=a===Jc;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Oc(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&n.extend(!0,a,c),a}function Pc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Qc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ac,type:"GET",isLocal:Ec.test(zc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Kc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Oc(Oc(a,n.ajaxSettings),b):Oc(n.ajaxSettings,a)},ajaxPrefilter:Mc(Ic),ajaxTransport:Mc(Jc),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=n.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?n(l):n.event,o=n.Deferred(),p=n.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!j){j={};while(b=Dc.exec(f))j[b[1].toLowerCase()]=b[2]}b=j[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return i&&i.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||Ac)+"").replace(Bc,"").replace(Gc,zc[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=n.trim(k.dataType||"*").toLowerCase().match(F)||[""],null==k.crossDomain&&(c=Hc.exec(k.url.toLowerCase()),k.crossDomain=!(!c||c[1]===zc[1]&&c[2]===zc[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(zc[3]||("http:"===zc[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=n.param(k.data,k.traditional)),Nc(Ic,k,b,v),2===t)return v;h=k.global,h&&0===n.active++&&n.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!Fc.test(k.type),e=k.url,k.hasContent||(k.data&&(e=k.url+=(xc.test(e)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=Cc.test(e)?e.replace(Cc,"$1_="+wc++):e+(xc.test(e)?"&":"?")+"_="+wc++)),k.ifModified&&(n.lastModified[e]&&v.setRequestHeader("If-Modified-Since",n.lastModified[e]),n.etag[e]&&v.setRequestHeader("If-None-Match",n.etag[e])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+Kc+"; q=0.01":""):k.accepts["*"]);for(d in k.headers)v.setRequestHeader(d,k.headers[d]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(d in{success:1,error:1,complete:1})v[d](k[d]);if(i=Nc(Jc,k,b,v)){v.readyState=1,h&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,i.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,c,d){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),i=void 0,f=d||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,c&&(u=Pc(k,v,c)),u=Qc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(n.lastModified[e]=w),w=v.getResponseHeader("etag"),w&&(n.etag[e]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,h&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),h&&(m.trigger("ajaxComplete",[v,k]),--n.active||n.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){if(n.isFunction(a))return this.each(function(b){n(this).wrapAll(a.call(this,b))});if(this[0]){var b=n(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(n.isFunction(a)?function(b){n(this).wrapInner(a.call(this,b))}:function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!l.reliableHiddenOffsets()&&"none"===(a.style&&a.style.display||n.css(a,"display"))},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var Rc=/%20/g,Sc=/\[\]$/,Tc=/\r?\n/g,Uc=/^(?:submit|button|image|reset|file)$/i,Vc=/^(?:input|select|textarea|keygen)/i;function Wc(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||Sc.test(a)?d(a,e):Wc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Wc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Wc(c,a[c],b,e);return d.join("&").replace(Rc,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&Vc.test(this.nodeName)&&!Uc.test(a)&&(this.checked||!X.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(Tc,"\r\n")}}):{name:b.name,value:c.replace(Tc,"\r\n")}}).get()}}),n.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&$c()||_c()}:$c;var Xc=0,Yc={},Zc=n.ajaxSettings.xhr();a.ActiveXObject&&n(a).on("unload",function(){for(var a in Yc)Yc[a](void 0,!0)}),l.cors=!!Zc&&"withCredentials"in Zc,Zc=l.ajax=!!Zc,Zc&&n.ajaxTransport(function(a){if(!a.crossDomain||l.cors){var b;return{send:function(c,d){var e,f=a.xhr(),g=++Xc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)void 0!==c[e]&&f.setRequestHeader(e,c[e]+"");f.send(a.hasContent&&a.data||null),b=function(c,e){var h,i,j;if(b&&(e||4===f.readyState))if(delete Yc[g],b=void 0,f.onreadystatechange=n.noop,e)4!==f.readyState&&f.abort();else{j={},h=f.status,"string"==typeof f.responseText&&(j.text=f.responseText);try{i=f.statusText}catch(k){i=""}h||!a.isLocal||a.crossDomain?1223===h&&(h=204):h=j.text?200:404}j&&d(h,i,j,f.getAllResponseHeaders())},a.async?4===f.readyState?setTimeout(b):f.onreadystatechange=Yc[g]=b:b()},abort:function(){b&&b(void 0,!0)}}}});function $c(){try{return new a.XMLHttpRequest}catch(b){}}function _c(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=z.head||n("head")[0]||z.documentElement;return{send:function(d,e){b=z.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var ad=[],bd=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=ad.pop()||n.expando+"_"+wc++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(bd.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&bd.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(bd,"$1"+e):b.jsonp!==!1&&(b.url+=(xc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,ad.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||z;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=n.buildFragment([a],b,e),e&&e.length&&n(e).remove(),n.merge([],d.childNodes))};var cd=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&cd)return cd.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=a.slice(h,a.length),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),g.length>0&&n.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){e=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,e||[a.responseText,b,a])}),this},n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};var dd=a.document.documentElement;function ed(a){return n.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&n.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,n.contains(b,e)?(typeof e.getBoundingClientRect!==L&&(d=e.getBoundingClientRect()),c=ed(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===n.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(c=a.offset()),c.top+=n.css(a[0],"borderTopWidth",!0),c.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-n.css(d,"marginTop",!0),left:b.left-c.left-n.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||dd;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||dd})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);n.fn[a]=function(d){return W(this,function(a,d,e){var f=ed(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?n(f).scrollLeft():e,c?e:n(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=Mb(l.pixelPosition,function(a,c){return c?(c=Kb(a,b),Ib.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return W(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var fd=a.jQuery,gd=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=gd),b&&a.jQuery===n&&(a.jQuery=fd),n},typeof b===L&&(a.jQuery=a.$=n),n});

/*! jQuery UI - v1.10.4 - 2014-05-01
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.sortable.js, jquery.ui.autocomplete.js, jquery.ui.menu.js, jquery.ui.slider.js, jquery.ui.tooltip.js, jquery.ui.effect.js
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

(function(e,t){function i(t,i){var s,a,o,r=t.nodeName.toLowerCase();return"area"===r?(s=t.parentNode,a=s.name,t.href&&a&&"map"===s.nodeName.toLowerCase()?(o=e("img[usemap=#"+a+"]")[0],!!o&&n(o)):!1):(/input|select|textarea|button|object/.test(r)?!t.disabled:"a"===r?t.href||i:i)&&n(t)}function n(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var s=0,a=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(i,n){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),n&&n.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var n,s,a=e(this[0]);a.length&&a[0]!==document;){if(n=a.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(s=parseInt(a.css("zIndex"),10),!isNaN(s)&&0!==s))return s;a=a.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++s)})},removeUniqueId:function(){return this.each(function(){a.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),s=isNaN(n);return(s||n>=0)&&i(t,!s)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,n){function s(t,i,n,s){return e.each(a,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var a="Width"===n?["Left","Right"]:["Top","Bottom"],o=n.toLowerCase(),r={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?r["inner"+n].call(this):this.each(function(){e(this).css(o,s(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?r["outer"+n].call(this,t):this.each(function(){e(this).css(o,s(this,t,!0,i)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,n){var s,a=e.ui[t].prototype;for(s in n)a.plugins[s]=a.plugins[s]||[],a.plugins[s].push([i,n[s]])},call:function(e,t,i){var n,s=e.plugins[t];if(s&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(n=0;s.length>n;n++)e.options[s[n][0]]&&s[n][1].apply(e.element,i)}},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",s=!1;return t[n]>0?!0:(t[n]=1,s=t[n]>0,t[n]=0,s)}})})(jQuery);(function(t,e){var i=0,s=Array.prototype.slice,n=t.cleanData;t.cleanData=function(e){for(var i,s=0;null!=(i=e[s]);s++)try{t(i).triggerHandler("remove")}catch(o){}n(e)},t.widget=function(i,s,n){var o,a,r,h,l={},c=i.split(".")[0];i=i.split(".")[1],o=c+"-"+i,n||(n=s,s=t.Widget),t.expr[":"][o.toLowerCase()]=function(e){return!!t.data(e,o)},t[c]=t[c]||{},a=t[c][i],r=t[c][i]=function(t,i){return this._createWidget?(arguments.length&&this._createWidget(t,i),e):new r(t,i)},t.extend(r,a,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),h=new s,h.options=t.widget.extend({},h.options),t.each(n,function(i,n){return t.isFunction(n)?(l[i]=function(){var t=function(){return s.prototype[i].apply(this,arguments)},e=function(t){return s.prototype[i].apply(this,t)};return function(){var i,s=this._super,o=this._superApply;return this._super=t,this._superApply=e,i=n.apply(this,arguments),this._super=s,this._superApply=o,i}}(),e):(l[i]=n,e)}),r.prototype=t.widget.extend(h,{widgetEventPrefix:a?h.widgetEventPrefix||i:i},l,{constructor:r,namespace:c,widgetName:i,widgetFullName:o}),a?(t.each(a._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,r,i._proto)}),delete a._childConstructors):s._childConstructors.push(r),t.widget.bridge(i,r)},t.widget.extend=function(i){for(var n,o,a=s.call(arguments,1),r=0,h=a.length;h>r;r++)for(n in a[r])o=a[r][n],a[r].hasOwnProperty(n)&&o!==e&&(i[n]=t.isPlainObject(o)?t.isPlainObject(i[n])?t.widget.extend({},i[n],o):t.widget.extend({},o):o);return i},t.widget.bridge=function(i,n){var o=n.prototype.widgetFullName||i;t.fn[i]=function(a){var r="string"==typeof a,h=s.call(arguments,1),l=this;return a=!r&&h.length?t.widget.extend.apply(null,[a].concat(h)):a,r?this.each(function(){var s,n=t.data(this,o);return n?t.isFunction(n[a])&&"_"!==a.charAt(0)?(s=n[a].apply(n,h),s!==n&&s!==e?(l=s&&s.jquery?l.pushStack(s.get()):s,!1):e):t.error("no such method '"+a+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+a+"'")}):this.each(function(){var e=t.data(this,o);e?e.option(a||{})._init():t.data(this,o,new n(a,this))}),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,s){s=t(s||this.defaultElement||this)[0],this.element=t(s),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),s!==this&&(t.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===s&&this.destroy()}}),this.document=t(s.style?s.ownerDocument:s.document||s),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,s){var n,o,a,r=i;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof i)if(r={},n=i.split("."),i=n.shift(),n.length){for(o=r[i]=t.widget.extend({},this.options[i]),a=0;n.length-1>a;a++)o[n[a]]=o[n[a]]||{},o=o[n[a]];if(i=n.pop(),1===arguments.length)return o[i]===e?null:o[i];o[i]=s}else{if(1===arguments.length)return this.options[i]===e?null:this.options[i];r[i]=s}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(i,s,n){var o,a=this;"boolean"!=typeof i&&(n=s,s=i,i=!1),n?(s=o=t(s),this.bindings=this.bindings.add(s)):(n=s,s=this.element,o=this.widget()),t.each(n,function(n,r){function h(){return i||a.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof r?a[r]:r).apply(a,arguments):e}"string"!=typeof r&&(h.guid=r.guid=r.guid||h.guid||t.guid++);var l=n.match(/^(\w+)\s*(.*)$/),c=l[1]+a.eventNamespace,u=l[2];u?o.delegate(u,c,h):s.bind(c,h)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}})})(jQuery);(function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):undefined}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var s=this,n=1===i.which,a="string"==typeof this.options.cancel&&i.target.nodeName?t(i.target).closest(this.options.cancel).length:!1;return n&&!a&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){s.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return s._mouseMove(t)},this._mouseUpDelegate=function(t){return s._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0,!0)):!0}},_mouseMove:function(e){return t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(jQuery);(function(t,e){function i(t,e,i){return[parseFloat(t[0])*(p.test(t[0])?e/100:1),parseFloat(t[1])*(p.test(t[1])?i/100:1)]}function s(e,i){return parseInt(t.css(e,i),10)||0}function n(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var a,o=Math.max,r=Math.abs,l=Math.round,h=/left|center|right/,c=/top|center|bottom/,u=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,p=/%$/,f=t.fn.position;t.position={scrollbarWidth:function(){if(a!==e)return a;var i,s,n=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=n.children()[0];return t("body").append(n),i=o.offsetWidth,n.css("overflow","scroll"),s=o.offsetWidth,i===s&&(s=n[0].clientWidth),n.remove(),a=i-s},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,a="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:a?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s?i.width():i.outerWidth(),height:s?i.height():i.outerHeight()}}},t.fn.position=function(e){if(!e||!e.of)return f.apply(this,arguments);e=t.extend({},e);var a,p,g,m,v,_,b=t(e.of),y=t.position.getWithinInfo(e.within),k=t.position.getScrollInfo(y),w=(e.collision||"flip").split(" "),D={};return _=n(b),b[0].preventDefault&&(e.at="left top"),p=_.width,g=_.height,m=_.offset,v=t.extend({},m),t.each(["my","at"],function(){var t,i,s=(e[this]||"").split(" ");1===s.length&&(s=h.test(s[0])?s.concat(["center"]):c.test(s[0])?["center"].concat(s):["center","center"]),s[0]=h.test(s[0])?s[0]:"center",s[1]=c.test(s[1])?s[1]:"center",t=u.exec(s[0]),i=u.exec(s[1]),D[this]=[t?t[0]:0,i?i[0]:0],e[this]=[d.exec(s[0])[0],d.exec(s[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===e.at[0]?v.left+=p:"center"===e.at[0]&&(v.left+=p/2),"bottom"===e.at[1]?v.top+=g:"center"===e.at[1]&&(v.top+=g/2),a=i(D.at,p,g),v.left+=a[0],v.top+=a[1],this.each(function(){var n,h,c=t(this),u=c.outerWidth(),d=c.outerHeight(),f=s(this,"marginLeft"),_=s(this,"marginTop"),x=u+f+s(this,"marginRight")+k.width,C=d+_+s(this,"marginBottom")+k.height,M=t.extend({},v),T=i(D.my,c.outerWidth(),c.outerHeight());"right"===e.my[0]?M.left-=u:"center"===e.my[0]&&(M.left-=u/2),"bottom"===e.my[1]?M.top-=d:"center"===e.my[1]&&(M.top-=d/2),M.left+=T[0],M.top+=T[1],t.support.offsetFractions||(M.left=l(M.left),M.top=l(M.top)),n={marginLeft:f,marginTop:_},t.each(["left","top"],function(i,s){t.ui.position[w[i]]&&t.ui.position[w[i]][s](M,{targetWidth:p,targetHeight:g,elemWidth:u,elemHeight:d,collisionPosition:n,collisionWidth:x,collisionHeight:C,offset:[a[0]+T[0],a[1]+T[1]],my:e.my,at:e.at,within:y,elem:c})}),e.using&&(h=function(t){var i=m.left-M.left,s=i+p-u,n=m.top-M.top,a=n+g-d,l={target:{element:b,left:m.left,top:m.top,width:p,height:g},element:{element:c,left:M.left,top:M.top,width:u,height:d},horizontal:0>s?"left":i>0?"right":"center",vertical:0>a?"top":n>0?"bottom":"middle"};u>p&&p>r(i+s)&&(l.horizontal="center"),d>g&&g>r(n+a)&&(l.vertical="middle"),l.important=o(r(i),r(s))>o(r(n),r(a))?"horizontal":"vertical",e.using.call(this,t,l)}),c.offset(t.extend(M,{using:h}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,l=n-r,h=r+e.collisionWidth-a-n;e.collisionWidth>a?l>0&&0>=h?(i=t.left+l+e.collisionWidth-a-n,t.left+=l-i):t.left=h>0&&0>=l?n:l>h?n+a-e.collisionWidth:n:l>0?t.left+=l:h>0?t.left-=h:t.left=o(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,l=n-r,h=r+e.collisionHeight-a-n;e.collisionHeight>a?l>0&&0>=h?(i=t.top+l+e.collisionHeight-a-n,t.top+=l-i):t.top=h>0&&0>=l?n:l>h?n+a-e.collisionHeight:n:l>0?t.top+=l:h>0?t.top-=h:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,a=n.offset.left+n.scrollLeft,o=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,h=t.left-e.collisionPosition.marginLeft,c=h-l,u=h+e.collisionWidth-o-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-o-a,(0>i||r(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-l,(s>0||u>r(s))&&(t.left+=d+p+f))},top:function(t,e){var i,s,n=e.within,a=n.offset.top+n.scrollTop,o=n.height,l=n.isWindow?n.scrollTop:n.offset.top,h=t.top-e.collisionPosition.marginTop,c=h-l,u=h+e.collisionHeight-o-l,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-o-a,t.top+p+f+g>c&&(0>s||r(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-l,t.top+p+f+g>u&&(i>0||u>r(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,s,n,a,o=document.getElementsByTagName("body")[0],r=document.createElement("div");e=document.createElement(o?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&t.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(a in s)e.style[a]=s[a];e.appendChild(r),i=o||document.documentElement,i.insertBefore(e,i.firstChild),r.style.cssText="position: absolute; left: 10.7432222px;",n=t(r).offset().left,t.support.offsetFractions=n>10&&11>n,e.innerHTML="",i.removeChild(e)}()})(jQuery);(function(t){t.widget("ui.draggable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(t(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"original"!==this.options.helper||t.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1):!1},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return s.parents("body").length||s.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s[0]===this.element[0]||/(fixed|absolute)/.test(s.css("position"))||s.css("position","absolute"),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;return n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):"document"===n.containment?(this.containment=[0,0,t(document).width()-this.helperProportions.width-this.margins.left,(t(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):n.containment.constructor===Array?(this.containment=n.containment,undefined):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i),undefined):(this.containment=null,undefined)},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:n.scrollTop(),left:n.scrollLeft()}),{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*s}},_generatePosition:function(e){var i,s,n,a,o=this.options,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=e.pageX,h=e.pageY;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(s=this.relative_container.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,h=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,l=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s]),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i){var s=t(this).data("ui-draggable"),n=s.options,a=t.extend({},i,{item:s.element});s.sortables=[],t(n.connectToSortable).each(function(){var i=t.data(this,"ui-sortable");i&&!i.options.disabled&&(s.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",e,a))})},stop:function(e,i){var s=t(this).data("ui-draggable"),n=t.extend({},i,{item:s.element});t.each(s.sortables,function(){this.instance.isOver?(this.instance.isOver=0,s.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===s.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,n))})},drag:function(e,i){var s=t(this).data("ui-draggable"),n=this;t.each(s.sortables,function(){var a=!1,o=this;this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(a=!0,t.each(s.sortables,function(){return this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this!==o&&this.instance._intersectsWith(this.instance.containerCache)&&t.contains(o.instance.element[0],this.instance.element[0])&&(a=!1),a})),a?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(n).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=s.offset.click.top,this.instance.offset.click.left=s.offset.click.left,this.instance.offset.parent.left-=s.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=s.offset.parent.top-this.instance.offset.parent.top,s._trigger("toSortable",e),s.dropped=this.instance.element,s.currentItem=s.element,this.instance.fromOutside=s),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),s._trigger("fromSortable",e),s.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),i=t(this).data("ui-draggable").options;e.css("cursor")&&(i._cursor=e.css("cursor")),e.css("cursor",i.cursor)},stop:function(){var e=t(this).data("ui-draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i){var s=t(i.helper),n=t(this).data("ui-draggable").options;s.css("opacity")&&(n._opacity=s.css("opacity")),s.css("opacity",n.opacity)},stop:function(e,i){var s=t(this).data("ui-draggable").options;s._opacity&&t(i.helper).css("opacity",s._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("ui-draggable");e.scrollParent[0]!==document&&"HTML"!==e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var i=t(this).data("ui-draggable"),s=i.options,n=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(s.axis&&"x"===s.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-i.overflowOffset.top<s.scrollSensitivity&&(i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop-s.scrollSpeed)),s.axis&&"y"===s.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-i.overflowOffset.left<s.scrollSensitivity&&(i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft-s.scrollSpeed))):(s.axis&&"x"===s.axis||(e.pageY-t(document).scrollTop()<s.scrollSensitivity?n=t(document).scrollTop(t(document).scrollTop()-s.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<s.scrollSensitivity&&(n=t(document).scrollTop(t(document).scrollTop()+s.scrollSpeed))),s.axis&&"y"===s.axis||(e.pageX-t(document).scrollLeft()<s.scrollSensitivity?n=t(document).scrollLeft(t(document).scrollLeft()-s.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<s.scrollSensitivity&&(n=t(document).scrollLeft(t(document).scrollLeft()+s.scrollSpeed)))),n!==!1&&t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(i,e)}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("ui-draggable"),i=e.options;e.snapElements=[],t(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=t(this),s=i.offset();this!==e.element[0]&&e.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:s.top,left:s.left})})},drag:function(e,i){var s,n,a,o,r,l,h,c,u,d,p=t(this).data("ui-draggable"),g=p.options,f=g.snapTolerance,m=i.offset.left,_=m+p.helperProportions.width,v=i.offset.top,b=v+p.helperProportions.height;for(u=p.snapElements.length-1;u>=0;u--)r=p.snapElements[u].left,l=r+p.snapElements[u].width,h=p.snapElements[u].top,c=h+p.snapElements[u].height,r-f>_||m>l+f||h-f>b||v>c+f||!t.contains(p.snapElements[u].item.ownerDocument,p.snapElements[u].item)?(p.snapElements[u].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[u].item})),p.snapElements[u].snapping=!1):("inner"!==g.snapMode&&(s=f>=Math.abs(h-b),n=f>=Math.abs(c-v),a=f>=Math.abs(r-_),o=f>=Math.abs(l-m),s&&(i.position.top=p._convertPositionTo("relative",{top:h-p.helperProportions.height,left:0}).top-p.margins.top),n&&(i.position.top=p._convertPositionTo("relative",{top:c,left:0}).top-p.margins.top),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:r-p.helperProportions.width}).left-p.margins.left),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l}).left-p.margins.left)),d=s||n||a||o,"outer"!==g.snapMode&&(s=f>=Math.abs(h-v),n=f>=Math.abs(c-b),a=f>=Math.abs(r-m),o=f>=Math.abs(l-_),s&&(i.position.top=p._convertPositionTo("relative",{top:h,left:0}).top-p.margins.top),n&&(i.position.top=p._convertPositionTo("relative",{top:c-p.helperProportions.height,left:0}).top-p.margins.top),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:r}).left-p.margins.left),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[u].snapping&&(s||n||a||o||d)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[u].item})),p.snapElements[u].snapping=s||n||a||o||d)}}),t.ui.plugin.add("draggable","stack",{start:function(){var e,i=this.data("ui-draggable").options,s=t.makeArray(t(i.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});s.length&&(e=parseInt(t(s[0]).css("zIndex"),10)||0,t(s).each(function(i){t(this).css("zIndex",e+i)}),this.css("zIndex",e+s.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i){var s=t(i.helper),n=t(this).data("ui-draggable").options;s.css("zIndex")&&(n._zIndex=s.css("zIndex")),s.css("zIndex",n.zIndex)},stop:function(e,i){var s=t(this).data("ui-draggable").options;s._zIndex&&t(i.helper).css("zIndex",s._zIndex)}})})(jQuery);(function(t){function e(t,e,i){return t>e&&e+i>t}t.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?(e=arguments[0],undefined):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},t.ui.ddmanager.droppables[i.scope]=t.ui.ddmanager.droppables[i.scope]||[],t.ui.ddmanager.droppables[i.scope].push(this),i.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var e=0,i=t.ui.ddmanager.droppables[this.options.scope];i.length>e;e++)i[e]===this&&i.splice(e,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,i){"accept"===e&&(this.accept=t.isFunction(i)?i:function(t){return t.is(i)}),t.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=t.data(this,"ui-droppable");return e.options.greedy&&!e.options.disabled&&e.options.scope===s.options.scope&&e.accept.call(e.element[0],s.currentItem||s.element)&&t.ui.intersect(s,t.extend(e,{offset:e.element.offset()}),e.options.tolerance)?(n=!0,!1):undefined}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(t,i,s){if(!i.offset)return!1;var n,a,o=(t.positionAbs||t.position.absolute).left,r=(t.positionAbs||t.position.absolute).top,l=o+t.helperProportions.width,h=r+t.helperProportions.height,c=i.offset.left,u=i.offset.top,d=c+i.proportions().width,p=u+i.proportions().height;switch(s){case"fit":return o>=c&&d>=l&&r>=u&&p>=h;case"intersect":return o+t.helperProportions.width/2>c&&d>l-t.helperProportions.width/2&&r+t.helperProportions.height/2>u&&p>h-t.helperProportions.height/2;case"pointer":return n=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,a=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,e(a,u,i.proportions().height)&&e(n,c,i.proportions().width);case"touch":return(r>=u&&p>=r||h>=u&&p>=h||u>r&&h>p)&&(o>=c&&d>=o||l>=c&&d>=l||c>o&&l>d);default:return!1}},t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s,n,a=t.ui.ddmanager.droppables[e.options.scope]||[],o=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;a.length>s;s++)if(!(a[s].options.disabled||e&&!a[s].accept.call(a[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===a[s].element[0]){a[s].proportions().height=0;continue t}a[s].visible="none"!==a[s].element.css("display"),a[s].visible&&("mousedown"===o&&a[s]._activate.call(a[s],i),a[s].offset=a[s].element.offset(),a[s].proportions({width:a[s].element[0].offsetWidth,height:a[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,a,o=t.ui.intersect(e,this,this.options.tolerance),r=!o&&this.isover?"isout":o&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return t.data(this,"ui-droppable").options.scope===n}),a.length&&(s=t.data(a[0],"ui-droppable"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}}})(jQuery);(function(t){function e(t){return parseInt(t,10)||0}function i(t){return!isNaN(parseInt(t,10))}t.widget("ui.resizable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var e,i,s,n,a,o=this,r=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),e=this.handles.split(","),this.handles={},i=0;e.length>i;i++)s=t.trim(e[i]),a="ui-resizable-"+s,n=t("<div class='ui-resizable-handle "+a+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(e){var i,s,n,a;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=t(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(s=t(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,a),this._proportionallyResize()),t(this.handles[i]).length},this._renderAxis(this.element),this._handles=t(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(t(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(t(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(i){var s,n,a,o=this.options,r=this.element.position(),h=this.element;return this.resizing=!0,/absolute/.test(h.css("position"))?h.css({position:"absolute",top:h.css("top"),left:h.css("left")}):h.is(".ui-draggable")&&h.css({position:"absolute",top:r.top,left:r.left}),this._renderProxy(),s=e(this.helper.css("left")),n=e(this.helper.css("top")),o.containment&&(s+=t(o.containment).scrollLeft()||0,n+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:s,top:n},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:h.width(),height:h.height()},this.originalSize=this._helper?{width:h.outerWidth(),height:h.outerHeight()}:{width:h.width(),height:h.height()},this.originalPosition={left:s,top:n},this.sizeDiff={width:h.outerWidth()-h.width(),height:h.outerHeight()-h.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,a=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===a?this.axis+"-resize":a),h.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(e){var i,s=this.helper,n={},a=this.originalMousePosition,o=this.axis,r=this.position.top,h=this.position.left,l=this.size.width,c=this.size.height,u=e.pageX-a.left||0,d=e.pageY-a.top||0,p=this._change[o];return p?(i=p.apply(this,[e,u,d]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),this.position.top!==r&&(n.top=this.position.top+"px"),this.position.left!==h&&(n.left=this.position.left+"px"),this.size.width!==l&&(n.width=this.size.width+"px"),this.size.height!==c&&(n.height=this.size.height+"px"),s.css(n),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(n)||this._trigger("resize",e,this.ui()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,s,n,a,o,r,h,l=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&t.ui.hasScroll(i[0],"left")?0:c.sizeDiff.height,a=s?0:c.sizeDiff.width,o={width:c.helper.width()-a,height:c.helper.height()-n},r=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,h=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null,l.animate||this.element.css(t.extend(o,{top:h,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!l.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(t){var e,s,n,a,o,r=this.options;o={minWidth:i(r.minWidth)?r.minWidth:0,maxWidth:i(r.maxWidth)?r.maxWidth:1/0,minHeight:i(r.minHeight)?r.minHeight:0,maxHeight:i(r.maxHeight)?r.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,n=o.minWidth/this.aspectRatio,s=o.maxHeight*this.aspectRatio,a=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),n>o.minHeight&&(o.minHeight=n),o.maxWidth>s&&(o.maxWidth=s),o.maxHeight>a&&(o.maxHeight=a)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),i(t.left)&&(this.position.left=t.left),i(t.top)&&(this.position.top=t.top),i(t.height)&&(this.size.height=t.height),i(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,s=this.size,n=this.axis;return i(t.height)?t.width=t.height*this.aspectRatio:i(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===n&&(t.left=e.left+(s.width-t.width),t.top=null),"nw"===n&&(t.top=e.top+(s.height-t.height),t.left=e.left+(s.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,s=this.axis,n=i(t.width)&&e.maxWidth&&e.maxWidth<t.width,a=i(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=i(t.width)&&e.minWidth&&e.minWidth>t.width,r=i(t.height)&&e.minHeight&&e.minHeight>t.height,h=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(s),u=/nw|ne|n/.test(s);return o&&(t.width=e.minWidth),r&&(t.height=e.minHeight),n&&(t.width=e.maxWidth),a&&(t.height=e.maxHeight),o&&c&&(t.left=h-e.minWidth),n&&c&&(t.left=h-e.maxWidth),r&&u&&(t.top=l-e.minHeight),a&&u&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var t,e,i,s,n,a=this.helper||this.element;for(t=0;this._proportionallyResizeElements.length>t;t++){if(n=this._proportionallyResizeElements[t],!this.borderDif)for(this.borderDif=[],i=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],s=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")],e=0;i.length>e;e++)this.borderDif[e]=(parseInt(i[e],10)||0)+(parseInt(s[e],10)||0);n.css({height:a.height()-this.borderDif[0]-this.borderDif[2]||0,width:a.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).data("ui-resizable"),s=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&t.ui.hasScroll(n[0],"left")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(h,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var i,s,n,a,o,r,h,l=t(this).data("ui-resizable"),c=l.options,u=l.element,d=c.containment,p=d instanceof t?d.get(0):/parent/.test(d)?u.parent().get(0):d;p&&(l.containerElement=t(p),/document/.test(d)||d===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(i=t(p),s=[],t(["Top","Right","Left","Bottom"]).each(function(t,n){s[t]=e(i.css("padding"+n))}),l.containerOffset=i.offset(),l.containerPosition=i.position(),l.containerSize={height:i.innerHeight()-s[3],width:i.innerWidth()-s[1]},n=l.containerOffset,a=l.containerSize.height,o=l.containerSize.width,r=t.ui.hasScroll(p,"left")?p.scrollWidth:o,h=t.ui.hasScroll(p)?p.scrollHeight:a,l.parentData={element:p,left:n.left,top:n.top,width:r,height:h}))},resize:function(e){var i,s,n,a,o=t(this).data("ui-resizable"),r=o.options,h=o.containerOffset,l=o.position,c=o._aspectRatio||e.shiftKey,u={top:0,left:0},d=o.containerElement;d[0]!==document&&/static/.test(d.css("position"))&&(u=h),l.left<(o._helper?h.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-u.left),c&&(o.size.height=o.size.width/o.aspectRatio),o.position.left=r.helper?h.left:0),l.top<(o._helper?h.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),c&&(o.size.width=o.size.height*o.aspectRatio),o.position.top=o._helper?h.top:0),o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top,i=Math.abs((o._helper?o.offset.left-u.left:o.offset.left-u.left)+o.sizeDiff.width),s=Math.abs((o._helper?o.offset.top-u.top:o.offset.top-h.top)+o.sizeDiff.height),n=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css("position")),n&&a&&(i-=Math.abs(o.parentData.left)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,c&&(o.size.height=o.size.width/o.aspectRatio)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,c&&(o.size.width=o.size.height*o.aspectRatio))},stop:function(){var e=t(this).data("ui-resizable"),i=e.options,s=e.containerOffset,n=e.containerPosition,a=e.containerElement,o=t(e.helper),r=o.offset(),h=o.outerWidth()-e.sizeDiff.width,l=o.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(a.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l}),e._helper&&!i.animate&&/static/.test(a.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,s=function(e){t(e).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?s(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):t.each(i.alsoResize,function(t){s(t)})},resize:function(e,i){var s=t(this).data("ui-resizable"),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0},h=function(e,s){t(e).each(function(){var e=t(this),n=t(this).data("ui-resizable-alsoresize"),a={},o=s&&s.length?s:e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(n[e]||0)+(r[e]||0);i&&i>=0&&(a[e]=i||null)}),e.css(a)})};"object"!=typeof n.alsoResize||n.alsoResize.nodeType?h(n.alsoResize):t.each(n.alsoResize,function(t,e){h(t,e)})},stop:function(){t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,s=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).data("ui-resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).data("ui-resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e=t(this).data("ui-resizable"),i=e.options,s=e.size,n=e.originalSize,a=e.originalPosition,o=e.axis,r="number"==typeof i.grid?[i.grid,i.grid]:i.grid,h=r[0]||1,l=r[1]||1,c=Math.round((s.width-n.width)/h)*h,u=Math.round((s.height-n.height)/l)*l,d=n.width+c,p=n.height+u,f=i.maxWidth&&d>i.maxWidth,g=i.maxHeight&&p>i.maxHeight,m=i.minWidth&&i.minWidth>d,v=i.minHeight&&i.minHeight>p;i.grid=r,m&&(d+=h),v&&(p+=l),f&&(d-=h),g&&(p-=l),/^(se|s|e)$/.test(o)?(e.size.width=d,e.size.height=p):/^(ne)$/.test(o)?(e.size.width=d,e.size.height=p,e.position.top=a.top-u):/^(sw)$/.test(o)?(e.size.width=d,e.size.height=p,e.position.left=a.left-c):(p-l>0?(e.size.height=p,e.position.top=a.top-u):(e.size.height=l,e.position.top=a.top+n.height-l),d-h>0?(e.size.width=d,e.position.left=a.left-c):(e.size.width=h,e.position.left=a.left+n.width-h))}})})(jQuery);(function(t){function e(t,e,i){return t>e&&e+i>t}function i(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))}t.widget("ui.sortable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||i(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,i){"disabled"===e?(this.options[e]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):undefined}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-t(document).scrollTop()<a.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-a.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<a.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+a.scrollSpeed)),e.pageX-t(document).scrollLeft()<a.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-a.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<a.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,h=r+t.height,l=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+l>r&&h>s+l,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e(this.positionAbs.top+this.offset.click.top,t.top,t.height),s="y"===this.options.axis||e(this.positionAbs.left+this.offset.click.left,t.left,t.width),n=i&&s,o=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return n?this.floating?a&&"right"===a||"down"===o?2:1:o&&("down"===o?2:1):!1},_intersectsWithSides:function(t){var i=e(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),s=e(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),n=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&s||"left"===o&&!s:n&&("down"===n&&i||"up"===n&&!i)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],h=[],l=this._connectWith();if(l&&e)for(s=l.length-1;s>=0;s--)for(o=t(l[s]),n=o.length-1;n>=0;n--)a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&h.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(h.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,h,l,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,l=r.length;l>s;s++)h=t(r[s]),h.data(this.widgetName+"-item",a),c.push({item:h,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===s?e.currentItem.children().each(function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(n)}):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_contactContainers:function(s){var n,o,a,r,h,l,c,u,d,p,f=null,g=null;for(n=this.containers.length-1;n>=0;n--)if(!t.contains(this.currentItem[0],this.containers[n].element[0]))if(this._intersectsWith(this.containers[n].containerCache)){if(f&&t.contains(this.containers[n].element[0],f.element[0]))continue;f=this.containers[n],g=n}else this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",s,this._uiHash(this)),this.containers[n].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[g].containerCache.over||(this.containers[g]._trigger("over",s,this._uiHash(this)),this.containers[g].containerCache.over=1);else{for(a=1e4,r=null,p=f.floating||i(this.currentItem),h=p?"left":"top",l=p?"width":"height",c=this.positionAbs[h]+this.offset.click[h],o=this.items.length-1;o>=0;o--)t.contains(this.containers[g].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!p||e(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(u=this.items[o].item.offset()[h],d=!1,Math.abs(u-c)>Math.abs(u+this.items[o][l]-c)&&(d=!0,u+=this.items[o][l]),a>Math.abs(u-c)&&(a=Math.abs(u-c),r=this.items[o],this.direction=d?"up":"down"));if(!r&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[g])return;r?this._rearrange(s,r,null,!0):this._rearrange(s,null,this.containers[g].element,!0),this._trigger("change",s,this._uiHash()),this.containers[g]._trigger("change",s,this._uiHash(this)),this.currentContainer=this.containers[g],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[g]._trigger("over",s,this._uiHash(this)),this.containers[g].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===n.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===n.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})})(jQuery);(function(e){e.widget("ui.autocomplete",{version:"1.10.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,n=this.element[0].nodeName.toLowerCase(),a="textarea"===n,o="input"===n;this.isMultiLine=a?!0:o?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[a||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,s=!0,i=!0,undefined;t=!1,s=!1,i=!1;var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:t=!0,this._move("previousPage",n);break;case a.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case a.UP:t=!0,this._keyEvent("previous",n);break;case a.DOWN:t=!0,this._keyEvent("next",n);break;case a.ENTER:case a.NUMPAD_ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case a.TAB:this.menu.active&&this.menu.select(n);break;case a.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(t)return t=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),undefined;if(!i){var n=e.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(e){return s?(s=!1,e.preventDefault(),undefined):(this._searchTimeout(e),undefined)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,undefined):(clearTimeout(this.searching),this.close(e),this._change(e),undefined)}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(s){s.target===t.element[0]||s.target===i||e.contains(i,s.target)||t.close()})})},menufocus:function(t,i){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)}),undefined;var s=i.item.data("ui-autocomplete-item");!1!==this._trigger("focus",t,{item:s})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(s.value):this.liveRegion.text(s.value)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){s.xhr&&s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):undefined},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").append(e("<a>").text(i.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),this.menu.blur(),undefined):(this.menu[e](t),undefined):(this.search(null,t),undefined)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var s=RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return s.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})})(jQuery);(function(t){t.widget("ui.menu",{version:"1.10.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,t.proxy(function(t){this.options.disabled&&t.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(t){t.preventDefault()},"click .ui-state-disabled > a":function(t){t.preventDefault()},"click .ui-menu-item:has(a)":function(e){var i=t(e.target).closest(".ui-menu-item");!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&t(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){var i=t(e.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(e,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.children(".ui-menu-item").eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){t.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){t(e.target).closest(".ui-menu").length||this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=t(this);e.data("ui-menu-submenu-carat")&&e.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var s,n,a,o,r,l=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:l=!1,n=this.previousFilter||"",a=String.fromCharCode(e.keyCode),o=!1,clearTimeout(this.filterTimer),a===n?o=!0:a=n+a,r=RegExp("^"+i(a),"i"),s=this.activeMenu.children(".ui-menu-item").filter(function(){return r.test(t(this).children("a").text())}),s=o&&-1!==s.index(this.active.next())?this.active.nextAll(".ui-menu-item"):s,s.length||(a=String.fromCharCode(e.keyCode),r=RegExp("^"+i(a),"i"),s=this.activeMenu.children(".ui-menu-item").filter(function(){return r.test(t(this).children("a").text())})),s.length?(this.focus(e,s),s.length>1?(this.previousFilter=a,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}l&&e.preventDefault()},_activate:function(t){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i=this.options.icons.submenu,s=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),s.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),s=e.prev("a"),n=t("<span>").addClass("ui-menu-icon ui-icon "+i).data("ui-menu-submenu-carat",!0);s.attr("aria-haspopup","true").prepend(n),e.attr("aria-labelledby",s.attr("id"))}),e=s.add(this.element),e.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),e.children(":not(.ui-menu-item)").each(function(){var e=t(this);/[^\-\u2014\u2013\s]/.test(e.text())||e.addClass("ui-widget-content ui-menu-divider")}),e.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){"icons"===t&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(e.submenu),this._super(t,e)},focus:function(t,e){var i,s;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,a,o,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,a=this.activeMenu.scrollTop(),o=this.activeMenu.height(),r=e.height(),0>n?this.activeMenu.scrollTop(a+n):n+r>o&&this.activeMenu.scrollTop(a+n-o+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",t,{item:this.active}))},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.children(".ui-menu-item")[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())),undefined):(this.next(e),undefined)},previousPage:function(e){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.children(".ui-menu-item").first())),undefined):(this.next(e),undefined)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)}})})(jQuery);(function(t){var e=5;t.widget("ui.slider",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)o.push(a);this.handles=n.add(t(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options,i="";e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=t("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===e.range||"max"===e.range?" ui-slider-range-"+e.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var t=this.handles.add(this.range).filter("a");this._off(t),this._on(t,this._handleEvents),this._hoverable(t),this._focusable(t)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,a,o,r,l,h,u=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-u.values(e));(n>i||n===i&&(e===u._lastChangedValue||u.values(e)===c.min))&&(n=i,a=t(this),o=e)}),r=this._start(e,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,a.addClass("ui-state-active").focus(),l=a.offset(),h=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:e.pageX-l.left-a.width()/2,top:e.pageY-l.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,o,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,a;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),a=this._valueMin()+s*n,this._trimAlignValue(a)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var s,n,a;this.options.values&&this.options.values.length?(s=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&i>s||1===e&&s>i)&&(i=s),i!==this.values(e)&&(n=this.values(),n[e]=i,a=this._trigger("slide",t,{handle:this.handles[e],value:i,values:n}),s=this.values(e?0:1),a!==!1&&this.values(e,i))):i!==this.value()&&(a=this._trigger("slide",t,{handle:this.handles[e],value:i}),a!==!1&&this.value(i))},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._lastChangedValue=e,this._trigger("change",t,i)}},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),undefined):this._value()},values:function(e,i){var s,n,a;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),undefined;if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(s=this.options.values,n=arguments[0],a=0;s.length>a;a+=1)s[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),t.Widget.prototype._setOption.apply(this,arguments),e){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;n>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e,i,s,n,a,o=this.options.range,r=this.options,l=this,h=this._animateOff?!1:r.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((l.values(s)-l._valueMin())/(l._valueMax()-l._valueMin())),u["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[h?"animate":"css"](u,r.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===s&&l.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},r.animate),1===s&&l.range[h?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&l.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&l.range[h?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?100*((s-n)/(a-n)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](u,r.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},r.animate),"max"===o&&"horizontal"===this.orientation&&this.range[h?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},r.animate),"max"===o&&"vertical"===this.orientation&&this.range[h?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(i){var s,n,a,o,r=t(i.target).data("ui-slider-handle-index");switch(i.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,t(i.target).addClass("ui-state-active"),s=this._start(i,r),s===!1))return}switch(o=this.options.step,n=a=this.options.values&&this.options.values.length?this.values(r):this.value(),i.keyCode){case t.ui.keyCode.HOME:a=this._valueMin();break;case t.ui.keyCode.END:a=this._valueMax();break;case t.ui.keyCode.PAGE_UP:a=this._trimAlignValue(n+(this._valueMax()-this._valueMin())/e);break;case t.ui.keyCode.PAGE_DOWN:a=this._trimAlignValue(n-(this._valueMax()-this._valueMin())/e);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(n===this._valueMax())return;a=this._trimAlignValue(n+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(n===this._valueMin())return;a=this._trimAlignValue(n-o)}this._slide(i,r,a)},click:function(t){t.preventDefault()},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),t(e.target).removeClass("ui-state-active"))}}})})(jQuery);(function(t){function e(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))}function i(e){var i=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),s=t.trim(s.join(" ")),s?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")}var s=0;t.widget("ui.tooltip",{version:"1.10.4",options:{content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(e,i){var s=this;return"disabled"===e?(this[i?"_disable":"_enable"](),this.options[e]=i,void 0):(this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e)}),void 0)},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s[0],e.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.is("[title]")&&e.data("ui-tooltip-title",e.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))})},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._updateContent(s,e))},_updateContent:function(t,e){var i,s=this.options.content,n=this,o=e?e.type:null;return"string"==typeof s?this._open(e,t,s):(i=s.call(t[0],function(i){t.data("ui-tooltip-open")&&n._delay(function(){e&&(e.type=o),this._open(e,t,i)})}),i&&this._open(e,t,i),void 0)},_open:function(i,s,n){function o(t){l.of=t,a.is(":hidden")||a.position(l)}var a,r,h,l=t.extend({},this.options.position);if(n){if(a=this._find(s),a.length)return a.find(".ui-tooltip-content").html(n),void 0;s.is("[title]")&&(i&&"mouseover"===i.type?s.attr("title",""):s.removeAttr("title")),a=this._tooltip(s),e(s,a.attr("id")),a.find(".ui-tooltip-content").html(n),this.options.track&&i&&/^mouse/.test(i.type)?(this._on(this.document,{mousemove:o}),o(i)):a.position(t.extend({of:s},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.show&&this.options.show.delay&&(h=this.delayedShow=setInterval(function(){a.is(":visible")&&(o(l.of),clearInterval(h))},t.fx.interval)),this._trigger("open",i,{tooltip:a}),r={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var i=t.Event(e);i.currentTarget=s[0],this.close(i,!0)}},remove:function(){this._removeTooltip(a)}},i&&"mouseover"!==i.type||(r.mouseleave="close"),i&&"focusin"!==i.type||(r.focusout="close"),this._on(!0,s,r)}},close:function(e){var s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);this.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&n.attr("title",n.data("ui-tooltip-title")),i(n),o.stop(!0),this._hide(o,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),this.closing=!0,this._trigger("close",e,{tooltip:o}),this.closing=!1)},_tooltip:function(e){var i="ui-tooltip-"+s++,n=t("<div>").attr({id:i,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return t("<div>").addClass("ui-tooltip-content").appendTo(n),n.appendTo(this.document[0].body),this.tooltips[i]=e,n},_find:function(e){var i=e.data("ui-tooltip-id");return i?t("#"+i):t()},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_destroy:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s[0],e.close(n,!0),t("#"+i).remove(),s.data("ui-tooltip-title")&&(s.attr("title",s.data("ui-tooltip-title")),s.removeData("ui-tooltip-title"))})}})})(jQuery);(function(t,e){var i="ui-effects-";t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=h(),n=s._rgba=[];return i=i.toLowerCase(),f(l,function(t,a){var o,r=a.re.exec(i),l=r&&a.parse(r),h=a.space||"rgba";return l?(o=s[h](l),s[c[h].cache]=o[c[h].cache],n=s._rgba=o._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,a.transparent),s):a[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var a,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],h=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=h.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),h.fn=t.extend(h.prototype,{parse:function(n,o,r,l){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(o),o=e);var u=this,d=t.type(n),p=this._rgba=[];return o!==e&&(n=[n,o,r,l],d="array"),"string"===d?this.parse(s(n)||a._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof h?f(c,function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}):f(c,function(e,s){var a=s.cache;f(s.props,function(t,e){if(!u[a]&&s.to){if("alpha"===t||null==n[t])return;u[a]=s.to(u._rgba)}u[a][e.idx]=i(n[t],e,!0)}),u[a]&&0>t.inArray(null,u[a].slice(0,3))&&(u[a][3]=1,s.from&&(u._rgba=s.from(u[a])))}),this):e},is:function(t){var i=h(t),s=!0,n=this;return f(c,function(t,a){var o,r=i[a.cache];return r&&(o=n[a.cache]||a.to&&a.to(n._rgba)||[],f(a.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=h(t),n=s._space(),a=c[n],o=0===this.alpha()?h("transparent"):this,r=o[a.cache]||a.to(o._rgba),l=r.slice();return s=s[a.cache],f(a.props,function(t,n){var a=n.idx,o=r[a],h=s[a],c=u[n.type]||{};null!==h&&(null===o?l[a]=h:(c.mod&&(h-o>c.mod/2?o+=c.mod:o-h>c.mod/2&&(o-=c.mod)),l[a]=i((h-o)*e+o,n)))}),this[n](l)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=h(e)._rgba;return h(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),h.fn.parse.prototype=h.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,a=t[2]/255,o=t[3],r=Math.max(s,n,a),l=Math.min(s,n,a),h=r-l,c=r+l,u=.5*c;return e=l===r?0:s===r?60*(n-a)/h+360:n===r?60*(a-s)/h+120:60*(s-n)/h+240,i=0===h?0:.5>=u?h/c:h/(2-c),[Math.round(e)%360,i,u,null==o?1:o]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],a=t[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*n(r,o,e+1/3)),Math.round(255*n(r,o,e)),Math.round(255*n(r,o,e-1/3)),a]},f(c,function(s,n){var a=n.props,o=n.cache,l=n.to,c=n.from;h.fn[s]=function(s){if(l&&!this[o]&&(this[o]=l(this._rgba)),s===e)return this[o].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[o].slice();return f(a,function(t,e){var s=u["object"===r?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?(n=h(c(d)),n[o]=d,n):h(d)},f(a,function(e,i){h.fn[e]||(h.fn[e]=function(n){var a,o=t.type(n),l="alpha"===e?this._hsla?"hsla":"rgba":s,h=this[l](),c=h[i.idx];return"undefined"===o?c:("function"===o&&(n=n.call(this,c),o=t.type(n)),null==n&&i.empty?this:("string"===o&&(a=r.exec(n),a&&(n=c+parseFloat(a[2])*("+"===a[1]?1:-1))),h[i.idx]=n,this[l](h)))})})}),h.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var a,o,r="";if("transparent"!==n&&("string"!==t.type(n)||(a=s(n)))){if(n=h(a||n),!d.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&o&&o.style;)try{r=t.css(o,"backgroundColor"),o=o.parentNode}catch(l){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(l){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=h(e.elem,i),e.end=h(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},h.hook(o),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},a=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function i(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(a[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a}function s(e,i){var s,n,o={};for(s in i)n=i[s],e[s]!==n&&(a[s]||(t.fx.step[s]||!isNaN(parseFloat(n)))&&(o[s]=n));return o}var n=["add","remove","toggle"],a={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(jQuery.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(e,a,o,r){var l=t.speed(a,o,r);return this.queue(function(){var a,o=t(this),r=o.attr("class")||"",h=l.children?o.find("*").addBack():o;h=h.map(function(){var e=t(this);return{el:e,start:i(this)}}),a=function(){t.each(n,function(t,i){e[i]&&o[i+"Class"](e[i])})},a(),h=h.map(function(){return this.end=i(this.el[0]),this.diff=s(this.start,this.end),this}),o.attr("class",r),h=h.map(function(){var e=this,i=t.Deferred(),s=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,h.get()).done(function(){a(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(o[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,a){return s?t.effects.animateClass.call(this,{add:i},s,n,a):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,a){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,a):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(i){return function(s,n,a,o,r){return"boolean"==typeof n||n===e?a?t.effects.animateClass.call(this,n?{add:s}:{remove:s},a,o,r):i.apply(this,arguments):t.effects.animateClass.call(this,{toggle:s},n,a,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,a){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,a)}})}(),function(){function s(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function n(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}t.extend(t.effects,{version:"1.10.4",save:function(t,e){for(var s=0;e.length>s;s++)null!==e[s]&&t.data(i+e[s],t[0].style[e[s]])},restore:function(t,s){var n,a;for(a=0;s.length>a;a++)null!==s[a]&&(n=t.data(i+s[a]),n===e&&(n=""),t.css(s[a],n))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},a=document.activeElement;try{a.id}catch(o){a=document.body}return e.wrap(s),(e[0]===a||t.contains(e[0],a))&&t(a).focus(),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var a=e.cssUnit(i);a[0]>0&&(n[i]=a[0]*s+a[1])}),n}}),t.fn.extend({effect:function(){function e(e){function s(){t.isFunction(a)&&a.call(n[0]),t.isFunction(e)&&e()}var n=t(this),a=i.complete,r=i.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),s()):o.call(n[0],i,s)}var i=s.apply(this,arguments),n=i.mode,a=i.queue,o=t.effects.effect[i.effect];return t.fx.off||!o?n?this[n](i.duration,i.complete):this.each(function(){i.complete&&i.complete.call(this)}):a===!1?this.each(e):this.queue(a||"fx",e)},show:function(t){return function(e){if(n(e))return t.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="show",this.effect.call(this,i)}}(t.fn.show),hide:function(t){return function(e){if(n(e))return t.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)}}(t.fn.hide),toggle:function(t){return function(e){if(n(e)||"boolean"==typeof e)return t.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="toggle",this.effect.call(this,i)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}()})(jQuery);
(function(f,D,N,U){function mb(a){this.foreach=function(j,l,p){if(Object.prototype.toString.call(j)==="[object Object]")for(var m in j)Object.prototype.hasOwnProperty.call(j,m)&&l.call(p,j[m],m,j);else{m=0;for(var n=j.length;m<n;m++)l.call(p,j[m],m,j)}};this.options=function(j,l){for(var p in l)j[p]=l[p];return j}({zone:"#wrapper",elements:"a",selectedClass:"ds-active",key:false,moreUsing:"shiftKey",enabled:true,start:null,stop:null,onSelect:null,onDeselect:null},a||{});this.on=false;var b=this;this.enable=function(){if(this.on)throw new Error(this.constructor.name+" :: is alredy enabled");this.zone=Array.prototype.slice.call(N.querySelectorAll(this.options.zone),0);if(!this.zone)throw new Error(this.constructor.name+" :: no zone defined in options. Please use element with ID");this.items=N.querySelectorAll(this.options.zone+" "+this.options.elements);this.disable();this.zone.forEach(function(j){j.addEventListener("mousedown",b.rectOpen)});this.on=true;return this};this.disable=function(){this.zone.forEach(function(j){j.removeEventListener("mousedown",b.rectOpen)});this.on=false;return this};var c=function(j){j=j.getBoundingClientRect();return{top:j.top+N.body.scrollTop,left:j.left+N.body.scrollLeft}};this.suspend=function(j){j.preventDefault();j.stopPropagation();return false};this.rectOpen=function(j){b.options.start&&b.options.start(j);if(!(b.options.key&&!j[b.options.key]||j.which!==1)){N.body.classList.add("s-noselect");b.foreach(b.items,function(p){p.addEventListener("click",b.suspend,true);j[b.options.moreUsing]||p.classList.remove(b.options.selectedClass)});b.ipos=[j.pageX,j.pageY];if(!g()){var l=N.createElement("div");l.id="s-rectBox";l.style.left=j.pageX+"px";l.style.top=j.pageY+"px";N.body.appendChild(l)}N.body.addEventListener("mousemove",b.rectDraw);N.body.addEventListener("mouseup",b.select)}};var g=function(){return N.getElementById("s-rectBox")},h=function(j,l){var p=c(j).top,m=c(j).left,n=c(l).top,q=c(l).left;return!(p+j.offsetHeight<n||p>n+l.offsetHeight||m+j.offsetWidth<q||m>q+l.offsetWidth)};this.select=function(j){var l=g();if(l){delete b.ipos;N.body.classList.remove("s-noselect");N.body.removeEventListener("mousemove",b.rectDraw);N.body.removeEventListener("mouseup",b.select);var p=b.options.selectedClass;b.foreach(b.items,function(m){if(h(l,m)===true)if(m.classList.contains(p)){m.classList.remove(p);b.options.onDeselect&&b.options.onDeselect(m)}else{m.classList.add(p);b.options.onSelect&&b.options.onSelect(m)}setTimeout(function(){m.removeEventListener("click",b.suspend,true)},100)});l.parentNode.removeChild(l);b.options.stop&&b.options.stop(j)}};this.rectDraw=function(j){var l=g();if(!(!b.ipos||l===null)){var p=b.ipos[0],m=b.ipos[1],n=j.pageX,q=j.pageY;if(p>n){j=n;n=p;p=j}if(m>q){j=q;q=m;m=j}l.style.left=p+"px";l.style.top=m+"px";l.style.width=n-p+"px";l.style.height=q-m+"px"}};this.options.selectables=this;if(this.options.enabled)return this.enable();return this}function qa(a){if(Xa){var b=Array.prototype.slice.apply(arguments,[1]),c=new Date;c=c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+"."+c.getMilliseconds();b[0]=c+" - "+b[0];try{switch(a){case"info":D.console.info.apply(D.console,b);break;case"warn":D.console.warn.apply(D.console,b);break;default:D.console.log.apply(D.console,b);break}}catch(g){D.console||(Xa=false)}}}function Ya(){Array.prototype.unshift.apply(arguments,["debug"]);qa.apply(this,arguments)}function nb(a){if(/^mailto:/.test(a))return false;return a.indexOf("@")!==-1}function Za(a,b,c){c=c.substring(a[b-2].pos,a[b-1].pos);if(c.length>=2&&c.charAt(0)==="<"&&c.charAt(c.length-1)===">")c=c.substr(1,c.length-
2);if(nb(c))c="mailto:"+c;a[b-2].node.href=c}function ob(a){var b=[""];b.index=a.length;b.input=a;return b}function pb(a,b){if(/Konqueror/.test(navigator.userAgent))if(!b.konquered){for(var c=0;c<b.length;c++)for(var g=0;g<b[c].length;g++){var h=b[c][g][0];if(h.source==="$")h.exec=ob}b.konquered=true}var j=N.createElement("a"),l=N.createElement("span"),p=[],m=0,n=[],q=0,t=null;c=function(I,J){I=I.length;if(I!==0){if(!J){var M=n.length;if(M!==0){M=n[M-1];M[3]||(J=M[1])}}if(t!==J){if(t){p[m++]={pos:q};t==="sh_url"&&Za(p,m,a)}if(J){M=J==="sh_url"?j.cloneNode(false):l.cloneNode(false);M.className=J;p[m++]={node:M,pos:q}}}q+=I;t=J}};g=/\r\n|\r|\n/g;g.lastIndex=0;for(h=a.length;q<h;){var v=q,x,z;z=g.exec(a);if(z===null)z=x=h;else{x=z.index;z=g.lastIndex}x=a.substring(v,x);for(var A=[];;){var B=q-v,C;C=n.length;C=C===0?0:n[C-1][2];var F=b[C],P=F.length,K=A[C];K||(K=A[C]=[]);C=null;for(var Q=-1,O=0;O<P;O++){var G;if(O<K.length&&(K[O]===null||B<=K[O].index))G=K[O];else{G=F[O][0];G.lastIndex=B;G=G.exec(x);K[O]=G}if(G!==null&&(C===null||G.index<C.index)){C=G;Q=O;if(G.index===B)break}}if(C===null){c(x.substring(B),null);break}else{C.index>B&&c(x.substring(B,C.index),null);B=F[Q];F=B[1];if(F instanceof Array)for(K=0;K<F.length;K++){P=C[K+1];c(P,F[K])}else{P=C[0];c(P,F)}switch(B[2]){case-1:break;case-2:n.pop();break;case-3:n.length=0;break;default:n.push(B);break}}}if(t){p[m++]={pos:q};t==="sh_url"&&Za(p,m,a);t=null}q=z}return p}function ab(a){var b=[];if((a=a.className)&&a.length>0){a=a.split(" ");for(var c=0;c<a.length;c++)a[c].length>0&&b.push(a[c])}return b}function qb(a,b){for(var c=ab(a),g=0;g<c.length;g++)if(b.toLowerCase()===c[g].toLowerCase())return;c.push(b);a.className=c.join(" ")}function bb(a,b){for(var c=a.length,g=0;g<c;g++){var h=a.item(g);switch(h.nodeType){case 1:if(h.nodeName.toLowerCase()==="br"){h=/MSIE/.test(navigator.userAgent)?"\r":"\n";b.text.push(h);b.pos++}else{b.tags.push({node:h.cloneNode(false),pos:b.pos});bb(h.childNodes,b);b.tags.push({pos:b.pos})}break;case 3:case 4:b.text.push(h.data);b.pos+=h.length;break}}}function rb(a,b){var c={};c.text=[];c.tags=b;c.pos=0;bb(a.childNodes,c);return c.text.join("")}function sb(a,b){var c=a.length;if(c===0)return b;var g=b.length;if(g===0)return a;for(var h=[],j=0,l=0;j<c&&l<g;){var p=a[j],m=b[l];if(p.pos<=m.pos){h.push(p);j++}else{h.push(m);if(b[l+1].pos<=p.pos){l++;h.push(b[l]);l++}else{h.push({pos:p.pos});b[l]={node:m.node.cloneNode(false),pos:p.pos}}}}for(;j<c;){h.push(a[j]);j++}for(;l<g;){h.push(b[l]);l++}return h}function tb(a,b){for(var c=N,g=N.createDocumentFragment(),h=0,j=a.length,l=0,p=b.length,m=g;l<p||h<j;){var n,q;if(h<j){n=a[h];q=n.pos}else q=p;if(q<=l){if(n.node){q=n.node;m.appendChild(q);m=q}else m=m.parentNode;h++}else{m.appendChild(c.createTextNode(b.substring(l,q)));l=q}}return g}function cb(a,b){qb(a,"sh_sourceCode");var c=[],g=rb(a,c);b=pb(g,b);c=sb(c,b);for(g=tb(c,g);a.hasChildNodes();)a.removeChild(a.firstChild);a.appendChild(g)}function ub(){if(D.ActiveXObject)return new ActiveXObject("Msxml2.XMLHTTP");else if(D.XMLHttpRequest)return new XMLHttpRequest;throw"No XMLHttpRequest implementation available";}function vb(a,b,c,g){if(a in Ga)Ga[a].push(b);else{Ga[a]=[b];var h=ub();h.open("GET",c+"sh_"+a+g,true);h.onreadystatechange=function(){if(h.readyState===4)try{if(!h.status||h.status===200){eval(h.responseText);for(var j=Ga[a],l=0;l<j.length;l++)cb(j[l],sh_languages[a])}else throw"HTTP error: status "+h.status;}finally{h=null}};h.send(null)}}function wb(a,b){for(var c=N.getElementsByTagName("pre"),g=0;g<c.length;g++)for(var h=c.item(g),j=ab(h),l=0;l<j.length;l++){var p=j[l].toLowerCase();if(p!=="sh_sourcecode")if(p.substr(0,3)==="sh_"){j=p.substring(3);if(j in sh_languages)cb(h,sh_languages[j]);else if(typeof a==="string"&&typeof b==="string")vb(j,h,a,b);else throw'Found <pre> element with class="'+p+'", but no such language exists';break}}}var ga=function(){};ga.extend=function(a,b){var c=ga.prototype.extend;ga._prototyping=true;var g=new this;c.call(g,a);delete ga._prototyping;var h=g.constructor,j=g.constructor=function(){if(!ga._prototyping)if(this._constructing||this.constructor==j){this._constructing=true;h.apply(this,arguments);delete this._constructing}else if(arguments[0]!=null)return(arguments[0].extend||c).call(arguments[0],g)};j.ancestor=this;j.extend=this.extend;j.forEach=this.forEach;j.implement=this.implement;j.prototype=g;j.toString=this.toString;j.valueOf=function(l){return l=="object"?j:h.valueOf()};c.call(j,b);typeof j.init=="function"&&j.init();return j};ga.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&typeof b=="function"&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var g=b.valueOf();b=function(){var n=this.base||ga.prototype.base;this.base=c;var q=g.apply(this,arguments);this.base=n;return q};b.valueOf=function(n){return n=="object"?b:g};b.toString=ga.toString}this[a]=b}else if(a){var h=ga.prototype.extend;if(!ga._prototyping&&typeof this!="function")h=this.extend||h;for(var j={toSource:null},l=["constructor","toString","valueOf"],p=ga._prototyping?0:1;m=l[p++];)a[m]!=j[m]&&h.call(this,m,a[m]);for(var m in a)j[m]||h.call(this,m,a[m])}return this},base:function(){}};ga=ga.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var g in a)this.prototype[g]===U&&b.call(c,a[g],g,a)},implement:function(){for(var a=0;a<arguments.length;a++)typeof arguments[a]=="function"?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});D.Base=ga;(function(a){function b(z,A,B){var C=[];B||(B={});a.each(z,function(F,P){C.push([F,P])});C.sort(function(F,P){var K=F[0].toLowerCase(),Q=P[0].toLowerCase();if(B[F[0]])K=B[F[0]];if(B[P[0]])Q=B[P[0]];if(K<Q)return-1;if(K>Q)return 1;return 0});a.each(C,function(F,P){A(P[0],P[1])})}function c(z){return z.then(function(A){var B=a.Deferred();setTimeout(function(){B.resolve(A)},0);return B})}function g(z,A,B){return z.then(function(C){var F=[];a.each(C,function(K,Q){F.push([K,Q])});d=a.Deferred().resolve(F);var P=[];for(C=0;C<F.length;C+=B)(function(K){d=c(d.then(function(Q){for(Q=0;Q<B&&K+Q<F.length;Q++){var O=A(F[K+Q][0],F[K+Q][1]);O!==U&&P.push(O)}return a.Deferred().resolve(P)}))})(C);return d})}function h(z,A){return z.then(function(B){A();return a.Deferred().resolve(B)})}function j(z,A,B){var C="",F=U;if(!B.letter)B.letter=[];for(var P=0;P<z.length;P++){if(P<B.letter.length)F=B.letter[P];C+=F?A.letter[F]:z.substr(P,1)}return C}function l(z){for(var A=0,B=0;B<z.length;B++){A+=z[B][0];z[B][0]=A?z[B-1].substr(0,A):"";z[B]=z[B][0]+
z[B][1]}return z}function p(z){var A=U,B=[];if(!a.isArray(z))return z;for(var C=0;C<z.length;C++)if(z[C]<0)for(var F=0;F<-z[C];F++)B.push(A);else{B.push(z[C]);A=z[C]}return B}function m(z,A){var B=[];a.each(z,function(P,K){for(var Q=U,O=0;O<A;O++){if(O<K.length)Q=K[O];B[O]||(B[O]={});B[O][P]=Q}});var C=null;a.each(B,function(P,K){if(C){var Q=0;a.each(z,function(O){if(O!="letter")if(C[O]||K[O])if(!C[O]||!K[O]||C[O]!=K[O])Q=1});if(!Q)K.__repeat=1}C=K});var F=[];a.each(B,function(P,K){if(K.__repeat)F[F.length-
1].__len++;else{K.__len=1;F.push(K)}});return F}function n(z,A,B){var C="span",F="span";if(A.href){C="a class='sequence_info' draggable='false'";F="a"}if(A.tag){C=z.tag[A.tag];F=z.tag[A.tag]}a.each(["href","title","style"],function(P,K){if(A[K])C+=" "+K+'="'+z[K][A[K]]+'"'});return"<"+C+">"+B+"</"+F+">"}function q(z,A,B){z=j(z,A,B);B=m(B,z.length);var C=0,F="";a.each(B,function(P,K){F+=n(A,K,z.substr(C,K.__len));C+=K.__len});return F}function t(z,A){var B=z.closest(".initial_panel"),C=z.parents(".js_panel").find(".ad-markup-loading");z=z.parents(".js_panel").find(".ad-markup-loaded");var F=B.data("number");F||(F=0);F+=A;B.data("number",F);if(F){z.hide();C.show()}else{z.show();C.hide()}}function v(z,A,B){var C=z.parents(".js_panel").find("._adornment_key"),F=C.data("data");F||(F={});A&&a.each(A,function(O,G){if(!F[O]||F[O]===-1)F[O]={};O=="_messages"?a.each(G,function(I,J){F[O][J]=1}):a.each(G,function(I,J){F[O][I]=J})});delete F["Basic Annotation"];var P=0;a.each(F,function(){P=1});P||(F["Basic Annotation"]=-1);a.each(F,function(O,G){G==-1&&delete F[O]});a.each(B,function(O,G){F[G]||(F[G]=-1)});C.data("data",F);var K="";b(F,function(O,G){if(O!="_messages"){var I="";if(G===-1)I+='<li><span class="ad-loading">loading</span></li>';else b(G,function(J,M){I+='<li><span class="adorn-key-entry" style="';I+=M["default"]?"background-color:"+M["default"]+";":"";I+=M.label?"color:"+M.label+";":"";I+=M.extra_css?M.extra_css:"";I+='">';if(M.title){I+='<span title="'+M.title+'"';I+=M.label?' style="border-color:'+M.label+'"':"";I+=">"+M.text+
"</span>"}else I+=M.text;I+="</span></li>"});if(I){O=O.substr(0,1).toUpperCase()+O.substr(1);O=O.replace(/([\/-])/g,"$1 ");K+="<dt>"+O+"</dt><dd><ul>"+I+"</ul></dd>"}}},{other:"~"});var Q="";F._messages&&a.each(F._messages,function(O){Q+="<li>"+O+"</li>"});A="";K+='<dt>Markup</dt><dd><ul><li><span class="ad-markup-loading ad-loading">loading</span><span class="ad-markup-loaded" style="display: none">loaded</span></li></ul></dd>';C=z.parents(".js_panel").find("._adornment_key");if(K)A+="<dl>"+K+"</dl>";if(Q)A+='<ul class="alignment-key">'+Q+"</ul>";C.html(A).toggle(!!A).find("span[title]").helptip();t(z,0)}function x(z,A,B){var C=a(z);if(C.hasClass("adornment-running")&&!B||C.hasClass("adornment-done"))return a.Deferred().resolve(0);var F=C.wrap("<div></div>").parent();C.addClass("adornment-running");B||(B=a.parseJSON(a(".adornment-data",z).text()));v(C,null,B.expect||B.provisional.expect);var P;P=B.url?a.Deferred().resolve(B.provisional):a.Deferred().resolve(B);P=P.then(function(K){a.each(K.ref,function(Q){K.ref[Q]=l(K.ref[Q])});a.each(K.seq,function(Q){a.isPlainObject(K.seq[Q])&&a.each(K.seq[Q],function(O){K.seq[Q][O]=p(K.seq[Q][O])})});K.seq=p(K.seq);return g(a.Deferred().resolve(K.seq),function(Q,O){if(O){var G=a(".adorn-"+Q,z);if(G.length){var I={};a.each(K.flourishes,function(J,M){M=M[Q];var T=a(".ad-"+J+"-"+Q,z);if(M&&T.length)I[J]=[T,a.parseJSON(M).v]});return[G,G.text(),K.ref,O,I]}else return U}},1E3,"a")});P=g(P,function(K,Q){K=q(Q[1],Q[2],Q[3]);return[Q[0],K,Q[4]]},1E3,"b");P=g(P,function(K,Q){Q[0].html(Q[1]);a.each(Q[2],function(O,G){G[0].html(G[1])})},1E3,"c");P=h(P,function(){a(".adornment-data",z).remove();C.appendTo(F);v(C,B.legend||B.provisional.legend,B.expect||B.provisional.expect)});P=B.url?P.then(function(){var K=C.parents(".adornment-load");if(!K.length||!K.hasClass("adornment-loaded")){K.addClass("adornment-loaded");a.paced_ajax({dataType:"html",url:B.url}).then(function(Q){var O=C;if(K.length)O=K.get(0);O=a(".adornment",O).addBack(".adornment");Q=a(".adornment-data",Q);for(var G=0;G<O.length;G++)x(O[G],A,a.parseJSON(a(Q[G]).text()));t(C,-1)});t(C,1)}}):h(P,function(){C.addClass("adornment-done");C.removeClass("adornment-running");C.closest(".initial_panel").find(".markup-loading").html("Finished")});return P=P.then(function(){A(z)})}a.fn.adorn=function(z){this.each(function(A,B){c(x(B,z))});return d}})(jQuery);(function(a){a.fn.afterimage=function(){var b=this;a(D).load(function(){$el=a(b);$el.each(function(){a("._afterimage",$el).each(function(){var c=a("<img/>").attr({"class":a(this).attr("class"),src:a(this).data("url")});a(this).replaceWith(c)})})})};a("html").afterimage()})(jQuery);(function(a){a.ajaxPrefilter(function(b){if(b.comet)return"comet"});a.ajaxTransport("comet",function(b,c){function g(){a(form).remove();a(h).off("load").attr("src","javascript:false;").remove();h=form=null;delete D[l][j]}var h=null,j="cIframe_"+a.now(),l="cUpdate";b.dataTypes.shift();D[l]||(D[l]={});D[l][j]=function(){(b.update||a.noop).apply(b.context||D,arguments)};form=a("<form>",function(n){if(n.method.match(/post/i))n.enctype="multipart/form-data";return n}({action:b.url,name:j,target:j,method:b.type||"POST"}));c=c.data||[];if(!a.isArray(c)){var p=[];if(!a.isPlainObject(c)){var m={};a.each(c.split("&|;"),function(n,q){q=q.split("=");m[q[0]]=decodeURIComponent(q[1].replace(/\+/g,"%20"))});c=m;m=null}a.each(c,function(n,q){p.push({name:n,value:q})});c=p;p=null}a.each(a.merge([{name:"X-Requested-With",value:"iframe"},{name:"X-Comet-Request",value:"true"},{name:"_cupdate",value:"parent."+l+"."+j}],c),function(n,q){a('<input type="hidden" />').attr(q).appendTo(form)});return{send:function(n,q){h=a('<iframe name="'+j+'" id="'+j+'" src="javascript:false;" style="display:none">').on("load.initial",function(){h.off("load").on("load",function(){var t=a(this.contentWindow?this.contentWindow.document:this.contentDocument?this.contentDocument:this.document).find("body");g();q(200,"OK",{html:t.html(),text:t.text()},null)});form[0].submit()});a("body").append(form,h);h.triggerHandler("load.initial")},abort:g}})})(jQuery);(function(a,b,c){a.fn.dataTableSettings=[];var g=a.fn.dataTableSettings;a.fn.dataTableExt={};var h=a.fn.dataTableExt;h.sVersion="1.8.1";h.sErrMode="alert";h.iApiIndex=0;h.oApi={};h.afnFiltering=[];h.aoFeatures=[];h.ofnSearch={};h.afnSortData=[];h.oStdClasses={sPagePrevEnabled:"paginate_enabled_previous",sPagePrevDisabled:"paginate_disabled_previous",sPageNextEnabled:"paginate_enabled_next",sPageNextDisabled:"paginate_disabled_next",sPageJUINext:"",sPageJUIPrev:"",sPageButton:"paginate_button",sPageButtonActive:"paginate_active",sPageButtonStaticDisabled:"paginate_button paginate_button_disabled",sPageFirst:"first",sPagePrevious:"previous",sPageNext:"next",sPageLast:"last",sStripOdd:"odd",sStripEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sFooterTH:""};h.oJUIClasses={sPagePrevEnabled:"fg-button ui-button ui-state-default ui-corner-left",sPagePrevDisabled:"fg-button ui-button ui-state-default ui-corner-left ui-state-disabled",sPageNextEnabled:"fg-button ui-button ui-state-default ui-corner-right",sPageNextDisabled:"fg-button ui-button ui-state-default ui-corner-right ui-state-disabled",sPageJUINext:"ui-icon ui-icon-circle-arrow-e",sPageJUIPrev:"ui-icon ui-icon-circle-arrow-w",sPageButton:"fg-button ui-button ui-state-default",sPageButtonActive:"fg-button ui-button ui-state-default ui-state-disabled",sPageButtonStaticDisabled:"fg-button ui-button ui-state-default ui-state-disabled",sPageFirst:"first ui-corner-tl ui-corner-bl",sPagePrevious:"previous",sPageNext:"next",sPageLast:"last ui-corner-tr ui-corner-br",sStripOdd:"odd",sStripEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"ui-state-default",sSortDesc:"ui-state-default",sSortable:"ui-state-default",sSortableAsc:"ui-state-default",sSortableDesc:"ui-state-default",sSortableNone:"ui-state-default",sSortColumn:"sorting_",sSortJUIAsc:"css_right ui-icon ui-icon-triangle-1-n",sSortJUIDesc:"css_right ui-icon ui-icon-triangle-1-s",sSortJUI:"css_right ui-icon ui-icon-carat-2-n-s",sSortJUIAscAllowed:"css_right ui-icon ui-icon-carat-1-n",sSortJUIDescAllowed:"css_right ui-icon ui-icon-carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead ui-state-default",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot ui-state-default",sScrollFootInner:"dataTables_scrollFootInner",sFooterTH:"ui-state-default"};h.oPagination={two_button:{fnInit:function(j,l,p){var m,n,q;if(j.bJUI){m=c.createElement("a");n=c.createElement("a");q=c.createElement("span");q.className=j.oClasses.sPageJUINext;n.appendChild(q);q=c.createElement("span");q.className=j.oClasses.sPageJUIPrev;m.appendChild(q)}else{m=c.createElement("div");n=c.createElement("div")}m.className=j.oClasses.sPagePrevDisabled;n.className=j.oClasses.sPageNextDisabled;m.title=j.oLanguage.oPaginate.sPrevious;n.title=j.oLanguage.oPaginate.sNext;l.appendChild(m);l.appendChild(n);a(m).on("click.DT",function(){j.oApi._fnPageChange(j,"previous")&&p(j)});a(n).on("click.DT",function(){j.oApi._fnPageChange(j,"next")&&p(j)});a(m).on("selectstart.DT",function(){return false});a(n).on("selectstart.DT",function(){return false});if(j.sTableId!==""&&typeof j.aanFeatures.p=="undefined"){l.setAttribute("id",j.sTableId+"_paginate");m.setAttribute("id",j.sTableId+"_previous");n.setAttribute("id",j.sTableId+"_next")}},fnUpdate:function(j){if(j.aanFeatures.p)for(var l=j.aanFeatures.p,p=0,m=l.length;p<m;p++)if(l[p].childNodes.length!==0){l[p].childNodes[0].className=j._iDisplayStart===0?j.oClasses.sPagePrevDisabled:j.oClasses.sPagePrevEnabled;l[p].childNodes[1].className=j.fnDisplayEnd()==j.fnRecordsDisplay()?j.oClasses.sPageNextDisabled:j.oClasses.sPageNextEnabled}}},iFullNumbersShowPages:5,full_numbers:{fnInit:function(j,l,p){var m=c.createElement("span"),n=c.createElement("span"),q=c.createElement("span"),t=c.createElement("span"),v=c.createElement("span");m.innerHTML=j.oLanguage.oPaginate.sFirst;n.innerHTML=j.oLanguage.oPaginate.sPrevious;t.innerHTML=j.oLanguage.oPaginate.sNext;v.innerHTML=j.oLanguage.oPaginate.sLast;var x=j.oClasses;m.className=x.sPageButton+" "+x.sPageFirst;n.className=x.sPageButton+" "+x.sPagePrevious;t.className=x.sPageButton+" "+x.sPageNext;v.className=x.sPageButton+
" "+x.sPageLast;l.appendChild(m);l.appendChild(n);l.appendChild(q);l.appendChild(t);l.appendChild(v);a(m).on("click.DT",function(){j.oApi._fnPageChange(j,"first")&&p(j)});a(n).on("click.DT",function(){j.oApi._fnPageChange(j,"previous")&&p(j)});a(t).on("click.DT",function(){j.oApi._fnPageChange(j,"next")&&p(j)});a(v).on("click.DT",function(){j.oApi._fnPageChange(j,"last")&&p(j)});a("span",l).on("mousedown.DT",function(){return false}).on("selectstart.DT",function(){return false});if(j.sTableId!==""&&typeof j.aanFeatures.p=="undefined"){l.setAttribute("id",j.sTableId+"_paginate");m.setAttribute("id",j.sTableId+"_first");n.setAttribute("id",j.sTableId+"_previous");t.setAttribute("id",j.sTableId+"_next");v.setAttribute("id",j.sTableId+"_last")}},fnUpdate:function(j,l){if(j.aanFeatures.p){var p=h.oPagination.iFullNumbersShowPages,m=Math.floor(p/2),n=Math.ceil(j.fnRecordsDisplay()/j._iDisplayLength),q=Math.ceil(j._iDisplayStart/j._iDisplayLength)+1,t="",v,x=j.oClasses;if(n<p){m=1;v=n}else if(q<=m){m=1;v=p}else if(q>=n-m){m=n-p+1;v=n}else{m=q-Math.ceil(p/2)+1;v=m+p-1}for(p=m;p<=v;p++)t+=q!=p?'<span class="'+x.sPageButton+'">'+p+"</span>":'<span class="'+x.sPageButtonActive+'">'+p+"</span>";v=j.aanFeatures.p;var z,A=function(C){j._iDisplayStart=(this.innerHTML*1-1)*j._iDisplayLength;l(j);C.preventDefault()},B=function(){return false};p=0;for(m=v.length;p<m;p++)if(v[p].childNodes.length!==0){z=a("span:eq(2)",v[p]);z.html(t);a("span",z).on("click.DT",A).on("mousedown.DT",B).on("selectstart.DT",B);z=v[p].getElementsByTagName("span");z=[z[0],z[1],z[z.length-2],z[z.length-1]];a(z).removeClass(x.sPageButton+" "+x.sPageButtonActive+" "+x.sPageButtonStaticDisabled);if(q==1){z[0].className+=" "+x.sPageButtonStaticDisabled;z[1].className+=" "+x.sPageButtonStaticDisabled}else{z[0].className+=" "+x.sPageButton;z[1].className+=" "+x.sPageButton}if(n===0||q==n||j._iDisplayLength==-1){z[2].className+=" "+x.sPageButtonStaticDisabled;z[3].className+=" "+x.sPageButtonStaticDisabled}else{z[2].className+=" "+
x.sPageButton;z[3].className+=" "+x.sPageButton}}}}}};h.oSort={"string-asc":function(j,l){if(typeof j!="string")j="";if(typeof l!="string")l="";j=j.toLowerCase();l=l.toLowerCase();return j<l?-1:j>l?1:0},"string-desc":function(j,l){if(typeof j!="string")j="";if(typeof l!="string")l="";j=j.toLowerCase();l=l.toLowerCase();return j<l?1:j>l?-1:0},"html-asc":function(j,l){j=j.replace(/<.*?>/g,"").toLowerCase();l=l.replace(/<.*?>/g,"").toLowerCase();return j<l?-1:j>l?1:0},"html-desc":function(j,l){j=j.replace(/<.*?>/g,"").toLowerCase();l=l.replace(/<.*?>/g,"").toLowerCase();return j<l?1:j>l?-1:0},"date-asc":function(j,l){j=Date.parse(j);l=Date.parse(l);if(isNaN(j)||j==="")j=Date.parse("01/01/1970 00:00:00");if(isNaN(l)||l==="")l=Date.parse("01/01/1970 00:00:00");return j-l},"date-desc":function(j,l){j=Date.parse(j);l=Date.parse(l);if(isNaN(j)||j==="")j=Date.parse("01/01/1970 00:00:00");if(isNaN(l)||l==="")l=Date.parse("01/01/1970 00:00:00");return l-j},"numeric-asc":function(j,l){return(j=="-"||j===""?0:j*1)-(l=="-"||l===""?0:l*1)},"numeric-desc":function(j,l){return(l=="-"||l===""?0:l*1)-(j=="-"||j===""?0:j*1)}};h.aTypes=[function(j){if(typeof j=="number")return"numeric";else if(typeof j!="string")return null;var l,p=false;l=j.charAt(0);if("0123456789-".indexOf(l)==-1)return null;for(var m=1;m<j.length;m++){l=j.charAt(m);if("0123456789.".indexOf(l)==-1)return null;if(l=="."){if(p)return null;p=true}}return"numeric"},function(j){var l=Date.parse(j);if(l!==null&&!isNaN(l)||typeof j=="string"&&j.length===0)return"date";return null},function(j){if(typeof j=="string"&&j.indexOf("<")!=-1&&j.indexOf(">")!=-1)return"html";return null}];h.fnVersionCheck=function(j){var l=function(v,x){for(;v.length<x;)v+="0";return v},p=h.sVersion.split(".");j=j.split(".");for(var m="",n="",q=0,t=j.length;q<t;q++){m+=l(p[q],3);n+=l(j[q],3)}return parseInt(m,10)>=parseInt(n,10)};h._oExternConfig={iNextUnique:0};a.fn.dataTable=function(j){function l(){this.fnRecordsTotal=function(){return this.oFeatures.bServerSide?parseInt(this._iRecordsTotal,10):this.aiDisplayMaster.length};this.fnRecordsDisplay=function(){return this.oFeatures.bServerSide?parseInt(this._iRecordsDisplay,10):this.aiDisplay.length};this.fnDisplayEnd=function(){return this.oFeatures.bServerSide?this.oFeatures.bPaginate===false||this._iDisplayLength==-1?this._iDisplayStart+this.aiDisplay.length:Math.min(this._iDisplayStart+this._iDisplayLength,this._iRecordsDisplay):this._iDisplayEnd};this.sInstance=this.oInstance=null;this.oFeatures={bPaginate:true,bLengthChange:true,bFilter:true,bSort:true,bInfo:true,bAutoWidth:true,bProcessing:false,bSortClasses:true,bStateSave:false,bServerSide:false,bDeferRender:false};this.oScroll={sX:"",sXInner:"",sY:"",bCollapse:false,bInfinite:false,iLoadGap:100,iBarWidth:0,bAutoCss:true};this.aanFeatures=[];this.oLanguage={sProcessing:"Processing...",sLengthMenu:"Show _MENU_ entries",sZeroRecords:"No matching records found",sEmptyTable:"No data available in table",sLoadingRecords:"Loading...",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sSearch:"Search:",sUrl:"",oPaginate:{sFirst:"First",sPrevious:"Previous",sNext:"Next",sLast:"Last"},fnInfoCallback:null};this.aoData=[];this.aiDisplay=[];this.aiDisplayMaster=[];this.aoColumns=[];this.aoHeader=[];this.aoFooter=[];this.iNextId=0;this.asDataSearch=[];this.oPreviousSearch={sSearch:"",bRegex:false,bSmart:true};this.aoPreSearchCols=[];this.aaSorting=[[0,"asc",0]];this.aaSortingFixed=null;this.asStripClasses=[];this.asDestoryStrips=[];this.sDestroyWidth=0;this.fnFooterCallback=this.fnHeaderCallback=this.fnRowCallback=null;this.aoDrawCallback=[];this.fnInitComplete=this.fnPreDrawCallback=null;this.sTableId="";this.nTableWrapper=this.nTBody=this.nTFoot=this.nTHead=this.nTable=null;this.bInitialised=this.bDeferLoading=false;this.aoOpenRows=[];this.sDom="lfrtip";this.sPaginationType="two_button";this.iCookieDuration=7200;this.sCookiePrefix="SpryMedia_DataTables_";this.fnCookieCallback=null;this.aoStateSave=[];this.aoStateLoad=[];this.sAjaxSource=this.oLoadedState=null;this.sAjaxDataProp="aaData";this.bAjaxDataGet=true;this.jqXHR=null;this.fnServerData=function(k,r,s,u){u.jqXHR=a.ajax({url:k,data:r,success:s,dataType:"json",cache:false,error:function(y,w){w=="parsererror"&&alert("DataTables warning: JSON data from server could not be parsed. This is caused by a JSON formatting error.")}})};this.fnFormatNumber=function(k){if(k<1E3)return k;else{var r=k+"";k=r.split("");var s="";r=r.length;for(var u=0;u<r;u++){if(u%3===0&&u!==0)s=","+s;s=k[r-u-1]+s}}return s};this.aLengthMenu=[10,25,50,100];this.bDrawing=this.iDraw=0;this.iDrawError=-1;this._iDisplayLength=10;this._iDisplayStart=0;this._iDisplayEnd=10;this._iRecordsDisplay=this._iRecordsTotal=0;this.bJUI=false;this.oClasses=h.oStdClasses;this.bSortCellsTop=this.bSorted=this.bFiltered=false;this.oInit=null}function p(k){return function(){var r=[fa(this[h.iApiIndex])].concat(Array.prototype.slice.call(arguments));return h.oApi[k].apply(this,r)}}function m(k){var r,s,u=k.iInitDisplayStart;if(k.bInitialised===false)setTimeout(function(){m(k)},200);else{O(k);B(k);C(k,k.aoHeader);k.nTFoot&&C(k,k.aoFooter);oa(k,true);k.oFeatures.bAutoWidth&&Ma(k);r=0;for(s=k.aoColumns.length;r<s;r++)if(k.aoColumns[r].sWidth!==null)k.aoColumns[r].nTh.style.width=ba(k.aoColumns[r].sWidth);if(k.oFeatures.bSort)ca(k);else if(k.oFeatures.bFilter)T(k,k.oPreviousSearch);else{k.aiDisplay=k.aiDisplayMaster.slice();ja(k);F(k)}if(k.sAjaxSource!==null&&!k.oFeatures.bServerSide)k.fnServerData.call(k.oInstance,k.sAjaxSource,[],function(y){var w=y;if(k.sAjaxDataProp!=="")w=Ha(k.sAjaxDataProp)(y);for(r=0;r<w.length;r++)x(k,w[r]);k.iInitDisplayStart=u;if(k.oFeatures.bSort)ca(k);else{k.aiDisplay=k.aiDisplayMaster.slice();ja(k);F(k)}oa(k,false);n(k,y)},k);else if(!k.oFeatures.bServerSide){oa(k,false);n(k)}}}function n(k,r){k._bInitComplete=true;if(typeof k.fnInitComplete=="function")typeof r!="undefined"?k.fnInitComplete.call(k.oInstance,k,r):k.fnInitComplete.call(k.oInstance,k)}function q(k,r,s){S(k.oLanguage,r,"sProcessing");S(k.oLanguage,r,"sLengthMenu");S(k.oLanguage,r,"sEmptyTable");S(k.oLanguage,r,"sLoadingRecords");S(k.oLanguage,r,"sZeroRecords");S(k.oLanguage,r,"sInfo");S(k.oLanguage,r,"sInfoEmpty");S(k.oLanguage,r,"sInfoFiltered");S(k.oLanguage,r,"sInfoPostFix");S(k.oLanguage,r,"sSearch");if(typeof r.oPaginate!="undefined"){S(k.oLanguage.oPaginate,r.oPaginate,"sFirst");S(k.oLanguage.oPaginate,r.oPaginate,"sPrevious");S(k.oLanguage.oPaginate,r.oPaginate,"sNext");S(k.oLanguage.oPaginate,r.oPaginate,"sLast")}typeof r.sEmptyTable=="undefined"&&typeof r.sZeroRecords!="undefined"&&S(k.oLanguage,r,"sZeroRecords","sEmptyTable");typeof r.sLoadingRecords=="undefined"&&typeof r.sZeroRecords!="undefined"&&S(k.oLanguage,r,"sZeroRecords","sLoadingRecords");s&&m(k)}function t(k,r){var s=k.aoColumns.length;r={sType:null,_bAutoType:true,bVisible:true,bSearchable:true,bSortable:true,asSorting:["asc","desc"],sSortingClass:k.oClasses.sSortable,sSortingClassJUI:k.oClasses.sSortJUI,sTitle:r?r.innerHTML:"",sName:"",sWidth:null,sWidthOrig:null,sClass:null,fnRender:null,bUseRendered:true,iDataSort:s,mDataProp:s,fnGetData:null,fnSetData:null,sSortDataType:"std",sDefaultContent:null,sContentPadding:"",nTh:r?r:c.createElement("th"),nTf:null};k.aoColumns.push(r);if(typeof k.aoPreSearchCols[s]=="undefined"||k.aoPreSearchCols[s]===null)k.aoPreSearchCols[s]={sSearch:"",bRegex:false,bSmart:true};else{if(typeof k.aoPreSearchCols[s].bRegex=="undefined")k.aoPreSearchCols[s].bRegex=true;if(typeof k.aoPreSearchCols[s].bSmart=="undefined")k.aoPreSearchCols[s].bSmart=true}v(k,s,null)}function v(k,r,s){r=k.aoColumns[r];if(typeof s!="undefined"&&s!==null){if(typeof s.sType!="undefined"){r.sType=s.sType;r._bAutoType=false}S(r,s,"bVisible");S(r,s,"bSearchable");S(r,s,"bSortable");S(r,s,"sTitle");S(r,s,"sName");S(r,s,"sWidth");S(r,s,"sWidth","sWidthOrig");S(r,s,"sClass");S(r,s,"fnRender");S(r,s,"bUseRendered");S(r,s,"iDataSort");S(r,s,"mDataProp");S(r,s,"asSorting");S(r,s,"sSortDataType");S(r,s,"sDefaultContent");S(r,s,"sContentPadding")}r.fnGetData=Ha(r.mDataProp);r.fnSetData=db(r.mDataProp);if(!k.oFeatures.bSort)r.bSortable=false;if(!r.bSortable||a.inArray("asc",r.asSorting)==-1&&a.inArray("desc",r.asSorting)==-1){r.sSortingClass=k.oClasses.sSortableNone;r.sSortingClassJUI=""}else if(r.bSortable||a.inArray("asc",r.asSorting)==-1&&a.inArray("desc",r.asSorting)==-1){r.sSortingClass=k.oClasses.sSortable;r.sSortingClassJUI=k.oClasses.sSortJUI}else if(a.inArray("asc",r.asSorting)!=-1&&a.inArray("desc",r.asSorting)==-1){r.sSortingClass=k.oClasses.sSortableAsc;r.sSortingClassJUI=k.oClasses.sSortJUIAscAllowed}else if(a.inArray("asc",r.asSorting)==-1&&a.inArray("desc",r.asSorting)!=-1){r.sSortingClass=k.oClasses.sSortableDesc;r.sSortingClassJUI=k.oClasses.sSortJUIDescAllowed}}function x(k,r){var s;s=typeof r.length=="number"?r.slice():a.extend(true,{},r);r=k.aoData.length;var u={nTr:null,_iId:k.iNextId++,_aData:s,_anHidden:[],_sRowStripe:""};k.aoData.push(u);for(var y,w=0,E=k.aoColumns.length;w<E;w++){s=k.aoColumns[w];typeof s.fnRender=="function"&&s.bUseRendered&&s.mDataProp!==null&&ra(k,r,w,s.fnRender({iDataRow:r,iDataColumn:w,aData:u._aData,oSettings:k}));if(s._bAutoType&&s.sType!="string"){y=la(k,r,w,"type");if(y!==null&&y!==""){y=Na(y);if(s.sType===null)s.sType=y;else if(s.sType!=y)s.sType="string"}}}k.aiDisplayMaster.push(r);k.oFeatures.bDeferRender||z(k,r);return r}function z(k,r){var s=k.aoData[r],u;if(s.nTr===null){s.nTr=c.createElement("tr");typeof s._aData.DT_RowId!="undefined"&&s.nTr.setAttribute("id",s._aData.DT_RowId);typeof s._aData.DT_RowClass!="undefined"&&a(s.nTr).addClass(s._aData.DT_RowClass);for(var y=0,w=k.aoColumns.length;y<w;y++){var E=k.aoColumns[y];u=c.createElement("td");u.innerHTML=typeof E.fnRender=="function"&&(!E.bUseRendered||E.mDataProp===null)?E.fnRender({iDataRow:r,iDataColumn:y,aData:s._aData,oSettings:k}):la(k,r,y,"display");if(E.sClass!==null)u.className=E.sClass;if(E.bVisible){s.nTr.appendChild(u);s._anHidden[y]=null}else s._anHidden[y]=u}}}function A(k){var r,s,u,y,w,E,H,L,R;if(k.bDeferLoading||k.sAjaxSource===null){H=k.nTBody.childNodes;r=0;for(s=H.length;r<s;r++)if(H[r].nodeName.toUpperCase()=="TR"){L=k.aoData.length;k.aoData.push({nTr:H[r],_iId:k.iNextId++,_aData:[],_anHidden:[],_sRowStripe:""});k.aiDisplayMaster.push(L);E=H[r].childNodes;u=w=0;for(y=E.length;u<y;u++){R=E[u].nodeName.toUpperCase();if(R=="TD"||R=="TH"){ra(k,L,w,a.trim(E[u].innerHTML));w++}}}}H=Ia(k);E=[];r=0;for(s=H.length;r<s;r++){u=0;for(y=H[r].childNodes.length;u<y;u++){w=H[r].childNodes[u];R=w.nodeName.toUpperCase();if(R=="TD"||R=="TH")E.push(w)}}E.length!=H.length*k.aoColumns.length&&pa(k,1,"Unexpected number of TD elements. Expected "+H.length*k.aoColumns.length+" and got "+E.length+". DataTables does not support rowspan / colspan in the table body, and there must be one cell for each row/column combination.");u=0;for(y=k.aoColumns.length;u<y;u++){if(k.aoColumns[u].sTitle===null)k.aoColumns[u].sTitle=k.aoColumns[u].nTh.innerHTML;H=k.aoColumns[u]._bAutoType;R=typeof k.aoColumns[u].fnRender=="function";w=k.aoColumns[u].sClass!==null;L=k.aoColumns[u].bVisible;var Z,X;if(H||R||w||!L){r=0;for(s=k.aoData.length;r<s;r++){Z=E[r*y+u];if(H&&k.aoColumns[u].sType!="string"){X=la(k,r,u,"type");if(X!==""){X=Na(X);if(k.aoColumns[u].sType===null)k.aoColumns[u].sType=X;else if(k.aoColumns[u].sType!=X)k.aoColumns[u].sType="string"}}if(R){X=k.aoColumns[u].fnRender({iDataRow:r,iDataColumn:u,aData:k.aoData[r]._aData,oSettings:k});Z.innerHTML=X;k.aoColumns[u].bUseRendered&&ra(k,r,u,X)}if(w)Z.className+=" "+k.aoColumns[u].sClass;if(L)k.aoData[r]._anHidden[u]=null;else{k.aoData[r]._anHidden[u]=Z;Z.parentNode.removeChild(Z)}}}}}function B(k){var r,s,u;k.nTHead.getElementsByTagName("tr");if(k.nTHead.getElementsByTagName("th").length!==0){r=0;for(u=k.aoColumns.length;r<u;r++){s=k.aoColumns[r].nTh;k.aoColumns[r].sClass!==null&&a(s).addClass(k.aoColumns[r].sClass);if(k.aoColumns[r].sTitle!=s.innerHTML)s.innerHTML=k.aoColumns[r].sTitle}}else{var y=c.createElement("tr");r=0;for(u=k.aoColumns.length;r<u;r++){s=k.aoColumns[r].nTh;s.innerHTML=k.aoColumns[r].sTitle;k.aoColumns[r].sClass!==null&&a(s).addClass(k.aoColumns[r].sClass);y.appendChild(s)}a(k.nTHead).html("")[0].appendChild(y);Da(k.aoHeader,k.nTHead)}if(k.bJUI){r=0;for(u=k.aoColumns.length;r<u;r++){s=k.aoColumns[r].nTh;y=c.createElement("div");y.className=k.oClasses.sSortJUIWrapper;a(s).contents().appendTo(y);var w=c.createElement("span");w.className=k.oClasses.sSortIcon;y.appendChild(w);s.appendChild(y)}}u=function(){this.onselectstart=function(){return false};return false};if(k.oFeatures.bSort)for(r=0;r<k.aoColumns.length;r++)if(k.aoColumns[r].bSortable!==false){ha(k,k.aoColumns[r].nTh,r);a(k.aoColumns[r].nTh).on("mousedown.DT",u)}else a(k.aoColumns[r].nTh).addClass(k.oClasses.sSortableNone);k.oClasses.sFooterTH!==""&&a(">tr>th",k.nTFoot).addClass(k.oClasses.sFooterTH);if(k.nTFoot!==null){s=xa(k,null,k.aoFooter);r=0;for(u=k.aoColumns.length;r<u;r++)if(typeof s[r]!="undefined")k.aoColumns[r].nTf=s[r]}}function C(k,r,s){var u,y,w,E=[],H=[],L=k.aoColumns.length;if(typeof s=="undefined")s=false;u=0;for(y=r.length;u<y;u++){E[u]=r[u].slice();E[u].nTr=r[u].nTr;for(w=L-1;w>=0;w--)!k.aoColumns[w].bVisible&&!s&&E[u].splice(w,1);H.push([])}u=0;for(y=E.length;u<y;u++){if(E[u].nTr){k=0;for(w=E[u].nTr.childNodes.length;k<w;k++)E[u].nTr.removeChild(E[u].nTr.childNodes[0])}w=0;for(r=E[u].length;w<r;w++){L=s=1;if(typeof H[u][w]=="undefined"){E[u].nTr.appendChild(E[u][w].cell);for(H[u][w]=1;typeof E[u+s]!="undefined"&&E[u][w].cell==E[u+s][w].cell;){H[u+s][w]=1;s++}for(;typeof E[u][w+L]!="undefined"&&E[u][w].cell==E[u][w+L].cell;){for(k=0;k<s;k++)H[u+k][w+L]=1;L++}E[u][w].cell.setAttribute("rowspan",s);E[u][w].cell.setAttribute("colspan",L)}}}}function F(k){var r,s,u=[],y=0,w=false;r=k.asStripClasses.length;s=k.aoOpenRows.length;if(!(k.fnPreDrawCallback!==null&&k.fnPreDrawCallback.call(k.oInstance,k)===false)){k.bDrawing=true;if(typeof k.iInitDisplayStart!="undefined"&&k.iInitDisplayStart!=-1){k._iDisplayStart=k.oFeatures.bServerSide?k.iInitDisplayStart:k.iInitDisplayStart>=k.fnRecordsDisplay()?0:k.iInitDisplayStart;k.iInitDisplayStart=-1;ja(k)}if(k.bDeferLoading){k.bDeferLoading=false;k.iDraw++}else if(k.oFeatures.bServerSide){if(!k.bDestroying&&!K(k))return}else k.iDraw++;if(k.aiDisplay.length!==0){var E=k._iDisplayStart,H=k._iDisplayEnd;if(k.oFeatures.bServerSide){E=0;H=k.aoData.length}for(E=E;E<H;E++){var L=k.aoData[k.aiDisplay[E]];L.nTr===null&&z(k,k.aiDisplay[E]);var R=L.nTr;if(r!==0){var Z=k.asStripClasses[y%r];if(L._sRowStripe!=Z){a(R).removeClass(L._sRowStripe).addClass(Z);L._sRowStripe=Z}}if(typeof k.fnRowCallback=="function"){R=k.fnRowCallback.call(k.oInstance,R,k.aoData[k.aiDisplay[E]]._aData,y,E);if(!R&&!w){pa(k,0,"A node was not returned by fnRowCallback");w=true}}u.push(R);y++;if(s!==0)for(L=0;L<s;L++)R==k.aoOpenRows[L].nParent&&u.push(k.aoOpenRows[L].nTr)}}else{u[0]=c.createElement("tr");if(typeof k.asStripClasses[0]!="undefined")u[0].className=k.asStripClasses[0];w=k.oLanguage.sZeroRecords.replace("_MAX_",k.fnFormatNumber(k.fnRecordsTotal()));if(k.iDraw==1&&k.sAjaxSource!==null&&!k.oFeatures.bServerSide)w=k.oLanguage.sLoadingRecords;else if(typeof k.oLanguage.sEmptyTable!="undefined"&&k.fnRecordsTotal()===0)w=k.oLanguage.sEmptyTable;r=c.createElement("td");r.setAttribute("valign","top");r.colSpan=Ea(k);r.className=k.oClasses.sRowEmpty;r.innerHTML=w;u[y].appendChild(r)}typeof k.fnHeaderCallback=="function"&&k.fnHeaderCallback.call(k.oInstance,a(">tr",k.nTHead)[0],Ja(k),k._iDisplayStart,k.fnDisplayEnd(),k.aiDisplay);typeof k.fnFooterCallback=="function"&&k.fnFooterCallback.call(k.oInstance,a(">tr",k.nTFoot)[0],Ja(k),k._iDisplayStart,k.fnDisplayEnd(),k.aiDisplay);y=c.createDocumentFragment();r=c.createDocumentFragment();if(k.nTBody){w=k.nTBody.parentNode;r.appendChild(k.nTBody);if(!k.oScroll.bInfinite||!k._bInitComplete||k.bSorted||k.bFiltered){s=k.nTBody.childNodes;for(r=s.length-1;r>=0;r--)s[r].parentNode.removeChild(s[r])}r=0;for(s=u.length;r<s;r++)y.appendChild(u[r]);k.nTBody.appendChild(y);w!==null&&w.appendChild(k.nTBody)}for(r=k.aoDrawCallback.length-1;r>=0;r--)k.aoDrawCallback[r].fn.call(k.oInstance,k);k.bSorted=false;k.bFiltered=false;k.bDrawing=false;if(k.oFeatures.bServerSide){oa(k,false);typeof k._bInitComplete=="undefined"&&n(k)}}}function P(k){if(k.oFeatures.bSort)ca(k,k.oPreviousSearch);else if(k.oFeatures.bFilter)T(k,k.oPreviousSearch);else{ja(k);F(k)}}function K(k){if(k.bAjaxDataGet){oa(k,true);var r=k.aoColumns.length,s=[],u,y;k.iDraw++;s.push({name:"sEcho",value:k.iDraw});s.push({name:"iColumns",value:r});s.push({name:"sColumns",value:Oa(k)});s.push({name:"iDisplayStart",value:k._iDisplayStart});s.push({name:"iDisplayLength",value:k.oFeatures.bPaginate!==false?k._iDisplayLength:-1});for(y=0;y<r;y++){u=k.aoColumns[y].mDataProp;s.push({name:"mDataProp_"+y,value:typeof u=="function"?"function":u})}if(k.oFeatures.bFilter!==false){s.push({name:"sSearch",value:k.oPreviousSearch.sSearch});s.push({name:"bRegex",value:k.oPreviousSearch.bRegex});for(y=0;y<r;y++){s.push({name:"sSearch_"+y,value:k.aoPreSearchCols[y].sSearch});s.push({name:"bRegex_"+y,value:k.aoPreSearchCols[y].bRegex});s.push({name:"bSearchable_"+y,value:k.aoColumns[y].bSearchable})}}if(k.oFeatures.bSort!==false){u=k.aaSortingFixed!==null?k.aaSortingFixed.length:0;var w=k.aaSorting.length;s.push({name:"iSortingCols",value:u+w});for(y=0;y<u;y++){s.push({name:"iSortCol_"+y,value:k.aaSortingFixed[y][0]});s.push({name:"sSortDir_"+y,value:k.aaSortingFixed[y][1]})}for(y=0;y<w;y++){s.push({name:"iSortCol_"+(y+u),value:k.aaSorting[y][0]});s.push({name:"sSortDir_"+(y+u),value:k.aaSorting[y][1]})}for(y=0;y<r;y++)s.push({name:"bSortable_"+y,value:k.aoColumns[y].bSortable})}k.fnServerData.call(k.oInstance,k.sAjaxSource,s,function(E){Q(k,E)},k);return false}else return true}function Q(k,r){if(typeof r.sEcho!="undefined")if(r.sEcho*1<k.iDraw)return;else k.iDraw=r.sEcho*1;if(!k.oScroll.bInfinite||k.oScroll.bInfinite&&(k.bSorted||k.bFiltered))Pa(k);k._iRecordsTotal=r.iTotalRecords;k._iRecordsDisplay=r.iTotalDisplayRecords;var s=Oa(k);if(s=typeof r.sColumns!="undefined"&&s!==""&&r.sColumns!=s)var u=eb(k,r.sColumns);r=Ha(k.sAjaxDataProp)(r);for(var y=0,w=r.length;y<w;y++)if(s){for(var E=[],H=0,L=k.aoColumns.length;H<L;H++)E.push(r[y][u[H]]);x(k,E)}else x(k,r[y]);k.aiDisplay=k.aiDisplayMaster.slice();k.bAjaxDataGet=false;F(k);k.bAjaxDataGet=true;oa(k,false)}function O(k){var r=c.createElement("div");k.nTable.parentNode.insertBefore(r,k.nTable);k.nTableWrapper=c.createElement("div");k.nTableWrapper.className=k.oClasses.sWrapper;k.sTableId!==""&&k.nTableWrapper.setAttribute("id",k.sTableId+"_wrapper");k.nTableReinsertBefore=k.nTable.nextSibling;for(var s=k.nTableWrapper,u=k.sDom.split(""),y,w,E,H,L,R,Z,X=0;X<u.length;X++){w=0;E=u[X];if(E=="<"){H=c.createElement("div");L=u[X+1];if(L=="'"||L=='"'){R="";for(Z=2;u[X+Z]!=L;){R+=u[X+Z];Z++}if(R=="H")R="fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix";else if(R=="F")R="fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix";if(R.indexOf(".")!=-1){L=R.split(".");H.setAttribute("id",L[0].substr(1,L[0].length-1));H.className=L[1]}else if(R.charAt(0)=="#")H.setAttribute("id",R.substr(1,R.length-1));else H.className=R;X+=Z}s.appendChild(H);s=H}else if(E==">")s=s.parentNode;else if(E=="l"&&k.oFeatures.bPaginate&&k.oFeatures.bLengthChange){y=ya(k);w=1}else if(E=="f"&&k.oFeatures.bFilter){y=M(k);w=1}else if(E=="r"&&k.oFeatures.bProcessing){y=za(k);w=1}else if(E=="t"){y=G(k);w=1}else if(E=="i"&&k.oFeatures.bInfo){y=Fa(k);w=1}else if(E=="p"&&k.oFeatures.bPaginate){y=sa(k);w=1}else if(h.aoFeatures.length!==0){H=h.aoFeatures;Z=0;for(L=H.length;Z<L;Z++)if(E==H[Z].cFeature){if(y=H[Z].fnInit(k))w=1;break}}if(w==1&&y!==null){if(typeof k.aanFeatures[E]!="object")k.aanFeatures[E]=[];k.aanFeatures[E].push(y);s.appendChild(y)}}r.parentNode.replaceChild(k.nTableWrapper,r)}function G(k){if(k.oScroll.sX===""&&k.oScroll.sY==="")return k.nTable;var r=c.createElement("div"),s=c.createElement("div"),u=c.createElement("div"),y=c.createElement("div"),w=c.createElement("div"),E=c.createElement("div"),H=k.nTable.cloneNode(false),L=k.nTable.cloneNode(false),R=k.nTable.getElementsByTagName("thead")[0],Z=k.nTable.getElementsByTagName("tfoot").length===0?null:k.nTable.getElementsByTagName("tfoot")[0],X=typeof j.bJQueryUI!="undefined"&&j.bJQueryUI?h.oJUIClasses:h.oStdClasses;s.appendChild(u);w.appendChild(E);y.appendChild(k.nTable);r.appendChild(s);r.appendChild(y);u.appendChild(H);H.appendChild(R);if(Z!==null){r.appendChild(w);E.appendChild(L);L.appendChild(Z)}r.className=X.sScrollWrapper;s.className=X.sScrollHead;u.className=X.sScrollHeadInner;y.className=X.sScrollBody;w.className=X.sScrollFoot;E.className=X.sScrollFootInner;if(k.oScroll.bAutoCss){s.style.overflow="hidden";s.style.position="relative";w.style.overflow="hidden";y.style.overflow="auto"}s.style.border="0";s.style.width="100%";w.style.border="0";u.style.width="150%";H.removeAttribute("id");H.style.marginLeft="0";k.nTable.style.marginLeft="0";if(Z!==null){L.removeAttribute("id");L.style.marginLeft="0"}u=a(">caption",k.nTable);E=0;for(L=u.length;E<L;E++)H.appendChild(u[E]);if(k.oScroll.sX!==""){s.style.width=ba(k.oScroll.sX);y.style.width=ba(k.oScroll.sX);if(Z!==null)w.style.width=ba(k.oScroll.sX);a(y).scroll(function(){s.scrollLeft=this.scrollLeft;if(Z!==null)w.scrollLeft=this.scrollLeft})}if(k.oScroll.sY!=="")y.style.height=ba(k.oScroll.sY);k.aoDrawCallback.push({fn:I,sName:"scrolling"});k.oScroll.bInfinite&&a(y).scroll(function(){if(!k.bDrawing)if(a(this).scrollTop()+a(this).height()>a(k.nTable).height()-k.oScroll.iLoadGap)if(k.fnDisplayEnd()<k.fnRecordsDisplay()){Aa(k,"next");ja(k);F(k)}});k.nScrollHead=s;k.nScrollFoot=w;return r}function I(k){var r=k.nScrollHead.getElementsByTagName("div")[0],s=r.getElementsByTagName("table")[0],u=k.nTable.parentNode,y,w,E,H,L,R,Z,X,ma=[];E=k.nTable.getElementsByTagName("thead");E.length>0&&k.nTable.removeChild(E[0]);if(k.nTFoot!==null){L=k.nTable.getElementsByTagName("tfoot");L.length>0&&k.nTable.removeChild(L[0])}E=k.nTHead.cloneNode(true);k.nTable.insertBefore(E,k.nTable.childNodes[0]);if(k.nTFoot!==null){L=k.nTFoot.cloneNode(true);k.nTable.insertBefore(L,k.nTable.childNodes[1])}if(k.oScroll.sX===""){u.style.width="100%";r.parentNode.style.width="100%"}var ta=xa(k,E);y=0;for(w=ta.length;y<w;y++){Z=Ka(k,y);ta[y].style.width=k.aoColumns[Z].sWidth}k.nTFoot!==null&&ua(function(ia){ia.style.width=""},L.getElementsByTagName("tr"));y=a(k.nTable).outerWidth();if(k.oScroll.sX===""){k.nTable.style.width="100%";if(a.browser.msie&&a.browser.version<=7)k.nTable.style.width=ba(a(k.nTable).outerWidth()-k.oScroll.iBarWidth)}else if(k.oScroll.sXInner!=="")k.nTable.style.width=ba(k.oScroll.sXInner);else if(y==a(u).width()&&a(u).height()<a(k.nTable).height()){k.nTable.style.width=ba(y-k.oScroll.iBarWidth);if(a(k.nTable).outerWidth()>y-k.oScroll.iBarWidth)k.nTable.style.width=ba(y)}else k.nTable.style.width=ba(y);y=a(k.nTable).outerWidth();if(k.oScroll.sX===""){u.style.width=ba(y+k.oScroll.iBarWidth);r.parentNode.style.width=ba(y+k.oScroll.iBarWidth)}w=k.nTHead.getElementsByTagName("tr");E=E.getElementsByTagName("tr");ua(function(ia,ka){R=ia.style;R.paddingTop="0";R.paddingBottom="0";R.borderTopWidth="0";R.borderBottomWidth="0";R.height=0;X=a(ia).width();ka.style.width=ba(X);ma.push(X)},E,w);a(E).height(0);if(k.nTFoot!==null){H=L.getElementsByTagName("tr");L=k.nTFoot.getElementsByTagName("tr");ua(function(ia,ka){R=ia.style;R.paddingTop="0";R.paddingBottom="0";R.borderTopWidth="0";R.borderBottomWidth="0";R.height=0;X=a(ia).width();ka.style.width=ba(X);ma.push(X)},H,L);a(H).height(0)}ua(function(ia){ia.innerHTML="";ia.style.width=ba(ma.shift())},E);k.nTFoot!==null&&ua(function(ia){ia.innerHTML="";ia.style.width=ba(ma.shift())},H);if(a(k.nTable).outerWidth()<y)if(k.oScroll.sX==="")pa(k,1,"The table cannot fit into the current element which will cause column misalignment. It is suggested that you enable x-scrolling or increase the width the table has in which to be drawn");else k.oScroll.sXInner!==""&&pa(k,1,"The table cannot fit into the current element which will cause column misalignment. It is suggested that you increase the sScrollXInner property to allow it to draw in a larger area, or simply remove that parameter to allow automatic calculation");if(k.oScroll.sY==="")if(a.browser.msie&&a.browser.version<=7)u.style.height=ba(k.nTable.offsetHeight+k.oScroll.iBarWidth);if(k.oScroll.sY!==""&&k.oScroll.bCollapse){u.style.height=ba(k.oScroll.sY);H=k.oScroll.sX!==""&&k.nTable.offsetWidth>u.offsetWidth?k.oScroll.iBarWidth:0;if(k.nTable.offsetHeight<u.offsetHeight)u.style.height=ba(a(k.nTable).height()+H)}H=a(k.nTable).outerWidth();s.style.width=ba(H);r.style.width=ba(H+k.oScroll.iBarWidth);if(k.nTFoot!==null){r=k.nScrollFoot.getElementsByTagName("div")[0];s=r.getElementsByTagName("table")[0];r.style.width=ba(k.nTable.offsetWidth+k.oScroll.iBarWidth);s.style.width=ba(k.nTable.offsetWidth)}if(k.bSorted||k.bFiltered)u.scrollTop=0}function J(k){if(k.oFeatures.bAutoWidth===false)return false;Ma(k);for(var r=0,s=k.aoColumns.length;r<s;r++)k.aoColumns[r].nTh.style.width=k.aoColumns[r].sWidth}function M(k){var r=k.oLanguage.sSearch;r=r.indexOf("_INPUT_")!==-1?r.replace("_INPUT_",'<input data-role="none" type="text" />'):r===""?'<input data-role="none" type="text" />':r+' <input data-role="none" type="text" />';var s=c.createElement("div");s.className=k.oClasses.sFilter;s.innerHTML="<label>"+r+"</label>";k.sTableId!==""&&typeof k.aanFeatures.f=="undefined"&&s.setAttribute("id",k.sTableId+"_filter");r=a("input",s);r.val(k.oPreviousSearch.sSearch.replace('"',"&quot;"));r.on("keyup.DT",function(){for(var u=k.aanFeatures.f,y=0,w=u.length;y<w;y++)u[y]!=this.parentNode&&a("input",u[y]).val(this.value);this.value!=k.oPreviousSearch.sSearch&&T(k,{sSearch:this.value,bRegex:k.oPreviousSearch.bRegex,bSmart:k.oPreviousSearch.bSmart})});r.on("keypress.DT",function(u){if(u.keyCode==13)return false});return s}function T(k,r,s){V(k,r.sSearch,s,r.bRegex,r.bSmart);for(r=0;r<k.aoPreSearchCols.length;r++)$(k,k.aoPreSearchCols[r].sSearch,r,k.aoPreSearchCols[r].bRegex,k.aoPreSearchCols[r].bSmart);h.afnFiltering.length!==0&&W(k);k.bFiltered=true;k._iDisplayStart=0;ja(k);F(k);aa(k,0)}function W(k){for(var r=h.afnFiltering,s=0,u=r.length;s<u;s++)for(var y=0,w=0,E=k.aiDisplay.length;w<E;w++){var H=k.aiDisplay[w-y];if(!r[s](k,La(k,H,"filter"),H)){k.aiDisplay.splice(w-y,1);y++}}}function $(k,r,s,u,y){if(r!==""){var w=0;r=Y(r,u,y);for(u=k.aiDisplay.length-1;u>=0;u--){y=ea(la(k,k.aiDisplay[u],s,"filter"),k.aoColumns[s].sType);if(!r.test(y)){k.aiDisplay.splice(u,1);w++}}}}function V(k,r,s,u,y){var w=Y(r,u,y);if(typeof s=="undefined"||s===null)s=0;if(h.afnFiltering.length!==0)s=1;if(r.length<=0){k.aiDisplay.splice(0,k.aiDisplay.length);k.aiDisplay=k.aiDisplayMaster.slice()}else if(k.aiDisplay.length==k.aiDisplayMaster.length||k.oPreviousSearch.sSearch.length>r.length||s==1||r.indexOf(k.oPreviousSearch.sSearch)!==0){k.aiDisplay.splice(0,k.aiDisplay.length);aa(k,1);for(s=0;s<k.aiDisplayMaster.length;s++)w.test(k.asDataSearch[s])&&k.aiDisplay.push(k.aiDisplayMaster[s])}else{var E=0;for(s=0;s<k.asDataSearch.length;s++)if(!w.test(k.asDataSearch[s])){k.aiDisplay.splice(s-E,1);E++}}k.oPreviousSearch.sSearch=r;k.oPreviousSearch.bRegex=u;k.oPreviousSearch.bSmart=y}function aa(k,r){k.asDataSearch.splice(0,k.asDataSearch.length);r=typeof r!="undefined"&&r==1?k.aiDisplayMaster:k.aiDisplay;for(var s=0,u=r.length;s<u;s++)k.asDataSearch[s]=da(k,La(k,r[s],"filter"))}function da(k,r){var s="";if(typeof k.__nTmpFilter=="undefined")k.__nTmpFilter=c.createElement("div");for(var u=k.__nTmpFilter,y=0,w=k.aoColumns.length;y<w;y++)if(k.aoColumns[y].bSearchable)s+=ea(r[y],k.aoColumns[y].sType)+"  ";if(s.indexOf("&")!==-1){u.innerHTML=s;s=u.textContent?u.textContent:u.innerText;s=s.replace(/\n/g," ").replace(/\r/g,"")}return s}function Y(k,r,s){if(s){k=r?k.split(" "):Qa(k).split(" ");k="^(?=.*?"+k.join(")(?=.*?")+").*$"}else k=r?k:Qa(k);return new RegExp(k,"i")}function ea(k,r){if(typeof h.ofnSearch[r]=="function")return h.ofnSearch[r](k);else if(r=="html")return k.replace(/\n/g," ").replace(/<.*?>/g,"");else if(typeof k=="string")return k.replace(/\n/g," ");else if(k===null)return"";return k}function ca(k,r){var s,u,y,w,E=[],H=[],L=h.oSort;u=k.aoData;var R=k.aoColumns;if(!k.oFeatures.bServerSide&&(k.aaSorting.length!==0||k.aaSortingFixed!==null)){E=k.aaSortingFixed!==null?k.aaSortingFixed.concat(k.aaSorting):k.aaSorting.slice();for(s=0;s<E.length;s++){var Z=E[s][0];y=Ba(k,Z);w=k.aoColumns[Z].sSortDataType;if(typeof h.afnSortData[w]!="undefined"){var X=h.afnSortData[w](k,Z,y);y=0;for(w=u.length;y<w;y++)ra(k,y,Z,X[y])}}s=0;for(u=k.aiDisplayMaster.length;s<u;s++)H[k.aiDisplayMaster[s]]=s;var ma=E.length;k.aiDisplayMaster.sort(function(ta,ia){var ka,Ra;for(s=0;s<ma;s++){ka=R[E[s][0]].iDataSort;Ra=R[ka].sType;ka=L[(Ra?Ra:"string")+"-"+E[s][1]](la(k,ta,ka,"sort"),la(k,ia,ka,"sort"));if(ka!==0)return ka}return L["numeric-asc"](H[ta],H[ia])})}if((typeof r=="undefined"||r)&&!k.oFeatures.bDeferRender)na(k);k.bSorted=true;if(k.oFeatures.bFilter)T(k,k.oPreviousSearch,1);else{k.aiDisplay=k.aiDisplayMaster.slice();k._iDisplayStart=0;ja(k);F(k)}}function ha(k,r,s,u){a(r).on("click.DT",function(y){if(k.aoColumns[s].bSortable!==false){var w=function(){var E,H;if(y.shiftKey){for(var L=false,R=0;R<k.aaSorting.length;R++)if(k.aaSorting[R][0]==s){L=true;E=k.aaSorting[R][0];H=k.aaSorting[R][2]+1;if(typeof k.aoColumns[E].asSorting[H]=="undefined")k.aaSorting.splice(R,1);else{k.aaSorting[R][1]=k.aoColumns[E].asSorting[H];k.aaSorting[R][2]=H}break}L===false&&k.aaSorting.push([s,k.aoColumns[s].asSorting[0],0])}else if(k.aaSorting.length==1&&k.aaSorting[0][0]==s){E=k.aaSorting[0][0];H=k.aaSorting[0][2]+1;if(typeof k.aoColumns[E].asSorting[H]=="undefined")H=0;k.aaSorting[0][1]=k.aoColumns[E].asSorting[H];k.aaSorting[0][2]=H}else{k.aaSorting.splice(0,k.aaSorting.length);k.aaSorting.push([s,k.aoColumns[s].asSorting[0],0])}ca(k)};if(k.oFeatures.bProcessing){oa(k,true);setTimeout(function(){w();k.oFeatures.bServerSide||oa(k,false)},0)}else w();typeof u=="function"&&u(k)}})}function na(k){var r,s,u,y,w,E=k.aoColumns.length,H=k.oClasses;for(r=0;r<E;r++)k.aoColumns[r].bSortable&&a(k.aoColumns[r].nTh).removeClass(H.sSortAsc+" "+H.sSortDesc+" "+k.aoColumns[r].sSortingClass);y=k.aaSortingFixed!==null?k.aaSortingFixed.concat(k.aaSorting):k.aaSorting.slice();for(r=0;r<k.aoColumns.length;r++)if(k.aoColumns[r].bSortable){w=k.aoColumns[r].sSortingClass;u=-1;for(s=0;s<y.length;s++)if(y[s][0]==r){w=y[s][1]=="asc"?H.sSortAsc:H.sSortDesc;u=s;break}a(k.aoColumns[r].nTh).addClass(w);if(k.bJUI){s=a("span",k.aoColumns[r].nTh);s.removeClass(H.sSortJUIAsc+" "+H.sSortJUIDesc+" "+H.sSortJUI+" "+H.sSortJUIAscAllowed+" "+H.sSortJUIDescAllowed);s.addClass(u==-1?k.aoColumns[r].sSortingClassJUI:y[u][1]=="asc"?H.sSortJUIAsc:H.sSortJUIDesc)}}else a(k.aoColumns[r].nTh).addClass(k.aoColumns[r].sSortingClass);w=H.sSortColumn;if(k.oFeatures.bSort&&k.oFeatures.bSortClasses){u=va(k);if(k.oFeatures.bDeferRender)a(u).removeClass(w+"1 "+w+"2 "+w+"3");else if(u.length>=E)for(r=0;r<E;r++)if(u[r].className.indexOf(w+"1")!=-1){s=0;for(k=u.length/E;s<k;s++)u[E*s+r].className=a.trim(u[E*s+r].className.replace(w+"1",""))}else if(u[r].className.indexOf(w+"2")!=-1){s=0;for(k=u.length/E;s<k;s++)u[E*s+r].className=a.trim(u[E*s+r].className.replace(w+"2",""))}else if(u[r].className.indexOf(w+"3")!=-1){s=0;for(k=u.length/E;s<k;s++)u[E*s+r].className=a.trim(u[E*s+r].className.replace(" "+w+"3",""))}H=1;var L;for(r=0;r<y.length;r++){L=parseInt(y[r][0],10);s=0;for(k=u.length/E;s<k;s++)u[E*s+L].className+=" "+w+H;H<3&&H++}}}function sa(k){if(k.oScroll.bInfinite)return null;var r=c.createElement("div");r.className=k.oClasses.sPaging+k.sPaginationType;h.oPagination[k.sPaginationType].fnInit(k,r,function(s){ja(s);F(s)});typeof k.aanFeatures.p=="undefined"&&k.aoDrawCallback.push({fn:function(s){h.oPagination[s.sPaginationType].fnUpdate(s,function(u){ja(u);F(u)})},sName:"pagination"});return r}function Aa(k,r){var s=k._iDisplayStart;if(r=="first")k._iDisplayStart=0;else if(r=="previous"){k._iDisplayStart=k._iDisplayLength>=0?k._iDisplayStart-k._iDisplayLength:0;if(k._iDisplayStart<0)k._iDisplayStart=0}else if(r=="next")if(k._iDisplayLength>=0){if(k._iDisplayStart+k._iDisplayLength<k.fnRecordsDisplay())k._iDisplayStart+=k._iDisplayLength}else k._iDisplayStart=0;else if(r=="last")if(k._iDisplayLength>=0){r=parseInt((k.fnRecordsDisplay()-1)/k._iDisplayLength,10)+1;k._iDisplayStart=(r-1)*k._iDisplayLength}else k._iDisplayStart=0;else pa(k,0,"Unknown paging action: "+r);return s!=k._iDisplayStart}function Fa(k){var r=c.createElement("div");r.className=k.oClasses.sInfo;if(typeof k.aanFeatures.i=="undefined"){k.aoDrawCallback.push({fn:wa,sName:"information"});k.sTableId!==""&&r.setAttribute("id",k.sTableId+"_info")}return r}function wa(k){if(!(!k.oFeatures.bInfo||k.aanFeatures.i.length===0)){var r=k._iDisplayStart+1,s=k.fnDisplayEnd(),u=k.fnRecordsTotal(),y=k.fnRecordsDisplay(),w=k.fnFormatNumber(r),E=k.fnFormatNumber(s),H=k.fnFormatNumber(u),L=k.fnFormatNumber(y);if(k.oScroll.bInfinite)w=k.fnFormatNumber(1);w=k.fnRecordsDisplay()===0&&k.fnRecordsDisplay()==k.fnRecordsTotal()?k.oLanguage.sInfoEmpty+
k.oLanguage.sInfoPostFix:k.fnRecordsDisplay()===0?k.oLanguage.sInfoEmpty+" "+k.oLanguage.sInfoFiltered.replace("_MAX_",H)+k.oLanguage.sInfoPostFix:k.fnRecordsDisplay()==k.fnRecordsTotal()?k.oLanguage.sInfo.replace("_START_",w).replace("_END_",E).replace("_TOTAL_",L)+k.oLanguage.sInfoPostFix:k.oLanguage.sInfo.replace("_START_",w).replace("_END_",E).replace("_TOTAL_",L)+" "+k.oLanguage.sInfoFiltered.replace("_MAX_",k.fnFormatNumber(k.fnRecordsTotal()))+k.oLanguage.sInfoPostFix;if(k.oLanguage.fnInfoCallback!==null)w=k.oLanguage.fnInfoCallback(k,r,s,u,y,w);k=k.aanFeatures.i;r=0;for(s=k.length;r<s;r++)a(k[r]).html(w)}}function ya(k){if(k.oScroll.bInfinite)return null;var r='<select data-role="none" size="1" '+(k.sTableId===""?"":'name="'+k.sTableId+'_length"')+">",s,u;if(k.aLengthMenu.length==2&&typeof k.aLengthMenu[0]=="object"&&typeof k.aLengthMenu[1]=="object"){s=0;for(u=k.aLengthMenu[0].length;s<u;s++)r+='<option value="'+k.aLengthMenu[0][s]+'">'+k.aLengthMenu[1][s]+"</option>"}else{s=0;for(u=k.aLengthMenu.length;s<u;s++)r+='<option value="'+k.aLengthMenu[s]+'">'+k.aLengthMenu[s]+"</option>"}r+="</select>";var y=c.createElement("div");k.sTableId!==""&&typeof k.aanFeatures.l=="undefined"&&y.setAttribute("id",k.sTableId+"_length");y.className=k.oClasses.sLength;y.innerHTML="<label>"+k.oLanguage.sLengthMenu.replace("_MENU_",r)+"</label>";a('select option[value="'+k._iDisplayLength+'"]',y).attr("selected",true);a("select",y).on("change.DT",function(){var w=a(this).val(),E=k.aanFeatures.l;s=0;for(u=E.length;s<u;s++)E[s]!=this.parentNode&&a("select",E[s]).val(w);k._iDisplayLength=parseInt(w,10);ja(k);if(k.fnDisplayEnd()==k.fnRecordsDisplay()){k._iDisplayStart=k.fnDisplayEnd()-k._iDisplayLength;if(k._iDisplayStart<0)k._iDisplayStart=0}if(k._iDisplayLength==-1)k._iDisplayStart=0;F(k)});return y}function za(k){var r=c.createElement("div");k.sTableId!==""&&typeof k.aanFeatures.r=="undefined"&&r.setAttribute("id",k.sTableId+"_processing");r.innerHTML=k.oLanguage.sProcessing;r.className=k.oClasses.sProcessing;k.nTable.parentNode.insertBefore(r,k.nTable);return r}function oa(k,r){if(k.oFeatures.bProcessing){k=k.aanFeatures.r;for(var s=0,u=k.length;s<u;s++)k[s].style.visibility=r?"visible":"hidden"}}function Ka(k,r){for(var s=-1,u=0;u<k.aoColumns.length;u++){k.aoColumns[u].bVisible===true&&s++;if(s==r)return u}return null}function Ba(k,r){for(var s=-1,u=0;u<k.aoColumns.length;u++){k.aoColumns[u].bVisible===true&&s++;if(u==r)return k.aoColumns[u].bVisible===true?s:null}return null}function Ca(k,r){var s,u;s=k._iDisplayStart;for(u=k._iDisplayEnd;s<u;s++)if(k.aoData[k.aiDisplay[s]].nTr==r)return k.aiDisplay[s];s=0;for(u=k.aoData.length;s<u;s++)if(k.aoData[s].nTr==r)return s;return null}function Ea(k){for(var r=0,s=0;s<k.aoColumns.length;s++)k.aoColumns[s].bVisible===true&&r++;return r}function ja(k){k._iDisplayEnd=k.oFeatures.bPaginate===false?k.aiDisplay.length:k._iDisplayStart+k._iDisplayLength>k.aiDisplay.length||k._iDisplayLength==-1?k.aiDisplay.length:k._iDisplayStart+k._iDisplayLength}function fb(k,r){if(!k||k===null||k==="")return 0;if(typeof r=="undefined")r=c.getElementsByTagName("body")[0];var s=c.createElement("div");s.style.width=ba(k);r.appendChild(s);k=s.offsetWidth;r.removeChild(s);return k}function Ma(k){var r=0,s,u=0,y=k.aoColumns.length,w,E=a("th",k.nTHead);for(w=0;w<y;w++)if(k.aoColumns[w].bVisible){u++;if(k.aoColumns[w].sWidth!==null){s=fb(k.aoColumns[w].sWidthOrig,k.nTable.parentNode);if(s!==null)k.aoColumns[w].sWidth=ba(s);r++}}if(y==E.length&&r===0&&u==y&&k.oScroll.sX===""&&k.oScroll.sY==="")for(w=0;w<k.aoColumns.length;w++){s=a(E[w]).width();if(s!==null)k.aoColumns[w].sWidth=ba(s)}else{r=k.nTable.cloneNode(false);w=k.nTHead.cloneNode(true);u=c.createElement("tbody");s=c.createElement("tr");r.removeAttribute("id");r.appendChild(w);if(k.nTFoot!==null){r.appendChild(k.nTFoot.cloneNode(true));ua(function(L){L.style.width=""},r.getElementsByTagName("tr"))}r.appendChild(u);u.appendChild(s);u=a("thead th",r);if(u.length===0)u=a("tbody tr:eq(0)>td",r);E=xa(k,w);for(w=u=0;w<y;w++){var H=k.aoColumns[w];if(H.bVisible&&H.sWidthOrig!==null&&H.sWidthOrig!=="")E[w-u].style.width=ba(H.sWidthOrig);else if(H.bVisible)E[w-u].style.width="";else u++}for(w=0;w<y;w++)if(k.aoColumns[w].bVisible){u=gb(k,w);if(u!==null){u=u.cloneNode(true);if(k.aoColumns[w].sContentPadding!=="")u.innerHTML+=k.aoColumns[w].sContentPadding;s.appendChild(u)}}y=k.nTable.parentNode;y.appendChild(r);if(k.oScroll.sX!==""&&k.oScroll.sXInner!=="")r.style.width=ba(k.oScroll.sXInner);else if(k.oScroll.sX!==""){r.style.width="";if(a(r).width()<y.offsetWidth)r.style.width=ba(y.offsetWidth)}else if(k.oScroll.sY!=="")r.style.width=ba(y.offsetWidth);r.style.visibility="hidden";hb(k,r);y=a("tbody tr:eq(0)",r).children();if(y.length===0)y=xa(k,a("thead",r)[0]);if(k.oScroll.sX!==""){for(w=u=s=0;w<k.aoColumns.length;w++)if(k.aoColumns[w].bVisible){s+=k.aoColumns[w].sWidthOrig===null?a(y[u]).outerWidth():parseInt(k.aoColumns[w].sWidth.replace("px",""),10)+(a(y[u]).outerWidth()-a(y[u]).width());u++}r.style.width=ba(s);k.nTable.style.width=ba(s)}for(w=u=0;w<k.aoColumns.length;w++)if(k.aoColumns[w].bVisible){s=a(y[u]).width();if(s!==null&&s>0)k.aoColumns[w].sWidth=ba(s);u++}k.nTable.style.width=ba(a(r).outerWidth());r.parentNode.removeChild(r)}}function hb(k,r){if(k.oScroll.sX===""&&k.oScroll.sY!==""){a(r).width();r.style.width=ba(a(r).outerWidth()-k.oScroll.iBarWidth)}else if(k.oScroll.sX!=="")r.style.width=ba(a(r).outerWidth())}function gb(k,r){var s=ib(k,r);if(s<0)return null;if(k.aoData[s].nTr===null){var u=c.createElement("td");u.innerHTML=la(k,s,r,"");return u}return va(k,s)[r]}function ib(k,r){for(var s=-1,u=-1,y=0;y<k.aoData.length;y++){var w=la(k,y,r,"display")+"";w=w.replace(/<.*?>/g,"");if(w.length>s){s=w.length;u=y}}return u}function ba(k){if(k===null)return"0px";if(typeof k=="number"){if(k<0)return"0px";return k+"px"}var r=k.charCodeAt(k.length-1);if(r<48||r>57)return k;return k+"px"}function xb(k,r){if(k.length!=r.length)return 1;for(var s=0;s<k.length;s++)if(k[s]!=r[s])return 2;return 0}function Na(k){for(var r=h.aTypes,s=r.length,u=0;u<s;u++){var y=r[u](k);if(y!==null)return y}return"string"}
function fa(k){for(var r=0;r<g.length;r++)if(g[r].nTable==k)return g[r];return null}function Ja(k){for(var r=[],s=k.aoData.length,u=0;u<s;u++)r.push(k.aoData[u]._aData);return r}function Ia(k){for(var r=[],s=0,u=k.aoData.length;s<u;s++)k.aoData[s].nTr!==null&&r.push(k.aoData[s].nTr);return r}function va(k,r){var s=[],u,y,w,E,H;y=0;var L=k.aoData.length;if(typeof r!="undefined"){y=r;L=r+1}for(y=y;y<L;y++){H=k.aoData[y];if(H.nTr!==null){r=[];w=0;for(E=H.nTr.childNodes.length;w<E;w++){u=H.nTr.childNodes[w].nodeName.toLowerCase();if(u=="td"||u=="th")r.push(H.nTr.childNodes[w])}w=u=0;for(E=k.aoColumns.length;w<E;w++)if(k.aoColumns[w].bVisible)s.push(r[w-u]);else{s.push(H._anHidden[w]);u++}}}return s}function Qa(k){return k.replace(new RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^)","g"),"\\$1")}function Sa(k,r){for(var s=-1,u=0,y=k.length;u<y;u++)if(k[u]==r)s=u;else k[u]>r&&k[u]--;s!=-1&&k.splice(s,1)}function eb(k,r){r=r.split(",");for(var s=[],u=0,y=k.aoColumns.length;u<y;u++)for(var w=0;w<y;w++)if(k.aoColumns[u].sName==r[w]){s.push(w);break}return s}function Oa(k){for(var r="",s=0,u=k.aoColumns.length;s<u;s++)r+=k.aoColumns[s].sName+",";if(r.length==u)return"";return r.slice(0,-1)}function pa(k,r,s){k=k.sTableId===""?"DataTables warning: "+s:"DataTables warning (table id = '"+k.sTableId+"'): "+s;if(r===0)if(h.sErrMode=="alert")alert(k);else throw k;else typeof console!="undefined"&&typeof console.log!="undefined"&&console.log(k)}function Pa(k){k.aoData.splice(0,k.aoData.length);k.aiDisplayMaster.splice(0,k.aiDisplayMaster.length);k.aiDisplay.splice(0,k.aiDisplay.length);ja(k)}function Ta(k){if(!(!k.oFeatures.bStateSave||typeof k.bDestroying!="undefined")){var r,s,u,y="{";y+='"iCreate":'+(new Date).getTime()+",";y+='"iStart":'+(k.oScroll.bInfinite?0:k._iDisplayStart)+",";y+='"iEnd":'+(k.oScroll.bInfinite?k._iDisplayLength:k._iDisplayEnd)+",";y+='"iLength":'+k._iDisplayLength+",";y+='"sFilter":"'+encodeURIComponent(k.oPreviousSearch.sSearch)+'",';y+='"sFilterEsc":'+!k.oPreviousSearch.bRegex+",";y+='"aaSorting":[ ';for(r=0;r<k.aaSorting.length;r++)y+="["+k.aaSorting[r][0]+',"'+k.aaSorting[r][1]+'"],';y=y.substring(0,y.length-1);y+="],";y+='"aaSearchCols":[ ';for(r=0;r<k.aoPreSearchCols.length;r++)y+='["'+encodeURIComponent(k.aoPreSearchCols[r].sSearch)+'",'+!k.aoPreSearchCols[r].bRegex+"],";y=y.substring(0,y.length-1);y+="],";y+='"abVisCols":[ ';for(r=0;r<k.aoColumns.length;r++)y+=k.aoColumns[r].bVisible+",";y=y.substring(0,y.length-1);y+="]";r=0;for(s=k.aoStateSave.length;r<s;r++){u=k.aoStateSave[r].fn(k,y);if(u!=="")y=u}y+="}";jb(k.sCookiePrefix+k.sInstance,y,k.iCookieDuration,k.sCookiePrefix,k.fnCookieCallback)}}function kb(k,r){if(k.oFeatures.bStateSave){var s,u,y;u=Ua(k.sCookiePrefix+k.sInstance);if(u!==null&&u!==""){try{s=typeof a.parseJSON=="function"?a.parseJSON(u.replace(/'/g,'"')):eval("("+u+")")}catch(w){return}u=0;for(y=k.aoStateLoad.length;u<y;u++)if(!k.aoStateLoad[u].fn(k,s))return;k.oLoadedState=a.extend(true,{},s);k._iDisplayStart=s.iStart;k.iInitDisplayStart=s.iStart;k._iDisplayEnd=s.iEnd;k._iDisplayLength=s.iLength;k.oPreviousSearch.sSearch=decodeURIComponent(s.sFilter);k.aaSorting=s.aaSorting.slice();k.saved_aaSorting=s.aaSorting.slice();if(typeof s.sFilterEsc!="undefined")k.oPreviousSearch.bRegex=!s.sFilterEsc;if(typeof s.aaSearchCols!="undefined")for(u=0;u<s.aaSearchCols.length;u++)k.aoPreSearchCols[u]={sSearch:decodeURIComponent(s.aaSearchCols[u][0]),bRegex:!s.aaSearchCols[u][1]};if(typeof s.abVisCols!="undefined"){r.saved_aoColumns=[];for(u=0;u<s.abVisCols.length;u++){r.saved_aoColumns[u]={};r.saved_aoColumns[u].bVisible=s.abVisCols[u]}}}}}function jb(k,r,s,u,y){var w=new Date;w.setTime(w.getTime()+s*1E3);s=b.location.pathname.split("/");k=k+"_"+s.pop().replace(/[\/:]/g,"").toLowerCase();var E;if(y!==null){E=typeof a.parseJSON=="function"?a.parseJSON(r):eval("("+r+")");r=y(k,E,w.toGMTString(),s.join("/")+"/")}else r=k+"="+encodeURIComponent(r)+"; expires="+w.toGMTString()+"; path="+s.join("/")+"/";y="";w=9999999999999;if((Ua(k)!==null?c.cookie.length:r.length+c.cookie.length)+10>4096){k=c.cookie.split(";");for(var H=0,L=k.length;H<L;H++)if(k[H].indexOf(u)!=-1){var R=k[H].split("=");try{E=eval("("+decodeURIComponent(R[1])+")")}catch(Z){continue}if(typeof E.iCreate!="undefined"&&E.iCreate<w){y=R[0];w=E.iCreate}}if(y!=="")c.cookie=y+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path="+s.join("/")+"/"}c.cookie=r}function Ua(k){var r=b.location.pathname.split("/");k=k+"_"+r[r.length-1].replace(/[\/:]/g,"").toLowerCase()+"=";r=c.cookie.split(";");for(var s=0;s<r.length;s++){for(var u=r[s];u.charAt(0)==" ";)u=u.substring(1,u.length);if(u.indexOf(k)===0)return decodeURIComponent(u.substring(k.length,u.length))}return null}function Da(k,r){r=r.getElementsByTagName("tr");var s,u,y,w,E,H,L,R,Z=function(ta,ia,ka){for(;typeof ta[ia][ka]!="undefined";)ka++;return ka};k.splice(0,k.length);u=0;for(H=r.length;u<H;u++)k.push([]);u=0;for(H=r.length;u<H;u++){y=0;for(L=r[u].childNodes.length;y<L;y++){s=r[u].childNodes[y];if(s.nodeName.toUpperCase()=="TD"||s.nodeName.toUpperCase()=="TH"){var X=s.getAttribute("colspan")*1,ma=s.getAttribute("rowspan")*1;X=!X||X===0||X===1?1:X;ma=!ma||ma===0||ma===1?1:ma;R=Z(k,u,0);for(E=0;E<X;E++)for(w=0;w<ma;w++){k[u+w][R+E]={cell:s,unique:X==1?true:false};k[u+w].nTr=r[u]}}}}}function xa(k,r,s){var u=[];if(typeof s=="undefined"){s=k.aoHeader;if(typeof r!="undefined"){s=[];Da(s,r)}}r=0;for(var y=s.length;r<y;r++)for(var w=0,E=s[r].length;w<E;w++)if(s[r][w].unique&&(typeof u[w]=="undefined"||!k.bSortCellsTop))u[w]=s[r][w].cell;return u}function lb(){var k=c.createElement("p"),r=k.style;r.width="100%";r.height="200px";var s=c.createElement("div");r=s.style;r.position="absolute";r.top="0px";r.left="0px";r.visibility="hidden";r.width="200px";r.height="150px";r.overflow="hidden";s.appendChild(k);c.body.appendChild(s);r=k.offsetWidth;s.style.overflow="scroll";k=k.offsetWidth;if(r==k)k=s.clientWidth;c.body.removeChild(s);return r-k}function ua(k,r,s){for(var u=0,y=r.length;u<y;u++)for(var w=0,E=r[u].childNodes.length;w<E;w++)if(r[u].childNodes[w].nodeType==1)typeof s!="undefined"?k(r[u].childNodes[w],s[u].childNodes[w]):k(r[u].childNodes[w])}function S(k,r,s,u){if(typeof u=="undefined")u=s;if(typeof r[s]!="undefined")k[u]=r[s]}function La(k,r,s){for(var u=[],y=0,w=k.aoColumns.length;y<w;y++)u.push(la(k,r,y,s));return u}function la(k,r,s,u){var y=k.aoColumns[s];if((s=y.fnGetData(k.aoData[r]._aData))===U){if(k.iDrawError!=k.iDraw&&y.sDefaultContent===null){pa(k,0,"Requested unknown parameter '"+y.mDataProp+"' from the data source for row "+r);k.iDrawError=k.iDraw}return y.sDefaultContent}if(s===null&&y.sDefaultContent!==null)s=y.sDefaultContent;if(u=="display"&&s===null)return"";return s}function ra(k,r,s,u){k.aoColumns[s].fnSetData(k.aoData[r]._aData,u)}function Ha(k){if(k===null)return function(){return null};else if(typeof k=="function")return function(s){return k(s)};else if(typeof k=="string"&&k.indexOf(".")!=-1){var r=k.split(".");return r.length==2?function(s){return s[r[0]][r[1]]}:r.length==3?function(s){return s[r[0]][r[1]][r[2]]}:function(s){for(var u=0,y=r.length;u<y;u++)s=s[r[u]];return s}}else return function(s){return s[k]}}function db(k){if(k===null)return function(){};else if(typeof k=="function")return function(s,u){return k(s,u)};else if(typeof k=="string"&&k.indexOf(".")!=-1){var r=k.split(".");return r.length==2?function(s,u){s[r[0]][r[1]]=u}:r.length==3?function(s,u){s[r[0]][r[1]][r[2]]=u}:function(s,u){for(var y=0,w=r.length-1;y<w;y++)s=s[r[y]];s[r[r.length-1]]=u}}else return function(s,u){s[k]=u}}this.oApi={};this.fnDraw=function(k){var r=fa(this[h.iApiIndex]);if(typeof k!="undefined"&&k===false){ja(r);F(r)}else P(r)};this.fnFilter=function(k,r,s,u,y){var w=fa(this[h.iApiIndex]);if(w.oFeatures.bFilter){if(typeof s=="undefined")s=false;if(typeof u=="undefined")u=true;if(typeof y=="undefined")y=true;if(typeof r=="undefined"||r===null){T(w,{sSearch:k,bRegex:s,bSmart:u},1);if(y&&typeof w.aanFeatures.f!="undefined"){r=w.aanFeatures.f;s=0;for(u=r.length;s<u;s++)a("input",r[s]).val(k)}}else{w.aoPreSearchCols[r].sSearch=k;w.aoPreSearchCols[r].bRegex=s;w.aoPreSearchCols[r].bSmart=u;T(w,w.oPreviousSearch,1)}}};this.fnSettings=function(){return fa(this[h.iApiIndex])};this.fnVersionCheck=h.fnVersionCheck;this.fnSort=function(k){var r=fa(this[h.iApiIndex]);r.aaSorting=k;ca(r)};this.fnSortListener=function(k,r,s){ha(fa(this[h.iApiIndex]),k,r,s)};this.fnAddData=function(k,r){if(k.length===0)return[];var s=[],u,y=fa(this[h.iApiIndex]);if(typeof k[0]=="object")for(var w=0;w<k.length;w++){u=x(y,k[w]);if(u==-1)return s;s.push(u)}else{u=x(y,k);if(u==-1)return s;s.push(u)}y.aiDisplay=y.aiDisplayMaster.slice();if(typeof r=="undefined"||r)P(y);return s};this.fnDeleteRow=function(k,r,s){var u=fa(this[h.iApiIndex]);k=typeof k=="object"?Ca(u,k):k;var y=u.aoData.splice(k,1),w=a.inArray(k,u.aiDisplay);u.asDataSearch.splice(w,1);Sa(u.aiDisplayMaster,k);Sa(u.aiDisplay,k);typeof r=="function"&&r.call(this,u,y);if(u._iDisplayStart>=u.aiDisplay.length){u._iDisplayStart-=u._iDisplayLength;if(u._iDisplayStart<0)u._iDisplayStart=0}if(typeof s=="undefined"||s){ja(u);F(u)}return y};this.fnClearTable=function(k){var r=fa(this[h.iApiIndex]);Pa(r);if(typeof k=="undefined"||k)F(r)};this.fnOpen=function(k,r,s){var u=fa(this[h.iApiIndex]);this.fnClose(k);var y=c.createElement("tr"),w=c.createElement("td");y.appendChild(w);w.className=s;w.colSpan=Ea(u);if(typeof r.jquery!="undefined"||typeof r=="object")w.appendChild(r);else w.innerHTML=r;r=a("tr",u.nTBody);a.inArray(k,r)!=-1&&a(y).insertAfter(k);u.aoOpenRows.push({nTr:y,nParent:k});return y};this.fnClose=function(k){for(var r=fa(this[h.iApiIndex]),s=0;s<r.aoOpenRows.length;s++)if(r.aoOpenRows[s].nParent==k){(k=r.aoOpenRows[s].nTr.parentNode)&&k.removeChild(r.aoOpenRows[s].nTr);r.aoOpenRows.splice(s,1);return 0}return 1};this.fnGetData=function(k,r){var s=fa(this[h.iApiIndex]);if(typeof k!="undefined"){k=typeof k=="object"?Ca(s,k):k;if(typeof r!="undefined")return la(s,k,r,"");return typeof s.aoData[k]!="undefined"?s.aoData[k]._aData:null}return Ja(s)};this.fnGetNodes=function(k){var r=fa(this[h.iApiIndex]);if(typeof k!="undefined")return typeof r.aoData[k]!="undefined"?r.aoData[k].nTr:null;return Ia(r)};this.fnGetPosition=function(k){var r=fa(this[h.iApiIndex]),s=k.nodeName.toUpperCase();if(s=="TR")return Ca(r,k);else if(s=="TD"||s=="TH"){s=Ca(r,k.parentNode);for(var u=va(r,s),y=0;y<r.aoColumns.length;y++)if(u[y]==k)return[s,Ba(r,y),y]}return null};this.fnUpdate=function(k,r,s,u,y){var w=fa(this[h.iApiIndex]);r=typeof r=="object"?Ca(w,r):r;if(a.isArray(k)&&typeof k=="object"){w.aoData[r]._aData=k.slice();for(s=0;s<w.aoColumns.length;s++)this.fnUpdate(la(w,r,s),r,s,false,false)}else if(typeof k=="object"){w.aoData[r]._aData=a.extend(true,{},k);for(s=0;s<w.aoColumns.length;s++)this.fnUpdate(la(w,r,s),r,s,false,false)}else{k=k;ra(w,r,s,k);if(w.aoColumns[s].fnRender!==null){k=w.aoColumns[s].fnRender({iDataRow:r,iDataColumn:s,aData:w.aoData[r]._aData,oSettings:w});w.aoColumns[s].bUseRendered&&ra(w,r,s,k)}if(w.aoData[r].nTr!==null)va(w,r)[s].innerHTML=k}s=a.inArray(r,w.aiDisplay);w.asDataSearch[s]=da(w,La(w,r,"filter"));if(typeof y=="undefined"||y)J(w);if(typeof u=="undefined"||u)P(w);return 0};this.fnSetColumnVis=function(k,r,s){var u=fa(this[h.iApiIndex]),y,w;w=u.aoColumns.length;var E,H;if(u.aoColumns[k].bVisible!=r){if(r){for(y=H=0;y<k;y++)u.aoColumns[y].bVisible&&H++;H=H>=Ea(u);if(!H)for(y=k;y<w;y++)if(u.aoColumns[y].bVisible){E=y;break}y=0;for(w=u.aoData.length;y<w;y++)if(u.aoData[y].nTr!==null)H?u.aoData[y].nTr.appendChild(u.aoData[y]._anHidden[k]):u.aoData[y].nTr.insertBefore(u.aoData[y]._anHidden[k],va(u,y)[E])}else{y=0;for(w=u.aoData.length;y<w;y++)if(u.aoData[y].nTr!==null){E=va(u,y)[k];u.aoData[y]._anHidden[k]=E;E.parentNode.removeChild(E)}}u.aoColumns[k].bVisible=r;C(u,u.aoHeader);u.nTFoot&&C(u,u.aoFooter);y=0;for(w=u.aoOpenRows.length;y<w;y++)u.aoOpenRows[y].nTr.colSpan=Ea(u);if(typeof s=="undefined"||s){J(u);F(u)}Ta(u)}};this.fnPageChange=function(k,r){var s=fa(this[h.iApiIndex]);Aa(s,k);ja(s);if(typeof r=="undefined"||r)F(s)};this.fnDestroy=function(){var k=fa(this[h.iApiIndex]),r=k.nTableWrapper.parentNode,s=k.nTBody,u,y;k.bDestroying=true;u=0;for(y=k.aoColumns.length;u<y;u++)k.aoColumns[u].bVisible===false&&this.fnSetColumnVis(u,true);a(k.nTableWrapper).find("*").andSelf().off(".DT");a("tbody>tr>td."+k.oClasses.sRowEmpty,k.nTable).parent().remove();if(k.nTable!=k.nTHead.parentNode){a(">thead",k.nTable).remove();k.nTable.appendChild(k.nTHead)}if(k.nTFoot&&k.nTable!=k.nTFoot.parentNode){a(">tfoot",k.nTable).remove();k.nTable.appendChild(k.nTFoot)}k.nTable.parentNode.removeChild(k.nTable);a(k.nTableWrapper).remove();k.aaSorting=[];k.aaSortingFixed=[];na(k);a(Ia(k)).removeClass(k.asStripClasses.join(" "));if(k.bJUI){a("th",k.nTHead).removeClass([h.oStdClasses.sSortable,h.oJUIClasses.sSortableAsc,h.oJUIClasses.sSortableDesc,h.oJUIClasses.sSortableNone].join(" "));a("th span."+h.oJUIClasses.sSortIcon,k.nTHead).remove();a("th",k.nTHead).each(function(){var w=a("div."+h.oJUIClasses.sSortJUIWrapper,this),E=w.contents();a(this).append(E);w.remove()})}else a("th",k.nTHead).removeClass([h.oStdClasses.sSortable,h.oStdClasses.sSortableAsc,h.oStdClasses.sSortableDesc,h.oStdClasses.sSortableNone].join(" "));k.nTableReinsertBefore?r.insertBefore(k.nTable,k.nTableReinsertBefore):r.appendChild(k.nTable);u=0;for(y=k.aoData.length;u<y;u++)k.aoData[u].nTr!==null&&s.appendChild(k.aoData[u].nTr);if(k.oFeatures.bAutoWidth===true)k.nTable.style.width=ba(k.sDestroyWidth);a(">tr:even",s).addClass(k.asDestoryStrips[0]);a(">tr:odd",s).addClass(k.asDestoryStrips[1]);u=0;for(y=g.length;u<y;u++)g[u]==k&&g.splice(u,1);k=null};this.fnAdjustColumnSizing=function(k){var r=fa(this[h.iApiIndex]);J(r);if(typeof k=="undefined"||k)this.fnDraw(false);else if(r.oScroll.sX!==""||r.oScroll.sY!=="")this.oApi._fnScrollDraw(r)};for(var Va in h.oApi)if(Va)this[Va]=p(Va);this.oApi._fnExternApiFunc=p;this.oApi._fnInitalise=m;this.oApi._fnInitComplete=n;this.oApi._fnLanguageProcess=q;this.oApi._fnAddColumn=t;this.oApi._fnColumnOptions=v;this.oApi._fnAddData=x;this.oApi._fnCreateTr=z;this.oApi._fnGatherData=A;this.oApi._fnBuildHead=B;this.oApi._fnDrawHead=C;this.oApi._fnDraw=F;this.oApi._fnReDraw=P;this.oApi._fnAjaxUpdate=K;this.oApi._fnAjaxUpdateDraw=Q;this.oApi._fnAddOptionsHtml=O;this.oApi._fnFeatureHtmlTable=G;this.oApi._fnScrollDraw=I;this.oApi._fnAjustColumnSizing=J;this.oApi._fnFeatureHtmlFilter=M;this.oApi._fnFilterComplete=T;this.oApi._fnFilterCustom=W;this.oApi._fnFilterColumn=$;this.oApi._fnFilter=V;this.oApi._fnBuildSearchArray=aa;this.oApi._fnBuildSearchRow=da;this.oApi._fnFilterCreateSearch=Y;this.oApi._fnDataToSearch=ea;this.oApi._fnSort=ca;this.oApi._fnSortAttachListener=ha;this.oApi._fnSortingClasses=na;this.oApi._fnFeatureHtmlPaginate=sa;this.oApi._fnPageChange=Aa;this.oApi._fnFeatureHtmlInfo=Fa;this.oApi._fnUpdateInfo=wa;this.oApi._fnFeatureHtmlLength=ya;this.oApi._fnFeatureHtmlProcessing=za;this.oApi._fnProcessingDisplay=oa;this.oApi._fnVisibleToColumnIndex=Ka;this.oApi._fnColumnIndexToVisible=Ba;this.oApi._fnNodeToDataIndex=Ca;this.oApi._fnVisbleColumns=Ea;this.oApi._fnCalculateEnd=ja;this.oApi._fnConvertToWidth=fb;this.oApi._fnCalculateColumnWidths=Ma;this.oApi._fnScrollingWidthAdjust=hb;this.oApi._fnGetWidestNode=gb;this.oApi._fnGetMaxLenString=ib;this.oApi._fnStringToCss=ba;this.oApi._fnArrayCmp=xb;this.oApi._fnDetectType=Na;this.oApi._fnSettingsFromNode=fa;this.oApi._fnGetDataMaster=Ja;this.oApi._fnGetTrNodes=Ia;this.oApi._fnGetTdNodes=va;this.oApi._fnEscapeRegex=Qa;this.oApi._fnDeleteIndex=Sa;this.oApi._fnReOrderIndex=eb;this.oApi._fnColumnOrdering=Oa;this.oApi._fnLog=pa;this.oApi._fnClearTable=Pa;this.oApi._fnSaveState=Ta;this.oApi._fnLoadState=kb;this.oApi._fnCreateCookie=jb;this.oApi._fnReadCookie=Ua;this.oApi._fnDetectHeader=Da;this.oApi._fnGetUniqueThs=xa;this.oApi._fnScrollBarWidth=lb;this.oApi._fnApplyToChildren=ua;this.oApi._fnMap=S;this.oApi._fnGetRowData=La;this.oApi._fnGetCellData=la;this.oApi._fnSetCellData=ra;this.oApi._fnGetObjectDataFn=Ha;this.oApi._fnSetObjectDataFn=db;var Wa=this;return this.each(function(){var k=0,r,s,u,y;k=0;for(r=g.length;k<r;k++){if(g[k].nTable==this)if(typeof j=="undefined"||typeof j.bRetrieve!="undefined"&&j.bRetrieve===true)return g[k].oInstance;else if(typeof j.bDestroy!="undefined"&&j.bDestroy===true){g[k].oInstance.fnDestroy();break}else{pa(g[k],0,"Cannot reinitialise DataTable.\n\nTo retrieve the DataTables object for this table, please pass either no arguments to the dataTable() function, or set bRetrieve to true. Alternatively, to destory the old table and create a new one, set bDestroy to true (note that a lot of changes to the configuration can be made through the API which is usually much faster).");return}if(g[k].sTableId!==""&&g[k].sTableId==this.getAttribute("id")){g.splice(k,1);break}}var w=new l;g.push(w);var E=false,H=false;k=this.getAttribute("id");if(k!==null){w.sTableId=k;w.sInstance=k}else w.sInstance=h._oExternConfig.iNextUnique++;if(this.nodeName.toLowerCase()!="table")pa(w,0,"Attempted to initialise DataTables on a node which is not a table: "+this.nodeName);else{w.nTable=this;w.oInstance=Wa.length==1?Wa:a(this).dataTable();w.oApi=Wa.oApi;w.sDestroyWidth=a(this).width();if(typeof j!="undefined"&&j!==null){w.oInit=j;S(w.oFeatures,j,"bPaginate");S(w.oFeatures,j,"bLengthChange");S(w.oFeatures,j,"bFilter");S(w.oFeatures,j,"bSort");S(w.oFeatures,j,"bInfo");S(w.oFeatures,j,"bProcessing");S(w.oFeatures,j,"bAutoWidth");S(w.oFeatures,j,"bSortClasses");S(w.oFeatures,j,"bServerSide");S(w.oFeatures,j,"bDeferRender");S(w.oScroll,j,"sScrollX","sX");S(w.oScroll,j,"sScrollXInner","sXInner");S(w.oScroll,j,"sScrollY","sY");S(w.oScroll,j,"bScrollCollapse","bCollapse");S(w.oScroll,j,"bScrollInfinite","bInfinite");S(w.oScroll,j,"iScrollLoadGap","iLoadGap");S(w.oScroll,j,"bScrollAutoCss","bAutoCss");S(w,j,"asStripClasses");S(w,j,"fnPreDrawCallback");S(w,j,"fnRowCallback");S(w,j,"fnHeaderCallback");S(w,j,"fnFooterCallback");S(w,j,"fnCookieCallback");S(w,j,"fnInitComplete");S(w,j,"fnServerData");S(w,j,"fnFormatNumber");S(w,j,"aaSorting");S(w,j,"aaSortingFixed");S(w,j,"aLengthMenu");S(w,j,"sPaginationType");S(w,j,"sAjaxSource");S(w,j,"sAjaxDataProp");S(w,j,"iCookieDuration");S(w,j,"sCookiePrefix");S(w,j,"sDom");S(w,j,"bSortCellsTop");S(w,j,"oSearch","oPreviousSearch");S(w,j,"aoSearchCols","aoPreSearchCols");S(w,j,"iDisplayLength","_iDisplayLength");S(w,j,"bJQueryUI","bJUI");S(w.oLanguage,j,"fnInfoCallback");typeof j.fnDrawCallback=="function"&&w.aoDrawCallback.push({fn:j.fnDrawCallback,sName:"user"});typeof j.fnStateSaveCallback=="function"&&w.aoStateSave.push({fn:j.fnStateSaveCallback,sName:"user"});typeof j.fnStateLoadCallback=="function"&&w.aoStateLoad.push({fn:j.fnStateLoadCallback,sName:"user"});if(w.oFeatures.bServerSide&&w.oFeatures.bSort&&w.oFeatures.bSortClasses)w.aoDrawCallback.push({fn:na,sName:"server_side_sort_classes"});else w.oFeatures.bDeferRender&&w.aoDrawCallback.push({fn:na,sName:"defer_sort_classes"});if(typeof j.bJQueryUI!="undefined"&&j.bJQueryUI){w.oClasses=h.oJUIClasses;if(typeof j.sDom=="undefined")w.sDom='<"H"lfr>t<"F"ip>'}if(w.oScroll.sX!==""||w.oScroll.sY!=="")w.oScroll.iBarWidth=lb();if(typeof j.iDisplayStart!="undefined"&&typeof w.iInitDisplayStart=="undefined"){w.iInitDisplayStart=j.iDisplayStart;w._iDisplayStart=j.iDisplayStart}if(typeof j.bStateSave!="undefined"){w.oFeatures.bStateSave=j.bStateSave;kb(w,j);w.aoDrawCallback.push({fn:Ta,sName:"state_save"})}if(typeof j.iDeferLoading!="undefined"){w.bDeferLoading=true;w._iRecordsTotal=j.iDeferLoading;w._iRecordsDisplay=j.iDeferLoading}if(typeof j.aaData!="undefined")H=true;if(typeof j!="undefined"&&typeof j.aoData!="undefined")j.aoColumns=j.aoData;if(typeof j.oLanguage!="undefined")if(typeof j.oLanguage.sUrl!="undefined"&&j.oLanguage.sUrl!==""){w.oLanguage.sUrl=j.oLanguage.sUrl;a.getJSON(w.oLanguage.sUrl,null,function(Z){q(w,Z,true)});E=true}else q(w,j.oLanguage,false)}else j={};if(typeof j.asStripClasses=="undefined"){w.asStripClasses.push(w.oClasses.sStripOdd);w.asStripClasses.push(w.oClasses.sStripEven)}s=false;u=a(">tbody>tr",this);k=0;for(r=w.asStripClasses.length;k<r;k++)if(u.filter(":lt(2)").hasClass(w.asStripClasses[k])){s=true;break}if(s){w.asDestoryStrips=["",""];if(a(u[0]).hasClass(w.oClasses.sStripOdd))w.asDestoryStrips[0]+=w.oClasses.sStripOdd+" ";if(a(u[0]).hasClass(w.oClasses.sStripEven))w.asDestoryStrips[0]+=w.oClasses.sStripEven;if(a(u[1]).hasClass(w.oClasses.sStripOdd))w.asDestoryStrips[1]+=w.oClasses.sStripOdd+" ";if(a(u[1]).hasClass(w.oClasses.sStripEven))w.asDestoryStrips[1]+=w.oClasses.sStripEven;u.removeClass(w.asStripClasses.join(" "))}s=[];var L;k=this.getElementsByTagName("thead");if(k.length!==0){Da(w.aoHeader,k[0]);s=xa(w)}if(typeof j.aoColumns=="undefined"){L=[];k=0;for(r=s.length;k<r;k++)L.push(null)}else L=j.aoColumns;k=0;for(r=L.length;k<r;k++){if(typeof j.saved_aoColumns!="undefined"&&j.saved_aoColumns.length==r){if(L[k]===null)L[k]={};L[k].bVisible=j.saved_aoColumns[k].bVisible}t(w,s?s[k]:null)}if(typeof j.aoColumnDefs!="undefined")for(k=j.aoColumnDefs.length-1;k>=0;k--){var R=j.aoColumnDefs[k].aTargets;a.isArray(R)||pa(w,1,"aTargets must be an array of targets, not a "+typeof R);s=0;for(u=R.length;s<u;s++)if(typeof R[s]=="number"&&R[s]>=0){for(;w.aoColumns.length<=R[s];)t(w);v(w,R[s],j.aoColumnDefs[k])}else if(typeof R[s]=="number"&&R[s]<0)v(w,w.aoColumns.length+R[s],j.aoColumnDefs[k]);else if(typeof R[s]=="string"){r=0;for(y=w.aoColumns.length;r<y;r++)if(R[s]=="_all"||a(w.aoColumns[r].nTh).hasClass(R[s]))v(w,r,j.aoColumnDefs[k])}}if(typeof L!="undefined"){k=0;for(r=L.length;k<r;k++)v(w,k,L[k])}k=0;for(r=w.aaSorting.length;k<r;k++){if(w.aaSorting[k][0]>=w.aoColumns.length)w.aaSorting[k][0]=0;L=w.aoColumns[w.aaSorting[k][0]];if(typeof w.aaSorting[k][2]=="undefined")w.aaSorting[k][2]=0;if(typeof j.aaSorting=="undefined"&&typeof w.saved_aaSorting=="undefined")w.aaSorting[k][1]=L.asSorting[0];s=0;for(u=L.asSorting.length;s<u;s++)if(w.aaSorting[k][1]==L.asSorting[s]){w.aaSorting[k][2]=s;break}}na(w);k=a(">thead",this);if(k.length===0){k=[c.createElement("thead")];this.appendChild(k[0])}w.nTHead=k[0];k=a(">tbody",this);if(k.length===0){k=[c.createElement("tbody")];this.appendChild(k[0])}w.nTBody=k[0];k=a(">tfoot",this);if(k.length>0){w.nTFoot=k[0];Da(w.aoFooter,w.nTFoot)}if(H)for(k=0;k<j.aaData.length;k++)x(w,j.aaData[k]);else A(w);w.aiDisplay=w.aiDisplayMaster.slice();w.bInitialised=true;E===false&&m(w)}})}})(jQuery,D,N);f.extend(f.fn.dataTableExt.oSort,{"numeric-asc":function(a,b){a=parseFloat(a);b=parseFloat(b);a=isNaN(a)||a===" "||a===""?1.0E100:a;b=isNaN(b)||b===" "||b===""?1.0E100:b;return a-b},"numeric-desc":function(a,b){a=parseFloat(a);b=parseFloat(b);a=isNaN(a)||a===" "||a===""?-1.0E100:a;return(isNaN(b)||b===" "||b===""?-1.0E100:b)-a},position:function(a,b,c){var g=!!(b.match(/:/)||c.match(/:/));b=b.split(/[:\-(]/).reverse();c=c.split(/[:\-(]/).reverse();if(b.length!==c.length){var h=b.length<c.length?b:c;h.unshift(h[0])}h=0;if(g){g=b.pop();h=c.pop();if(h=isNaN(g)&&isNaN(h)?this["string-"+a](g,h):isNaN(g)?a==="asc"?1:-1:isNaN(h)?a==="asc"?-1:1:this["numeric-"+a](parseInt(g,10),parseInt(h,10)))return h}for(g=b.length;g--;)if(h=this["numeric-"+a](parseInt(b[g],10),parseInt(c[g],10)))break;return h},"position-asc":function(a,b){return this.position("asc",a,b)},"position-desc":function(a,b){return this.position("desc",a,b)},"position_html-asc":function(a,b){return this.position("asc",a.replace(/<.*?>/g,""),b.replace(/<.*?>/g,""))},"position_html-desc":function(a,b){return this.position("desc",a.replace(/<.*?>/g,""),b.replace(/<.*?>/g,""))},"string-asc":function(a,b){a=a===" "||a==="-"||a.toLowerCase()==="n/a"?"zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz":a.toLowerCase();b=b===" "||b==="-"||b.toLowerCase()==="n/a"?"zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz":b.toLowerCase();return a<b?-1:a>b?1:0},"string-desc":function(a,b){a=a===" "||a==="-"||a.toLowerCase()==="n/a"?"":a.toLowerCase();b=b===" "||b==="-"||b.toLowerCase()==="n/a"?"":b.toLowerCase();return a<b?1:a>b?-1:0},"string_hidden-asc":function(a,b){return this["string-asc"]((a.match(/<.*?>(.+)<\/.*?>/)||["",a])[1],(b.match(/<.*?>(.+)<\/.*?>/)||["",b])[1])},"string_hidden-desc":function(a,b){return this["string-desc"]((a.match(/<.*?>(.+)<\/.*?>/)||["",a])[1],(b.match(/<.*?>(.+)<\/.*?>/)||["",b])[1])},"numeric_hidden-asc":function(a,b){return this["numeric-asc"]((a.match(/<.*?>(.+)<\/.*?>/)||a.match(/^(\d+)$/)||[])[1],(b.match(/<.*?>(.+)<\/.*?>/)||b.match(/^(\d+)$/)||[])[1])},"numeric_hidden-desc":function(a,b){return this["numeric-desc"]((a.match(/<.*?>(.+)<\/.*?>/)||a.match(/^(\d+)$/)||[])[1],(b.match(/<.*?>(.+)<\/.*?>/)||b.match(/^(\d+)$/)||[])[1])},"html-asc":function(a,b){return this["string-asc"](a.replace(/<.*?>/g,""),b.replace(/<.*?>/g,""))},"html-desc":function(a,b){return this["string-desc"](a.replace(/<.*?>/g,""),b.replace(/<.*?>/g,""))},"html_numeric-asc":function(a,b){function c(g){return g.replace(/<.*?>/g,"").replace(/[^0-9]/g,"")}return this["numeric-asc"](c(a),c(b))},"html_numeric-desc":function(a,b){function c(g){return g.replace(/<.*?>/g,"").replace(/[^0-9]/g,"")}return this["numeric-desc"](c(a),c(b))}});(function(a){a.fn.dynaLoad=function(b){b=b||{};return this.each(function(){var c=a(this),g=c.data("dynaLoad")||{};if(!(g.loaded&&(!b.url||b.url===g.url))){b.url=b.url||g.url||c.find("a").first().attr("href");b.fallBack=b.fallBack||g.fallBack||c.find("a").first().text()||"Request failed";b.responseFilter=b.responseFilter||g.responseFilter||function(h){return h};b.complete=b.complete||g.complete||a.noop;b.loaded=true;c.empty().data("dynaLoad",b);b.url?a.ajax({cache:true,context:c,url:b.url,dataType:"html",success:function(h){this.html(this.data("dynaLoad").responseFilter(h)||this.data("dynaLoad").fallBack)},error:function(){this.html(this.data("dynaLoad").fallBack).data("dynaLoad").loaded=false},complete:function(){this.data("dynaLoad").complete.call(this)}}):c.html(b.fallBack)}})}})(jQuery);var Xa=true,yb=null;(function(a){function b(m){var n=m.options.dnd||null;if(n&&(n.onDragStart||n.onDrop))p();n&&n.onDragStart&&m.$tree.draggable({addClasses:false,appendTo:"body",containment:false,delay:0,distance:4,revert:false,scroll:true,scrollSpeed:7,scrollSensitivity:10,connectToDynatree:true,helper:function(q){var t=a.ui.dynatree.getNode(q.target);if(!t)return"<div></div>";return t.tree._onDragEvent("helper",t,null,q,null,null)},start:function(q,t){return!!t.helper.data("dtSourceNode")},_last:null});n&&n.onDrop&&m.$tree.droppable({addClasses:false,tolerance:"intersect",greedy:false,_last:null})}var c={create:function(){return function(){this.initialize.apply(this,arguments)}}},g=c.create();g.prototype={initialize:function(m,n,q){this.parent=m;this.tree=n;if(typeof q==="string")q={title:q};if(q.key===U)q.key="_"+n._nodeCount++;this.data=a.extend({},a.ui.dynatree.nodedatadefaults,q);this.childList=this.ul=this.span=this.li=null;this.bSelected=this.bExpanded=this.hasSubSel=this._isLoading=false},toString:function(){return"DynaTreeNode<"+this.data.key+">: '"+this.data.synonym||this.data.synonym+"'"},toDict:function(m,n){var q=a.extend({},this.data);q.activate=this.tree.activeNode===this;q.focus=this.tree.focusNode===this;q.expand=this.bExpanded;q.select=this.bSelected;n&&n(q);if(m&&this.childList){q.children=[];m=0;for(var t=this.childList.length;m<t;m++)q.children.push(this.childList[m].toDict(true,n))}else delete q.children;return q},fromDict:function(m){var n=m.children;if(n===U){this.data=a.extend(this.data,m);this.render()}else{m=a.extend({},m);m.children=U;this.data=a.extend(this.data,m);this.removeChildren();this.addChild(n)}},_getInnerHtml:function(){var m=this.tree,n=m.options,q=m.cache,t=this.getLevel(),v=this.data,x="";if(t<n.minExpandLevel){if(t>1)x+=q.tagConnector}else x+=this.hasChildren()!==false?q.tagExpander:q.tagConnector;if(n.checkbox&&v.hideCheckbox!==1&&!v.isStatusNode)x+=q.tagCheckbox;if(v.icon){q=v.icon.charAt(0)==="/"?v.icon:n.imagePath+v.icon;x+="<img src='"+q+
"' alt='' />"}else if(v.icon!==false)x+=q.tagNodeIcon;q="";if(n.onCustomRender)q=n.onCustomRender.call(m,this)||"";if(!q){m=v.tooltip?' title="'+v.tooltip.replace(/\"/g,"&quot;")+'"':"";q=v.href||"#";q=n.noLink||v.noLink?'<span style="display:inline-block;" class="'+n.classNames.title+' "'+m+">"+v.title+"</span>":'<a href="'+q+'" class="'+n.classNames.title+' "'+m+">"+v.title+"</a>"}x+=q;return x},_fixOrder:function(){var m=this.childList;if(m&&this.ul)for(var n=this.ul.firstChild,q=0,t=m.length-
1;q<t;q++){var v=m[q],x=n.dtnode;if(v!==x){this.tree.logDebug("_fixOrder: mismatch at index "+q+": "+v+" != "+x);this.ul.insertBefore(v.li,x.li)}else n=n.nextSibling}},render:function(m,n){var q=this.tree,t=this.parent,v=this.data,x=q.options,z=x.classNames,A=this.isLastSibling(),B=false;if(!t&&!this.ul){this.li=this.span=null;this.ul=N.createElement("ul");this.ul.className=x.minExpandLevel>1?z.container+" "+z.noConnector:z.container}else if(t){if(!this.li){B=true;this.li=N.createElement("li");this.li.dtnode=this;if(v.key&&x.generateIds)this.li.id=x.idPrefix+v.key;this.span=N.createElement("span");this.span.className=z.title;this.li.appendChild(this.span);if(!t.ul){t.ul=N.createElement("ul");t.ul.style.display="none";t.li.appendChild(t.ul)}t.ul.appendChild(this.li)}this.span.innerHTML=this._getInnerHtml();var C=[];C.push(z.node);v.isFolder&&C.push(z.folder);this.bExpanded&&C.push(z.expanded);this.hasChildren()!==false&&C.push(z.hasChildren);v.isLazy&&this.childList===null&&C.push(z.lazy);A&&C.push(z.lastsib);this.bSelected&&C.push(z.selected);this.hasSubSel&&C.push(z.partsel);q.activeNode===this&&C.push(z.active);v.addClass&&C.push(v.addClass);C.push(z.combinedExpanderPrefix+(this.bExpanded?"e":"c")+(v.isLazy&&this.childList===null?"d":"")+(A?"l":""));C.push(z.combinedIconPrefix+(this.bExpanded?"e":"c")+(v.isFolder?"f":""));this.span.className=C.join(" ");this.li.className=A?z.lastsib:"";B&&x.onCreate&&x.onCreate.call(q,this,this.span);x.onRender&&x.onRender.call(q,this,this.span)}if((this.bExpanded||n===true)&&this.childList){q=0;for(v=this.childList.length;q<v;q++)this.childList[q].render(false,n);this._fixOrder()}if(this.ul){n=this.ul.style.display==="none";q=!!this.bExpanded;if(m&&x.fx&&n===q){m=x.fx.duration||200;a(this.ul).animate(x.fx,m)}else this.ul.style.display=this.bExpanded||!t?"":"none"}},getKeyPath:function(m,n){var q=[];n=n||"title";this.visitParents(function(t){t.parent&&q.unshift(t.data[n])},!m);return"/"+q.join(this.tree.options.keyPathSeparator)},getParent:function(){return this.parent},getChildren:function(){if(this.hasChildren()===U)return U;return this.childList},hasChildren:function(){if(this.data.isLazy){if(this.childList===null||this.childList===U)return U;else if(this.childList.length===0)return false;else if(this.childList.length===1&&this.childList[0].isStatusNode())return U;return true}return!!this.childList},isFirstSibling:function(){var m=this.parent;return!m||m.childList[0]===this},isLastSibling:function(){var m=this.parent;return!m||m.childList[m.childList.length-1]===this},isLoading:function(){return!!this._isLoading},getPrevSibling:function(){if(!this.parent)return null;for(var m=this.parent.childList,n=1,q=m.length;n<q;n++)if(m[n]===this)return m[n-1];return null},getNextSibling:function(){if(!this.parent)return null;for(var m=this.parent.childList,n=0,q=m.length-1;n<q;n++)if(m[n]===this)return m[n+1];return null},isStatusNode:function(){return this.data.isStatusNode===true},isChildOf:function(m){return this.parent&&this.parent===m},isDescendantOf:function(m){if(!m)return false;for(var n=this.parent;n;){if(n===m)return true;n=n.parent}return false},countChildren:function(){var m=this.childList;if(!m)return 0;for(var n=m.length,q=0,t=n;q<t;q++)n+=m[q].countChildren();return n},sortChildren:function(m,n){var q=this.childList;if(q){m=m||function(x,z){x=x.data.title.toLowerCase();z=z.data.title.toLowerCase();return x===z?0:x>z?1:-1};q.sort(m);if(n)for(var t=0,v=q.length;t<v;t++)q[t].childList&&q[t].sortChildren(m,"$norender$");n!=="$norender$"&&this.render()}},_setStatusNode:function(m){var n=this.childList?this.childList[0]:null;if(m)if(n){m.isStatusNode=true;m.key="_statusNode";n.data=m;n.render()}else{m.isStatusNode=true;m.key="_statusNode";this.addChild(m)}else if(n&&n.isStatusNode()){try{if(this.ul){this.ul.removeChild(n.li);n.li=null}}catch(q){}if(this.childList.length===1)this.childList=[];else this.childList.shift()}},setLazyNodeStatus:function(m,n){var q=n&&n.tooltip?n.tooltip:null;n=n&&n.info?" ("+n.info+")":"";switch(m){case 0:this._setStatusNode(null);a(this.span).removeClass(this.tree.options.classNames.nodeLoading);this._isLoading=false;if(this.tree.options.autoFocus)this===this.tree.tnRoot&&this.childList&&this.childList.length>0?this.childList[0].focus():this.focus();break;case 1:this._isLoading=true;a(this.span).addClass(this.tree.options.classNames.nodeLoading);this.parent||this._setStatusNode({title:this.tree.options.strings.loading+n,tooltip:q,addClass:this.tree.options.classNames.nodeWait});break;case-1:this._isLoading=false;this._setStatusNode({title:this.tree.options.strings.loadError+n,tooltip:q,addClass:this.tree.options.classNames.nodeError});break;default:throw"Bad LazyNodeStatus: '"+m+"'.";}},_parentList:function(m,n){var q=[];for(n=n?this:this.parent;n;){if(m||n.parent)q.unshift(n);n=n.parent}return q},getLevel:function(){for(var m=0,n=this.parent;n;){m++;n=n.parent}return m},_getTypeForOuterNodeEvent:function(m){var n=this.tree.options.classNames,q=m.target;if(q.className.indexOf(n.node)<0)return null;var t=m.pageX-q.offsetLeft;m=m.pageY-q.offsetTop;for(var v=0,x=q.childNodes.length;v<x;v++){var z=q.childNodes[v],A=z.offsetLeft-q.offsetLeft,B=z.offsetTop-q.offsetTop,C=z.clientWidth,F=z.clientHeight;if(t>=A&&t<=A+C&&m>=B&&m<=B+F)if(z.className==n.title)return"title";else if(z.className==n.expander)return"expander";else if(z.className==n.checkbox)return"checkbox";else if(z.className==n.nodeIcon)return"icon"}return"prefix"},getEventTargetType:function(m){var n=m&&m.target?m.target.className:"",q=this.tree.options.classNames;if(n===q.title)return"title";else if(n===q.expander)return"expander";else if(n===q.checkbox)return"checkbox";else if(n===q.nodeIcon)return"icon";else if(n===q.empty||n===q.vline||n===q.connector)return"prefix";else if(n.indexOf(q.node)>=0)return this._getTypeForOuterNodeEvent(m);return null},isVisible:function(){for(var m=this._parentList(true,false),n=0,q=m.length;n<q;n++)if(!m[n].bExpanded)return false;return true},makeVisible:function(){for(var m=this._parentList(true,false),n=0,q=m.length;n<q;n++)m[n]._expand(true)},focus:function(){this.makeVisible();try{a(this.span).find(">a").focus()}catch(m){}},isFocused:function(){return this.tree.tnFocused===this},_activate:function(m,n){this.tree.logDebug("dtnode._activate(%o, fireEvents=%o) - %o",m,n,this);var q=this.tree.options;if(!this.data.isStatusNode)if(!(n&&q.onQueryActivate&&q.onQueryActivate.call(this.tree,m,this)===false))if(m){if(this.tree.activeNode){if(this.tree.activeNode===this)return;this.tree.activeNode.deactivate()}q.activeVisible&&this.makeVisible();this.tree.activeNode=this;q.persist&&a.cookie(q.cookieId+"-active",this.data.key,q.cookie);this.tree.persistence.activeKey=this.data.key;a(this.span).addClass(q.classNames.active);n&&q.onActivate&&q.onActivate.call(this.tree,this)}else if(this.tree.activeNode===this)if(!(q.onQueryActivate&&q.onQueryActivate.call(this.tree,false,this)===false)){a(this.span).removeClass(q.classNames.active);q.persist&&a.cookie(q.cookieId+"-active","",q.cookie);this.tree.persistence.activeKey=null;this.tree.activeNode=null;n&&q.onDeactivate&&q.onDeactivate.call(this.tree,this)}},activate:function(){this._activate(true,true)},activateSilently:function(){this._activate(true,false)},deactivate:function(){this._activate(false,true)},isActive:function(){return this.tree.activeNode===this},_userActivate:function(){var m=true,n=false;if(this.data.isFolder)switch(this.tree.options.clickFolderMode){case 2:m=false;n=true;break;case 3:m=n=true;break}if(this.parent===null)n=false;if(n){this.toggleExpand();this.focus()}m&&this.activate()},_setSubSel:function(m){if(m){this.hasSubSel=true;a(this.span).addClass(this.tree.options.classNames.partsel)}else{this.hasSubSel=false;a(this.span).removeClass(this.tree.options.classNames.partsel)}},_updatePartSelectionState:function(){var m;if(!this.hasChildren()){m=this.bSelected&&!this.data.unselectable&&!this.data.isStatusNode;this._setSubSel(false);return m}var n,q=this.childList,t=true,v=true;m=0;for(n=q.length;m<n;m++){var x=q[m]._updatePartSelectionState();if(x!==false)v=false;if(x!==true)t=false}m=t?true:v?false:U;this._setSubSel(m===U);this.bSelected=m===true;return m},_fixSelectionState:function(){var m,n,q;if(this.bSelected){this.visit(function(x){x.parent._setSubSel(true);x.data.unselectable||x._select(true,false,false)});for(m=this.parent;m;){m._setSubSel(true);var t=true;n=0;for(q=m.childList.length;n<q;n++){var v=m.childList[n];if(!v.bSelected&&!v.data.isStatusNode&&!v.data.unselectable){t=false;break}}t&&m._select(true,false,false);m=m.parent}}else{this._setSubSel(false);this.visit(function(x){x._setSubSel(false);x._select(false,false,false)});for(m=this.parent;m;){m._select(false,false,false);t=false;n=0;for(q=m.childList.length;n<q;n++)if(m.childList[n].bSelected||m.childList[n].hasSubSel){t=true;break}m._setSubSel(t);m=m.parent}}},_select:function(m,n,q){var t=this.tree.options;if(!this.data.isStatusNode)if(this.bSelected!==m)if(!(n&&t.onQuerySelect&&t.onQuerySelect.call(this.tree,m,this)===false)){t.selectMode==1&&m&&this.tree.visit(function(v){if(v.bSelected){v._select(false,false,false);return false}});if(this.bSelected=m){t.persist&&this.tree.persistence.addSelect(this.data.key);a(this.span).addClass(t.classNames.selected);q&&t.selectMode===3&&this._fixSelectionState();n&&t.onSelect&&t.onSelect.call(this.tree,true,this)}else{t.persist&&this.tree.persistence.clearSelect(this.data.key);a(this.span).removeClass(t.classNames.selected);q&&t.selectMode===3&&this._fixSelectionState();n&&t.onSelect&&t.onSelect.call(this.tree,false,this)}}},select:function(m){if(this.data.unselectable)return this.bSelected;return this._select(m!==false,true,true)},toggleSelect:function(){return this.select(!this.bSelected)},isSelected:function(){return this.bSelected},isLazy:function(){return!!this.data.isLazy},_loadContent:function(){try{var m=this.tree.options;this.tree.logDebug("_loadContent: start - %o",this);this.setLazyNodeStatus(1);if(true===m.onLazyRead.call(this.tree,this)){this.setLazyNodeStatus(0);this.tree.logDebug("_loadContent: succeeded - %o",this)}}catch(n){this.tree.logWarning("_loadContent: failed - %o",n);this.setLazyNodeStatus(-1,{tooltip:""+n})}},_expand:function(m,n){if(this.bExpanded===m)this.tree.logDebug("dtnode._expand(%o) IGNORED - %o",m,this);else{this.tree.logDebug("dtnode._expand(%o) - %o",m,this);var q=this.tree.options;if(!m&&this.getLevel()<q.minExpandLevel)this.tree.logDebug("dtnode._expand(%o) prevented collapse - %o",m,this);else if(!(q.onQueryExpand&&q.onQueryExpand.call(this.tree,m,this)===false)){this.bExpanded=m;if(q.persist)m?this.tree.persistence.addExpand(this.data.key):this.tree.persistence.clearExpand(this.data.key);this.render(!(this.data.isLazy&&this.childList===null)&&!this._isLoading&&!n);if(this.bExpanded&&this.parent&&q.autoCollapse){n=this._parentList(false,true);for(var t=0,v=n.length;t<v;t++)n[t].collapseSiblings()}q.activeVisible&&this.tree.activeNode&&!this.tree.activeNode.isVisible()&&this.tree.activeNode.deactivate();if(m&&this.data.isLazy&&this.childList===null&&!this._isLoading)this._loadContent();else q.onExpand&&q.onExpand.call(this.tree,m,this)}}},isExpanded:function(){return this.bExpanded},expand:function(m){m=m!==false;!this.childList&&!this.data.isLazy&&m||this.parent===null&&!m||this._expand(m)},scheduleAction:function(m,n){if(this.tree.timer){clearTimeout(this.tree.timer);this.tree.logDebug("clearTimeout(%o)",this.tree.timer)}var q=this;switch(m){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){q.tree.logDebug("setTimeout: trigger expand");q.expand(true)},n);break;case"activate":this.tree.timer=setTimeout(function(){q.tree.logDebug("setTimeout: trigger activate");q.activate()},n);break;default:throw"Invalid mode "+m;}this.tree.logDebug("setTimeout(%s, %s): %s",m,n,this.tree.timer)},toggleExpand:function(){this.expand(!this.bExpanded)},collapseSiblings:function(){if(this.parent!==null)for(var m=this.parent.childList,n=0,q=m.length;n<q;n++)m[n]!==this&&m[n].bExpanded&&m[n]._expand(false)},_onClick:function(m){var n=this.getEventTargetType(m);if(n==="expander"){this.toggleExpand();this.focus()}else if(n==="checkbox"){this.toggleSelect();this.focus()}else{this._userActivate();n=this.span.getElementsByTagName("a");if(n[0])a.browser&&!(a.browser.msie&&parseInt(a.browser.version,10)<9)&&n[0].focus();else return true}m.preventDefault()},_onDblClick:function(){},_onKeydown:function(m){var n=true,q;switch(m.which){case 107:case 187:this.bExpanded||this.toggleExpand();break;case 109:case 189:this.bExpanded&&this.toggleExpand();break;case 32:this._userActivate();break;case 8:this.parent&&this.parent.focus();break;case 37:if(this.bExpanded){this.toggleExpand();this.focus()}else this.parent&&this.parent.parent&&this.parent.focus();break;case 39:if(!this.bExpanded&&(this.childList||this.data.isLazy)){this.toggleExpand();this.focus()}else this.childList&&this.childList[0].focus();break;case 38:for(q=this.getPrevSibling();q&&q.bExpanded&&q.childList;)q=q.childList[q.childList.length-1];if(!q&&this.parent&&this.parent.parent)q=this.parent;q&&q.focus();break;case 40:if(this.bExpanded&&this.childList)q=this.childList[0];else for(var t=this._parentList(false,true),v=t.length-1;v>=0;v--)if(q=t[v].getNextSibling())break;q&&q.focus();break;default:n=false}n&&m.preventDefault()},_onKeypress:function(){},_onFocus:function(m){var n=this.tree.options;if(m.type=="blur"||m.type=="focusout"){n.onBlur&&n.onBlur.call(this.tree,this);this.tree.tnFocused&&a(this.tree.tnFocused.span).removeClass(n.classNames.focused);this.tree.tnFocused=null;n.persist&&a.cookie(n.cookieId+"-focus","",n.cookie)}else if(m.type=="focus"||m.type=="focusin"){if(this.tree.tnFocused&&this.tree.tnFocused!==this){this.tree.logDebug("dtnode.onFocus: out of sync: curFocus: %o",this.tree.tnFocused);a(this.tree.tnFocused.span).removeClass(n.classNames.focused)}this.tree.tnFocused=this;n.onFocus&&n.onFocus.call(this.tree,this);a(this.tree.tnFocused.span).addClass(n.classNames.focused);n.persist&&a.cookie(n.cookieId+"-focus",this.data.key,n.cookie)}},visit:function(m,n){var q=true;if(n===true){q=m(this);if(q===false||q=="skip")return q}if(this.childList){n=0;for(var t=this.childList.length;n<t;n++){q=this.childList[n].visit(m,true);if(q===false)break}}return q},visitParents:function(m,n){if(n&&m(this)===false)return false;for(n=this.parent;n;){if(m(n)===false)return false;n=n.parent}return true},remove:function(){if(this===this.tree.root)throw"Cannot remove system root";return this.parent.removeChild(this)},removeChild:function(m){var n=this.childList;if(n.length==1){if(m!==n[0])throw"removeChild: invalid child";return this.removeChildren()}m===this.tree.activeNode&&m.deactivate();if(this.tree.options.persist){m.bSelected&&this.tree.persistence.clearSelect(m.data.key);m.bExpanded&&this.tree.persistence.clearExpand(m.data.key)}m.removeChildren(true);this.ul.removeChild(m.li);for(var q=0,t=n.length;q<t;q++)if(n[q]===m){this.childList.splice(q,1);break}},removeChildren:function(m,n){this.tree.logDebug("%s.removeChildren(%o)",this,m);var q=this.tree,t=this.childList;if(t){for(var v=0,x=t.length;v<x;v++){var z=t[v];z===q.activeNode&&!n&&z.deactivate();if(this.tree.options.persist&&!n){z.bSelected&&this.tree.persistence.clearSelect(z.data.key);z.bExpanded&&this.tree.persistence.clearExpand(z.data.key)}z.removeChildren(true,n);this.ul&&a("li",a(this.ul)).remove()}this.childList=null}if(!m){this._isLoading=false;this.render()}},setTitle:function(m){this.fromDict({title:m})},reload:function(){throw"Use reloadChildren() instead";},reloadChildren:function(m){if(this.parent===null)throw"Use tree.reload() instead";else if(!this.data.isLazy)throw"node.reloadChildren() requires lazy nodes.";if(m){var n=this,q="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key;this.tree.$tree.bind(q,function(t,v,x){n.tree.$tree.unbind(q);n.tree.logDebug("loaded %o, %o, %o",t,v,x);if(v!==n)throw"got invalid load event";m.call(n.tree,v,x)})}this.removeChildren();this._loadContent()},_loadKeyPath:function(m,n){var q=this.tree;q.logDebug("%s._loadKeyPath(%s)",this,m);if(m==="")throw"Key path must not be empty";var t=m.split(q.options.keyPathSeparator);if(t[0]==="")throw"Key path must be relative (don't start with '/')";var v=t.shift();if(this.childList)for(var x=0,z=this.childList.length;x<z;x++){var A=this.childList[x];if(A.data.key===v){if(t.length===0)n.call(q,A,"ok");else if(A.data.isLazy&&(A.childList===null||A.childList===U)){q.logDebug("%s._loadKeyPath(%s) -> reloading %s...",this,m,A);var B=this;A.reloadChildren(function(C,F){if(F){q.logDebug("%s._loadKeyPath(%s) -> reloaded %s.",C,m,C);n.call(q,A,"loaded");C._loadKeyPath(t.join(q.options.keyPathSeparator),n)}else{q.logWarning("%s._loadKeyPath(%s) -> reloadChildren() failed.",B,m);n.call(q,A,"error")}})}else{n.call(q,A,"loaded");A._loadKeyPath(t.join(q.options.keyPathSeparator),n)}return}}n.call(q,U,"notfound",v,t.length===0);q.logWarning("Node not found: "+v)},resetLazy:function(){if(this.parent===null)throw"Use tree.reload() instead";else if(!this.data.isLazy)throw"node.resetLazy() requires lazy nodes.";this.expand(false);this.removeChildren()},_addChildNode:function(m,n){var q=this.tree,t=q.options,v=q.persistence;m.parent=this;if(this.childList===null)this.childList=[];else n||this.childList.length>0&&a(this.childList[this.childList.length-1].span).removeClass(t.classNames.lastsib);if(n){n=a.inArray(n,this.childList);if(n<0)throw"<beforeNode> must be a child of <this>";this.childList.splice(n,0,m)}else this.childList.push(m);n=q.isInitializing();if(t.persist&&v.cookiesFound&&n){if(v.activeKey===m.data.key)q.activeNode=m;if(v.focusedKey===m.data.key)q.focusNode=m;m.bExpanded=a.inArray(m.data.key,v.expandedKeyList)>=0;m.bSelected=a.inArray(m.data.key,v.selectedKeyList)>=0}else{if(m.data.activate){q.activeNode=m;if(t.persist)v.activeKey=m.data.key}if(m.data.focus){q.focusNode=m;if(t.persist)v.focusedKey=m.data.key}m.bExpanded=m.data.expand===true;m.bExpanded&&t.persist&&v.addExpand(m.data.key);m.bSelected=m.data.select===true;m.bSelected&&t.persist&&v.addSelect(m.data.key)}if(t.minExpandLevel>=m.getLevel())this.bExpanded=true;if(m.bSelected&&t.selectMode==3)for(t=this;t;){t.hasSubSel||t._setSubSel(true);t=t.parent}q.bEnableUpdate&&this.render();return m},addChild:function(m,n){if(typeof m=="string")throw"Invalid data type for "+m;else if(!m||m.length===0)return;else if(m instanceof g)return this._addChildNode(m,n);m.length||(m=[m]);for(var q=this.tree.enableUpdate(false),t=null,v=0,x=m.length;v<x;v++){var z=m[v],A=this._addChildNode(new g(this,this.tree,z),n);t||(t=A);z.children&&A.addChild(z.children,null)}this.tree.enableUpdate(q);return t},append:function(m){this.tree.logWarning("node.append() is deprecated (use node.addChild() instead).");return this.addChild(m,null)},appendAjax:function(m){var n=this;this.removeChildren(false,true);this.setLazyNodeStatus(1);if(m.debugLazyDelay){var q=m.debugLazyDelay;m.debugLazyDelay=0;this.tree.logInfo("appendAjax: waiting for debugLazyDelay "+q);setTimeout(function(){n.appendAjax(m)},q)}else{var t=m.success,v=m.error,x="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key,z=a.extend({},this.tree.options.ajaxDefaults,m,{success:function(A,B){var C=n.tree.phase;n.tree.phase="init";if(z.postProcess)A=z.postProcess.call(this,A,this.dataType);else if(A&&A.hasOwnProperty("d"))A=typeof A.d=="string"?a.parseJSON(A.d):A.d;if(!a.isArray(A)||A.length!==0)n.addChild(A,null);n.tree.phase="postInit";t&&t.call(z,n,A,B);n.tree.logDebug("trigger "+x);n.tree.$tree.trigger(x,[n,true]);n.tree.phase=C;n.setLazyNodeStatus(0);if(a.isArray(A)&&A.length===0){n.childList=[];n.render()}},error:function(A,B,C){n.tree.logWarning("appendAjax failed:",B,":\n",A,"\n",C);v&&v.call(z,n,A,B,C);n.tree.$tree.trigger(x,[n,false]);n.setLazyNodeStatus(-1,{info:B,tooltip:""+C})}});a.ajax(z)}},move:function(m,n){var q;if(this!==m){if(!this.parent)throw"Cannot move system root";if(n===U||n=="over")n="child";var t=this.parent,v=n==="child"?m:m.parent;if(v.isDescendantOf(this))throw"Cannot move a node to it's own descendant";if(this.parent.childList.length==1){this.parent.childList=this.parent.data.isLazy?[]:null;this.parent.bExpanded=false}else{q=a.inArray(this,this.parent.childList);if(q<0)throw"Internal error";this.parent.childList.splice(q,1)}this.parent.ul&&this.parent.ul.removeChild(this.li);this.parent=v;if(v.hasChildren())switch(n){case"child":v.childList.push(this);break;case"before":q=a.inArray(m,v.childList);if(q<0)throw"Internal error";v.childList.splice(q,0,this);break;case"after":q=a.inArray(m,v.childList);if(q<0)throw"Internal error";v.childList.splice(q+1,0,this);break;default:throw"Invalid mode "+
n;}else v.childList=[this];if(!v.ul){v.ul=N.createElement("ul");v.ul.style.display="none";v.li.appendChild(v.ul)}this.li&&v.ul.appendChild(this.li);if(this.tree!==m.tree){this.visit(function(x){x.tree=m.tree},null,true);throw"Not yet implemented.";}t.isDescendantOf(v)||t.render();v.isDescendantOf(t)||v.render()}},lastentry:U};var h=c.create();h._getTreePersistData=function(m,n){m=new h(m,n);m.read();return m.toDict()};yb=h._getTreePersistData;h.prototype={initialize:function(m,n){if(m===U)m=a.ui.dynatree.prototype.options.cookieId;n=a.extend({},a.ui.dynatree.prototype.options.cookie,n);this.cookieId=m;this.cookieOpts=n;this.cookiesFound=U;this.selectedKeyList=this.expandedKeyList=this.focusedKey=this.activeKey=null},_log:function(){Array.prototype.unshift.apply(arguments,["debug"]);qa.apply(this,arguments)},read:function(){this.cookiesFound=false;var m=a.cookie(this.cookieId+"-active");this.activeKey=m===null?"":m;if(m!==null)this.cookiesFound=true;m=a.cookie(this.cookieId+"-focus");this.focusedKey=m===null?"":m;if(m!==null)this.cookiesFound=true;m=a.cookie(this.cookieId+"-expand");this.expandedKeyList=m===null?[]:m.split(",");if(m!==null)this.cookiesFound=true;m=a.cookie(this.cookieId+"-select");this.selectedKeyList=m===null?[]:m.split(",");if(m!==null)this.cookiesFound=true},write:function(){a.cookie(this.cookieId+"-active",this.activeKey===null?"":this.activeKey,this.cookieOpts);a.cookie(this.cookieId+"-focus",this.focusedKey===null?"":this.focusedKey,this.cookieOpts);a.cookie(this.cookieId+"-expand",this.expandedKeyList===null?"":this.expandedKeyList.join(","),this.cookieOpts);a.cookie(this.cookieId+"-select",this.selectedKeyList===null?"":this.selectedKeyList.join(","),this.cookieOpts)},addExpand:function(m){if(a.inArray(m,this.expandedKeyList)<0){this.expandedKeyList.push(m);a.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts)}},clearExpand:function(m){m=a.inArray(m,this.expandedKeyList);if(m>=0){this.expandedKeyList.splice(m,1);a.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts)}},addSelect:function(m){if(a.inArray(m,this.selectedKeyList)<0){this.selectedKeyList.push(m);a.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts)}},clearSelect:function(m){m=a.inArray(m,this.selectedKeyList);if(m>=0){this.selectedKeyList.splice(m,1);a.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts)}},isReloading:function(){return this.cookiesFound===true},toDict:function(){return{cookiesFound:this.cookiesFound,activeKey:this.activeKey,focusedKey:this.activeKey,expandedKeyList:this.expandedKeyList,selectedKeyList:this.selectedKeyList}},lastentry:U};var j=c.create();j.version="$Version: 1.2.2$";j.prototype={initialize:function(m){this.phase="init";this.$widget=m;this.options=m.options;this.$tree=m.element;this.timer=null;this.divTree=this.$tree.get(0);b(this)},_load:function(m){var n=this.options,q=this;this.bEnableUpdate=true;this._nodeCount=1;this.focusNode=this.activeNode=null;n.rootVisible!==U&&this.logWarning("Option 'rootVisible' is no longer supported.");if(n.minExpandLevel<1){this.logWarning("Option 'minExpandLevel' must be >= 1.");n.minExpandLevel=1}if(n.classNames!==a.ui.dynatree.prototype.options.classNames)n.classNames=a.extend({},a.ui.dynatree.prototype.options.classNames,n.classNames);if(n.ajaxDefaults!==a.ui.dynatree.prototype.options.ajaxDefaults)n.ajaxDefaults=a.extend({},a.ui.dynatree.prototype.options.ajaxDefaults,n.ajaxDefaults);if(n.dnd!==a.ui.dynatree.prototype.options.dnd)n.dnd=a.extend({},a.ui.dynatree.prototype.options.dnd,n.dnd);n.imagePath||a("script").each(function(){if(this.src.search(/.*dynatree[^\/]*\.js$/i)>=0){n.imagePath=this.src.indexOf("/")>=0?this.src.slice(0,this.src.lastIndexOf("/"))+"/skin/":"skin/";q.logDebug("Guessing imagePath from '%s': '%s'",this.src,n.imagePath);return false}});this.persistence=new h(n.cookieId,n.cookie);if(n.persist){a.cookie||qa("warn","Please include jquery.cookie.js to use persistence.");this.persistence.read()}this.logDebug("DynaTree.persistence: %o",this.persistence.toDict());this.cache={tagEmpty:"<span class='"+n.classNames.empty+"'></span>",tagVline:"<span class='"+n.classNames.vline+"'></span>",tagExpander:"<span class='"+n.classNames.expander+"'></span>",tagConnector:"<span class='"+n.classNames.connector+"'></span>",tagNodeIcon:"<span class='"+n.classNames.nodeIcon+"'></span>",tagCheckbox:"<span class='"+n.classNames.checkbox+"'></span>",lastentry:U};if(n.children||n.initAjax&&n.initAjax.url||n.initId)a(this.divTree).empty();var t=this.$tree.find(">ul:first").hide();this.tnRoot=new g(null,this,{});this.tnRoot.bExpanded=true;this.tnRoot.render();this.divTree.appendChild(this.tnRoot.ul);var v=this.tnRoot,x=n.persist&&this.persistence.isReloading(),z=false,A=this.enableUpdate(false);this.logDebug("Dynatree._load(): read tree structure...");if(n.children)v.addChild(n.children);else if(n.initAjax&&n.initAjax.url){z=true;v.data.isLazy=true;this._reloadAjax(m)}else if(n.initId)this._createFromTag(v,a("#"+n.initId));else{this._createFromTag(v,t);t.remove()}this._checkConsistency();!z&&n.selectMode==3&&v._updatePartSelectionState();this.logDebug("Dynatree._load(): render nodes...");this.enableUpdate(A);this.logDebug("Dynatree._load(): bind events...");this.$widget.bind();this.logDebug("Dynatree._load(): postInit...");this.phase="postInit";n.persist&&this.persistence.write();if(this.focusNode&&this.focusNode.isVisible()){this.logDebug("Focus on init: %o",this.focusNode);this.focusNode.focus()}if(!z){n.onPostInit&&n.onPostInit.call(this,x,false);m&&m.call(this,"ok")}this.phase="idle"},_reloadAjax:function(m){var n=this.options;if(!n.initAjax||!n.initAjax.url)throw"tree.reload() requires 'initAjax' mode.";var q=this.persistence,t=a.extend({},n.initAjax);if(t.addActiveKey)t.data.activeKey=q.activeKey;if(t.addFocusedKey)t.data.focusedKey=q.focusedKey;if(t.addExpandedKeyList)t.data.expandedKeyList=q.expandedKeyList.join(",");if(t.addSelectedKeyList)t.data.selectedKeyList=q.selectedKeyList.join(",");t.success&&this.logWarning("initAjax: success callback is ignored; use onPostInit instead.");t.error&&this.logWarning("initAjax: error callback is ignored; use onPostInit instead.");var v=q.isReloading();t.success=function(x){n.selectMode==3&&x.tree.tnRoot._updatePartSelectionState();n.onPostInit&&n.onPostInit.call(x.tree,v,false);m&&m.call(x.tree,"ok")};t.error=function(x,z,A,B){n.onPostInit&&n.onPostInit.call(x.tree,v,true,z,A,B);m&&m.call(x.tree,"error",z,A,B)};this.logDebug("Dynatree._init(): send Ajax request...");this.tnRoot.appendAjax(t)},toString:function(){return"Dynatree '"+this.$tree.attr("id")+
"'"},toDict:function(){return this.tnRoot.toDict(true)},serializeArray:function(m){m=this.getSelectedNodes(m);for(var n=this.$tree.attr("name")||this.$tree.attr("id"),q=[],t=0,v=m.length;t<v;t++)q.push({name:n,value:m[t].data.key});return q},getPersistData:function(){return this.persistence.toDict()},logDebug:function(){if(this.options.debugLevel>=2){Array.prototype.unshift.apply(arguments,["debug"]);qa.apply(this,arguments)}},logInfo:function(){if(this.options.debugLevel>=1){Array.prototype.unshift.apply(arguments,["info"]);qa.apply(this,arguments)}},logWarning:function(){Array.prototype.unshift.apply(arguments,["warn"]);qa.apply(this,arguments)},isInitializing:function(){return this.phase=="init"||this.phase=="postInit"},isReloading:function(){return(this.phase=="init"||this.phase=="postInit")&&this.options.persist&&this.persistence.cookiesFound},isUserEvent:function(){return this.phase=="userEvent"},redraw:function(){this.tnRoot.render(false,false)},renderInvisibleNodes:function(){this.tnRoot.render(false,true)},reload:function(m){this._load(m)},getRoot:function(){return this.tnRoot},enable:function(){this.$widget.enable()},disable:function(){this.$widget.disable()},getNodeByKey:function(m){var n=N.getElementById(this.options.idPrefix+m);if(n)return n.dtnode?n.dtnode:null;var q=null;this.visit(function(t){if(t.data.key==m){q=t;return false}},true);return q},getNodeInTree:function(m){var n=N.getElementById(this.options.idPrefix+m);if(n)return n.dtnode?n.dtnode:null;var q=null;this.visit(function(t){a.each(t.data,function(v){if(t.data[v]===m){q=t;return false}})},true);return q},getActiveNode:function(){return this.activeNode},reactivate:function(m){var n=this.activeNode;if(n){this.activeNode=null;n.activate();m&&n.focus()}},getSelectedNodes:function(m){var n=[];this.tnRoot.visit(function(q){if(q.bSelected){n.push(q);if(m===true)return"skip"}});return n},activateKey:function(m){m=m===null?null:this.getNodeByKey(m);if(!m){this.activeNode&&this.activeNode.deactivate();return this.activeNode=null}m.focus();m.activate();return m},loadKeyPath:function(m,n){m=m.split(this.options.keyPathSeparator);m[0]===""&&m.shift();if(m[0]==this.tnRoot.data.key){this.logDebug("Removed leading root key.");m.shift()}m=m.join(this.options.keyPathSeparator);return this.tnRoot._loadKeyPath(m,n)},selectKey:function(m,n){m=this.getNodeByKey(m);if(!m)return null;m.select(n);return m},enableUpdate:function(m){if(this.bEnableUpdate==m)return m;(this.bEnableUpdate=m)&&this.redraw();return!m},count:function(){return this.tnRoot.countChildren()},visit:function(m,n){return this.tnRoot.visit(m,n)},_createFromTag:function(m,n){var q=this;n.find(">li").each(function(){var t=a(this),v=t.find(">span:first"),x=t.find(">a:first"),z=null,A=null,B;if(v.length)v=v.html();else if(x.length){v=x.html();z=x.attr("href");A=x.attr("target");B=x.attr("title")}else{v=t.html();x=v.search(/<ul/i);v=x>=0?a.trim(v.substring(0,x)):a.trim(v)}B={title:v,tooltip:B,isFolder:t.hasClass("folder"),isLazy:t.hasClass("lazy"),expand:t.hasClass("expanded"),select:t.hasClass("selected"),activate:t.hasClass("active"),focus:t.hasClass("focused"),noLink:t.hasClass("noLink")};if(z){B.href=z;B.target=A}if(t.attr("title"))B.tooltip=t.attr("title");if(t.attr("id"))B.key=t.attr("id");if(t.attr("data"))if(z=a.trim(t.attr("data"))){if(z.charAt(0)!="{")z="{"+z+"}";try{a.extend(B,eval("("+z+")"))}catch(C){throw"Error parsing node data: "+C+"\ndata:\n'"+z+"'";}}z=m.addChild(B);t=t.find(">ul:first");t.length&&q._createFromTag(z,t)})},_checkConsistency:function(){},_setDndStatus:function(m,n,q,t,v){m=m?a(m.span):null;n=a(n.span);if(!this.$dndMarker)this.$dndMarker=a("<div id='dynatree-drop-marker'></div>").hide().css({"z-index":1E3}).prependTo(a(this.divTree).parent());if(t==="after"||t==="before"||t==="over"){var x="0 0";switch(t){case"before":this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-over");this.$dndMarker.addClass("dynatree-drop-before");x="0 -8";break;case"after":this.$dndMarker.removeClass("dynatree-drop-before dynatree-drop-over");this.$dndMarker.addClass("dynatree-drop-after");x="0 8";break;default:this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-before");this.$dndMarker.addClass("dynatree-drop-over");n.addClass("dynatree-drop-target");x="8 0"}this.$dndMarker.show().position({my:"left top",at:"left top",of:n,offset:x})}else{n.removeClass("dynatree-drop-target");this.$dndMarker.hide()}t==="after"?n.addClass("dynatree-drop-after"):n.removeClass("dynatree-drop-after");t==="before"?n.addClass("dynatree-drop-before"):n.removeClass("dynatree-drop-before");if(v===true){m&&m.addClass("dynatree-drop-accept");n.addClass("dynatree-drop-accept");q.addClass("dynatree-drop-accept")}else{m&&m.removeClass("dynatree-drop-accept");n.removeClass("dynatree-drop-accept");q.removeClass("dynatree-drop-accept")}if(v===false){m&&m.addClass("dynatree-drop-reject");n.addClass("dynatree-drop-reject");q.addClass("dynatree-drop-reject")}else{m&&m.removeClass("dynatree-drop-reject");n.removeClass("dynatree-drop-reject");q.removeClass("dynatree-drop-reject")}},_onDragEvent:function(m,n,q,t,v,x){var z=this.options.dnd,A=null,B=a(n.span);switch(m){case"helper":q=a("<div class='dynatree-drag-helper'><span class='dynatree-drag-helper-img' /></div>").append(a(t.target).closest("a").clone());a("ul.dynatree-container",n.tree.divTree).append(q);q.data("dtSourceNode",n);A=q;break;case"start":if(n.isStatusNode())A=false;else if(z.onDragStart)A=z.onDragStart(n);if(A===false){this.logDebug("tree.onDragStart() cancelled");v.helper.trigger("mouseup");v.helper.hide()}else B.addClass("dynatree-drag-source");break;case"enter":A=(A=z.onDragEnter?z.onDragEnter(n,q):null)?{over:A===true||A==="over"||a.inArray("over",A)>=0,before:A===true||A==="before"||a.inArray("before",A)>=0,after:A===true||A==="after"||a.inArray("after",A)>=0}:false;v.helper.data("enterResponse",A);break;case"over":x=v.helper.data("enterResponse");m=null;if(x!==false)if(typeof x==="string")m=x;else{var C=B.offset();t={x:t.pageX-C.left,y:t.pageY-C.top};B={x:t.x/B.width(),y:t.y/B.height()};if(x.after&&B.y>0.75)m="after";else if(!x.over&&x.after&&B.y>0.5)m="after";else if(x.before&&B.y<=0.25)m="before";else if(!x.over&&x.before&&B.y<=0.5)m="before";else if(x.over)m="over";if(z.preventVoidMoves)if(n===q)m=null;else if(m==="before"&&q&&n===q.getNextSibling())m=null;else if(m==="after"&&q&&n===q.getPrevSibling())m=null;else if(m==="over"&&q&&q.parent===n&&q.isLastSibling())m=null;v.helper.data("hitMode",m)}m==="over"&&z.autoExpandMS&&n.hasChildren()!==false&&!n.bExpanded&&n.scheduleAction("expand",z.autoExpandMS);if(m&&z.onDragOver){A=z.onDragOver(n,q,m);if(A==="over"||A==="before"||A==="after")m=A}this._setDndStatus(q,n,v.helper,m,A!==false&&m!==null);break;case"drop":B=v.helper.hasClass("dynatree-drop-reject");(m=v.helper.data("hitMode"))&&z.onDrop&&!B&&z.onDrop(n,q,m,v,x);break;case"leave":n.scheduleAction("cancel");v.helper.data("enterResponse",null);v.helper.data("hitMode",null);this._setDndStatus(q,n,v.helper,"out",U);z.onDragLeave&&z.onDragLeave(n,q);break;case"stop":B.removeClass("dynatree-drag-source");z.onDragStop&&z.onDragStop(n);break;default:throw"Unsupported drag event: "+m;}return A},cancelDrag:function(){var m=a.ui.ddmanager.current;m&&m.cancel()},lastentry:U};a.widget("ui.dynatree",{_init:function(){if(parseFloat(a.ui.version)<1.8){this.options.debugLevel>=0&&qa("warn","ui.dynatree._init() was called; you should upgrade to jquery.ui.core.js v1.8 or higher.");return this._create()}this.options.debugLevel>=2&&qa("debug","ui.dynatree._init() was called; no current default functionality.")},_create:function(){this.options.debugLevel>=1&&Ya("Dynatree._create(): version='%s', debugLevel=%o.",a.ui.dynatree.version,this.options.debugLevel);this.options.event+=".dynatree";this.element.get(0);this.tree=new j(this);this.tree._load();this.tree.logDebug("Dynatree._init(): done.")},bind:function(){function m(q){q=a.event.fix(q||D.event);var t=a.ui.dynatree.getNode(q.target);return t?t._onFocus(q):false}this.unbind();var n="click.dynatree dblclick.dynatree";if(this.options.keyboard)n+=" keypress.dynatree keydown.dynatree";this.element.bind(n,function(q){var t=a.ui.dynatree.getNode(q.target);if(!t)return true;var v=t.tree,x=v.options;v.logDebug("event(%s): dtnode: %s",q.type,t);var z=v.phase;v.phase="userEvent";try{switch(q.type){case"click":return x.onClick&&x.onClick.call(v,t,q)===false?false:t._onClick(q);case"dblclick":return x.onDblClick&&x.onDblClick.call(v,t,q)===false?false:t._onDblClick(q);case"keydown":return x.onKeydown&&x.onKeydown.call(v,t,q)===false?false:t._onKeydown(q);case"keypress":return x.onKeypress&&x.onKeypress.call(v,t,q)===false?false:t._onKeypress(q)}}catch(A){v.logWarning("bind(%o): dtnode: %o, error: %o",q,t,A)}finally{v.phase=z}});n=this.tree.divTree;if(n.addEventListener){n.addEventListener("focus",m,true);n.addEventListener("blur",m,true)}else n.onfocusin=n.onfocusout=m},unbind:function(){this.element.unbind(".dynatree")},enable:function(){this.bind();a.Widget.prototype.enable.apply(this,arguments)},disable:function(){this.unbind();a.Widget.prototype.disable.apply(this,arguments)},getTree:function(){return this.tree},getRoot:function(){return this.tree.getRoot()},getActiveNode:function(){return this.tree.getActiveNode()},getSelectedNodes:function(){return this.tree.getSelectedNodes()},lastentry:U});if(parseFloat(a.ui.version)<1.8)a.ui.dynatree.getter="getTree getRoot getActiveNode getSelectedNodes";a.ui.dynatree.version="$Version: 1.2.2$";a.ui.dynatree.getNode=function(m){if(m instanceof g)return m;if(m.selector!==U)m=m[0];for(;m;){if(m.dtnode)return m.dtnode;m=m.parentNode}return null};a.ui.dynatree.getPersistData=h._getTreePersistData;a.ui.dynatree.prototype.options={title:"Dynatree",minExpandLevel:1,imagePath:null,children:null,initId:null,initAjax:null,autoFocus:true,keyboard:true,persist:false,autoCollapse:false,clickFolderMode:3,activeVisible:true,checkbox:false,selectMode:2,fx:null,noLink:false,onClick:null,onDblClick:null,onKeydown:null,onKeypress:null,onFocus:null,onBlur:null,onQueryActivate:null,onQuerySelect:null,onQueryExpand:null,onPostInit:null,onActivate:null,onDeactivate:null,onSelect:null,onExpand:null,onLazyRead:null,onCustomRender:null,onCreate:null,onRender:null,postProcess:null,dnd:{onDragStart:null,onDragStop:null,autoExpandMS:1E3,preventVoidMoves:true,onDragEnter:null,onDragOver:null,onDrop:null,onDragLeave:null},ajaxDefaults:{cache:false,timeout:0,dataType:"json"},strings:{loading:"Loading&#8230;",loadError:"Load error!"},generateIds:false,idPrefix:"dynatree-id-",keyPathSeparator:"/",cookieId:"dynatree",cookie:{expires:null},classNames:{container:"dynatree-container",node:"dynatree-node",folder:"dynatree-folder",empty:"dynatree-empty",vline:"dynatree-vline",expander:"dynatree-expander",connector:"dynatree-connector",checkbox:"dynatree-checkbox",nodeIcon:"dynatree-icon",title:"dynatree-title",strain:"ss-strain",noConnector:"dynatree-no-connector",nodeError:"dynatree-statusnode-error",nodeWait:"dynatree-statusnode-wait",hidden:"dynatree-hidden",combinedExpanderPrefix:"dynatree-exp-",combinedIconPrefix:"dynatree-ico-",nodeLoading:"dynatree-loading",hasChildren:"dynatree-has-children",active:"dynatree-active",selected:"dynatree-selected",expanded:"dynatree-expanded",lazy:"dynatree-lazy",focused:"dynatree-focused",partsel:"dynatree-partsel",lastsib:"dynatree-lastsib"},debugLevel:1,lastentry:U};if(parseFloat(a.ui.version)<1.8)a.ui.dynatree.defaults=a.ui.dynatree.prototype.options;a.ui.dynatree.nodedatadefaults={title:null,key:null,isFolder:false,isLazy:false,tooltip:null,href:null,icon:null,addClass:null,noLink:false,activate:false,focus:false,expand:true,select:false,hideCheckbox:false,unselectable:false,children:null,lastentry:U};var l=false,p=function(){if(!l){a.ui.plugin.add("draggable","connectToDynatree",{start:function(m,n){var q=a(this).data("draggable"),t=n.helper.data("dtSourceNode")||null;if(t){q.offset.click.top=-2;q.offset.click.left=+16;return t.tree._onDragEvent("start",t,null,m,n,q)}},drag:function(m,n){var q=a(this).data("draggable"),t=n.helper.data("dtSourceNode")||null,v=n.helper.data("dtTargetNode")||null,x=a.ui.dynatree.getNode(m.target);if(m.target&&!x)if(a(m.target).closest("div.dynatree-drag-helper,#dynatree-drop-marker").length>0)return;n.helper.data("dtTargetNode",x);v&&v!==x&&v.tree._onDragEvent("leave",v,t,m,n,q);if(x)if(x.tree.options.dnd.onDrop)x===v?x.tree._onDragEvent("over",x,t,m,n,q):x.tree._onDragEvent("enter",x,t,m,n,q)},stop:function(m,n){var q=a(this).data("draggable"),t=n.helper.data("dtSourceNode")||null,v=n.helper.data("dtTargetNode")||null,x=m.type=="mouseup"&&m.which==1;x||Ya("Drag was cancelled");if(v){x&&v.tree._onDragEvent("drop",v,t,m,n,q);v.tree._onDragEvent("leave",v,t,m,n,q)}t&&t.tree._onDragEvent("stop",t,null,m,n,q)}});l=true}}})(jQuery);(function(a){a.fn.externalLinks=function(){return this.each(function(){a(this).find('a[rel!=external][rel!=notexternal][target!=_blank][href^="http"]:not(:empty):not(:has(img))').filter(function(){return this.hostname!==D.location.hostname}).attr("rel","external")})}})(jQuery);(function(a){a.fn.filterableDropdown=function(b){return this.each(function(){a.filterableDropdown(a(this),b)})};a.filterableDropdown=function(b,c){c=a.extend({},c);if(b.data("filterableDropdown")){c.change&&b.off("afterAddRemove.filterableDropdown").on("afterAddRemove.filterableDropdown",c.change);c.refresh&&b.trigger("open").trigger("close").find("label").trigger("refresh")}else{b.on({"focusInput.filterableDropdown":function(){b.find("._fd_filter input").trigger("focus")},"open.filterableDropdown":function(){if(b.data("filterableDropdown").closed){b.data("filterableDropdown").closed=false;b.addClass("open").find("._fd_filter").show().find("input").trigger("focus").trigger("keyup").next().html("&#9650;");a(N).off(".filterableDropdown").on("mousedown.filterableDropdown",function(){b.trigger("close")})}},"close.filterableDropdown":function(){var h=b.data("filterableDropdown").tag,j=b.find("input[type=checkbox]:checked, input[type=radio]:checked");b.data("filterableDropdown").closed=true;b.removeClass("open").find("._fd_tag").remove().end().find("._fd_filter input").trigger("reset").next().html("&#9660;").end().end().prepend(j.map(function(){return h.clone().data("input",this).show().find("span").first().html(this.nextSibling.innerHTML).end().end()}).toArray()).trigger("afterAddRemove");j.length&&j.prop("type")==="radio"&&b.find("._fd_filter").hide();a(N).off(".filterableDropdown");h=j=null},"afterAddRemove.filterableDropdown":c.change||a.noop}).on("click","._fdt_button",function(){var h=a(a(this).parent().data("input"));a(this.parentNode).remove();if(h.prop("type")==="checkbox"){h.prop("checked",false);g.trigger("refresh");b.trigger("afterAddRemove")}else b.trigger("open")}).children().on({"mousedown.filterableDropdown":function(h){h.stopPropagation()}}).find("input[type=checkbox], input[type=radio]").on({"keydown.filterableDropdown":function(h){h.preventDefault()},"click.filterableDropdown":function(h){if(h.originalEvent)a(this).triggerHandler("afterClick",this.type!=="radio"&&(h.metaKey||h.ctrlKey))},"afterClick.filterableDropdown":function(h,j){g.trigger("refresh");b.trigger(j?"focusInput":"close")}});var g=b.find("label").on({"mouseenter.filterableDropdown":function(){g.removeClass("highlight");a(this).addClass("highlight")},"refresh.filterableDropdown":function(){a(this).toggleClass("selected",a(this.parentNode).find("input").prop("checked"))},"click.filterableDropdown":function(h){var j=a(this).parent().find("input");if(j.prop("type")!=="radio"&&(h.metaKey||h.ctrlKey)){h.preventDefault();j.prop("checked",function(){return!this.checked}).triggerHandler("afterClick",true)}j=null}}).trigger("refresh");b.find("._fd_filter input").on({"focus.filterableDropdown":function(){this.value==this.defaultValue&&a(this).val("");b.trigger("open")},"reset.filterableDropdown":function(){a(this).val(this.defaultValue).trigger("keyup").trigger("blur")},"keyup.filterableDropdown mouseup.filterableDropdown":function(h){var j=this.value;if(h.originalEvent&&(j===this.defaultValue||h.which===38||h.which===40||h.which===13||b.data("filterableDropdown").previousValue===j))return false;b.data("filterableDropdown").previousValue=j;g.each(function(){var l=a(this);this.innerHTML=l.text();if(j.match(/^[a-z\s]+$/i)){l.parent().hide();this.innerHTML=this.innerHTML.replace(new RegExp("(^|[^a-z]{1})("+j+")","i"),function(p,m,n){l.parent().show();return m+'<span class="highlight">'+n+"</span>"})}else{l.parent().show();g.removeClass("highlight")}});g.filter(".highlight:visible").length||g.removeClass("highlight").filter(":visible").first().addClass("highlight");b.find("._fd_nomatch").toggle(!g.filter(":visible").parent().removeClass("first-child last-child").first().addClass("first-child").end().last().addClass("last-child").end().length);g.parent().parent().scrollTop(0)},"keydown.filterableDropdown paste.filterableDropdown":function(h){var j,l=false;switch(h.which){case 13:h.preventDefault();j=g.filter(".highlight:visible").parent().find("input");j.prop("type")!=="radio"&&(h.metaKey||h.ctrlKey)?j.prop("checked",true).triggerHandler("afterClick",true):j.prop("checked",false).trigger("click").triggerHandler("afterClick",false);j=null;break;case 9:case 27:b.trigger("close");break;case 38:j=a(g.get().reverse());case 40:h.preventDefault();(j||g).filter(":visible").each(function(){var p=a(this);if(p.hasClass("highlight")){p.removeClass("highlight");l=true}else{p.toggleClass("highlight",l);if(l){var m=p.parent();p=m.parent();var n=m.height(),q=p.height();m=m.offset().top-p.offset().top-1;if(m>0){m=m+n-q;if(m<0)m=0}m&&p.scrollTop(p.scrollTop()+m)}l=false}}).filter(".highlight").length||(j||g).filter(":visible").last().addClass("highlight");break;default:if(!this.value||this.value==this.defaultValue)a(this).val("");break}}}).next().on({"click.filterableDropdown":function(){b.trigger(b.data("filterableDropdown").closed?"open":"close")}});b.data("filterableDropdown",{tag:b.find("._fd_tag").remove()}).trigger("close")}}})(jQuery);(function(a,b,c){function g(q){q=q||location.href;return"#"+q.replace(/^[^#]*#?(.*)$/,"$1")}var h="hashchange",j=N,l,p=a.event.special,m=j.documentMode,n="on"+h in b&&(m===c||m>7);a.fn[h]=function(q){return q?this.on(h,q):this.trigger(h)};a.fn[h].delay=50;p[h]=a.extend(p[h],{setup:function(){if(n)return false;a(l.start)},teardown:function(){if(n)return false;a(l.stop)}});l=function(){function q(){var C=g(),F=B(x);if(C!==x){A(x=C,F);a(b).trigger(h)}else if(F!==x)location.href=location.href.replace(/#.*/,"")+F;v=setTimeout(q,a.fn[h].delay)}
var t={},v,x=g(),z=function(C){return C},A=z,B=z;t.start=function(){v||q()};t.stop=function(){v&&clearTimeout(v);v=c};a("body").hasClass("ie")&&!n&&function(){var C,F;t.start=function(){if(!C){F=(F=a.fn[h].src)&&F+g();C=a('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){F||A(g());q()}).attr("src",F||"javascript:0").insertAfter("body")[0].contentWindow;j.onpropertychange=function(){try{if(event.propertyName==="title")C.document.title=j.title}catch(P){}}}};t.stop=z;B=function(){return g(C.location.href)};A=function(P,K){var Q=C.document,O=a.fn[h].domain;if(P!==K){Q.title=j.title;Q.open();O&&Q.write('<script>document.domain="'+O+'"<\/script>');Q.close();C.location.hash=P}}}();return t}()})(jQuery,this);(function(a){function b(c){if(!c.data("uiTooltip")){var g=c.data("opts")||{};g.content=g.content||(c.data("title")||"").replace(/\n/g,"<br />")||c.find(">._ht_tip").first().remove().text();g.track=g.track||c.hasClass("_ht_track");g.delay=g.delay||c.hasClass("_ht_delay")||a("<div>").html(g.content).find("a[href],form").length;g.position=a.extend({my:g.track?"center top+24":"center top+8",at:"center bottom",using:function(h,j){if(g.track&&j.vertical==="bottom")h.top+=16;a(this).removeClass("helptip-top helptip-bottom helptip-middle").addClass("helptip-"+j.vertical).css(h)}},g.position||{});if(g.delay){g.origClose=g.close||a.noop;g.close=function(h,j){var l=a(this),p=l.data("uiTooltip").options.origClose;j.tooltip.on({"mouseenter.helptip":function(){a(this).clearQueue()},"mouseleave.helptip":function(m){a(this).remove();m.data.close.call(m.data.element,m,j,true)}},{element:l,close:p});p.call(l,h,j)};g.hide={delay:200,duration:0}}delete g.delay;c.tooltip(a.extend({show:{delay:100,duration:1},hide:false,items:"*",open:function(h,j){if(h.originalEvent&&h.originalEvent.type==="focusin"&&!a(h.originalEvent.currentTarget).is("input,textarea")){j.tooltip.remove();return false}j.tooltip.externalLinks()}},g))}}a.fn.helptip=function(c){if(typeof c==="string"){b(a(this));return this.tooltip.apply(this,arguments)}else return this.each(function(){var g=a.extend({},c||{}),h=a(this);h.data("opts",g);h.data("title",h.attr("title"));h.removeAttr("title");h.on("mouseover",function(){b(h);h.tooltip("open");return true})})}})(jQuery);(function(a){a.fn.hoverIntent=function(b,c){var g={sensitivity:7,interval:100,timeout:0,namespace:"hoverIntent"};g=a.extend(g,c?{over:b,out:c}:b);var h,j,l,p,m=function(t){h=t.pageX;j=t.pageY},n=function(t,v){v.hoverIntent_t=clearTimeout(v.hoverIntent_t);if(Math.abs(l-h)+Math.abs(p-j)<g.sensitivity){a(v).off("mousemove."+
g.namespace,m);v.hoverIntent_s=1;return g.over.apply(v,[t])}else{l=h;p=j;v.hoverIntent_t=setTimeout(function(){n(t,v)},g.interval)}},q=function(t,v){v.hoverIntent_t=clearTimeout(v.hoverIntent_t);v.hoverIntent_s=0;return g.out.apply(v,[t])};b=function(t){var v=jQuery.extend({},t),x=this;if(x.hoverIntent_t)x.hoverIntent_t=clearTimeout(x.hoverIntent_t);if(t.type=="mouseenter"){l=v.pageX;p=v.pageY;a(x).on("mousemove."+g.namespace,m);if(x.hoverIntent_s!=1)x.hoverIntent_t=setTimeout(function(){n(v,x)},g.interval)}else{a(x).off("mousemove."+g.namespace,m);if(x.hoverIntent_s==1)x.hoverIntent_t=setTimeout(function(){q(v,x)},g.timeout)}};return this.on("mouseenter."+g.namespace,b).on("mouseleave."+g.namespace,b)}})(jQuery);(function(a){a.ajaxPrefilter(function(b){if(b.iframe)return"iframe"});a.ajaxTransport("iframe",function(b){function c(){if(g){j.clones.replaceWith(function(p){return j.originals[p]});h.remove();g.off("load").attr("src","javascript:false;").remove();h=g=null}}var g=null,h=null,j={originals:b.form.find('input:file:enabled:not([value=""])')},l="iframe"+a.now();b.dataTypes.shift();if(j.originals.length){h=a("<form>",{action:b.url||b.form.attr("href"),name:l,target:l,enctype:"multipart/form-data",method:"POST"});a.each(a.merge([{name:"X-Requested-With",value:"iframe"}],b.form.serializeArray()),function(p,m){a('<input type="hidden" />').attr(m).appendTo(h)});j.clones=j.originals.after(function(){return this.cloneNode(true)}).next();j.originals.appendTo(h);return{send:function(p,m){g=a('<iframe name="'+l+'" id="'+l+'" src="javascript:false;" style="display:none">').on("load.initial",function(){g.off("load").on("load",function(){var n=this.contentWindow?this.contentWindow.document:this.contentDocument?this.contentDocument:this.document;n=n.documentElement||n.body;c();m(200,"OK",{html:n.innerHTML,text:n.textContent||n.innerText},null)});h[0].submit()});a("body").append(h,g);g.triggerHandler("load.initial")},abort:function(){c()}}}})})(jQuery);(function(a){a.keepOnPage=function(b,c){b=a(b);var g;if(b.data("keepOnPage")){g=b.data("keepOnPage").eventId;if(c==="trigger")a(D).triggerHandler("scroll.keepOnPage_"+g,true);else if(c==="destroy"){a(D).off(".keepOnPage_"+g);b.removeData("keepOnPage")}}else if(c!=="destroy"){g=Math.random().toString().split(".")[1];b.data("keepOnPage",{active:false,eventId:g});a(D).on("load.keepOnPage_"+g+" scroll.keepOnPage_"+g,a.extend({el:b,options:c},function(h,j){return{clone:j.position==="static"?h.clone().hide().empty().css({visibility:"hidden",height:h.height(),width:h.width()}).insertAfter(h):false,defaults:j}}(b,{cssTop:b.css("top"),offsetTop:b.offset().top,position:b.css("position")})),function(h,j){if(!h.data.el.data("keepOnPage").active)h.data.defaults.offsetTop=h.data.el.offset().top;var l=Math.max(a(D).scrollTop()-h.data.defaults.offsetTop+h.data.options.marginTop,0),p=h.data.defaults.position==="relative",m=h.data.el.data("keepOnPage").active===!l;if(!(!j&&!m&&(!l||!p))){h.data.el.data("keepOnPage").active=!!l;if(h.data.clone)h.data.clone.css(j&&l?{height:h.data.el.height(),width:h.data.el.width()}:{}).toggle(!!l);h.data.el.css(l?p?{top:l}:{position:"fixed",top:h.data.options.marginTop}:{position:h.data.defaults.position,top:p?h.data.defaults.cssTop:h.data.defaults.offsetTop});if(m)((l?h.data.options.onfix:h.data.options.onreset)||a.noop).apply(h.data.el[0])}})}};a.fn.keepOnPage=function(b){b=b||{};b.marginTop=b.marginTop||0;this.each(function(){a.keepOnPage(this,b)});return this}})(jQuery);(function(a){function b(){if(!(!g.length||h>=j)){var l=g.shift();h+=1;a.ajax(l[0]).always(function(){h--;b()}).done(function(p){l[1].resolve(p)}).fail(function(p){l[1].reject(p)})}}function c(l){e=a.Deferred();g.push([l,e]);b();return e}var g=[],h=0,j=a("body").data("pace")||2;a.extend({paced_ajax:c})})(jQuery);f(function(){function a(){if(!(b>=prefetch.length)){f("<img/>").attr({src:prefetch[b],style:"display: none"}).appendTo(f("body"));b++;setTimeout(a,1E3)}}if("prefetch"in D&&prefetch){var b=0;setTimeout(a,3E3)}});(function(a){a.fn.scrollyTable=function(b){return this.each(function(){var c,g=a(this);if(c=(this.className.match(/_scrollytable_id_[0-9]+/)||[]).pop())switch(b){case"refresh":g.parent().prev().children().width(g.outerWidth()).filter(function(){return a(this.parentNode).outerHeight()<1&&!!a(this).data("uiTooltip")}).helptip("close");break;case"destroy":g.removeClass(c).parent().prev().remove().end().replaceWith(g);a(D).off("."+c);break}else if(!b){c=Math.random().toString().replace("0.","_scrollytable_id_");g.addClass(c).wrap('<div style="overflow:auto">').parent().on("scroll.scrollyTable",function(){a(this.previousSibling).scrollLeft(a(this).scrollLeft())}).before('<div style="overflow:auto"><div style="height:1px"></div></div>').prev().on("scroll.scrollyTable",function(){a(this.nextSibling).scrollLeft(a(this).scrollLeft())}).children().width(g.outerWidth()).end().filter(function(){return a(this).outerHeight()>=1}).children().helptip({content:"Scroll to see more columns &raquo;",position:{my:"right-20 top+12",at:"left+"+g.parent().width()+" top"},open:function(h,j){j.tooltip.css("cursor","default").one("click",function(){a(this).fadeOut()})},hide:400}).helptip("open").end().one("scroll.scrollyTable",function(){a(this).children().helptip("close")});a(D).on("resize."+c,{el:this},function(h){a(h.data.el).scrollyTable("refresh")});g.hasClass("data_table")&&g.dataTable().fnSettings().aoDrawCallback.push({fn:function(){this.scrollyTable("refresh")}})}g=null})}})(jQuery);(function(a){a.fn.selectRange=function(b,c){return this.filter(":visible").each(function(){var g=typeof b==="function"?b.call(this):b,h=typeof c==="function"?c.call(this):c;if(this.setSelectionRange){this.focus();this.setSelectionRange(g,h)}else if(this.createTextRange){var j=this.createTextRange();j.collapse(true);j.moveEnd("character",h);j.moveStart("character",g);j.select()}}).end()}})(jQuery);(function(a){a.selectToToggle=function(b){b.off(".selectToToggle").on("change.selectToToggle",function(){var c=a(this).data("selectToToggle"),g=c.wrapper;c=c.toggleMap;var h=this.nodeName==="INPUT"&&this.type==="checkbox"&&!this.checked?false:this.value;for(var j in c)j!==h&&g.find(c[j]).hide().removeAttr("checked").filter("option").each(function(){var l=a(this);typeof l.data("sttDisabled")==="undefined"&&l.data("sttDisabled",!!this.disabled)}).prop("disabled",true);g.find(c[h]).show().filter("option").prop("disabled",function(){return a(this).data("sttDisabled")}).filter("select option").parent().each(function(){var l=a(this);if(!l.find("option:selected:enabled").length){l.find("option:enabled").first().prop("selected",true);l.data("selectToToggle")&&l.trigger("change.selectToToggle")}})}).filter("select, input:checked").first().triggerHandler("change.selectToToggle")};a.fn.selectToToggle=function(b,c){return this.each(function(){var g=a(this),h=g.data("selectToToggle"),j=function(p,m){return p[0].nodeName==="INPUT"?m.find("input[name="+p[0].name+"]"):p};if(h)if(b==="trigger"){if(g[0].nodeName==="SELECT"||g[0].checked)g.trigger("change.selectToToggle")}else b==="destroy"&&j(g,h.wrapper).off(".selectToToggle").removeData("selectToToggle");else{var l=a.extend({},b);c=c||a(N.body);g=j(g,c);if(a.isEmptyObject(l))(this.nodeName=="SELECT"?g.find("option"):g).each(function(){if(this.value){var p=a.map(this.className.match(/(\s+|^)_stt__([^\s]+)/g)||[],function(m){return m.replace("_stt__","._stt_")});p.push("._stt_"+this.value);l[this.value]=this.className.match(/(\s+|^)_sttmulti($|\s+)/)?p.join(","):p[0]}});g.data("selectToToggle",{wrapper:c,toggleMap:l});a.selectToToggle(g)}})}})(jQuery);(function(a){a.fn.speciesDropdown=function(b){return this.each(function(){a.speciesDropdown(a(this),b)})};a.speciesDropdown=function(b,c){c&&c.change&&b.data("speciesDropdown",{change:c.change});a.filterableDropdown(b,a.extend({},c,{change:function(){var g=a(this).find("._fd_tag").each(function(){this.style.backgroundImage=this.style.backgroundImage.replace(/[^\/]+\.png/,a(a(this).data("input")).val()+".png")}).end().data("speciesDropdown");g&&g.change.apply(this,arguments);g=null}}))}})(jQuery);(function(a){a.fn.tabs=function(b,c){if(this.length===b.length){var g=[];this.each(function(h){g.push({button:a(this),target:b.eq(h),event:c})});a.each(g,function(h,j){j.button.data("tabs",{target:j.target,siblings:g}).on(j.event==="click"?"click.tabs":"mouseenter.tabs",function(){a.each(a(this).data("tabs").siblings,function(l,p){p.button.add(p.target).removeClass("active")});a(this).add(a(this).data("tabs").target).addClass("active")})});g=null}return this}})(jQuery);(function(a){function b(g,h){return a.ajax({url:g,type:"POST",traditional:true,cache:false,context:this,dataType:"json",data:{state:h}}).fail(function(){$this.toggleClass("off")})}
function c(g){g=g.parent(".group");a("a.togglebutton.radiogroup",g).length&&a("a.togglebutton:not(.off)",g).length<2?a("a.togglebutton:not(.off)",g).addClass("inactive"):a("a.togglebutton",g).removeClass("inactive")}a.fn.toggleButtons=function(){return this.each(function(){var g=a(this),h=g.parent(".group");a("a.togglebutton.radiogroup",h);c(g);g.click(function(){if(g.hasClass("inactive")||g.hasClass("disabled"))return false;g.toggleClass("off");c(g);var j=g.hasClass("off")?"0":"1",l=g.attr("href");l&&b(l,j).done(function(p){p.reload_panels&&a.each(p.reload_panels,function(m,n){o.EventManager.triggerSpecific("updatePanel",n)})});return false})})}})(jQuery);(function(a){a.fn.toggleClass2=function(b,c){return this.each(function(){a(this)[(typeof c==="function"?c.call(this):c)?"addClass":"removeClass"](b)})}})(jQuery);(function(a){a.togglewrap=function(b,c){function g(){b.each(function(){var x=a(this);if(!x.data("togglewrap")){if(this.nodeName==="TABLE")if(x.css("table-layout")!=="fixed"){a("th, td",x).width(function(A,B){return B});x.css("table-layout","fixed")}a(D).on("resize.togglewrap",function(A){A.target.tagName||h()});var z=x.find(".toggle_img");if(!z.hasClass("_bound")){x.on("click",".height_wrap .toggle_img",function(){j(a(this));return false});z.addClass("_bound")}x.find(".toggle_img").addClass("_bound");x.data("togglewrap",true).find(".toggle_div").each(function(){a(this).data("togglewrap",{})});h();q()}x=null})}function h(){a(".height_wrap",b).each(function(){var x=a(this),z=x.find("span.toggle_img");z.length||(z=a('<span class="toggle_img" />').appendTo(this));var A=x.hasClass("open"),B=x.find(".val,.cell_detail"),C=B.text()==="";A&&x.removeClass("open");B[C?"addClass":"removeClass"]("empty");z[x.height()<B.height()?"show":"hide"]();if(A){x.addClass("open");C&&z.trigger("click")}})}function j(x){n(x);x.toggleClass("open").parents().first().toggleClass("open")}function l(x){return x.parents().filter(function(){return a(this).css("display")!=="inline"}).first()}function p(x,z,A,B){var C=1;if(B){B=a.now();C=z(x);var F=a.now();if(!C){A&&A();return}B=F-B;if(B>100)x/=2;if(B<25)x*=2;C=Math.min(B*10,2E3)}setTimeout(function(){p(x,z,A,1)},C)}function m(x,z){var A=0,B=a(".toggle_div",b);p(1,function(C){B.slice(A,A+C).each(x);A+=C;return A<B.length&&B.length},z)}function n(x){x.hasClass("toggle_img")||(x=a(".toggle_img",x));var z=x.parents(".toggleblock");z.length||(z=l(x.parents(".toggle_div")));z.data("togglewrap.fixWidth",z.width()-16)}function q(){m(function(){n(a(this))},function(){t()})}function t(){m(function(){a(this).data("togglewrap.innerWidth",a(".cell_detail",this).width()).data("togglewrap.summaryWidth",a(".toggle_summary",this).width()+100)},function(){v()})}function v(){m(function(){var x=a(this),z=l(x).data("togglewrap.fixWidth");if(x.data("togglewrap.innerWidth")<z)x.replaceWith(a(".cell_detail",x).removeClass("cell_detail"));else z>x.data("togglewrap.summaryWidth")&&a("span.toggle-img",x).addClass("limpet")})}if(c==="update")h();else{c=="redo"&&b.removeData("togglewrap");b=b.filter(".heightwrap_inside, .cellwrap_inside").add(b.find(".heightwrap_inside, .cellwrap_inside"));g()}};a.fn.togglewrap=function(b){return this.each(function(){a.togglewrap(a(this),b)})}})(jQuery);(function(a){a.extend(a.fn,{validate:function(b){return this.each(function(){if(this.nodeName==="FORM"){var c=a(this).data("validator");if(!c){c=new a.validator(b,this);a(this).data("validator",c)}c.validateInputs(null,"initial")}else if(this.nodeName.match(/SELECT|INPUT|TEXTAREA/)){c=a(this);if(c.parents("form").data("validator"))c.data("required",b===false?false:true)}})}});a.validator=function(b,c){var g=this;this.settings=a.extend({},a.validator.defaults,b);this.rules=this.settings.rules;this.tests=this.settings.tests;this.trim=this.settings.trim;this.inputs=a('input[type="text"], input[type="password"], input[type="file"], textarea, select',c);this.submitButtons=a('input[type="submit"]',c);this.result=true;a(c).on("submit.validate",function(h){g.result=true;g.validateInputs(null,"showError");if(!g.result){h.stopImmediatePropagation();h.preventDefault()}});this.inputs.each(function(){var h=a(this),j={valid:true};if(this.className){if(h.hasClass(g.settings.requiredClass))j.required=true;var l=this.className.match(/.*\b_(\w+)\b.*/);if(l){j.rule=l[1];l=this.className.match(/\bmin_(.+)\b/);var p=this.className.match(/\bmax_(.+)\b/),m=this.className.match(/\bdefault_([^\s]+)\b/);if(l)j.min=parseFloat(l[1],10);if(p)j.max=parseFloat(p[1],10);if(m)j["default"]=m[1]}}h.data(j)}).on({"keyup.validate":function(h){h.keyCode!==9&&g.validateInputs(a(this),"delay","keyup")},"change.validate":function(){g.validateInputs(a(this),"delay","change")},"blur.validate":function(){g.validateInputs(a(this),"showError","blur")}});c=null};a.extend(a.validator,{defaults:{validClass:"valid",invalidClass:"invalid",requiredClass:"required",trim:["int","nonnegint","posint","float","nonnegfloat","posfloat","email","url"],tests:{"int":new RegExp(/^[\-+]?\d+$/),"float":new RegExp(/^([\-+]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([\-+]?\d+))?$/),password:new RegExp(/^\S{6,32}$/),email:new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i),url:new RegExp(/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i)},rules:{nonnegint:function(b){return this.tests["int"].test(b)&&b>=0},posint:function(b){return this.tests["int"].test(b)&&b>0},nonnegfloat:function(b){return this.tests["float"].test(b)&&b>=0},posfloat:function(b){return this.tests["float"].test(b)&&b>0}},messages:{required:"This field is required","int":"Please enter an integer",nonnegint:"Please enter an integer (minimum 0)",posint:"Please enter an integer (minimum 1)","float":"Please enter a number",nonnegfloat:"Please enter a number (minimum 0)",posfloat:"Please enter a number (minimum 1)",password:"The password you have entered is invalid",email:"Please enter a valid email address",url:"Please enter a valid URL"}},prototype:{validateInputs:function(b,c,g){function h(){var p=true,m;b.each(function(){var n=a(this),q=a.extend({},n.data()),t=this.value;if(j.trim.indexOf(q.rule)>=0)t=t.trim();if(t===""&&"default"in q)t=q["default"];var v=(c==="initial"||!q.required)&&!t?null:q.rule&&j.rules[q.rule]?j.rules[q.rule].call(j,t):q.rule&&j.tests[q.rule]?j.tests[q.rule].test(t):q.required?!!t:null;if(v&&q.min)v=parseFloat(t,10)>=q.min;if(v&&q.max)v=parseFloat(t,10)<=q.max;l[v](this);n.data("valid",v);if(v===false){if(q.required&&!t)q.rule="required";v=j.settings.messages[q.rule];if(q.rule.match(/int$/))if(q.min&&q.max)v="Please enter an integer between "+q.min+" and "+q.max;else if(q.min||q.max)v="Please enter an integer ("+(q.min?"min":"max")+"imum "+(q.min||q.max)+")";if(q.error){if(q.error.rule!==q.rule){q.error.el.html(v);q.error.rule=q.rule}}else{q.error={rule:q.rule,el:a("<label>",{"class":j.settings.invalidClass,"for":this.id,html:v}).hide().appendTo(n.parent())};n.data("error",q.error)}c==="showError"&&q.error.el.css("display","inline")}else if(q.error){q.error.el.remove();n.data("error",false)}if(g!=="keyup"&&t!==this.value)this.value=t});for(m in j.inputs.toArray())if(a(j.inputs[m]).data("valid")===false){p=false;break}if(typeof j.settings.validate==="function")p=j.settings.validate.call(j,p,b,c);p?j.submitButtons.prop("disabled",false).removeClass("disabled"):j.submitButtons.prop("disabled",true).addClass("disabled");if(!p)j.result=false}b=b||this.inputs;var j=this,l={"true":function(p){a(p).removeClass(j.settings.invalidClass).addClass(j.settings.validClass)},"false":function(p){a(p).removeClass(j.settings.validClass).addClass(j.settings.invalidClass)},"null":function(p){a(p).removeClass(j.settings.validClass+" "+j.settings.invalidClass)}};this.timeout&&clearTimeout(this.timeout);if(c==="delay")this.timeout=setTimeout(h,250);else h()}}})})(jQuery);(function(a){a.fn.zMenuLink=function(){return this.on("click.zmenulink",function(b){b.preventDefault();var c=a(a(this).siblings("._zmenu_link")[0]||this);o.EventManager.trigger("makeZMenu",c.attr("href").replace(/\W/g,"_"),{event:b,area:{link:c}})})}})(jQuery);var o=new ga;o.extend({constructor:null,initialize:function(){var a=this.cookie.get("ENSEMBL_HINTS"),b=f(".image_panel"),c=D.location.hash.match(/(modal_.+)/);if(!D.name)D.name="ensembl_"+(new Date).getTime()+"_"+Math.floor(Math.random()*1E4);this.setSpecies();this.locationURL=typeof D.history.pushState==="function"?"search":"hash";this.hashParamRegex="([#?;&])(__PARAM__=)[^;&]+((;&)?)";this.locationMatch=new RegExp(/[#?;&]r=([^;&]+)/);this.markLocationMatch=new RegExp(/[#?;&]mr=([^;&]+)/);this.locationReplace=new RegExp(this.hashParamRegex.replace("__PARAM__","r"));this.width=parseInt(this.cookie.get("ENSEMBL_WIDTH"),10)||this.setWidth(U,1);this.dynamicWidth=!!this.cookie.get("DYNAMIC_WIDTH");this.hideHints={};this.initialPanels=f(".initial_panel");this.minWidthEl=f("#min_width_container");this.maxRegionLength=parseInt(f("#max_region_length").val()||0,10);this.images={total:b.length,last:b.last()[0]};this.markedLocation=this.getMarkedLocation();this.lastMarkedLocation=false;this.browser=function(g){var h={};if(g.match(/webkit/i)){h.webkit=true;if(g.match(/chrome/i))h.chrome=true;else if(g.match(/safari/i))h.safari=true}else if(g.match(/firefox/))h.firefox=true;else if(g.match(/msie|trident/i))h.ie=true;return h}(navigator.userAgent||"");if(this.dynamicWidth&&!D.name.match(/^popup_/)){b=this.imageWidth();if(b>0&&this.width!==b){this.width=b;this.cookie.set("ENSEMBL_WIDTH",b)}}a&&f.each(a.split(/:/),function(){o.hideHints[this]=1});b=null;this.setCoreParams();this.LayoutManager.initialize();b=(a=this.locationURL==="hash"?"":D.location.hash.match("="))?D.location.hash.match(this.locationMatch):false;f("input.ajax_load").val(function(g,h){return o.urlFromHash(h)});a&&D.history.replaceState({},"",o.urlFromHash(D.location.search));this.PanelManager.initialize();if(c){this.EventManager.deferTrigger("modalOpen",{className:"force",rel:c[1]});D.location.hash=""}b&&this.EventManager.trigger("hashChange",b[1])},setSpecies:function(){this.speciesPath=f("#species_path").val()||"";this.speciesCommon=f("#species_common_name").val()||"";this.speciesImagePath=f("#ensembl_image_root").val()+"species/"||"";this.species=this.speciesPath.split("/").pop()},cookie:{set:function(a,b,c,g,h){var j=null;if(h)if(h=N.domain.match(new RegExp(/(.*?)\.?([^\.]*?)\.(ac\.uk|org)$/)))j=h[2]?h[2]+"."+h[3]:N.domain;a=[g===true?a+"="+
(b||""):escape(a)+"="+escape(b||""),(j?"; domain="+j:"")+"; expires=",c===-1||b===""?"Thu, 01 Jan 1970 00:00:00 GMT":c?c:"Tue, 19 Jan 2038 00:00:00 GMT","; path=/"].join("");N.cookie=a;return b},get:function(a,b){return(a=N.cookie.match(new RegExp("(^|;)\\s*"+(b===true?a:escape(a))+"=([^;\\s]*)")))?unescape(a[2]):""}},imageWidth:function(){return Math.floor((f(D).width()-240)/100)*100},setWidth:function(a,b){var c=!isNaN(a);a=c?a:this.imageWidth();this.width=a<500?500:a;if(b){this.cookie.set("ENSEMBL_WIDTH",this.width);this.cookie.set("DYNAMIC_WIDTH",c?"":1);this.dynamicWidth=!c}return this.width},setCoreParams:function(){var a=D.location.search,b=D.location.hash,c=this.locationURL==="hash"?b:a,g=this.coreParams?this.coreParams.r:"",h,j,l;this.hash=b;this.coreParams={};this.initialR=f("input[name=r]","#core_params").val();this.location={length:1E5};this.multiSpecies={};f("input","#core_params").each(function(){var p=c.match("[#?;&]%s=([^;&]+)".replace("%s",this.name));o.coreParams[this.name]=p?unescape(p[1]):this.value});this.lastR=g||(b?this.coreParams.r:this.initialR);if(b=this.coreParams.r?this.coreParams.r.match(/(.+):(\d+)-(\d+)/):false){this.location={name:b[1],start:parseInt(b[2],10),end:parseInt(b[3],10)};this.location.length=this.location.end-this.location.start+1}(b=a.match(/s\d+=([^;&]+)/g))&&f.each(b,function(){h=this.split("=");j=h[0].substr(1);o.multiSpecies[j]={};f.each(["r","g","s"],function(p,m){o.multiSpecies[j][m]=a.match("[#?;&]%s=([^;&]+)".replace("%s",m+j));if(o.multiSpecies[j][m])o.multiSpecies[j][m]=unescape(o.multiSpecies[j][m][1]);if(m==="r"&&o.multiSpecies[j].r){l=o.multiSpecies[j].r.match(/(.+):(\d+)-(\d+)/);o.multiSpecies[j].location={name:l[1],start:parseInt(l[2],10),end:parseInt(l[3],10)}}})})},changeCoreParam:function(a,b){var c=f("#core_params input[name="+a+"]");c.length||(c=f("<input name="+a+">").appendTo(f("#core_params")));b===false?c.remove():c.val(b)},cleanURL:function(a){return a.replace(/&/g,";").replace(/#.*$/g,"").replace(/([?;])time=[^;]+;?/g,"$1").replace(/[?;]$/g,"")},replaceTimestamp:function(a){var b=new Date;b=b.getTime()+b.getMilliseconds()/1E3;a=this.cleanURL(a);a+=(a.match(/\?/)?";":"?")+"time="+b;return a},prepareRequestParams:function(a,b){var c={};a=b&&decodeURIComponent(a)||a;if(a.length>1500||b){f.each((a.split(/\?/)[1]||"").split(/&|;/),function(g,h){h=h.split("=");if(typeof h[0]!=="undefined"&&!(h[0]in c))c[h[0]]=h[1]});a=a.split(/\?/)[0];b="POST"}else{a=this.replaceTimestamp(a);b="GET"}return{requestURL:a,requestType:b,requestData:c}},redirect:function(a){for(var b in this.PanelManager.panels)this.PanelManager.panels[b].destructor("cleanup");a=a||this.replaceTimestamp(D.location.href);if(D.location.hash)a=this.urlFromHash(a);D.location=a},updateLocation:function(a){this.historyReady=true;if(this.updateURL({r:a})===true&&this.locationURL==="search"){this.setCoreParams();this.EventManager.trigger("hashChange",a)}},getMarkedLocation:function(a){return(a=((a||D.location.href).match(this.markLocationMatch)||[""]).pop().match(/(.+):(\d+)-(\d+)/))?[a[0],a[1],parseInt(a[2]),parseInt(a[3])]:null},markLocation:function(a){if(a&&typeof a==="string")a=this.getMarkedLocation(a);if(a||a===false){this.updateURL({mr:a&&a[0]});this.changeCoreParam("mr",a[0]);this.setCoreParams();this.lastMarkedLocation=this.markedLocation||this.lastMarkedLocation;this.markedLocation=a;this.EventManager.trigger("markLocation",a)}},updateURL:function(a,b){var c=b||D.location[this.locationURL];c.match(/\?/)||(c+="?");for(var g in a)if(a[g]===false)c=c.replace(new RegExp(this.hashParamRegex.replace("__PARAM__",g)),"$1");else if(c.match(new RegExp("[#?;&]"+g+"="))){var h=new RegExp(this.hashParamRegex.replace("__PARAM__",g));c=c.match(h)?c.replace(h,"$1$2"+a[g]+"$3"):c.replace(g+"=",g+"="+a[g])}else c+=(c?";":"")+g+"="+a[g];c=c.replace(/([?;]);+/g,"$1").replace(/[?;&]$/,"");if(b)return c;if(this.locationURL==="hash"){c=c.replace(/^\?/,"");if(D.location.hash!==c){D.location.hash=c;return true}}else if(D.location.search!==c){D.history.pushState({},"",c);return true}},urlFromHash:function(a,b){var c=(D.location[this.locationURL].replace(/^#/,"?")+";").match(this.locationMatch);c=c?c[1]:this.initialR||"";if(b)return c;var g=c&&this.locationURL==="search"?{r:c}:{};g.r&&f.each(["g","db","mr"],function(h,j){if(o.coreParams[j])g[j]=o.coreParams[j]});f.each(D.location.hash.replace("#","").split(/[;&]/),function(){var h=this.split("=");if(h.length===2)g[h[0]]=h[1]});return this.updateURL(g,a)},thousandify:function(a){a+="";var b=/(\d+)(\d{3})/,c=a.split(".");a=c[0];for(c=c.length>1?"."+c[1]:"";b.test(a);)a=a.replace(b,"$1,$2");return a+c},openMotifWidget:function(a){D.open("/motifWidget.htm?id="+
a,"Motif Feature Widget","width=950,height=550")},populateTemplate:function(a,b){for(var c=/\{\{[\.\w]+\}\}/g,g=[],h;(h=c.exec(a))!=null;)g.push({str:h[0],index:h.index});c=[];for(var j=g.length-1;j>=0;j--){h=g[j].str.replace(/\{|\}/g,"");try{var l=function(m,n){for(;n.length;){var q=n.shift();if(q in m)m=m[q];else throw Error("Missing key '"+q+"'");}return m}(b,h.split("."))}catch(p){throw Error("Ensembl.populateTemplate could not parse '"+h+"': "+p.message);}c.unshift(a.substring(g[j].index+g[j].str.length));c.unshift(l);a=a.substr(0,g[j].index)}c.unshift(a);return c.join("")}});o.Class={};D.Ensembl=o;o.EventLoop={_queue:[],push:function(a){this._queue.push(a);return this},execute:function(a){a&&this.push(a);this._timeout=D.setTimeout(function(){var b=o.EventLoop._queue.shift();if(b){b.method.apply(b.context,b.arguments);o.EventLoop._queue.length&&o.EventLoop.execute()}},0);return this},pause:function(){this._timeout&&D.clearTimeout(this._timeout)},clear:function(){this.pause();this._queue=[]}};o.EventManager={registry:{},deferred:{},register:function(a,b,c){var g=b.id;if(!this.registry[a]){this.registry[a]={};this.registry[a].ref={};this.registry[a].count=0}for(var h in this.getCallIds(g)){this.registry[a].ref[h]||this.registry[a].count++;this.registry[a].ref[h]={};this.registry[a].ref[h].func=c;this.registry[a].ref[h].obj=b;if(this.deferred[a])for(var j=0;j<this.deferred[a].length;j++)this.triggerSpecific.apply(this,[a,h].concat(this.deferred[a][j]))}},unregister:function(a,b){b=b.id;if(this.registry[a]&&this.registry[a].ref[b]){for(var c in this.getCallIds(b)){delete this.registry[a].ref[c];this.registry[a].count--}this.deleteTest(a)}},remove:function(a){var b;for(b in this.registry){if(this.registry[b].ref[a])for(var c in this.getCallIds(a)){delete this.registry[b].ref[c];this.registry[b].count--}this.deleteTest(b)}},getCallIds:function(a){var b=a.split(/--/),c={};b.length>1&&b.push(a);f.each(b,function(){c[this]=1});return c},clear:function(a){this.registry[a]&&delete this.registry[a]},deleteTest:function(a){this.registry[a].count===0&&delete this.registry[a]},trigger:function(a){var b=[].slice.call(arguments,1),c={},g=[],h,j;if(this.registry[a])for(h in this.registry[a].ref){j=this.registry[a].ref[h].func.apply(this.registry[a].ref[h].obj,b);if(typeof j!=="undefined"){c[h]=j;g.push(h)}}if(g.length===1)c=c[g[0]];else if(g.length===0)c=U;return c},deferTrigger:function(a){var b=[].slice.call(arguments,1);this.deferred[a]||(this.deferred[a]=[]);this.deferred[a].push(b);if(this.registry[a])return this.trigger.apply(this,arguments)},triggerSpecific:function(a,b){var c=[].slice.call(arguments,2);if(this.registry[a]&&this.registry[a].ref[b])return this.registry[a].ref[b].func.apply(this.registry[a].ref[b].obj,c)}};o.LayoutManager=new ga;o.LayoutManager.extend({constructor:null,initialize:function(){this.id="LayoutManager";o.EventManager.register("reloadPage",this,this.reloadPage);o.EventManager.register("validateForms",this,this.validateForms);o.EventManager.register("makeZMenu",this,this.makeZMenu);o.EventManager.register("hashChange",this,this.hashChange);o.EventManager.register("markLocation",this,this.updateMarkedLocation);o.EventManager.register("toggleContent",this,this.toggleContent);o.EventManager.register("changeWidth",this,this.changeWidth);f("#page_nav .tool_buttons > p").show();f("#header a:not(#tabs a)").addClass("constant");if(D.location.hash.match(o.locationMatch)){f(".ajax_load").val(function(a,b){return o.urlFromHash(b)});this.hashChange(o.urlFromHash(D.location.href,true))}f(N).find("#static").externalLinks();f(N).on("click",".modal_link",function(){if(o.EventManager.trigger("modalOpen",this))return false}).on("click",".popup",function(){if(D.name.match(/^popup_/))return true;D.open(this.href,"_blank","width=950,height=500,resizable,scrollbars");return false}).on("click",'a[rel="external"]',function(){this.target="_blank"}).on("click","a.update_panel",function(){var a=this.rel,b=o.PanelManager.panels[a];if(b){var c={};f(this).find(".update_url").each(function(){c[this.name]=this.value}).length&&o.updateURL(c);c.update_panel=1;o.EventManager.triggerSpecific("updatePanel",a,o.updateURL(c,b.params.updateURL))}else console.log("Missing panel: "+a);return false}).on("submit","form.update_panel",function(){var a=f(this).serializeArray(),b={},c,g,h;for(var j in a)switch(a[j].name){case"panel_id":c=a[j].value;break;case"url":g=a[j].value;break;case"element":h=a[j].value;break;default:b[a[j].name]=a[j].value;break}g=o.updateURL(f.extend({update_panel:1},b),g);o.EventManager.triggerSpecific("updatePanel",c,g,h,null,b);return false}).on({"keyup.ensembl":function(a){a.keyCode===27&&o.EventManager.trigger("modalClose",true)},"mouseup.ensembl":function(a){if(!a.which||a.which===1)o.EventManager.trigger("mouseUp",a)}});f(".modal_link").show();this.validateForms(N);f(D).on({"resize.ensembl":function(a){if(D.name.match(/^popup_/))return false;if(!a.target.tagName){a=o.width;o.dynamicWidth&&o.setWidth(U,true);o.EventManager.trigger("windowResize");if(o.dynamicWidth&&o.width!==a){o.LayoutManager.changeWidth();o.EventManager.trigger("imageResize")}}},"hashchange.ensembl":f.proxy(this.popState,this),"popstate.ensembl":f.proxy(this.popState,this)});this.showGDPRCookieBanner();this.showTemporaryMessage();this.showMirrorMessage()},reloadPage:function(a,b){if(typeof a==="string")o.EventManager.triggerSpecific("updatePanel",a);else if(typeof a==="object")for(var c in a)o.EventManager.triggerSpecific("updatePanel",c);else return o.redirect(b);f(".session_messages").hide()},validateForms:function(a){f("form._check",a).validate().on("submit",function(){var b=f(this);if(b.parents("#modal_panel").length){for(var c=b.parents(".js_panel").map(function(){return this.id}).toArray(),g;c.length&&typeof g==="undefined";)g=o.EventManager.triggerSpecific("modalFormSubmit",c.shift(),b);return g}})},makeZMenu:function(a,b){f("#"+a).length||o.Panel.ZMenu.template.clone().attr("id",a).appendTo("body");o.EventManager.trigger("addPanel",a,"ZMenu",U,U,b,"showExistingZMenu")},popState:function(){if(o.historyReady&&(D.location[o.locationURL].match(o.locationMatch)&&!(o.locationURL==="search"&&D.location.hash&&!D.location.hash.match(o.locationMatch))||!D.location.hash&&o.hash.match(o.locationMatch))){o.setCoreParams();o.EventManager.trigger("hashChange",o.urlFromHash(D.location.href,true))}},hashChange:function(a){if(a){a=decodeURIComponent(a);var b=a.split(/\W/);b=b[0]+": "+o.thousandify(b[1])+"-"+o.thousandify(b[2]);f("a:not(.constant)").attr("href",function(){var c;if(this.title==="UCSC")this.href=this.href.replace(/(&?position=)[^&]+(.?)/,"$1chr"+o.urlFromHash(this.href,true)+"$2");else if(this.title==="NCBI"){c=o.urlFromHash(this.href,true).split(/[:\-]/);this.href=this.href.replace(/(&?CHR=).+&BEG=.+&END=[^&]+(.?)/,"$1"+c[0]+"&BEG="+c[1]+"&END="+c[2]+"$2")}else return o.urlFromHash(this.href)});f("input[name=r]","form:not(#core_params)").val(a);f("h1.summary-heading").html(function(c,g){return g.replace(/^(Chromosome ).+/,"$1"+b)});N.title=N.title.replace(/(Chromosome ).+/,"$1"+b)}},updateMarkedLocation:function(a){f("a:not(.constant):not(._location_mark)").filter(function(){return this.hostname===D.location.hostname&&!!this.href.match(o.locationMatch)}).attr("href",function(){return o.updateURL({mr:a&&a[0]},this.href)})},toggleContent:function(a,b){if(a)D.setTimeout(function(){f('a.toggle[rel="'+a+'"]').toggleClass("open closed")},b&&f('a.toggle[rel="'+a+'"]').hasClass("open")?b:0)},changeWidth:function(){var a=f("#modal_panel");f(".navbar, div.info, div.hint, div.warning, div.error").not(".fixed_width").not(function(){return a.find(this).length}).width(o.width);a=null},showMirrorMessage:function(){var a=decodeURIComponent(o.cookie.get("redirected_from_url"));if(a){o.cookie.set("redirected_from_url","");a=f("<a>").attr("href",a+(a.match(/\?/)?";redirect=no":"?redirect=no"));if(a.prop("hostname")!=D.location.hostname){a.html("Click here to go back to <b>"+a.prop("hostname")+"</b>");a=f('<div class="redirect-message hidden"><p class="msg">You have been redirected to your nearest mirror. <span class="_redirect_link"></span></p><span class="close">x</span></div>').find("span._redirect_link").append(a).end().appendTo(f("body")).fadeIn();a.find(".close").on("click",{divs:a},function(b){b.preventDefault();b.data.divs.fadeOut(200)});a=a=null}}},showGDPRCookieBanner:function(){var a=f("#gdpr_cookie_name").val(),b=o.cookie.get(a);o.gdpr_version=f("#gdpr_version").val();o.gdpr_policy_url=f("#gdpr_policy_url").val();o.gdpr_terms_url=f("#gdpr_terms_url").val();if(o.gdpr_version&&(!b||b!==o.gdpr_version)){f(["<div class='cookie-message'><p class='msg'>This website requires cookies, and the limited processing of your personal data in order to function. By using the site you are agreeing to this as outlined in our <a target='_blank' href='",o.gdpr_policy_url,"'>Privacy Policy</a> and <a target='_blank' href='",o.gdpr_terms_url,"'> Terms of Use </a></p><div class='agree-button'><a id='gdpr-agree' class='button no-underline'> I Agree </a></div></div>"].join("")).appendTo(N.body).show().find("#gdpr-agree").on("click",function(){o.cookie.set(a,o.gdpr_version,"",true,true);f(this).addClass("clicked").closest(".cookie-message").delay(1E3).fadeOut(100)});return true}return false},showTemporaryMessage:function(){var a=o.cookie.get("tmp_message_ok"),b=f("#tmp_message").remove(),c=b.children("div").text(),g=b.children("input[name=md5]").val(),h=b.children("input[name=colour]").val(),j=parseInt(b.children("input[name=expiry]").val())||24;b=(b.children("input[name=position]").val()||"").split(/\s+/);if(c&&(!a||a!==g)){f(['<div class="tmp-message hidden '+f.makeArray(f.map(f.merge([h],b),function(l){return l?"tm-"+l:null})).join(" ")+'">',"<div>"+c+"</div>","<p><button>Close</button></p></div>"].join("")).appendTo(N.body).show().find("button").on("click",{cookieValue:g,cookieExpiry:(new Date((new Date).getTime()+j*60*60*1E3)).toUTCString()},function(l){l.preventDefault();o.cookie.set("tmp_message_ok",l.data.cookieValue,l.data.cookieExpiry);f(this).parents("div").first().fadeOut(200)});return true}return false}});o.PanelManager=new ga;o.PanelManager.extend({constructor:null,initialize:function(){function a(){f(".ajax_load").length||o.EventManager.trigger("ajaxComplete")}this.id="PanelManager";this.panels={};this.nextId=1;this.panelNumber=0;this.zIndex=101;o.EventManager.register("createPanel",this,this.createPanel);o.EventManager.register("destroyPanel",this,this.destroyPanel);o.EventManager.register("addPanel",this,this.addPanel);o.EventManager.register("panelToFront",this,this.panelToFront);o.EventManager.register("ajaxLoaded",this,a);this.init(f(".js_panel"));a()},init:function(a){var b=[[],[]];a.each(function(){b[0+!!f(this).find(".ajax").length].push(this)});a=b[1].concat(b[0]);f.each(a,function(){(function(c){setTimeout(function(){var g=f("input.panel_type",c).val(),h={};o.PanelManager.generateId(c);f(c).parents(".js_panel").each(function(){h[o.PanelManager.panels[this.id].panelType]=1});h[g]||o.PanelManager.createPanel(c.id,g)},0)})(this)})},generateId:function(a){a.className.match(/js_panel/)||(a=f(".js_panel",a)[0]);if(a){if(!a.id)a.id="ensembl_panel_"+this.nextId++;return a.id}},getPanels:function(a){var b=[],c=[];for(var g in this.panels)if(!a||this.panels[g]instanceof o.Panel[a])b.push("#"+this.panels[g].id);f.each(f(b.join(",")),function(){c.push(o.PanelManager.panels[this.id])});return c},addPanel:function(a,b,c,g,h,j){if(this.panels[a]&&j){o.EventManager.triggerSpecific(j,a,h);this.panelToFront(a)}else{h=h||{};if(g&&c){g.html(c);a=a||this.generateId(g[0])}if(a){this.createPanel(a,b,h);if(!this.panels[a].el)throw Error("Container div 'el' is missing for panel "+a+" ("+b+"). Perhaps panel.init is not called properly.");this.init(f(".js_panel",this.panels[a].el))}}},createPanel:function(a,b,c){this.panels[a]&&this.destroyPanel(a,"cleanup");this.panels[a]=b?new o.Panel[b](a,c):new o.Panel(a,c);this.panels[a].panelNumber=this.panelNumber++;this.panels[a].panelType=b;this.panels[a].init();return this.panels[a]},destroyPanel:function(a,b){if(this.panels[a]!==U){this.panels[a].destructor(b);delete this.panels[a];o.EventManager.remove(a)}},panelToFront:function(a){if(this.panels[a]!==U){this.panels[a].el.css("zIndex",++this.zIndex);this.zIndex>1E6&&this.resetZIndex()}},resetZIndex:function(){function a(g,h){return g.index-h.index}
var b=[],c;this.zIndex=101;for(c in this.panels)b.push({id:c,index:this.panels[c].el.css("zIndex")});for(c in b.sort(a))this.panels[b[c].id].el.css("zIndex",++this.zIndex)}});o.Panel=ga.extend({constructor:function(a,b){if(typeof a!=="undefined")this.id=a;this.params=typeof b==="undefined"?{}:b;this.initialised=false},destructor:function(a){var b;if(a==="empty")this.el.empty().off();else a!=="cleanup"&&this.el.remove();for(b in this.elLk)this.elLk[b]=null;this.el=null},init:function(){var a=this;if(this.initialised)return false;this.el=f("#"+this.id);if(!this.el.length)throw new Error("Could not find "+this.id+", perhaps DOM is not ready");this.elLk={};f("input.js_param",this.el).each(function(){a.params[this.name]||(a.params[this.name]=f(this).hasClass("json")?JSON.parse(this.value):this.value)});this.initialised=true},hide:function(){this.el.hide()},show:function(){this.el.show()},height:function(a){return this.el.height(a)},width:function(a){return this.el.width(a)}});o.DataTable={dataTableInit:function(){var a=this;this.elLk.dataTable.each(function(){for(var b in f.fn.dataTableSettings)if(f.fn.dataTableSettings[b].nTable===this)return;b=f(this);var c=b.hasClass("no_col_toggle"),g=b.hasClass("exportable"),h=a.getOptions(b,c,g);f.fn.dataTableExt.oStdClasses.sWrapper=b.hasClass("toggle_table")?"toggleable toggleTable_wrapper":"dataTables_wrapper";h=b.dataTable(h);var j=h.fnSettings(),l=f(".dataTables_filter input",j.nTableWrapper),p=l.after('<div class="overlay">Filter</div>').on({focus:function(){f(this).siblings(".overlay").hide()},blur:function(){this.value||f(this).siblings(".overlay").show()}});l.val()&&l.val().length&&p.siblings(".overlay").hide();c||a.columnToggle(j);g&&a.makeExportable(j.nTableWrapper);b.hasClass("editable")&&a.makeEditable(b);a.dataTables=a.dataTables||[];a.dataTables.push(h);b=h=null});this.elLk.colToggle=f(".col_toggle",this.el);this.tableFilters()},getOptions:function(a,b,c){var g=f("tbody tr",a).length,h=a.hasClass("no_sort"),j=[[],[]],l={sPaginationType:"full_numbers",aaSorting:[],aoColumnDefs:[],asStripClasses:["bg1","bg2"],iDisplayLength:-1,bAutoWidth:false,oLanguage:{sSearch:"",oPaginate:{sFirst:"&lt;&lt;",sPrevious:"&lt;",sNext:"&gt;",sLast:"&gt;&gt;"}},fnInitComplete:function(){var p=this.is(":hidden"),m=this.closest(".toggleTable_wrapper, .dataTables_wrapper"),n=this.css("display")==="none";if(this[0].style.width!=="100%"){p&&this.show();m.width(this.outerWidth())}if(p&&n){m.hide();this.removeClass("hide")}},fnDrawCallback:function(p){this.togglewrap("redo");f(".dataTables_info, .dataTables_paginate, .dataTables_bottom",p.nTableWrapper)[p._iDisplayLength===-1?"hide":"show"]();var m=this.data(),n=m.defaultHiddenColumns||[],q=f.map(p.aoColumns,function(x,z){return x.bVisible^n[z]?null:z*(n[z]?-1:1)}).join(","),t=f.map(p.aaSorting,function(x){return'"'+x.join(" ")+'"'}).join(",");if(p._bInitComplete!==true)this.data({hiddenCols:q,sorting:t});else{this.fnSettings().oInit.fnInitComplete.call(this);this.data("export",false);for(var v=0;v<p.aoOpenRows.length;v++)p.aoOpenRows[v].nTr.className=p.aoOpenRows[v].nParent.className;if(m.hiddenCols!==q||m.sorting!==t){this.data({hiddenCols:q,sorting:t});f.ajax({url:"/Ajax/data_table_config",data:{id:this.data("code"),sorting:t,hidden_columns:q}})}o.EventManager.trigger("dataTableRedraw")}}};l.aoColumns=f("thead th",a).map(function(){var p=this.className.match(/\s*sort_(\w+)\s*/),m={};p=p?p[1]:"string";if(h||p==="none")m.bSortable=false;else m.sType=f.fn.dataTableExt.oSort[p+"-asc"]?p:"string";return m}).toArray();if(g>10){l.sDom='<"dataTables_top"l'+(b?"":'<"col_toggle">')+(c?'<"dataTables_export">':"")+'f<"invisible">>t<"dataTables_bottom"ip<"invisible">>';f.each([10,25,50,100],function(){if(this<g){j[0].push(this);j[1].push(this)}});j[0].push(-1);j[1].push("All")}else l.sDom='<"dataTables_top"'+(b?"":'<"col_toggle left">')+(c?'<"dataTables_export">':"")+'<"dataTables_filter_overlay">f<"invisible">>t';l.aLengthMenu=j;f("input",a.siblings("div.data_table_config")).each(function(){if(this.name==="code")a.data("code",this.value);else{var p=JSON.parse(this.value.replace(/'/g,'"'));if(this.name==="hiddenColumns")f.each(p,function(){if(l.aoColumns[this])l.aoColumns[this].bVisible=false});else if(this.name.indexOf("expopts")!==0)if(typeof l[this.name]==="object")f.extend(true,l[this.name],p);else l[this.name]=p}});if(l.defaultHiddenColumns){a.data("defaultHiddenColumns",l.defaultHiddenColumns);delete l.defaultHiddenColumns}a=null;return l},buttonText:function(a){var b=a.aoColumns,c=0;f.each(b,function(g){b[g].bVisible||c++});a="";if(c)a=" ("+c+" hidden)";return"Show/hide columns"+
a},columnToggle:function(a){var b=this,c=a.aoColumns,g=f('<ul class="floating_popup"></ul>'),h=f('<div class="toggle">'+b.buttonText(a)+"</div>").append(g).on("click",function(j){if(j.target===this){g.toggle();if(g.is(":hidden")){h.remove();b.columnToggle(a)}}});f.each(c,function(j){var l=f(this.nTh),p=f(l).clone().find(".hidden").remove().end().html();f("<li>",{html:'<input data-role="none" type="checkbox"'+(l.hasClass("no_hide")?" disabled":"")+(c[j].bVisible?" checked":"")+" /><span>"+p+"</span>",click:function(){var m=f("input",this),n,q,t,v;if(!m.prop("disabled")){n=f.grep(b.dataTables,function(x){return!x.is(".no_col_toggle")});q=!c[j].bVisible;if(b.elLk.colToggle.length===1)m.prop("checked",q);else{t=f(this).index();v=f(this).parent().text();n=[];b.elLk.colToggle.each(function(x){if(f(this).find("ul").text()===v){f("input",this).get(t).checked=q;n.push(b.dataTables[x])}})}f.each(n,function(){this.fnSetColumnVis(j,q)})}m=null}}).appendTo(g);l=null});f(".col_toggle",a.nTableWrapper).append(h)},makeExportable:function(a){function b(){f(this).children().toggle();o.browser.ie67&&f(this).siblings(".dataTables_filter").toggle()}f(".dataTables_top .dataTables_export",a).append('<div class="floating_popup"><a>Download what you see</a><a class="all">Download whole table</a></div>').hover(b,b).on("click",function(c){var g=f(this).parent().next(),h=g.dataTable().fnSettings(),j=f(h.nTableWrapper).siblings("form.data_table_export"),l;if(c.target.className==="all"){if(!g.data("exportAll")){l=[[]];var p=[];f.each(h.aoColumns,function(m,n){if(f(n.nTh).hasClass("_no_export"))p.push(m);else{m=f("<div/>");m.append(n.sTitle);var q=f(".hidden:not(.export)",f(m));q.length?l[0].push(f.trim(f(m).find(q).remove().end().html())):l[0].push(n.sTitle)}});f.each(h.aoData,function(m,n){var q=[];f(n._aData).each(function(t,v){var x=f("<div/>");x.append(v);if(f.inArray(t,p)==-1){t=f(".hidden:not(.export), ._no_export",f(x));t.length?q.push(f.trim(f(x).find(t).remove().end().html())):q.push(v)}});l.push(q)});g.data("exportAll",l);j.find("input.data").val(JSON.stringify(l))}}else if(!g.data("export")){c=g.clone();l=[];f(c).find(".hidden:not(.export), ._no_export").remove();f("tr",c).each(function(m){l[m]=[];f(this.cells).each(function(){l[m].push(f(this).html())})});g.data("export",l);j.find("input.data").val(JSON.stringify(l))}j.trigger("submit");g=j=null});a=null},makeEditable:function(a){function b(g){if(g.is(":hidden")){g=null;return false}var h=g.parents("td"),j=g.hide().val().replace(/<[^>]+>/g,""),l=g.attr("name");g.siblings().show();if(g.data("oldVal")!==j){g.data("oldVal",j);g.parent().find(".val").html(j.replace(/\n/g,"<br />"));g.parents("table").dataTable().fnUpdate(h.html(),h.parent()[0],h.index());typeof c.saveEdit==="function"?c.saveEdit(l,j,h):f.ajax({url:h.find("a.save").attr("href"),data:{param:l,value:j},success:function(p){if(p==="reload")c instanceof o.Panel.ModalContent?c.el.append('<div class="modal_reload"></div>'):o.EventManager.trigger("queuePageReload","",false,false)}})}g=h=null}var c=this;a.on("click",".editable",function(g){f(g.target).is(".val")&&f(this).find(":input").val(f(this).find(".val").html().replace(/\n/g,"").replace(/<br( \/)?>/g,"\n").replace(/<[^>]+>/g,"")).show().trigger("focus").siblings().hide()}).on({blur:function(){b(f(this))},keydown:function(g){if(g.keyCode===13&&!g.shiftKey)return false},keyup:function(g){g.keyCode===13&&!g.shiftKey&&b(f(this))}},".editable :input");a=null},tableFilters:function(){var a=this,b=f("input.table_filter",this.el);if(b.length){f.fn.dataTableExt.afnFiltering.push(function(c,g,h){if(c.classFilter){g=c.classFilter.length;for(h=" "+c.aoData[h].nTr.className+" ";g--;)if(h.indexOf(c.classFilter[g])!==-1)return true;return false}return true});b.on("click",function(){var c=[],g=f("#"+this.name,a.el).dataTable(),h=g.fnSettings();if(this.checked)if(this.value==="all")f("input.table_filter[name="+this.name+"]",a.el).not("[value=all]",a.el).prop("checked",false);else{f("input.table_filter[name="+this.name+"][value=all]",a.el).prop("checked")===true&&f("input.table_filter[name="+
this.name+"][value=all]",a.el).prop("checked",false);var j=f("input.table_filter[name="+this.name+"]",a.el).length;if(f("input.table_filter[name="+this.name+"]:checked",a.el).length>=j-1){f("input.table_filter[name="+this.name+"]:checked",a.el).prop("checked",false);f("input.table_filter[name="+this.name+"][value=all]",a.el).prop("checked",true)}}else f("input.table_filter[name="+this.name+"]:checked",a.el).length===0&&f("input.table_filter[name="+this.name+"][value=all]",a.el).prop("checked",true);f("input.table_filter[name="+this.name+"]",a.el).each(function(){this.checked&&c.push(" "+this.value+" ")});if(c.length)h.classFilter=c;else delete h.classFilter;g.fnFilter(f(".dataTables_filter input",h.nTableWrapper).val());g=null;o.EventManager.trigger("dataTableFilterUpdated",c)});b=null}}};o.Share={shareInit:function(a){var b=this;this.shareOptions=f.extend({species:{},type:"page",positionPopup:function(c,g){return c.css({top:f(g).offset().top+1,left:this.el.outerWidth(true)})}},a);this.elLk.shareLink=f("a.share",this.el).on("click",function(){if(b.elLk.share)b.elLk.share.data("loading")||b.shareOptions.positionPopup.call(b,b.elLk.share,this).toggle();else{b.elLk.share=f('<div class="share_page info_popup"><span class="close"></span></div>').appendTo("body").css("left",b.el.offset().left).data("loading",true);b.elLk.shareSpinner=f('<div class="spinner"></div>').appendTo(b.elLk.share);b.share(this.href,this);b.elLk.share.on("click",".close, .cancel",function(){b.elLk.share.hide()}).on("click",".url",function(){f(this).select()});b.elLk.shareLink.data("popup",b.elLk.share)}return false})},share:function(a,b){var c=this;if(this.elLk.share){this.shareOptions.positionPopup.call(this,this.elLk.share,b);this.shareTimeout=setTimeout(function(){c.elLk.share.add(c.elLk.shareSpinner).show()},200);if(this.shareEnabled===false)this.shareWaiting=true;else f.ajax({url:a,dataType:"json",data:{species:JSON.stringify(this.shareOptions.species),hash:D.location.hash.replace("#","")},success:function(g){clearTimeout(c.shareTimeout);c.elLk.shareSpinner.hide();if(g.url){g.url=f("<a>").attr("href",g.url).prop("href");if(!f(".url",c.elLk.share).val(g.url).add(".copy",c.elLk.share).show().length){c.elLk.share.find(".fbutton").addClass("bottom-margin");c.elLk.shareSpinner.before('<p class="copy">Copy this link:</p><input class="url" type="text" value="'+g.url+'" />')}}else if(g.confirmShare){c.elLk.shareSpinner.before("<p>This "+c.shareOptions.type+" is displaying some custom tracks.<br />Select which of these you'd like to share:</p><ul>"+
f.map(g.confirmShare,function(h){return"<li><label>"+h[0]+'</label><input class="file" type="checkbox" value="'+h[1]+'" /></li>'}).join("")+'</ul><input type="button" class="go fbutton" value="Accept" /><input type="button" class="cancel fbutton" value="Cancel" />');f(".go",c.elLk.share).on("click",function(){f(".url",c.elLk.share).add(".copy",c.elLk.share).hide();c.elLk.shareSpinner.show();c.share(a+";custom_data="+(f(".file",c.elLk.share).map(function(){return this.checked?this.value:U}).toArray().join(",")||"none"),b)})}c.elLk.share.show().removeData("loading")},error:function(){c.elLk.share.remove();delete c.elLk.share}})}},removeShare:function(){if(this.elLk.share){this.elLk.share.remove();delete this.elLk.share}}};o.Panel.CloudMultiSelector=o.Panel.extend({constructor:function(a,b){this.base(a);this.urlParam=b.urlParam;this.params=b;this.userInteraction="";this.selection=[];o.EventManager.register("updateConfiguration",this,this.updateSelection)},set_selection:function(){var a=this;if(a.orig){a.changed_on=[];a.changed_off=[];f(".cloud_multi_selector_list li",a.elLk.content).each(function(){var b=f(this).data("key"),c="on";if(f(this).hasClass("off"))c="off";if(f(this).hasClass("partial"))c="partial";if(c!=a.orig[b])c=="on"?a.changed_on.push(b):a.changed_off.push(b)});a.changed=a.changed_on.length||a.changed_off.length}else{a.orig={};f(".cloud_multi_selector_list li",a.elLk.content).each(function(){var b="on";if(f(this).hasClass("off"))b="off";if(f(this).hasClass("partial"))b="partial";a.orig[f(this).data("key")]=b});a.changed=false}},reset_selection:function(){delete this.orig_selection;this.set_selection()},init:function(){var a=this;this.base();this.elLk.content=f(".modal_wrapper",this.el);this.elLk.list=f(".cloud_multi_selector_list li",this.elLk.content);this.elLk.filter=f(".cloud_filter input",this.el);this.elLk.clear=f(".cloud_filter_clear",this.el);this.elLk.all=f(".all",this.el);this.elLk.none=f(".none",this.el);a.set_selection();f(a.el).on("filter",function(b,c){a.elLk.list.each(function(){var g=f(this);g.text().toLowerCase().indexOf(c.toLowerCase())==0?g.removeClass("hidden"):g.addClass("hidden")});c?a.elLk.clear.show():a.elLk.clear.hide();a.elLk.filter.focus()});this.elLk.list.click(function(){a.userInteraction="partial";f(this).hasClass("partial")?f(this).removeClass("partial"):f(this).toggleClass("off");a.set_selection();a.elLk.filter.focus();return false});this.elLk.all.click(function(){a.userInteraction="all-on";a.elLk.list.removeClass("off");a.set_selection();return false});this.elLk.none.click(function(){a.userInteraction="all-off";a.elLk.list.addClass("off");a.set_selection();return false});this.set_selection();this.val="";a.elLk.filter.val("");a.elLk.clear.hide();this.elLk.filter.on({"keydown paste keyup mouseup blur":function(){var b=a.elLk.filter.val();if(a.val!=b){f(a.el).trigger("filter",[b]);a.val=b}}}).focus();f(this.el).click(function(){a.elLk.filter.focus()});a.elLk.clear.click(function(){a.val="";a.elLk.filter.val("");f(a.el).trigger("filter",[""])})}});o.Panel.Content=o.Panel.extend({init:function(){this.base();this.xhr=false;var a={ajaxLoad:f(".ajax",this.el),hideHints:f(".hint",this.el),helpTips:f("._ht",this.el),zMenuLink:f("._zmenu",this.el),wrapping:f("table.cellwrap_inside, table.heightwrap_inside",this.el),selectToToggle:f("._stt",this.el),selectAll:f("input._selectall",this.el),filterable:f("._fd",this.el),speciesDropdown:f("._sdd",this.el),toggleButtons:f(".tool_buttons a.togglebutton",this.el),dataTable:f("table.data_table",this.el),redirectForm:f("form._redirect",this.el),newTable:f(".new_table",this.el)};this.el.hasClass("ajax")&&f.extend(a.ajaxLoad,this.el);f.extend(this.elLk,a);this.toggleable();f(this).afterimage();this.el.on("click","a._motif",function(c){c.preventDefault();o.openMotifWidget(f(this).html())});for(var b in a)a[b].length&&this[b]();o.EventManager.register("updatePanel",this,this.getContent);this.el.parent(".initial_panel")[0]===o.initialPanels.get(-1)&&o.EventManager.register("hashChange",this,this.hashChange);o.EventManager.trigger("validateForms",this.el);o.EventManager.deferTrigger("relocateTools",this.el.find(".other_tool"));D.name.match(/^popup_/)&&f("a:not(.cp-internal, .popup)",this.el).on("click",function(){D.open(this.href,D.name.replace(/^popup_/,"")+"_1");return false});this.el.externalLinks()},ajaxLoad:function(){var a=this;f(".navbar",this.el).width(o.width);if(f.find(".js_panel .error.fatal").length)return false;this.elLk.ajaxLoad.each(function(){var b=f(this),c=b.find("input.ajax_load").val(),g={};if(c){if(c.match(/\?/))c=o.replaceTimestamp(c);else c+="?";b.find("input.ajax_post").each(function(h,j){g[j.name]=j.value});a.getContent(c,f(this),{updateURL:c+";update_panel=1",updateType:f.isEmptyObject(g)?"get":"post",updateData:g})}})},getContent:function(a,b,c,g,h){var j,l,p;h=h||{};p=h.background||0;if(typeof b==="string"){b=f(b,this.el);p||b.empty()}else f(".js_panel",b||this.el).each(function(){o.EventManager.trigger("destroyPanel",this.id)});c=c||this.params;a=a||o.replaceTimestamp(c.updateURL);b=b||this.el;p||b.empty();switch(b[0].nodeName){case"DL":j="dt";break;case"UL":case"OL":j="li";break;default:j="p";break}p||b.append("<"+j+' class="spinner ajax_pending">Loading component</'+j+">");if(g===true)D.location.hash=b[0].id;else g&&o.updateURL(g);l=c.updateData||(typeof g==="object"?g:{})||{};if(c.updateType==="post")f.each((a.split(/\?/)[1]||"").split(/&|;/),function(m,n){n=n.split("=");if(typeof n[0]!=="undefined"&&!(n[0]in l))l[n[0]]=n[1]});this.xhr=f[h.paced?"paced_ajax":"ajax"]({url:a,data:l,dataType:"html",context:this,type:c.updateType,success:function(m){p&&b.empty();if(m){o.EventManager.trigger("addPanel",U,f((m.match(/<input[^<]*class="[^<]*panel_type[^<]*"[^<]*>/)||[])[0]).val()||"Content",m,b,c);if(g===true){D.location.hash="_";D.location.hash=b[0].id}}else b.html("");o.EventManager.trigger("ajaxLoaded")},error:function(m){m.status!==0&&b.html('<div class="error ajax_error"><h3>Ajax error</h3><div class="error-pad"><p>Sorry, the page request "'+a+'" failed to load.</p></div></div>')},complete:function(){b=null;this.xhr=false}})},addContent:function(a,b){var c=f('<div class="js_panel">').appendTo(this.el),g=1;if(b)c.addClass(b);else b="anchor";for(;N.getElementById(b);)b+=g++;c.attr("id",b+"Panel");this.getContent(a,c,this.params,true);return c},toggleable:function(){var a=this,b={};f("a.toggle, .ajax_add",this.el).on("click",function(c){c.preventDefault();c=c.which&&f(this).hasClass("_slide_toggle")?parseInt((this.className.match(/_slide_toggle_(\d+)/)||[300]).pop()):U;if(f(this).hasClass("ajax_add")){var g=f("input.url",this).val();if(g)if(a.elLk[this.rel]){a.toggleContent(f(this),c);D.location.hash=a.elLk[this.rel][0].id}else a.elLk[this.rel]=a.addContent(g,this.rel)}else{a.toggleContent(f(this),c);if(a.elLk[this.rel]&&f(this).hasClass("closed"))if(a.elLk[this.rel][0].id)D.location.hash=a.elLk[this.rel][0].id}o.EventManager.trigger("toggleContent",this.rel,c);return false}).filter("[rel]").each(function(){var c=o.cookie.get("toggle_"+this.rel);if(f(this).hasClass("closed")){var g="[#?;&]"+this.rel+"(Panel)?[&;]*";if(c==="open"||o.hash.match(new RegExp(g)))b[this.rel]=this}else if(f(this).hasClass("open")&&c==="closed")b[this.rel]=this});f.each(b,function(){f(this).trigger("click")})},toggleContent:function(a,b){var c=a.attr("rel"),g=b?"slideToggle":"toggle",h=a.html();if(c){if(this.id===c+"Panel")this.el.find(".toggleable")[g](b);else{this.elLk[c]||(this.elLk[c]=f("."+c,this.el));this.elLk[c].find(".toggleable:first").addBack(".toggleable")[g](b).length||a.siblings(".toggleable")[g](b)}if(h.match(/Show/)&&a.hasClass("toggle_link"))a.html("Hide");else h.match(/Hide/)&&a.hasClass("toggle_link")&&a.html("Show");if(a.hasClass("set_cookie"))o.cookie.set("toggle_"+c,a.hasClass("open")?"closed":"open")}else a.toggleClass("open closed").siblings(".toggleable")[g](b)},hashChange:function(){this.params.updateURL=o.urlFromHash(this.params.updateURL);if(this.xhr){this.xhr.abort();this.xhr=false}this.getContent(o.replaceTimestamp(this.params.updateURL+";hash_change="+o.lastR))},hideHints:function(){this.elLk.hideHints.each(function(){var a=f(this);f('<img src="/i/close.png" alt="Hide" title="" />').on("click",function(){var b=[];a.hide();o.hideHints[a[0].id]=1;for(var c in o.hideHints)b.push(c);o.cookie.set("ENSEMBL_HINTS",b.join(":"))}).prependTo(this.firstChild).helptip({content:"Hide this panel"})})},dataTable:function(){f.extend(this,o.DataTable);this.dataTableInit()},helpTips:function(){this.elLk.helpTips.helptip()},zMenuLink:function(){this.elLk.zMenuLink.zMenuLink()},wrapping:function(){this.elLk.wrapping.togglewrap()},selectToToggle:function(){this.elLk.selectToToggle.selectToToggle({},this.el)},selectAll:function(){this.elLk.selectAll.on("change",function(){f(this).parents("div._selectall").find("input[type=checkbox]").prop("checked",this.checked)})},filterable:function(){this.elLk.filterable.filterableDropdown()},speciesDropdown:function(){this.elLk.speciesDropdown.speciesDropdown()},toggleButtons:function(){this.elLk.toggleButtons.toggleButtons()},redirectForm:function(){this.elLk.redirectForm.on("submit",function(){this.action=f(this).find("select[name=url]").val()})},newTable:function(){this.elLk.newTable.newTable()}});o.Panel.LocalContext=o.Panel.extend({init:function(){var a=this;this.base();f.extend(this,o.Share);this.shareInit();o.EventManager.register("removeShare",this,this.removeShare);o.EventManager.register("hashChange",this,this.removeShare);o.EventManager.register("reloadPage",this,this.removeShare);o.EventManager.register("ajaxComplete",this,this.shareReady);o.EventManager.register("share",this,this.share);if(!this.el.hasClass("modal_nav")){o.EventManager.register("relocateTools",this,this.relocateTools);this.pulseToolButton()}this.elLk.links=f("ul.local_context li",this.el);f("img.toggle",this.elLk.links).on("click",function(){var b=f(this).parent();b.toggleClass("closed");var c=b.hasClass("closed")?"closed":"open",g=(a instanceof o.Panel.ModalContent?a.params.url:D.location.pathname).replace(o.speciesPath+"/","").split("/")[0];f(this).attr("src",function(h,j){return j.replace(/closed|open/,c)});f.ajax({url:"/Ajax/nav_config",data:{code:g,menu:this.className.replace(/toggle|\s/g,""),state:c==="closed"^b.hasClass("default_closed")?1:0}});b=null;return false});this.el.find("._ht").helptip()},relocateTools:function(a){var b=this.el.find(".tool_buttons");a.each(function(){var c=f(this).find("a")[0],g=c?f(".additional ."+c.className.replace(" ","."),b):[];g.length?g.replaceWith(c):f(this).children().addClass("additional").appendTo(b).not(".hidden").show()}).remove();this.pulseToolButton();a=null},pulseToolButton:function(){f(".tool_buttons a.pulse:not(.pulsing)",this.el).one("click",function(){clearInterval(f(this).stop().removeClass("pulse").css({backgroundColor:"",color:""}).data("interval"))}).addClass("pulsing").each(function(){var a=f(this).data({dark:false,interval:setInterval(function(){var b=a.data();a.toggleClass("pulse",!b.dark,1E3);b.dark=!b.dark},1E3)})})},shareReady:function(){var a=this;this.shareOptions.species={};f.each(o.PanelManager.getPanels("ImageMap"),function(){a.shareOptions.species[this.id]=this.getSpecies()});this.elLk.shareLink.length>0&&this.elLk.shareLink[0].href&&o.EventManager.deferTrigger("share",this.elLk.shareLink[0].href,this.elLk.shareLink[0]);o.EventManager.unregister("ajaxLoaded",this)}});o.Panel.LocationNav=o.Panel.extend({constructor:function(a,b){this.base(a,b);this.geneCache={};this.geneIDCache={};this.sliderConfig=false;this.extraParams={};this.refreshOnly=true;this.alignmentPage=false;o.EventManager.register("hashChange",this,this.getContent);o.EventManager.register("changeWidth",this,this.resize);o.EventManager.register("imageResize",this,this.resize);if(D.location.pathname.match(/\/Multi/)){this.extraParams={realign:1};this.refreshOnly=false}},currentLocations:function(){var a={},b=new RegExp(/^([^:]*):([^-]*)-([^:]*)(:.*)?/);f.each(D.location.search.replace(/^\?/,"").split(/[;&]/),function(c,g){c=g.split("=");if(c[0].match(/^r[0-9]*$/)){g=decodeURIComponent(c[1]).match(b);a[c[0]]=[g[1],parseInt(g[2]),parseInt(g[3]),g[4]||""]}});return a},newHref:function(a,b){var c=D.location.href.split("?"),g=[];b=b||{};f.each(c[1].split(/[;&]/),function(j,l){j=l.split("=");if(j[0].match(/^r[0-9]*$/)&&a[j[0]])g.push(j[0]+"="+a[j[0]][0]+":"+a[j[0]][1]+
"-"+a[j[0]][2]+(a[j[0]][3]||""));else if(j[0]in b){g.push(j[0]+"="+b[j[0]]);delete b[j[0]]}else g.push(j[0]+"="+decodeURIComponent(j[1]))});for(var h in b)g.push(h+"="+b[h]);for(h in this.extraParams)g.push(h+"="+this.extraParams[h]);return c[0]+"?"+g.sort(function(j,l){return j.split("=")[0]>l.split("=")[0]}).join(";")},arrowHref:function(a){var b=this,c=this.currentLocations();f.each(c,function(g,h){h[1]+=a;h[2]+=a;if(g=="r"){if(h[1]>b.sliderConfig.length)h[1]=b.sliderConfig.length-b.sliderConfig.min;if(h[2]>b.sliderConfig.length)h[2]=b.sliderConfig.length;if(h[1]<1)h[1]=1;if(h[2]<1)h[2]=b.sliderConfig.min}});return this.newHref(c)},zoomHref:function(a){var b=this.currentLocations();b=this.rescale(b,(b.r[2]-b.r[1])*a);a>1&&f.each(b,function(c,g){g[1]==g[2]&&g[2]++});return this.newHref(b)},rescale:function(a,b){var c=this;b=Math.round(b);var g={};f.each(a,function(h,j){var l=Math.max(Math.round((Math.round(j[1]+j[2])-b)/2),1),p=l+b+1;if(h=="r"){l=Math.max(Math.min(l,c.sliderConfig.length-c.sliderConfig.min),1);p=Math.min(p,c.sliderConfig.length)}g[h]=[j[0],l,p,j[3]]});return g},updateButtons:function(a){a=Math.round(typeof a==="undefined"?this._val2pos():a);var b=this.currentLocations(),c=b.r[2]-b.r[1]+1;this.elLk.left1.attr("href",this.arrowHref(-c));this.elLk.left2.attr("href",this.arrowHref(-1000000));this.elLk.right1.attr("href",this.arrowHref(c));this.elLk.right2.attr("href",this.arrowHref(1E6));this.elLk.zoomIn.attr("href",this.zoomHref(0.5)).toggleClass("disabled",a===0).helptip(a===0?"disable":"enable");this.elLk.zoomOut.attr("href",this.zoomHref(2)).toggleClass("disabled",a===100).helptip(a===100?"disable":"enable");this.elLk.regionInput.val(b.r[0]+":"+b.r[1]+"-"+b.r[2])},init:function(){this.base();this.elLk.navbar=this.el.find(".navbar");this.elLk.imageNav=this.elLk.navbar.find(".image_nav");this.elLk.forms=this.elLk.navbar.find("form");this.elLk.navLinks=this.elLk.imageNav.find("a");this.alignmentPage=!!this.elLk.forms.first().closest(".alignment_select").length;this.initNavForms();this.initNavLinks();this.initSlider();this.resize()},initNavForms:function(){var a=this;this.elLk.regionInput=this.elLk.forms.find("input[name=r]");this.elLk.geneInput=this.elLk.forms.find("input[name=q]");this.elLk.forms.on("submit",function(b){b.preventDefault();b={};var c,g;if(a.alignmentPage)return o.redirect(a.newHref([],function(h){var j={};f.each(h.serializeArray(),function(l,p){j[p.name]=p.value});return j}(f(this))));if(this.className.match(/_nav_gene/)){g=function(h,j,l){if(j){h.elLk.geneInput.autocomplete("close").val(j.label||j.g);h.updateURL({g:j.g,db:j.db,r:j.r})}else alert("No gene found for '"+l+"'")};c=this.q.value.trim().toUpperCase();if(c.length<3)alert("Please type in at least 3 characters to get a list of matching genes");else(b=(a.geneCache[c.substr(0,3)]||{})[c]||a.geneIDCache[c])?g(a,b,c):f.ajax({url:o.speciesPath+"/Ajax/autocomplete_geneid",cache:true,data:{q:c},dataType:"json",context:{panel:a,stableID:c,goToGene:g},success:function(h){if(this.stableID in h)this.panel.geneIDCache[this.stableID]=h[this.stableID];this.goToGene(this.panel,this.panel.geneIDCache[this.stableID],this.stableID)}})}else a.updateURL({r:this.r.value.trim()})}).find("a").on("click",function(b){b.preventDefault();f(this).closest("form").trigger("submit")});this.elLk.geneInput.autocomplete({minLength:3,source:function(b,c){var g={panel:a,term:b.term,key:b.term.substr(0,3).toUpperCase(),callback:function(h,j){var l=new RegExp("^"+f.ui.autocomplete.escapeRegex(h),"i");return c(f.map(j,function(p,m){return l.test(m)?p.label:null}))}};if(g.key in
a.geneCache)return g.callback(b.term,a.geneCache[g.key]);f.ajax({url:o.speciesPath+"/Ajax/autocomplete",cache:true,data:{q:g.key},dataType:"json",context:g,success:function(h){this.panel.geneCache[this.key]=h},complete:function(){return this.callback(this.term,this.panel.geneCache[this.key])}})},select:function(b,c){f(this).closest("form").find("input[name=q]").val(c.item.value).end().trigger("submit")}})},updateURL:function(a){var b=a.r.match(/^([^:]+):\s?([0-9\,]+)(-|_|\.\.)([0-9\,]+)$/);if(!b||b.length!==5||b[4]-b[2]<0)alert("Invalid location: "+a.r);else if(this.refreshOnly){o.updateURL(f.extend({},this.extraParams,{g:a.g,db:a.db}));a=b[1].replace(/^(chr)/,"")+":"+b[2].replace(/\,/g,"")+b[3].replace(/(_|\.\.)/,"-")+b[4].replace(/\,/g,"");a=a.replace(/\s/g,"");o.updateLocation(a)}else o.redirect(this.newHref([],a))},initNavLinks:function(){var a=this;this.elLk.navLinks.helptip().addClass("constant").on("click",function(b){if(this.className.match(/disabled/))return false;if(a.refreshOnly){b.preventDefault();b=this.href.match(o.locationMatch)[1];b!==o.coreParams.r&&o.updateLocation(b)}})},initSlider:function(){var a=this;try{this.sliderConfig=f.parseJSON(this.elLk.imageNav.find("span.ramp").remove().text())}catch(b){return}if(this.sliderConfig){this.elLk.slider=this.elLk.imageNav.find(".slider_wrapper").show().find(".slider");this.elLk.sliderLabel=this.elLk.imageNav.find(".slider_label").hide();this.elLk.zoomIn=this.elLk.navLinks.filter(".zoom_in");this.elLk.zoomOut=this.elLk.navLinks.filter(".zoom_out");this.elLk.left1=this.elLk.navLinks.filter(".left_1");this.elLk.left2=this.elLk.navLinks.filter(".left_2");this.elLk.right1=this.elLk.navLinks.filter(".right_1");this.elLk.right2=this.elLk.navLinks.filter(".right_2");this.elLk.slider.slider({value:this._val2pos(),step:1,min:0,max:100,force:false,slide:function(c,g){a.elLk.sliderLabel.html(a._pos2val(g.value)+" bp").show()},change:function(c,g){if(!a.elLk.slider.slider("option","fake")){c=a.rescale(a.currentLocations(),a._pos2val(g.value));if(c.r[2]-
c.r[1]>1E6)c.r[2]=c.r[1]+1E6;a.refreshOnly?o.updateLocation(c.r[0]+":"+c.r[1]+"-"+c.r[2]):o.redirect(a.newHref(c))}},stop:function(c,g){a.elLk.sliderLabel.hide();f(g.handle).trigger("blur")}});this.updateButtons()}},getContent:function(){if(this.elLk.slider){var a=this._val2pos();this.elLk.slider.slider("option","fake",true);this.elLk.slider.slider("value",a);this.elLk.slider.slider("option","fake",false);this.updateButtons(a)}},resize:function(){var a={navbar:this.elLk.navbar.width(),slider:this.elLk.imageNav.width(),forms:this.elLk.forms.width()};if(a.navbar<a.forms+a.slider)this.elLk.navbar.removeClass("narrow1").addClass("narrow2");else a.navbar<a.forms*this.elLk.forms.length+a.slider?this.elLk.navbar.removeClass("narrow2").addClass("narrow1"):this.elLk.navbar.removeClass("narrow1 narrow2");this.elLk.slider&&this.updateButtons()},_val2pos:function(){var a=this.currentLocations();a=a.r[2]-a.r[1]+1;var b=(Math.log(this.sliderConfig.max)-Math.log(this.sliderConfig.min))/100,c=Math.log(this.sliderConfig.min);return Math.min(Math.max((Math.log(a)-
c)/b,0),100)},_pos2val:function(a){var b=(Math.log(this.sliderConfig.max)-Math.log(this.sliderConfig.min))/100,c=Math.log(this.sliderConfig.min);a=Math.exp(a*b+c);b=Math.pow(10,2-Math.ceil(Math.log(a)/Math.LN10));return Math.round(Math.round(a*b)/b)}});o.Panel.Masthead=o.Panel.extend({constructor:function(a){this.moreShown=this.longTabs=false;this.recentLocations={};this.base(a);o.EventManager.register("windowResize",this,this.resize);o.EventManager.register("hashChange",this,this.hashChange);o.EventManager.register("deleteBookmark",this,this.deleteBookmark)},init:function(){var a=this;this.base();var b=f(".tabs_holder",this.el),c=f(".tabs",b),g=f(".spbar_holder",this.el),h=f(".tools_holder",this.el),j=f(".logo_holder",this.el);this.elLk.allTabs=f("li",c);this.elLk.shortTabs=f("li.short_tab",c);this.elLk.longTabs=f("li.long_tab",c);this.elLk.toolsUl=f(".tools",h);this.elLk.tools=f("li",this.elLk.toolsUl);this.elLk.toolMore=f(".more",h);this.elLk.toolMoreUl=f('<ul class="more_tools" />').appendTo(this.elLk.toolMore);this.elLk.dropdowns=f("div.dropdown",b).on("click",function(){f(this).css("zIndex",++o.PanelManager.zIndex)});this.el.find("._ht").helptip();this.elLk.dropdowns.filter(".location").find("ul.recent li a").each(function(){a.recentLocations[f(this).text()]=1});f("a.clear_history",this.elLk.dropdowns).on("click",function(){var l=f(this).parent();f.ajax({url:this.href,success:function(){var p=l.parents(".dropdown").find(".recent li");l.remove();a.deleteFromDropdown(p);l=null}});return false});D.location.hash&&this.hashChange(o.urlFromHash(D.location.href,true),true);f(".toggle",c).each(function(){f(this).data("cls","."+(this.rel||this.title)).removeAttr("title")}).on("click",function(){var l=f(this).data("cls"),p=a.elLk.dropdowns.filter(l);a.dropdownPosition(p,f(this).parents("li"));p.not(":visible").css("zIndex",++o.PanelManager.zIndex).end().toggle();a.elLk.allTabs.filter(l).find("a.toggle").html(p.is(":visible")?"&#9650;":"&#9660;");p.data("type",l);return false});this.elLk.sppDropdown=f("div.dropdown",g).on("click",function(){f(this).css("zIndex",++o.PanelManager.zIndex)});this.elLk.sppToggle=f("a.toggle",g).on("click",function(){var l=a.elLk.sppDropdown;a.dropdownPosition(l,f(this));l.not(":visible").css("zIndex",++o.PanelManager.zIndex).end().toggle();f(this).html(l.is(":visible")?"&#9650;":"&#9660;");return false});this.elLk.toolMore.children("a").on("click",function(){f(this).toggleClass("open");a.elLk.toolMoreUl.html(a.elLk.toolsOverflow.clone()).toggle();a.moreShown=true;return false});this.toolsShown=this.elLk.tools.length;this.widths={search:f(".search_holder",this.el).outerWidth(true),logo:j.outerWidth(true)+j.offset().left,more:this.elLk.toolMore.outerWidth(true)};this.setWidth("tools");this.elLk.longTabs.show();this.setWidth("longTabs");this.elLk.longTabs.hide();this.resize();b=c=h=j=null},dropdownPosition:function(a,b,c){var g={},h;if(c||!a.data("positioning:"+this.longTabs)){c=b.outerWidth();h=a.outerWidth();g.left=b.offset().left;if(!b.hasClass("species"))g.width=c>h?c-(h-a.width()):"auto";a.data("positioning:"+this.longTabs,g)}a.css(a.data("positioning:"+this.longTabs))},deleteFromDropdown:function(a){if(a.length){var b=a.parent();a.remove();b.children().length||b.hide().prev("h4").hide();b.siblings("ul:visible").length?this.dropdownPosition(b.parent(),this.elLk.allTabs.filter(b.parent().data("type")+":visible"),true):this.elLk.allTabs.filter(b.parent().data("type")).find(".toggle").hide().first().trigger("click").end().parent().addClass("empty")}},deleteBookmark:function(a){this.deleteFromDropdown(f(".bookmarks ."+
a,this.elLk.dropdowns).parent())},setWidth:function(a){var b=this;this.widths[a]=0;this.widths[a+"Array"]=[];this.elLk[a].each(function(){var c=f(this).outerWidth(true);b.widths[a]+=c;b.widths[a+"Array"].unshift(c)})},resize:function(){if(this.widths){var a=this,b=o.minWidthEl.outerWidth(),c=f(D).width();b=c<b?b:c;c=this.widths.longTabs<b;var g=this.widths.tools>b-this.widths.search-this.widths.logo,h;if(c!==this.longTabs){if(c){this.elLk.shortTabs.hide();this.elLk.longTabs.show();h=this.elLk.longTabs}else{this.elLk.shortTabs.show();this.elLk.longTabs.hide();h=this.elLk.shortTabs}this.longTabs=c;this.elLk.dropdowns.filter(":visible").each(function(){a.dropdownPosition(f(this),h.filter(f(this).data("type")))});h=null}if(g){b=b-this.widths.search-this.widths.logo-this.widths.more;c=this.widths.toolsArray.length;for(g=0;c--;){if(g+this.widths.toolsArray[c]>b){this.elLk.toolsOverflow=this.elLk.tools.filter(":gt("+(this.widths.toolsArray.length-c-2)+")");break}g+=this.widths.toolsArray[c]}this.elLk.toolsUl.width(b);this.elLk.toolMore.css("left",g).show();this.moreShown&&this.elLk.toolMoreUl.html(this.elLk.toolsOverflow.clone())}else{this.elLk.tools.show();this.elLk.toolMore.hide();this.elLk.toolsUl.width("auto")}}},hashChange:function(a,b){var c=this.elLk.shortTabs.filter(".location"),g=this.elLk.longTabs.filter(".location"),h=o.speciesCommon+": "+o.lastR;a=a.split(/\W/);a="Location: "+a[0]+":"+o.thousandify(a[1])+"-"+o.thousandify(a[2]);c.find("a:not(.toggle)").attr("title",a);g.find("a:not(.toggle)").html(a);if(!b){f.each([c,g],function(){this.children(".dropdown").removeClass("empty").children(".toggle").show()});if(this.elLk.dropdowns.length&&!this.recentLocations[h]){this.elLk.dropdowns.filter(".location").find("ul.recent").prepend('<li><a href="'+o.urlFromHash(D.location.href).replace(/([\?;]r=)[^;]+(;?)/,"$1"+o.lastR+"$2")+'">'+h+"</a></li>").show().prev("h4").show();this.recentLocations[h]=1}}}});o.Panel.MultiSelector=o.Panel.extend({constructor:function(a,b){this.base(a);this.urlParam=b.urlParam;this.paramMode=b.paramMode;o.EventManager.register("updateConfiguration",this,this.updateSelection)},init:function(){var a=this;this.base();this.initialSelection="";this.selection=[];this.elLk.content=f(".modal_wrapper",this.el);this.elLk.list=f(".multi_selector_list",this.elLk.content);var b=f("ul",this.elLk.list),c=f("span",b),g=f("li",b);this.elLk.spans=c.filter(":not(.switch)");this.elLk.form=f("form",this.elLk.content);this.elLk.included=b.filter(".included");this.elLk.excluded=b.filter(".excluded");this.setSelection(true);this.updateTitleCount();this.elLk.included.sortable({containment:this.elLk.included.parent(),stop:f.proxy(this.setSelection,this)});this.buttonWidth=g.on("click",function(){var h=f(this),j,l;j=h.parent().data("category");if(h.parent().hasClass("included")){var p=a.elLk.excluded.filter("[data-category='"+j+"']");p.length||(p=a.elLk.excluded.first());j=f("li",p);for(l=j.length;l--;)if(f(j[l]).text()<h.text()){f(j[l]).after(h);break}l===-1&&p.prepend(h);a.setSelection()}else{j=a.elLk.included.filter("[data-category='"+j+"']");j.length||(j=a.elLk.included.first());j.append(h);a.selection.push(h.attr("class"))}a.updateTitleCount()});this.buttonWidth=c.width();f(".select_by select",this.el).on("change",function(){var h,j;switch(this.value){case"":break;case"all":h=a.elLk.excluded.children();break;case"none":j=a.elLk.included.children();break;default:h=a.elLk.excluded.children(":contains("+this.options[this.selectedIndex].innerHTML+")");j=a.elLk.included.children().not(":contains("+this.options[this.selectedIndex].innerHTML+")");break}h&&a.elLk.included.append(h);j&&j.add(a.elLk.excluded.children()).detach().sort(function(l,p){return f(l).text()>f(p).text()}).appendTo(a.elLk.excluded);a.setSelection();a.updateTitleCount();h=j=null});b=null},updateTitleCount:function(){var a=this.elLk.excluded.children().length,b=this.elLk.included.children().length;this.el.find("._unselected_species h2 span").html(a);this.el.find("._selected_species h2 span").html(b)},setSelection:function(a){this.selection=f.map(f("li",this.elLk.included),function(b){return b.className});if(a===true)this.initialSelection=this.selection.join(",")},updateSelection:function(){var a=[],b;if(this.paramMode==="single")a.push(this.urlParam+"="+this.selection.join(","));else for(b=0;b<this.selection.length;b++)a.push(this.urlParam+(b+1)+"="+this.selection[b]);this.selection.join(",")!==this.initialSelection&&o.redirect(this.elLk.form.attr("action")+"?"+o.cleanURL(this.elLk.form.serialize()+";"+a.join(";")));return true}});o.Panel.Overlay=o.Panel.extend({constructor:function(a){this.base(a);this.window=f(D);this.firstOpen=true;this.setMinMax();o.EventManager.register("windowResize",this,this.pageResize)},init:function(){var a=this;this.customized=this.getCookie();this.base();o.browser.ie6||this.el.draggable({containment:"document",handle:"div.modal_title",stop:function(b,c){if(c.position.top<a.offsetTop){c.position.top=a.offsetTop;f(this).css("top",a.offsetTop)}a.customized.left=c.position.left||1;a.customized.top=c.position.top;a.setCookie()}}).resizable({maxWidth:this.maxWidth,maxHeight:this.maxHeight,minWidth:this.minWidth,minHeight:this.minHeight,start:function(){f(this).css("position","fixed")},stop:function(b,c){f.extend(a.customized,c.size);a.setCookie();f(this).css("position","fixed");o.EventManager.trigger("modalPanelResize")}});this.elLk.background=f("#modal_bg").on("click",function(){a.hide()})},setCookie:function(){var a=this,b=f.map(["width","height","left","top"],function(c){return a.customized[c]||0});o.cookie.set("modal",b.join("|"))},getCookie:function(){var a=o.cookie.get("modal").split("|");return a.length===4&&!o.browser.ie6?{width:Math.min(parseInt(a[0],10),this.maxWidth),height:Math.min(parseInt(a[1],10),this.maxHeight),left:parseInt(a[2],10),top:parseInt(a[3],10)}:{}},show:function(){var a;this.elLk.background.show();if(this.firstOpen){this.setDimensions();this.firstOpen=false}if(o.browser.ie6){a={marginTop:this.window.scrollTop(),marginLeft:this.window.scrollLeft()};this.el.css(a);this.elLk.background.css(a);f("body").css("overflow","hidden");f("select").hide();f("select",this.el).show()}this.base();if(!this.offsetTop)this.offsetTop=-f(".modal_title",this.el).position().top-
f(".modal_close",this.el).position().top},hide:function(){this.base();this.elLk.background.hide();if(o.browser.ie6){f("body").css("overflow","auto");f("select").show()}},setMinMax:function(){this.maxWidth=Math.round(this.window.width()*0.9);this.maxHeight=Math.round(this.window.height()*0.8);this.minWidth=Math.min(900,this.maxWidth);this.minHeight=Math.min(500,this.maxHeight)},setDimensions:function(){this.setMinMax();var a=this.customized.height?Math.min(this.customized.height,this.maxHeight):this.maxHeight,b=this.customized.width?Math.min(this.customized.width,this.maxWidth):this.maxWidth,c=this.el.offset(),g=this.window.width(),h=this.window.height();o.browser.ie6||this.el.resizable("option",{maxWidth:this.maxWidth,maxHeight:this.maxHeight,minWidth:this.minWidth,minHeight:this.minHeight});this.el.css({height:a,width:b,top:!this.customized.top||c.top+a>h||this.customized.top+a>h?(h-a)/2:this.customized.top,left:!this.customized.left||c.left+b>g||this.customized.left+b>g?(g-b)/2:this.customized.left})},pageResize:function(){this.setDimensions();this.el.is(":visible")&&o.EventManager.trigger("modalPanelResize")}});o.Panel.Piechart=o.Panel.Content.extend({init:function(){var a=this;this.base();typeof Raphael==="undefined"&&f.getScript("/raphael/raphael-min.js").done(function(){f.getScript("/raphael/g.raphael-min.js").done(function(){f.getScript("/raphael/g.pie-modified-min.js").done(function(){a.getContent()})})})},getContent:function(){var a=this,b=[];this.graphData=[];this.graphConfig={};this.graphEls={};this.dimensions=eval(f("input.graph_dimensions",this.el).val());f("input.graph_data",this.el).each(function(){a.graphData.push(eval(this.value))});f("input.graph_config",this.el).each(function(){a.graphConfig[this.name]=eval(this.value)});for(i in this.graphData){this.graphEls[i]=f("#graphHolder"+i);this.graphEls[i].is(":visible")&&b.push(i)}this.makeGraphs(b)},makeGraphs:function(a){var b,c,g,h,j;for(b in a)if(!this.graphEls[a[b]].data("done")){j={legend:[],colors:[]};h=[];g=0;for(c in this.graphData[a[b]])if(typeof this.graphData[a[b]][c]==="object"){h.push(this.graphData[a[b]][c][0]);j.legend.push(this.graphData[a[b]][c][1]+": %%");if(this.graphColours){j.colors.push(this.graphColours[this.graphData[a[b]][c][1]]||this.graphColours["default"][g++]);if(g===this.graphColours["default"].length)g=0}}else h.push(this.graphData[a[b]][c]);g=Raphael("graphHolder"+a[b]);g.g.txtattr.font="12px 'Luxi Sans','Helvetica', sans-serif";g.g.piechart(this.dimensions[0],this.dimensions[1],this.dimensions[2],h,f.extend(j,this.graphConfig));this.graphEls[a[b]].data("done",true)}}});o.Panel.SearchBox=o.Panel.extend({init:function(){var a=this;this.base();this.elLk.img=f(".search_image",this.el);this.elLk.sites=f(".sites",this.el);this.elLk.siteInput=f("input",this.elLk.sites);this.elLk.menu=f(".site_menu",this.el);this.elLk.input=f(".query",this.el);this.elLk.select=f("select[name=species]",this.el);this.label=this.elLk.input[0].defaultValue;this.species=this.elLk.select.val();this.updateSearch(o.cookie.get("ENSEMBL_SEARCH"));this.label!==this.elLk.input.val()&&this.elLk.input.removeClass("inactive");this.elLk.input.on({"click focus":function(){a.label===this.value&&f(this).selectRange(0,0)},"keydown paste":function(){this.className.match("inactive")&&f(this).removeClass("inactive").val("")},blur:function(){this.value||f(this).addClass("inactive").val(a.label)}});f("div",this.elLk.menu).on("click",function(){var b=this.className;a.updateSearch(b);a.elLk.menu.hide();o.cookie.set("ENSEMBL_SEARCH",b)});this.elLk.sites.on("click",function(){a.elLk.menu.toggle()});f("form",this.el).on("submit",function(){if(a.elLk.input.val()===a.label&&a.elLk.select.val()===a.species||a.elLk.input.val()==="")return false})},updateSearch:function(a){var b=a?this.elLk.menu.find("."+a+" input").val():false;if(b){this.elLk.img.attr("src",this.elLk.menu.find("."+a+" img").attr("src"));this.elLk.siteInput.val(a);this.elLk.input.val()===this.label&&this.elLk.input.val(b);this.label=b}}});o.Panel.SpeciesList=o.Panel.extend({init:function(){this.base();this.elLk.container=this.el.find("._species_fav_container");this.elLk.list=this.el.find("._species_sort_container");this.elLk.dropdown=this.el.find("select._all_species");this.elLk.buttonEdit=this.el.find("a._list_edit");this.elLk.buttonDone=this.el.find("a._list_done");this.elLk.buttonReset=this.el.find("a._list_reset");this.allSpecies=this.params.species_list||[];this.favTemplate=this.params.fav_template;this.listTemplate=this.params.list_template;this.refreshURL=this.params.ajax_refresh_url;this.saveURL=this.params.ajax_save_url;this.displayLimit=this.params.display_limit;this.taxonOrder=this.params.taxon_order;this.taxonLabels=this.params.taxon_labels;this.elLk.buttonEdit.on("click",{panel:this},function(a){a.preventDefault();if(o.isLoggedInUser){a.stopImmediatePropagation();a.stopPropagation();a.data.panel.toggleList(true)}});this.elLk.buttonDone.on("click",{panel:this},function(a){a.preventDefault();a.data.panel.toggleList(false)});this.elLk.buttonReset.on("click",{panel:this},function(a){a.preventDefault();a.data.panel.updateFav("");a.data.panel.toggleList(false)});this.elLk.dropdown.on("change",function(){var a=f(this).val();if(a)D.location.href=a});this.refreshFav();this.renderDropdown()},renderFav:function(){this.elLk.container.empty();for(var a=0;a<this.allSpecies.length;a++){var b=this.allSpecies[a];if(!b.favourite||a>=this.displayLimit)break;this.elLk.container.append(o.populateTemplate(this.favTemplate,{species:b}))}},refreshFav:function(){this.elLk.container.addClass("faded");o.isLoggedInUser?f.ajax({url:this.refreshURL,context:this,dataType:"json",success:function(a){this.allSpecies=a;this.renderFav();this.renderList();this.elLk.container.removeClass("faded").externalLinks()}}):this.elLk.container.removeClass("faded").externalLinks()},renderList:function(){var a=this,b=this.listTemplate,c=this.elLk.list.find("ul._favourites").empty(),g=this.elLk.list.find("ul._species").empty();f.each(this.allSpecies,function(h,j){j.external||(j.favourite?c:g).append(o.populateTemplate(b,{species:j}))});c.add(g).sortable({connectWith:"._species, ._favourites",containment:this.el,stop:function(){a.updateFav(c.sortable("toArray").join(",").replace(/species\-/g,""))}})},toggleList:function(a){this.elLk.list.toggleClass("hidden",!a);this.elLk.buttonEdit.toggle(!a)},renderDropdown:function(){var a=this,b=this.taxonLabels,c=this.elLk.dropdown.children(":not(:first-child)").remove().end(),g=f(),h=f.map(this.allSpecies,function(p){return p.favourite?p:null}),j=this.allSpecies.slice(0).sort(function(p,m){return p.common>m.common?1:-1});f.each(h,function(p,m){p=g.filter(".favourites");if(!p.length){p=f('<optgroup class="favourites" label="Favourites"></optgroup>');g=g.add(p)}a.addOption(p,m,true)});f.each(j,function(p,m){if(!m.external){p=m.group;var n=g.filter("."+p);if(!n.length){n=f('<optgroup class="'+p+'" label="'+(b[m.group]||p)+'"></optgroup>');g=g.add(n)}a.addOption(n,m)}});g.filter(".favourites").appendTo(c);for(var l in this.taxonOrder)g.filter("."+this.taxonOrder[l]).appendTo(c)},addOption:function(a,b,c){a.append('<option value="'+b.homepage+'">'+b.common+"</option>");!c&&b.strainspage&&a.append('<option value="'+b.strainspage+'">'+b.common+" strains</option>")},updateFav:function(a){f.ajax({url:this.saveURL,context:this,data:{favourites:a},dataType:"json",success:function(b){b.updated&&this.refreshFav()}})}});o.Panel.UserData=o.Panel.extend({formats:{bam:"BAM",bb:"BIGBED",bed:"BED",bgr:"BEDGRAPH",bw:"BIGWIG",cram:"CRAM",gff:"GTF",gff3:"GFF3",gtf:"GTF",psl:"PSL",vcf:"VCF",vep:"VEP",wig:"WIG"},init:function(){var a=this;this.base.apply(this,arguments);this.elLk.activeLink=this.el.parents(".modal_wrapper").siblings(".modal_nav").find("ul.local_context li.active");this.elLk.form=this.el.find("form").off(".UserData").on("submit.UserData",function(c){c.preventDefault();a.formSubmit()});this.elLk.formatDropdown=this.elLk.form.find("select[name=format]").on("change",function(){a.showError()});var b=function(){a.showError();var c=f(this).off("blur change paste");setTimeout(function(){c.trigger("finish").trigger("blur").on("blur change paste",b);c=null},100)};this.elLk.dataFieldText=this.elLk.form.find("._userdata_add textarea").on({focus:function(){if(!this.value||this.value===this.defaultValue)f(this).val("").removeClass("inactive")},finish:function(){if((this.value=this.value.trim())&&this.value!==this.defaultValue)a.updateFormatDropdown(this.value,false);else{f(this).val(this.defaultValue).addClass("inactive");a.resetFormatDropdown()}},"blur change paste":b});this.elLk.dataFieldFile=this.elLk.form.find("._userdata_add input[type=file]").on("change",function(){a.updateFormatDropdown(this.value,true)})},updateFormatDropdown:function(a,b){var c;this.elLk[b?"dataFieldText":"dataFieldFile"].val("").trigger("finish");if(!b)if(a.match(/^(ht|f)tp(s?)\:\/\//)){if(a.match(/\/hub\.txt$/))c="TRACKHUB"}else{b=true;c="unknown"}c||(c=this.formats[a.replace(/\.gz$/,"").split(".").pop().toLowerCase()]);this.elLk.formatDropdown.find("option").prop("disabled",function(){return!(b?!this.className.match("_format_remote"):!this.className.match("_format_upload"))}).filter(":first, [value="+c+"]:enabled").last().prop("selected",true);this.elLk.formatDropdown.removeClass("hide")},resetFormatDropdown:function(){if(!this.elLk.dataFieldFile.val()&&(!this.elLk.dataFieldText.val()||this.elLk.dataFieldText.val()===this.elLk.dataFieldText.prop("defaultValue")))this.elLk.formatDropdown.find("option").prop("disabled",false).first().prop("selected",true)},showError:function(a,b){if(a){if(!this.elLk.errorMessage)this.elLk.errorMessage=f("<label>").addClass("invalid");this.elLk.errorMessage.html("&nbsp;"+a).insertAfter(b)}else f(this.elLk.errorMessage).empty().remove()},formSubmit:function(){if(!this.elLk.dataFieldFile.val()&&(!this.elLk.dataFieldText.val()||this.elLk.dataFieldText.val()===this.elLk.dataFieldText.prop("defaultValue"))){this.showError("Please provide some data",this.elLk.dataFieldText);return false}if(!this.elLk.formatDropdown.val()){this.showError("Please select a format",this.elLk.formatDropdown);return false}this.showError();this.elLk.activeLink.removeClass("active");return o.EventManager.trigger("modalFormSubmit",this.elLk.form)}});o.Panel.ZMenu=o.Panel.extend({constructor:function(a,b){this.base(a);this.data=b;a=b.area.a;var c;if(b.area.link)a={klass:{},attrs:{href:b.area.link.attr("href"),title:b.area.link.attr("title")}};this.drag=a.klass.drag?"drag":a.klass.vdrag?"vdrag":false;this.align=a.klass.align;this.group=a.klass.group||a.klass.pseudogroup;this.coloured=a.klass.coloured;this.href=a.attrs.href;this.title=a.attrs.title||"";this.das=false;this.event=b.event;this.coords=b.coords||{};this.imageId=b.imageId;this.onclose=b.onclose;this.context=b.context;this.relatedEl=b.relatedEl;this.areaCoords=f.extend({},b.area);this.location=0;if(a.klass.das){this.das=a.klass.group?"group":a.klass.pseudogroup?"pseudogroup":"feature";this.logicName="";f.each(a.attrs,function(g){if(g!="das"&&g!="pseudogroup"&&g!="group")this.logicName+=g})}if(this.drag){b=this.href.split("|");c=parseInt(b[1],10)-1;this.speciesPath=b[3].replace(/-/,"/");this.species=this.speciesPath.split("/").pop();this.chr=b[4];this.start=parseInt(b[5],10);this.end=parseInt(b[6],10);this.strand=parseInt(b[7],10);this.multi=a.klass.multi?c:false;if(!this.speciesPath.match(/^\//))this.speciesPath="/"+this.speciesPath}a=null;delete this.areaCoords.a;o.EventManager.register("showExistingZMenu",this,this.showExisting)},init:function(){var a=this,b=new RegExp("([\\?;]r"+(this.multi||"")+"=)[^;]+;?","g");this.base();this.elLk.container=f(".container",this.el);this.elLk.loading=f(".loading",this.el);this.el.on("click","a._motif",function(c){c.preventDefault();o.openMotifWidget(f(this).html())});this.el.on("mousedown",function(){o.EventManager.trigger("panelToFront",a.id)}).on("click","a._location_change",function(c){if(!D.location.pathname.match(/\/Location\/View(\/|$)/))return true;var g=this.href.match(o.locationMatch);if(g){c.preventDefault();g[1]!==o.coreParams.r&&o.updateLocation(g[1]);a.hide()}}).on("click","a._location_mark",function(c){c.preventDefault();o.markLocation(this.href);a.hide()});f(".close",this.el).on("click",function(){a.hide();if(a.onclose)a.onclose.call(a.context||a)});this.baseURL=D.location.href.replace(/&/g,";").replace(/#.*$/g,"").replace(b,"$1%s;").replace(/[\?;]$/g,"");this.baseURL.match(/%s/)||(this.baseURL+=(this.baseURL.match(/\?/)?";":"?")+"r=%s");if(this.multi)this.baseURL=this.baseURL.replace(/align=\d+;?/,"").replace(/;$/,"")+";action=primary;id="+this.multi;if(this.multi===false)this.baseURL=this.baseURL.replace(/r\d+=[^;]+;?/g,"");this.coloured&&this.el.addClass("coloured");this.el.on("click","a.expand",function(){a.populateAjax(this.href,f(this).parents("tr"));return false});this.getContent();f(".refresh-zmenu",this.el).on("click",function(){f(this).closest("tbody").hide();a.elLk.loading.show();a.populateAjax(a.href,f(this).parents("tbody"),1);return false})},getContent:function(){var a=this;this.populated=false;clearTimeout(this.timeout);this.timeout=setTimeout(function(){if(a.populated===false){a.elLk.container.hide();a.elLk.loading.show();a.show(a.das)}},300);if(this.data.mr_menu)this.showMarkRegionMenu();else if(this.drag==="drag")this.populateRegion();else if(this.drag==="vdrag")this.populateVRegion();else if(this.das!==false)this.populateDas();else if(this.href)this.href.match(/#/)&&!this.href.match(/#:@:/)?this.populate(true):this.populateAjax();else this.populate()},showMarkRegionMenu:function(){var a=this,b=[];o.markedLocation&&b.push('<a class="loc-icon-a _mr_jump_location"> <span class="loc-icon loc-change"></span>Jump to marked location</a>','<a class="loc-icon-a _mr_remove" style="cursor:pointer;"> <span class="loc-icon remove"></span>Remove marking</a>');this.buildMenu(b,"Marked Region");this.elLk.container.find("._mr_jump_location").off().on("click",function(){o.updateLocation(o.markedLocation[0]);a.hide()}).css({cursor:"pointer"});this.elLk.container.find("._mr_remove").off().on("click",function(){o.markLocation(false);a.hide()})},populate:function(a,b,c){var g=this.title.toString().split("; "),h=g.shift();this.buildMenu(g,h,a,b,true,c)},populateDas:function(){var a=this.title.match(/Start: (\d+)/)[1],b=this.title.match(/End: (\d+)/)[1],c=(this.title.match(/Strand: ([-+])/)||[])[1],g=this.title.match(/; Id: ([^;]+)$/)[1];a=[D.location.pathname.replace(/\/(\w+)\/\w+$/,"/ZMenu/$1/Das"),"?logic_name=",this.logicName,";",this.das,"_id=",g,";start=",a,";end=",b,";strand=",{"+":1,"-":-1}[c],";label=",this.title.split("; ")[0]].join("");for(var h in o.coreParams)if(o.coreParams[h])a+=";"+h+"="+o.coreParams[h];this.populateNoAjax(true);this.populateAjax(a)},convertQuickUrl:function(a){if(!a.match(/^#:@:/))return a;a=a.replace(/^#:@:/,"");for(var b=[];;){var c=/^(\d+)-/.exec(a);if(!c)break;var g=parseInt(c[1]);b.push(a.substr(c[0].length,g));a=a.substr(c[0].length+g+1)}a=[];c={};for(var h;b.length>1;){g=b.shift();var j=b.shift();a.push(g);c[g]=encodeURIComponent(g)+"="+encodeURIComponent(j);if(g=="type")h=j}b=D.location.pathname.split("/");b.splice(1,2,b[1],"ZMenu",a.type||h);h=D.location.search.replace(/^\?/,"").split(/&|;/);g=[];for(j=0;j<h.length;j++){var l=h[j].split("=");c[decodeURIComponent(l[0])]===U&&g.push(h[j])}for(j=0;j<a.length;j++)g.push(c[a[j]]);return b.join("/")+"?"+g.join(";")},populateAjax:function(a,b){var c=this.timeout;a=a||this.href;(a=this.convertQuickUrl(a))&&a.match("/ZMenu/")?f.extend(f.ajax({url:a,data:this.coords.clickStart?{click_chr:this.coords.clickChr||o.location.name,click_start:this.coords.clickStart,click_end:this.coords.clickEnd,click_y:this.coords.clickY}:{},dataType:this.crossOrigin?"jsonp":"json",context:this,success:f.proxy(this.buildMenuAjax,this),error:f.proxy(this.populateNoAjax,this,false,true)}),{timeout:c,expand:b}):this.populateNoAjax()},buildMenuAjax:function(a,b,c){b=a.features;var g=b.length,h=Math.min(g,5),j,l,p,m,n,q;if(c.timeout===this.timeout){if(g===0)return this.populateNoAjax();this.populated=true;for(p=0;p<g;p++){l=b[p];if(p===0||j.children().length===h)j=f("<div></div>").appendTo(this.elLk.container);if(l.entries.length){n=q="";if(l.caption)n+=this.header(l.caption,g>1);for(m=0;m<l.entries.length;m++){if(l.entries[m].key==="subheader"){if(l.entries[m].value!==l.caption)q=this.header(l.entries[m].value,true)}else q=this.row(l.entries[m].key,l.entries[m].value,l.entries[m]["class"],l.entries[m].childOf);n+=q}if(c.expand){c.expand.replaceWith(n);c.expand=null}else this.makeTable(n).appendTo(j).find("a.update_panel").attr("rel",this.imageId)}}if(g>1)this.elLk.header=f('<div class="header">'+(a.header?a.header:g+" features")+"</div>").insertBefore(this.elLk.container.addClass("row"+(g>h?" grid":"")));this.addLocationIcons();this.show()}},addLocationIcons:function(){var a=this.elLk.container.find("._location_mark").removeClass("_location_mark");a.length&&this.imageId&&!this.imageId.match("Multi")&&a.each(function(){var b=this.href.match(o.locationMatch);if(b)f('<br /><a class="loc-icon loc-mark _location_mark _ht" title="Mark feature on image" href="'+o.updateURL({mr:b[1]},this.href)+'"></a>'+(this.className.match(/_location_change/)?'<a class="loc-icon loc-zoom _location_change _ht" title="Zoom on feature" href="'+this.href+'"></a>':"")).insertAfter(this);return true})},populateNoAjax:function(a,b){if(this.das&&a!==true){this.populated=true;this.show()}else{a="";var c=this.title.match(/Location: (\S+)/),g;if(c){g=c[1].split(/\W/);this.location=parseInt(g[1],10)+(g[2]-g[1])/2;a+=this.row(" ",'<a class="loc-icon-a _location_change" href="'+this.zoomURL(1)+'"><span class="loc-icon loc-pin"></span>Centre on feature</a>');a+=this.row(" ",'<a class="loc-icon-a _location_change" href="'+this.baseURL.replace(/%s/,c[1])+'"><span class="loc-icon loc-zoom"></span>Zoom to feature</a>')}this.populate(true,a,b)}},populateRegion:function(){function a(){var x=v-t+1>o.maxRegionLength?"Overview":"View";m=m.replace(/.+\?/,"?");n=['<a class="loc-icon-a" href="'+
g.speciesPath+"/Location/"+x+m+'"><span class="loc-icon loc-change"></span>Jump to region '+x.toLowerCase()+"</a>"]}function b(){var x=t?"region":"location";n=['<a href="'+m.replace(/;action=primary;id=\d+/,"")+'">Realign using this '+x+"</a>"];g.multi?n.push('<a href="'+m+'">Use '+x+" as primary</a>"):n.push('<a href="'+m.replace(/[rg]\d+=[^;]+;?/g,"")+'">Jump to '+x+"</a>");q=g.species.replace(/_/g," ")+" "+g.chr+":"+(t?t+"-"+v:g.location)}function c(){var x=t?"region":"location";x+=g.species===o.species?"":" on "+o.species.replace(/_/g," ");n=['<a class="loc-icon-a" href="'+m.replace(/%s/,o.coreParams.r+";align_start="+t+";align_end="+v)+'"><span class="loc-icon loc-change"></span>Jump to best aligned '+x+"</a>"];q="Alignment: "+(t?t+"-"+v:g.location)}var g=this,h=this.start,j=this.end,l=!!D.location.pathname.match("/Location/")&&!D.location.pathname.match(/\/(Chromosome|Synteny)/),p=(j-h+1)/(this.areaCoords.r-this.areaCoords.l),m=this.baseURL,n,q,t,v;if(this.coords.r){t=Math.floor(h+(this.coords.s-
this.areaCoords.l)*p);v=Math.floor(h+(this.coords.s+this.coords.r-this.areaCoords.l)*p);if(t>v){p=t;t=v;v=p}t=Math.max(t,h);v=Math.min(v,j);if(this.strand===1)this.location=(t+v)/2;else{this.location=(2*this.start+2*this.end-t-v)/2;p=t;t=this.end+this.start-v;v=this.end+this.start-p}if(this.align)c();else{m=m.replace(/%s/,this.chr+":"+t+"-"+v);q="Region: "+this.chr+":"+t+"-"+v;if(l)if(this.multi!==false)b();else{h="_location_change";if(v-t+1>o.maxRegionLength)if(m.match("/View")){m=m.replace("/View","/Overview");h=""}n=['<a class="'+h+' loc-icon-a" href="'+m+'"><span class="loc-icon loc-change"></span>Jump to region ('+(v-t+1)+" bp)</a>"]}else a()}this.multi===false&&!this.align&&n.unshift('<a class="_location_mark loc-icon-a" href="'+o.updateURL({mr:this.chr+":"+t+"-"+v},D.location.href)+'"><span class="loc-icon loc-mark"></span>Mark region ('+(v-t+1)+" bp)</a>")}else{this.location=Math.floor(h+(this.coords.x-this.areaCoords.l)*p);if(this.align){m=this.zoomURL(0.1);c()}else{m=this.zoomURL(1);q="Location: "+this.chr+":"+this.location;if(l)if(this.multi!==false)b();else{n=['<a class="_location_change" href="'+this.zoomURL(10)+'">Zoom out x10</a>','<a class="_location_change" href="'+this.zoomURL(5)+'">Zoom out x5</a>','<a class="_location_change" href="'+this.zoomURL(2)+'">Zoom out x2</a>','<a class="_location_change" href="'+m+'">Centre here</a>'];f.each([2,5,10],function(){var x=g.zoomURL(1/this);x!==""&&n.push('<a class="_location_change" href="'+x+'">Zoom in x'+this+"</a>")})}else a()}}this.buildMenu(n,q)},populateVRegion:function(){var a=this.start,b=this.end,c=(b-a+1)/(this.areaCoords.b-this.areaCoords.t),g=Math.min(o.location.length,o.maxRegionLength)/2,h,j;if(c===b)c/=2;if(this.coords.r){h=Math.floor(a+(this.coords.s-this.areaCoords.t)*c);g=Math.floor(a+(this.coords.s+this.coords.r-this.areaCoords.t)*c);c=g-h+1>o.maxRegionLength?"Overview":"View";if(h>g){j=h;h=g;g=j}h=Math.max(h,a);g=Math.min(g,b);a=this.chr+": "+h+"-"+g;this.location=(h+g)/2}else{this.location=Math.floor(a+(this.coords.y-this.areaCoords.t)*c);c="View";h=Math.max(Math.floor(this.location-g),1);g=Math.floor(this.location+g);a=this.chr+": "+this.location}h=this.baseURL.replace(/.+\?/,"?").replace(/%s/,this.chr+":"+h+"-"+g);c=['<a href="'+this.speciesPath+"/Location/"+c+h+'">Jump to region '+c.toLowerCase()+"</a>"];D.location.pathname.match("/Chromosome")||c.push('<a href="'+this.speciesPath+"/Location/Chromosome"+h+'">Chromosome summary</a>');this.buildMenu(c,a)},buildMenu:function(a,b,c,g,h,j){var l=[],p=a.length,m;b=b||(j?"Message":"Menu");g=g||"";if(j===true)g=this.row('<p>Still loading data... <a class="refresh-zmenu"> Please click here to refresh </a> this menu. </p> <p>If you think this is an error, or you have any questions, please <a href="/Help/Contact" class="popup">contact our HelpDesk team</a>.</p>')+g;else if(c===true&&this.href){c=this.title?this.title.split("; ")[0]:b;g=this.row("Link",'<a href="'+this.href+'">'+c+"</a>")+g}for(;p--;)if(c=this.coloured?a[p].match(/\[(.+)\]/):null){c=c[1].split(",");for(j=0;j<c.length;j+=2){c[j]=c[j].split(":");m='<td style="color:#'+c[j][1]+'">'+c[j][0]+"</td>";if(c[j+1]){c[j+1]=c[j+1].split(":");m+='<td style="color:#'+c[j+1][1]+'">'+c[j+1][0]+"</td>"}else m+="<td></td>";l.push("<tr>"+m+"</tr>")}}else{j=h?f("<span/>").html(a[p]).text():a[p];c=j.split(": ");l.unshift(this.row.apply(this,c.length>1?[c.shift(),c.join(": ")]:[j]))}this.makeTable(this.header(b)+l.join("")+g).appendTo(this.elLk.container);if(this.das)this.elLk.container.hide();else{this.populated=true;this.show()}},zoomURL:function(a){var b=Math.min(o.location.length,o.maxRegionLength)*a;if(b<1)return"";a=Math.round(this.location-(b-1)/2);b=Math.round(this.location+(b-1)/2);if(a<1)a=this.start;return this.align?this.baseURL.replace(/%s/,o.coreParams.r+";align_start="+a+";align_end="+b):this.baseURL.replace(/%s/,(this.chr||o.location.name)+":"+a+"-"+b)},show:function(a){if(!a&&this.elLk.container.html()){this.elLk.loading.hide();this.elLk.container.show()}o.EventManager.trigger("panelToFront",this.id);this.el.css({top:0,left:0,display:"block"}).position({of:this.event,my:"left top",collision:"fit"}).hasClass("ui-draggable")||this.el.scrollTop(0).draggable(f.extend({handle:".header:not(.subheader)",containment:"document"},o.browser.webkit?{}:{start:function(){f(this).css({"margin-top":-1*f(D).scrollTop()})},stop:function(){f(this).css({top:parseInt(f(this).css("top"))+parseInt(f(this).css("margin-top")),"margin-top":0})}}));this.relatedEl&&this.relatedEl.addClass("highlight");this.elLk.container.find("._ht").helptip();this.elLk.container.find("._zmenu").zMenuLink();this.el.hasClass("closed")&&this.hide()},showExisting:function(a){this.event=a.event;this.coords=a.coords;if(this.group||this.drag||this.event.shiftKey){if(this.elLk.header){this.elLk.header.remove();delete this.elLk.header}this.elLk.container.empty();this.hide();this.getContent()}else this.show()},hide:function(){if(this.el){this.base();this.relatedEl&&this.relatedEl.removeClass("highlight")}},makeTable:function(a){function b(l){if(l.target.nodeName!=="A"){l=f(this).parent();l.siblings("."+l[0].className).toggle();f(this).toggleClass("closed opened")}}var c={};a=f('<table class="zmenu" cellspacing="0"></table>').html(a);var g=a.find("tr.child"),h=a.find("tr[class]:not(.child)").each(function(){if(g.filter("."+this.className).length)c[this.className]=1});for(var j in c){h.filter("."+j).children(":first").addClass("closed").on("click",b);g.filter("."+j).hide()}h=g=null;return a},header:function(a,b){return'<tr class="header'+(b?" subheader":"")+'"><th colspan="2">'+a+"</th></tr>"},row:function(a,b,c,g){return"<tr"+
(c||g?' class="'+(c||g).replace(/\W/g,"_")+(g?" child":"")+'"':"")+">"+(a&&b?"<th>"+a+"</th><td>"+b+"</td>":'<td colspan="2">'+(a||b)+"</td>")+"</tr>"}},{template:f('<div class="zmenu_holder">  <span class="close"></span>  <div class="info_popup floating_popup">    <div class="loading"><div>Loading component</div><p class="spinner"></p></div>    <div class="container"></div>  </div></div>')});o.Panel.AlignmentText=o.Panel.Content.extend({constructor:function(){this.base.apply(this,arguments)},init:function(){this.base();var a,b,c="",g="";f("div.display_full_message_div a",this.el).on("click",function(h){h.preventDefault();c||(c=f(this).parent(".display_full_message_div").siblings("p").html());g||(g="Currently showing full alignment. Please click the button below to show the alignment for first "+f(this).data("displayWidth")+" columns.");a=o.PanelManager.getPanels("TextSequence")[0];if(f(this).html()==="Display full alignment"){f(this).html("Hide full alignment");f(this).closest(".message-pad").find("p:first-child").hide().html(g).fadeIn("slow");a&&a.el.hide();b&&b.el.fadeIn()}else{f(this).html("Display full alignment");f(this).closest(".message-pad").find("p:first-child").hide().html(c).fadeIn("slow");b&&b.el.hide();a&&a.el.fadeIn()}if(!b){h={};Object.assign(h,f(this).data(),a.params);b=o.EventManager.trigger("createPanel","full_alignment","TextSequence",h);h=b.showFullTextSequence(f(this).data("totalLength"),f(this).data("chunkLength"),f(this).data("displayWidth"));b.el.html(h);b.init()}})}});o.Panel.CellTypeSelector=o.Panel.CloudMultiSelector.extend({updateSelection:function(){if(this.changed){var a={image_config:this.params.image_config};a[this.urlParam+"_on"]=encodeURIComponent(this.changed_on.join(","));a[this.urlParam+"_off"]=encodeURIComponent(this.changed_off.join(","));this.reset_selection();f.ajax({url:"/"+o.species+"/Ajax/cell_type",data:a,context:this,complete:function(){var b=["FeaturesByCellLine","FeatureDetails","FeatureSummary","ViewBottom"];o.EventManager.trigger("partialReload");for(var c=0;c<b.length;c++)o.EventManager.triggerSpecific("updatePanel",b[c])}});return true}}});o.Panel.ComparaAlignSliceSelector=o.Panel.extend({constructor:function(a){this.base(a);o.EventManager.register("updateAlignmentSpeciesSelection",this,this.updateAlignmentSpeciesSelection);o.EventManager.register("updateMultipleAlignmentSpeciesSelection",this,this.updateMultipleAlignmentSpeciesSelection)},init:function(){this.base();this.elLk.form=f("form",this.el);this.elLk.selectedInput=f("form input.ss-alignment-selected-value",this.el);this.elLk.go=f("form a.alignment-go",this.el);this.configUrl=f("input.compara_config_url",this.el).val();this.updateComponent=f("input.update_component",this.el).val()},updateAlignmentSpeciesSelection:function(a){this.elLk.selectedInput.val(a.data.value);var b=this.elLk.go[0].href;b.match(/align=/)?b.replace(/align=(\d+)/,"align="+a.data.value):b.replace(/;$/,"");this.elLk.form.submit()},updateMultipleAlignmentSpeciesSelection:function(a){var b={};f.each(a.childList,function(c,g){b[g.data.key]=g.bSelected?"yes":"off"});b.align=a.data.value;f.ajax({url:this.configUrl,type:"POST",data:{alignment_selector:JSON.stringify(b),submit:1},traditional:true,dataType:"json",async:false,context:this,success:function(c){if(c.updated){c=this.elLk.selectedInput.val();if(!c||c!==a.data.value)this.updateAlignmentSpeciesSelection(a);else{this.elLk.selectedInput.val(a.data.value);o.EventManager.trigger("queuePageReload",this.updateComponent,true)}}}})}});o.Panel.EvidenceSelector=o.Panel.CloudMultiSelector.extend({updateSelection:function(){if(this.changed){var a={};a[this.urlParam]=encodeURIComponent(this.selection.join(","));a[this.urlParam+
"_on"]=encodeURIComponent(this.changed_on.join(","));a[this.urlParam+"_off"]=encodeURIComponent(this.changed_off.join(","));this.reset_selection();f.ajax({url:"/"+o.species+"/Ajax/evidence",data:a,context:this,complete:function(){o.EventManager.trigger("partialReload");o.EventManager.triggerSpecific("updatePanel","FeaturesByCellLine");o.EventManager.triggerSpecific("updatePanel","ViewBottom")}});return true}}});o.Panel.ImageMap=o.Panel.Content.extend({constructor:function(a,b){function c(){delete this.imgOffset}
this.base(a,b);this.panning=this.panningAllowed=this.dragging=false;this.clicking=true;this.dragCoords={};this.dragRegion={};this.highlightRegions={};this.areas=[];this.draggables=[];this.speciesCount=0;this.minImageWidth=500;this.labelWidth=0;this.boxCoords={};this.altKeyDragging=false;this.allowHighlight=!!D.location.pathname.match(/\/Location\//);this.locationMarkingArea=false;this.highlightedTracks={};o.EventManager.register("highlightImage",this,this.highlightImage);o.EventManager.register("mouseUp",this,this.dragStop);o.EventManager.register("hashChange",this,this.hashChange);o.EventManager.register("changeFavourite",this,this.changeFavourite);o.EventManager.register("imageResize",this,function(){this.xhr&&this.xhr.abort();this.getContent()});o.EventManager.register("windowResize",this,c);o.EventManager.register("ajaxLoaded",this,c);o.EventManager.register("changeWidth",this,function(){this.params.updateURL=o.updateURL({image_width:false},this.params.updateURL);o.EventManager.trigger("queuePageReload",this.id)});o.EventManager.register("highlightAllImages",this,function(){this.align||this.highlightAllImages()});o.EventManager.register("markLocation",this,this.markLocation)},init:function(){var a=this,b={};this.base();this.imageConfig=f("input.image_config",this.el).val();this.viewConfig=f("input.view_config",this.el).val();this.hashChangeReload=(this.lastImage=o.images.total>1&&this.el.parents(".image_panel")[0]===o.images.last)||f(".hash_change_reload",this.el).length;this.zMenus={};this.params.highlight=o.images.total===1||!this.lastImage;this.elLk.container=f(".image_container",this.el);this.elLk.drag=f(".drag_select",this.elLk.container);this.elLk.map=f(".json_imagemap",this.elLk.container);var c=this.loadJSON(this.elLk.map.html());this.elLk.areas=c.out;this.elLk.resizeMenu=f(".image_resize_menu",this.elLk.container).appendTo("body").css("left",this.el.offset().left).attr("rel",this.id);this.elLk.img=f("img.imagemap",this.elLk.container);this.elLk.hoverLabels=f(".hover_label",this.elLk.container);this.elLk.boundaries=f(".boundaries",this.elLk.container);this.elLk.toolbars=f(".image_toolbar",this.elLk.container);this.elLk.exportButton=this.elLk.toolbars.find(".export");this.elLk.popupLinks=f("a.popup",this.elLk.toolbars);this.vertical=this.elLk.img.hasClass("vertical");if(c.flags){this.multi=c.flags.multi;this.align=c.flags.align}this.makeImageMap();this.makeHoverLabels();this.initImageButtons();this.initImagePanning();this.initSelector();this.highlightLastUploadedUserDataTrack();this.markLocation(o.markedLocation);this.updateHighlightedTracks();this.vertical||this.makeResizable();b[this.id]=this.getSpecies();f.extend(this,o.Share);this.shareInit({species:b,type:"image",positionPopup:this.positionToolbarPopup});if(this.elLk.boundaries.length){o.EventManager.register("changeTrackOrder",this,this.externalOrder);this.elLk.img[0].complete?this.makeSortable():this.elLk.img.on("load",function(){a.makeSortable()})}typeof FileReader!=="undefined"&&this.dropFileUpload();f("a",this.elLk.toolbars).helptip({track:false});f("a.resize",this.elLk.toolbars).data("popup",this.elLk.resizeMenu);this.elLk.popupLinks.on("click",function(){var g=f(this).data("popup");a.elLk.popupLinks.map(function(){return(f(this).data("popup")||f()).filter(":visible")[0]}).not(g).hide();g&&!g.hasClass("share_page")&&a.positionToolbarPopup(g,this).toggle();g=null;return false});f("a.image_resize",this.elLk.resizeMenu).on("click",function(){f(this).has(".current").length||a.resize(parseInt(f(this).text(),10)||o.imageWidth());return false});this.highlightAllImages()},loadJSON:function(a){if(!a)return{out:[],flags:{}};raw=f.parseJSON(a);out=[];flags={};f.each(raw,function(b,c){data={shape:c[0],coords:c[1],attrs:c[2]};klass={};data.attrs.klass&&f.each(data.attrs.klass,function(g,h){klass[h]=1;flags[h]=1});data.klass=klass;out.push(data)});return{out:out,flags:flags}},initImageButtons:function(){var a=this;this.el.find("._reset").on("click",function(b){b.preventDefault();f.ajax({context:a,url:this.href,type:"post",success:function(){o.EventManager.trigger("resetConfig");o.EventManager.trigger("resetMessage");this.getContent()},data:{image_config:a.imageConfig,view_config:a.viewConfig}})})},initImagePanning:function(){var a=this;if(this.elLk.boundaries.length&&this.draggables.length){this.elLk.dragSwitch=this.elLk.toolbars.first().append('<div class="scroll-switch"><span>Drag/Select:</span><div><button title="Scroll to a region" class="dragging on"></button></div><div class="last"><button title="Select a region" class="dragging"></button></div></div>').find("button").helptip().on("click",function(){var b=f(this).hasClass("on");a.setPanning(b);if(b){a.selectArea(false);a.removeZMenus()}}).parent();this.panningAllowed=true;this.setPanning()}},hashChange:function(a){var b=this.hashChangeReload;this.params.updateURL=o.urlFromHash(this.params.updateURL);if(o.images.total===1)this.highlightAllImages();else if(!this.multi&&this.highlightRegions[0]){var c=this.highlightRegions[0][0].region.range;a=a.split(/\W/);if(parseInt(a[1],10)<c.start||parseInt(a[2],10)>c.end||c.chr!==a[0])b=true}b&&this.base();this.align&&o.EventManager.trigger("highlightAllImages")},toggleLoading:function(a){if(a){this.selectArea(false);this.elLk.drag.filter(":not(:has(.image_spinner))").append('<div class="spinner image_spinner"><div>');this.elLk.toolbars.append('<div class="image_loading">Loading&#133;</div>')}else this.elLk.drag.find(".image_spinner").add(this.elLk.toolbars.find(".image_loading")).remove()},getContent:function(a,b,c,g,h){if(this.imageConfig){f(this.elLk.labelLayers).add(this.elLk.hoverLayers).add(this.elLk.resizeMenu).remove();this.removeZMenus();this.removeShare()}if(this.elLk.drag&&this.elLk.drag.length&&f.contains(this.el[0],this.elLk.drag[0])){this.toggleLoading(true);h=h||{};h.background=true}this.base.call(this,a,b,c,g,h);this.xhr.done(function(j){if(!j){delete o.images[this.imageNumber];o.EventManager.trigger("highlightAllImages")}})},makeImageMap:function(){var a=this,b=["l","t","r","b"];f.each(this.elLk.areas,function(){var c,g,h,j,l;g={a:this};if(this.shape&&this.shape.toLowerCase()!=="rect"){g.c=[];f.each(this.coords,function(){g.c.push(parseInt(this,10))})}else f.each(this.coords,function(p){g[b[p]]=parseInt(this,10)});a.areas.push(g);if(this.klass.drag||this.klass.vdrag){h=this.attrs.href.split("|");c=parseInt(h[5],10);j=parseInt(h[6],10);l=(j-c+1)/(this.vertical?g.b-g.t:g.r-g.l);g.range={chr:h[4],start:c,end:j,scale:l,vertical:this.vertical};a.draggables.push(g);if(a.allowHighlight&&!a.vertical){c=parseInt(h[1],10)-1;if(a.multi||!c){if(!a.highlightRegions[c]){a.highlightRegions[c]=[];a.speciesCount++}a.highlightRegions[c].push({region:g});a.imageNumber=parseInt(h[2],10);o.images[a.imageNumber]=o.images[a.imageNumber]||{};o.images[a.imageNumber][c]=[a.imageNumber,c,parseInt(h[5],10),parseInt(h[6],10)]}}}});if(this.draggables.length)this.locationMarkingArea=this.draggables[0];o.images.total&&this.highlightAllImages();this.elLk.drag.on({mousedown:function(c,g){c=g||c;if(!c.which||c.which===1)a.dragStart(c);return false},mousemove:function(c,g){c=g||c;if(a.dragging===false){c=a.getArea(a.getMapCoords(c));var h;f(this).toggleClass("drag_select_pointer",!(!c||c.a.klass.label||c.a.klass.drag||c.a.klass.vdrag||c.a.klass.hover));if(c&&c.a&&(c.a.klass.nav||c.a.klass.tooltip)){if(h!==c.a.attrs.alt){h=c.a.attrs.alt;if(!a.elLk.helpTip)a.elLk.helpTip=f('<div class="ui-tooltip helptip-bottom"><div class="ui-tooltip-content"></div></div>');a.elLk.helpTip.children().html(h).end().appendTo("body").position({of:{pageX:a.imgOffset.left+c.l+10,pageY:a.imgOffset.top+c.t-48,preventDefault:true},my:"center top"})}}else a.elLk.helpTip&&a.elLk.helpTip.detach().css({top:0,left:0})}},mouseleave:function(c,g){c=g||c;c.relatedTarget&&a.elLk.helpTip&&a.elLk.helpTip.detach()},click:function(c,g){c=g||c;if(a.clicking)a.makeZMenu(c,a.getMapCoords(c));else a.clicking=true}})},makeHoverLabels:function(){var a=this;this.elLk.labelLayers=f();this.elLk.hoverLayers=f();f.each(this.areas,function(){if(this.a){if(this.a.klass.label){var b="";f.each(this.a.klass,function(h){if(h!="label")b+=h});b=a.elLk.hoverLabels.filter("."+b);var c=b.find(".hl-content ._copy_url"),g=f("<a/>",{href:c.val()}).prop("href");c.val(g);b.find(".hl-content ._copy_url").val(g);if(b.length)a.elLk.labelLayers=a.elLk.labelLayers.add(f('<div class="label_layer _label_layer">').append('<div class="label_layer_bg">').append(b).appendTo(a.elLk.container).data({area:this}));a.labelWidth=Math.max(a.labelWidth,this.a.coords[2]);b=null}else if(this.a.klass.hover)a.elLk.hoverLayers=a.elLk.hoverLayers.add(f('<div class="hover_layer">').appendTo(a.elLk.container).data({area:this}).on("mousedown mousemove click",function(h){a.elLk.drag.triggerHandler(h.type,h)}));else if(this.a.klass.hoverzmenu&&this.a.attrs.alt){c=f('<div class="label_layer">');c.appendTo(a.elLk.container).data({area:this});a.elLk.labelLayers=a.elLk.labelLayers.add(c);(function(h){h.on("click",function(j){if(!f(this).data("zmenu")){j=a.makeZMenu(j,a.getMapCoords(j),{approx:2});f(this).data("zmenu",j)}f("#"+f(this).data("zmenu")).show().find(".close").remove()});h.on("mouseleave",function(){f("#"+f(this).data("zmenu")).delay(200).hide(0).on("mouseenter",function(){f(this).clearQueue()}).on("mouseleave",function(){f(this).hide()})})})(c)}$a=null}});this.elLk.labelLayers.on({mouseenter:function(){f(this).find("._dyna_load").removeClass("_dyna_load").dynaLoad();a.elLk.boundaries.find("."+f(this).find(".hl-icon-highlight").data("highlightTrack")).addClass("hover")},mouseleave:function(){a.elLk.boundaries.find("."+f(this).find(".hl-icon-highlight").data("highlightTrack")).removeClass("hover")},click:function(){f(this).siblings().not(".pinned").find(".hover_label").hide();if(!f(this).hasClass("pinned")){f(this).find(".hover_label").toggle().off().click(function(b){if(b.target.nodeName!=="A"||f(b.target).hasClass("config"))b.stopPropagation()});f(N).off(".hoverMenuRemove").on("click.hoverMenuRemove",function(b){if(!f(b.target).is("._label_layer")){f(a.elLk.labelLayers).not(".pinned").find(".hover_label").hide();f(this).off(".hoverMenuRemove")}})}}}).find(".close").on({click:function(b){f(this).parent().hide();f(this).siblings("._hl_pin").removeClass("on").closest("._label_layer").removeClass("pinned");b.stopPropagation();f(N).off(".hoverMenuRemove")}}).externalLinks();this.positionLayers();this.elLk.hoverLabels.css("left",function(){return f(this.parentNode).width()});this.initHoverLabels()},positionLayers:function(){if(this.elLk.img&&this.elLk.img.length){var a=this.elLk.container.offset(),b=this.elLk.img.offset(),c=b.top-a.top-1,g=b.left-a.left-1,h=this.labelWidth;this.elLk.labelLayers.each(function(){var j=f(this),l=j.data("area");j.css({left:g+l.l,top:c+l.t,height:l.b-l.t,width:h-l.l})});this.elLk.hoverLayers.each(function(){var j=f(this),l=j.data("area");j.css({left:g+l.l+1,top:c+
l.t+1,height:l.b-l.t,width:l.r-l.l})})}},initHoverLabels:function(){var a=this;this.elLk.hoverLabels.each(function(){f(this).find("._hl_icon").removeClass("_hl_icon").tabs(f(this).find("._hl_tab")).end().find("._hl_pin").off().on("click",function(b){f(this).toggleClass("on").closest("._label_layer").toggleClass("pinned",f(this).hasClass("on"));b.stopPropagation&&b.stopPropagation()}).end().find("._hl_extend").off().on({click:function(b){b.stopPropagation()},mousedown:function(b){b.preventDefault();var c=f(this).closest(".hover_label");f(N).on("mousemove.resizeHoverLabel",{hoverLabel:c,startX:b.pageX,startW:c.width()},function(g){g.data.hoverLabel.css("width",Math.max(300,Math.min(o.cookie.get("ENSEMBL_WIDTH")-300,g.data.startW+g.pageX-g.data.startX)))}).on("mouseup.resizeHoverLabel",function(){f(N).off(".resizeHoverLabel")})}})}).find(".hl-icon-highlight").on("click",function(b){b.preventDefault();a.toggleHighlight(f(this).data("highlightTrack"))}).end().find("a.config").on("click",function(b){b.preventDefault();a.handleConfigClick(this)}).end().find("form.graph_config").on("submit",function(b){b.preventDefault();a.handleGraphForm(this)}).end().find("input._copy_url").off().on("click focus blur",function(b){f(this).val(this.value).select().closest("._label_layer").toggleClass("focused",b.type!=="blur")})},toggleHighlight:function(a,b){var c=this;Array.isArray(a)||(a=[a]);f.each(a,function(g,h){track=h&&h.split(".")[0];if(g=f(f(c.elLk.boundaries).find("li."+track)))if(b)f(g)&&f(g).addClass("track_highlight");else if(b!==""&&b!==U)f(g)&&f(g).removeClass("track_highlight");else f(g)&&f(g).toggleClass("track_highlight")});this.updateHighlightedTracks()},updateHighlightedTracks:function(){var a=this;f.each(a.elLk.hoverLabels,function(b,c){b=f(c).find(".hl-icon-highlight").data("highlightTrack");f("li",a.elLk.boundaries).filter(".track_highlight."+b).length?(a.highlightedTracks[b]=1):a.highlightedTracks[b]&&delete a.highlightedTracks[b]});this.updateExportButton()},highlightLastUploadedUserDataTrack:function(){var a=this,b=[];this.elLk.boundaries.find("li._new_userdata.usertrack_highlight").on("mouseover",function(){a.removeUserDataHighlight()});var c=0;this.elLk.boundaries.children().each(function(){var g=f(this);if(f(this).hasClass("_new_userdata"))b.push(g);else{a.addHighlightClasses(b);b=[]}c++;b.length&&a.elLk.boundaries.children().length===c&&a.addHighlightClasses(b)})},addHighlightClasses:function(a){if(a.length>1)f(a).each(function(b,c){if(b==0)f(c).addClass("usertrack_highlight_border_top usertrack_highlight_border_left usertrack_highlight_border_right");else b!==a.length-1?f(c).addClass("usertrack_highlight_border_left usertrack_highlight_border_right"):f(c).addClass("usertrack_highlight_border_bottom usertrack_highlight_border_left usertrack_highlight_border_right")});else a.length==1&&f(a[0]).addClass("usertrack_highlight_border_top usertrack_highlight_border_bottom usertrack_highlight_border_left usertrack_highlight_border_right")},removeUserDataHighlight:function(){f(this.elLk.boundaries).find("._new_userdata").removeClass("usertrack_highlight _new_userdata usertrack_highlight_border_top usertrack_highlight_border_left usertrack_highlight_border_right usertrack_highlight_border_bottom")},handleConfigClick:function(a){var b=f(a);if(!b.parent().hasClass("current")){var c=a.rel;a=a.href.split(";");var g=a.pop().split("="),h="";h={};var j=b.hasClass("favourite"),l=b.hasClass("hl-icon-highlight"),p=b.hasClass("matrix-cell");if(j||l){h=b.hasClass("selected")?"off":"on";a.push(g[0]+"="+g[1]+h);j&&o.EventManager.trigger("changeFavourite",g[0],h==="on");this.changeHighlightTrackIcon(g[0],h==="on")}else{b.parents("._label_layer").addClass("hover_label_spinner");h[g[0]]={renderer:g[1]};a.push("image_config="+
encodeURIComponent(JSON.stringify(h)))}f.ajax({url:a.join(";"),dataType:"json",context:{panel:this,track:g[0],update:g[1]},success:function(m){if(m.updated){this.panel.changeConfiguration(c,this.track,this.update);this.panel.updateExportButton();p&&o.EventManager.trigger("updateFromTrackLabel",g)}}});b=null}},handleGraphForm:function(a){a=f(a);var b=a.prop("action").split(";"),c=a.find("input[name=config]").val(),g=a.find("input[name=track]").val(),h=a.find("input[name=y_min]").val(),j=a.find("input[name=y_max]").val();a.parents("._label_layer").addClass("hover_label_spinner");a={};a[g]={y_max:j,y_min:h};b.push("image_config="+encodeURIComponent(JSON.stringify(a)));f.ajax({url:b.join(";"),dataType:"json",context:{panel:this,track:g,update:j},success:function(l){l.updated&&this.panel.changeAxes(c,this.track,this.y_min,this.y_max)}});$form=null},changeConfiguration:function(a,b,c){o.EventManager.triggerSpecific("changeConfiguration","modal_config_"+a,b,c);if(c==="off")if(this.removeTrack(b))return;o.EventManager.trigger("reloadPage",this.id);o.EventManager.trigger("partialReload")},changeAxes:function(a,b,c,g){o.EventManager.triggerSpecific("changeAxes","modal_config_"+a,b,c,g);o.EventManager.trigger("reloadPage",this.id);o.EventManager.trigger("partialReload")},makeResizable:function(){function a(g,h){c.imageResize=Math.floor(h.size.width/100)*100;b.apply(this,[h.helper].concat(g.type==="resizestart"?["Drag to resize",g.pageY]:c.imageResize+"px"))}function b(g,h,j){if(typeof j==="number")g.data("y",j);else j=g.data("y");g.html('<div class="bg"></div><div class="ui-tooltip"><div class="ui-tooltip-content"></div></div>').find(".ui-tooltip-content").html(h).parent().css("top",function(){return j-g.offset().top-f(this).outerHeight(true)/2});g=null}var c=this;this.elLk.container.resizable({handles:"e",grid:[100,0],minWidth:this.minImageWidth,maxWidth:f(D).width()-this.el.offset().left,helper:"image_resize_overlay",start:a,resize:a,stop:function(g,h){h.originalSize.width===h.size.width?f(this).css({width:c.imageResize,height:""}):c.resize(c.imageResize)}})},makeSortable:function(){var a=this,b=f(".boundaries_wrapper",this.el).position().top,c=this.elLk.boundaries.position().top+
b-(o.browser.ie7?3:0),g=[];this.elLk.boundaries.children().each(function(h){var j=f(this),l=j.position().top+c,p=[];j.data({areas:p,position:h,top:j.offset().top});g.push({top:Math.floor(l),bottom:Math.ceil(l+j.height()),areas:p})});f.each(this.areas,function(){var h=0;a:for(;h<=10;h++)for(var j=g.length-1;j>=0;j--)if(g[j].top<=this.t+h&&g[j].bottom>=this.b-h){g[j].areas.push(this);this.assigned=true;break a}});this.elLk.boundaries.each(function(){f(this).data("species",this.className.split(" ")[0])}).sortable({axis:"y",handle:"div.handle",revert:200,helper:"clone",placeholder:"placeholder",start:function(h,j){a.sortStart(h,j)},stop:function(h,j){a.sortStop(h,j)},update:function(h,j){a.sortUpdate(h,j)}}).css("visibility","visible");this.elLk.img2=this.elLk.img.wrap("<div>").parent().css({overflow:"hidden",height:b}).clone().insertAfter(this.elLk.img.parent()).css({height:"auto"}).find("img").css({marginTop:-b})},removeTrack:function(a){var b=this;if(!this.elLk.img2)return false;var c=0;this.el.find("li."+a).each(function(){var g=f(this),h=g.data("areas");b.areas=f.grep(b.areas,function(j){return f.inArray(j,h)===-1});c+=parseInt(g.css("height"));g=null}).remove();this.elLk.labelLayers=this.elLk.labelLayers.has("."+a).remove().end().filter(function(){return!!this.parentNode});this.elLk.img2.css("marginTop",parseInt(this.elLk.img2.css("marginTop"))-c);this.positionAreas(-c);this.positionLayers();this.removeShare();o.EventManager.trigger("removeShare");Object.keys(this.highlightRegions)>0&&this.highlightImage(this.imageNumber,0);this.markLocation(o.markedLocation);return true},sortStart:function(a,b){b.placeholder.css({backgroundImage:b.item.css("backgroundImage"),backgroundPosition:b.item.css("backgroundPosition"),backgroundPositionY:b.item.css("backgroundPositionY"),height:b.item.height(),opacity:0.8}).html(b.item.html());b.helper.stop().css({opacity:0.8}).addClass("helper");f(N.body).addClass("track-reordering");this.dragging=true},sortStop:function(){f(N.body).removeClass("track-reordering");this.dragging=false},sortUpdate:function(a,b){a=f.trim(b.item.prev().prop("className")||"").replace(" ",".");var c=f.trim(b.item.prop("className")).replace(" ",".");o.EventManager.triggerSpecific("changeTrackOrder","modal_config_"+this.id.toLowerCase(),c,a);this.afterSort(b.item.parent().data("species"),c,a)},externalOrder:function(a,b,c){var g=this.elLk.boundaries.find("li."+b),h=[];for(var j in c){h=this.elLk.boundaries.find("li."+c[j]);if(h.length)break}if(g.length)h.length?g.insertAfter(h):g.parent().prepend(g);this.afterSort(a,b,c[0]||"")},afterSort:function(a,b,c){this.positionAreas();this.positionLayers();this.removeShare();o.EventManager.trigger("removeShare");this.saveSort(a,b,c)},saveSort:function(a,b,c){f.ajax({url:"/"+a+"/Ajax/track_order",type:"post",data:{image_config:this.imageConfig,track:b,prev:c}})},positionAreas:function(a){var b=this.elLk.boundaries.children();b.each(function(c){var g=f(this),h,j;if(c!==g.data("position")){h=g.offset().top;j=h-g.data("top");f.each(g.data("areas"),function(){this.t+=j;this.b+=j});g.data({top:h,position:c})}g=null});a&&f.each(this.areas,function(c,g){if(g.a.klass.drag)g.b+=a;else if(g.a.klass.label&&!g.assigned){g.t+=a;g.b+=a}});b=null},changeFavourite:function(a,b){this.elLk.hoverLabels.filter("."+a).find("a.favourite").toggleClass("selected",b)},changeHighlightTrackIcon:function(a,b){this.elLk.hoverLabels.filter("."+a).find("a.hl-icon-highlight").toggleClass("selected",b)},dragStart:function(a){var b=this;this.dragCoords.map=this.getMapCoords(a);this.dragCoords.page={x:a.pageX,y:a.pageY};this.dragCoords.offset={x:a.pageX-this.dragCoords.map.x,y:a.pageY-this.dragCoords.map.y};if(this.dragRegion=this.getArea(this.dragCoords.map,true)){this.mousemove=function(c,g){b.dragging=a;b.drag(g||c);return false};this.elLk.drag.on("mousemove",this.mousemove);f(N).on("keyup.exitOnEsc",function(c){if(c.which===27){b.newLocation=false;b.panning&&b.dragStop()}});(this.altKeyDragging=a.altKey||a.shiftKey||a.metaKey)&&this.setPanning(!this.panning);if(this.panning){this.selectArea(false);this.removeZMenus();this.elLk.hoverLayers.hide()}}},dragStop:function(a){var b;if(this.mousemove){this.elLk.drag.off("mousemove",this.mousemove);this.mousemove=false;f(N).off(".exitOnEsc");this.altKeyDragging&&this.setPanning(!this.panning)}if(this.dragging!==false){this.elLk.hoverLayers.show();if(this.elLk.boundariesPanning){this.clicking=this.dragging=false;this.elLk.boundariesPanning.helptip("destroy");if(this.newLocation)o.updateLocation(this.newLocation);else{this.elLk.boundariesPanning.parent().remove();this.elLk.boundariesPanning=false;this.markLocation(o.markedLocation)}}else{b={x:a.pageX-this.dragCoords.page.x,y:a.pageY-this.dragCoords.page.y};if(Math.abs(b.x)<3&&Math.abs(b.y)<3)this.clicking=true;else{b=this.vertical?{r:b.y,s:this.dragCoords.map.y}:{r:b.x,s:this.dragCoords.map.x};this.makeZMenu(a,b,{onclose:function(){this.selectArea(false)},context:this});this.clicking=this.dragging=false}}}},drag:function(a){this.panning?this.panImage(a):this.selectArea(a)},setPanning:function(a){if(this.panningAllowed){if(typeof a==="undefined")a=o.cookie.get("ENSEMBL_REGION_PAN")==="1";else o.cookie.set("ENSEMBL_REGION_PAN",a?"1":"0");this.panning=a;this.elLk.dragSwitch.toggleClass2("selected",function(){return f(this).find("button").hasClass("on")?a:!a})}},panImage:function(a){if(!this.elLk.boundariesPanning)this.elLk.boundariesPanning=f('<div class="boundaries_panning">').appendTo(this.elLk.boundaries.parent()).append(this.elLk.boundaries.clone()).css({left:this.dragRegion.l,width:this.dragRegion.r-this.dragRegion.l}).find("ul").find("li").css("marginLeft",-1*this.dragRegion.l).end().helptip({delay:500,position:{at:"center",of:this.el}});if(a=Math.min(this.dragRegion.range.start-1,Math.round((a.pageX-this.dragCoords.page.x)*this.dragRegion.range.scale))){this.newLocation=this.dragRegion.range.chr+":"+(this.dragRegion.range.start-a)+"-"+(this.dragRegion.range.end-a);this.elLk.boundariesPanning.helptip("option","content",this.newLocation).helptip("open");this.markLocation(o.markedLocation,a)}else{this.newLocation=false;this.elLk.boundariesPanning.helptip("close")}this.elLk.boundariesPanning.css("left",a/this.dragRegion.range.scale+"px")},resize:function(a){this.params.updateURL=o.updateURL({image_width:a},this.params.updateURL);this.getContent()},makeZMenu:function(a,b,c){var g;g=b.r?this.dragRegion:c&&c.approx?this.getBestArea(b,U,c.approx):this.getArea(b);if(!(!g||g.a.klass.label||g.a.klass.tooltip))if(g.a.klass.nav)this.navClick(g,a);else{if(g.a.attrs.href&&o.markedLocation)g.a.attrs.href=o.updateURL({mr:o.markedLocation[0]},g.a.attrs.href);var h=(c&&c.mr_menu?"mr_menu":"zmenu_")+g.a.coords.join("_"),j,l,p;if(a.shiftKey||g.a.klass.das||g.a.klass.group)if(l=(j=this.dragRegion||this.getArea(b,true))?j.range:false){j=l.start+l.scale*(l.vertical?b.y-j.t:b.x-j.l);p=l.scale*2;b.clickChr=l.chr;b.clickStart=Math.max(Math.floor(j-p),l.start);b.clickEnd=p>1?Math.min(Math.ceil(j+p),l.end):Math.max(b.clickStart,Math.floor(j));b.clickY=g.a.coords[3]-b.y;h+="_multi"}if(c&&c.close)(a=f("#"+h))&&a.hide();else{o.EventManager.trigger("makeZMenu",h,f.extend({event:a,coords:b,area:g,imageId:this.id,relatedEl:g.a.id?f("."+g.a.id,this.el):false},c));this.zMenus[h]=1;return h}}},navClick:function(a){o.redirect(a.a.attrs.href)},removeZMenus:function(){for(var a in this.zMenus)o.EventManager.trigger("destroyPanel",a)},highlightAllImages:function(){var a=o.images[this.imageNumber+1]||o.images[this.imageNumber],b,c;for(c in a){b=a[c];this.highlightImage.apply(this,b)}if(!this.align&&o.images[this.imageNumber-1]){a=o.images[this.imageNumber];for(c in a){b=a[c].slice();b.unshift("highlightImage");o.EventManager.trigger.apply(o.EventManager,b)}}},highlightImage:function(a,b,c,g){if(!(!this.draggables.length||this.vertical||a-this.imageNumber>1||a-this.imageNumber<0))for(var h=this.highlightRegions[b].length,j;h--;){j=this.highlightRegions[b][h];if(!j.region.a)break;if(this.imageNumber===a){this.imageNumber!==1&&this.highlight(j.region,"redbox",b,h);if(b&&o.multiSpecies[b]){c=o.multiSpecies[b].location.start;g=o.multiSpecies[b].location.end}else{c=o.location.start;g=o.location.end}}j={t:Math.round(j.region.t+2),b:Math.round(j.region.b-
2),l:Math.round((c-j.region.range.start)/j.region.range.scale+j.region.l),r:Math.round((g-j.region.range.start)/j.region.range.scale+j.region.l)};if(this.params.highlight){this.boxCoords[b]=j;this.updateExportButton();this.highlight(j,"redbox2",b,h)}}},highlight:function(a,b,c,g){var h=a.r-a.l+1,j=a.b-a.t+1,l,p={l:{left:a.l,width:1,top:a.t,height:j},r:{left:a.r,width:1,top:a.t,height:j},t:{left:a.l,width:h,top:a.t,height:1,overflow:"hidden"},b:{left:a.l,width:h,top:a.b,height:1,overflow:"hidden"}};if(typeof c!=="undefined"){l=b;b=b+"_"+c+(g||"")}a=f("."+b,this.el);a.length||(a=f(['<div class="',b,' l"></div><div class="',b,' r"></div><div class="',b,' t"></div><div class="',b,' b"></div>'].join("")).insertAfter(this.elLk.img));a.each(function(){f(this).css(p[this.className.split(" ")[1]])});typeof c!=="undefined"&&a.addClass(l);this.selectArea(false);a=null},selectArea:function(a){if(a===false)this.elLk.selector&&this.elLk.selector.hide();else{var b={},c=a.pageX-this.dragCoords.offset.x;a=a.pageY-this.dragCoords.offset.y;switch(c<this.dragCoords.map.x){case true:b.l=c;b.r=this.dragCoords.map.x;break;case false:b.r=c;b.l=this.dragCoords.map.x;break}switch(a<this.dragCoords.map.y){case true:b.t=a;b.b=this.dragCoords.map.y;break;case false:b.b=a;b.t=this.dragCoords.map.y;break}if(this.vertical||c<this.dragRegion.l)b.l=this.dragRegion.l;if(this.vertical||c>this.dragRegion.r)b.r=this.dragRegion.r;if(!this.vertical||a<this.dragRegion.t)b.t=this.dragRegion.t;if(!this.vertical||a>this.dragRegion.b)b.b=this.dragRegion.b;this.elLk.selector.css({left:b.l,top:b.t,width:b.r-b.l+1,height:b.b-b.t-1}).show()}},initSelector:function(){if(!this.elLk.selector||!this.elLk.selector.length){this.elLk.selector=f('<div class="_selector selector"></div>').insertAfter(this.elLk.img).toggleClass("vertical",this.vertical).filter(":not(.vertical)").append('<div class="left-border"></div><div class="right-border"></div>').end();this.activateSelector()}},activateSelector:function(){this.elLk.selector.on("click",function(a){a.stopPropagation();f(N).off(".selectbox")}).on("mousedown",{panel:this},function(a){a.stopPropagation();a.preventDefault();f(N).on("mousemove.selectbox",{action:a.target!==a.currentTarget?a.target.className.match(/left/)?"left":"right":"move",x:a.pageX,panel:a.data.panel,width:parseInt(a.data.panel.elLk.selector.css("width")),left:parseInt(a.data.panel.elLk.selector.css("left"))},function(b){b.stopPropagation();var c=b.pageX-b.data.x,g={left:b.data.left,width:b.data.width};if(b.data.action!=="right")c=Math.max(c,b.data.panel.dragRegion.l+
1-g.left);if(b.data.action!=="left")c=Math.min(b.data.panel.dragRegion.r-g.left-g.width+1,c);switch(b.data.action){case"left":c=Math.min(g.width-6,c);g.left+=c;g.width-=c;break;case"right":g.width=Math.max(g.width+c,6);break;case"move":g.left+=c;break}b.data.panel.elLk.selector.css(g);b.data.panel.makeZMenu(b,{s:g.left,r:g.width})}).on("mouseup.selectbox click.selectbox",function(){f(this).off(".selectbox")})}).end()},markLocation:function(a,b){var c=this,g;b=b||0;if(!(this.vertical||this.multi))if(this.locationMarkingArea){if(!this.elLk.markedLocation)this.elLk.markedLocation=f('<div class="selector mrselector"><div class="mrselector-close">&#9776;</div></div>').hide().insertAfter(this.elLk.selector).find("div").helptip({content:"Click for more options"}).on("click mousedown",function(h){h.stopPropagation();f(this).helptip("close");h.type==="click"&&c.makeZMenu(h,c.getMapCoords(h),{onclose:function(){c.selectArea(false)},context:c,mr_menu:1})}).end();if(!this.elLk.markerButton)this.elLk.markerButton=f('<a class="mr-reset outside">').hide().appendTo(this.elLk.toolbars).helptip().on({refreshTip:function(){f(this).helptip("option","content",this.className.match(/outside/)?"Jump to the marked region":this.className.match(/selected/)?"Clear marked region":"Reinstate marked region")},click:function(h){h.preventDefault();if(this.className.match("selected"))o.markLocation(false);else if(this.className.match(/outside/)){h=o.getMarkedLocation()||o.lastMarkedLocation;var j=c.locationMarkingArea.range.end-c.locationMarkingArea.range.start,l=(h[2]+h[3])/2;o.markLocation(h);o.updateLocation(h[1]+":"+Math.max(1,Math.round(l-j/2))+"-"+
Math.round(l+j/2))}else o.markLocation(o.lastMarkedLocation)}});if(a===false){this.elLk.markedLocation.hide();this.elLk.markerButton.removeClass("selected").trigger("refreshTip").show();this.updateExportButton()}else if(a){this.selectArea(false);g=this.locationMarkingArea.range.start-b;b=this.locationMarkingArea.range.end+1-b;if(this.locationMarkingArea.range.chr===a[1]&&(g>a[2]&&g<a[3]||b>a[2]&&b<a[3]||g<=a[2]&&b>=a[3])){this.elLk.markedLocation.css({left:this.locationMarkingArea.l+Math.max(a[2]-
g,0)/this.locationMarkingArea.range.scale,width:(Math.min(b,a[3]+1)-Math.max(a[2],g))/this.locationMarkingArea.range.scale-1,top:this.locationMarkingArea.t,height:this.locationMarkingArea.b-this.locationMarkingArea.t}).show();this.elLk.markerButton.addClass("selected").removeClass("outside").trigger("refreshTip").show()}else{this.elLk.markedLocation.hide();this.panningAllowed?this.elLk.markerButton.addClass("outside").removeClass("selected").trigger("refreshTip").show():this.elLk.markerButton.hide()}this.updateExportButton()}}},updateExportButton:function(){var a=this.getExtraExportParam();a=f.isEmptyObject(a)?false:encodeURIComponent(JSON.stringify(a));this.elLk.exportButton.attr("href",function(){return o.updateURL({extra:a,decodeURL:1},this.href)})},getExtraExportParam:function(){var a={};a.highlightedTracks=Object.keys(this.highlightedTracks);if(!f.isEmptyObject(this.boxCoords))a.boxes=this.boxCoords;if(o.markedLocation&&this.locationMarkingArea){a.mark={x:Math.round((o.markedLocation[2]-this.locationMarkingArea.range.start)/
this.locationMarkingArea.range.scale+this.locationMarkingArea.l),y:this.locationMarkingArea.t,w:Math.round((o.markedLocation[3]-o.markedLocation[2])/this.locationMarkingArea.range.scale),h:this.locationMarkingArea.b-this.locationMarkingArea.t};if(a.mark.x<this.locationMarkingArea.l){a.mark.w=a.mark.w-this.locationMarkingArea.l+a.mark.x;a.mark.x=this.locationMarkingArea.l}a.mark.w<=0&&delete a.mark}return a},getMapCoords:function(a){this.imgOffset=this.elLk.img||this.imgOffset?this.imgOffset||this.elLk.img.offset():0;return{x:a.pageX-this.imgOffset.left-1,y:a.pageY-this.imgOffset.top-1}},getBestArea:function(a,b,c){var g,h=[[0,0],[-1,0],[1,0],[0,-1],[0,1]];for(g=0;g<h.length;g++){var j=this.getArea({x:a.x+h[g][0]*c,y:a.y+h[g][1]*c},b);if(j)return j}},getArea:function(a,b){var c=false;b=b?this.draggables:this.areas;for(var g,h,j=0;j<b.length;j++){g=b[j];switch(g.a.shape.toLowerCase()){case"circle":c=this.inCircle(g.c,a);break;case"poly":c=this.inPoly(g.c,a);break;default:c=this.inRect(g,a);break}if(c===true){c=f.extend({},g);if(!c.a.attrs.overlap)return h||c;h=c}}return h},inRect:function(a,b){return b.x>=a.l&&b.x<=a.r&&b.y>=a.t&&b.y<=a.b},inCircle:function(a,b){return(b.x-a[0])*(b.x-a[0])+(b.y-a[1])*(b.y-a[1])<=a[2]*a[2]},inPoly:function(a,b){for(var c=a.length,g=0,h,j,l,p,m=0;m<c;m+=2){h=a[m%c]-b.x;l=a[(m+1)%c]-b.y;j=a[(m+2)%c]-b.x;p=a[(m+3)%c]-b.y;g+=Math.atan2(h*p-l*j,h*j+l*p)}return Math.abs(g/Math.PI/2)>0.01},positionToolbarPopup:function(a,b){b=f(b.parentNode);a.css({top:b.hasClass("bottom")?b.offset().top-
a.outerHeight():this.elLk.img.offset().top});return a},getSpecies:function(){var a=f.map(this.draggables,function(c){return c.a.attrs.href.split("|")[3]});if(a.length){var b={};b[o.species]=1;f.each(a,function(){b[this]=1});a=f.map(b,function(c,g){return g})}return a.length>1?a:U},dropFileUpload:function(){function a(p){p.stopPropagation();p.preventDefault();return false}function b(p){if(p.length){var m=p.shift();if(m.size>5*Math.pow(1024,2))return b(p);h.readAsText(m);h.onloadend=function(n){j.push(f.ajax({url:"/"+
o.species+"/UserData/DropUpload",data:{text:n.target.result,name:m.name},type:"POST",success:function(q){if(q)l=q;b(p)}}))}}else if(l){c.hashChangeReload=true;o.updateLocation(l)}}var c=this,g=this.el[0],h=new FileReader,j=[],l;g.addEventListener("dragenter",a,false);g.addEventListener("dragexit",a,false);g.addEventListener("dragover",a,false);f(".drop_upload",this.el).length&&!this.multi?g.addEventListener("drop",function(p){p.stopPropagation();p.preventDefault();b([].slice.call(p.dataTransfer.files).sort(function(m,n){return m.name.toLowerCase()>n.name.toLowerCase()}))},false):g.addEventListener("drop",a,false);g=null}});o.Panel.Message=o.Panel.Content.extend({constructor:function(){this.base.apply(this,arguments);o.EventManager.register("resetMessage",this,this.reset)},reset:function(){this.el.empty()}});o.Panel.ModalContainer=o.Panel.Overlay.extend({init:function(){var a=this;this.base();this.elLk.content=f(".modal_content",this.el);this.elLk.title=f(".modal_title",this.el);this.elLk.menu=f("ul.tabs",this.el);this.elLk.tabs=f("li",this.elLk.menu);this.elLk.caption=f(".modal_caption",this.el);this.elLk.closeButton=f(".modal_close",this.el).on("click",f.proxy(this.hide,this));this.elLk.overlay=f(".modal_overlay",this.el);this.elLk.overlayBg=f(".modal_overlay_bg",this.el);this.elLk.overlayContent=f(".overlay_content",this.elLk.overlay);this.pageReload=this.reloadURL=this.xhr=false;this.sectionReload={};this.modalReload={};this.activePanel="";this.el.on("click",".modal_confirm",function(){var b=confirm(this.title+
"\nAre you sure you want to continue?");this.title="";b===true&&a.open(this);return false});f(".overlay_close",this.elLk.overlay).on("click",f.proxy(this.hideOverlay,this));this.elLk.content.each(function(){f(this).data("tab",a.elLk.tabs.children("a."+this.id).parent())});this.elLk.tabs.children("a").each(function(){f(this).data("panels",a.elLk.content.filter("#"+this.className).addClass("active"))}).on("click",function(){var b=f(this).parent();if(!b.hasClass("active")){o.EventManager.trigger("updateConfiguration",true);if(a.el){a.elLk.tabs.removeClass("active");b.addClass("active");a.getContent(this.href,f(this).data("panels").filter(".active").attr("id"))}}return false});o.EventManager.register("modalOpen",this,this.open);o.EventManager.register("modalClose",this,this.hide);o.EventManager.register("modalOverlayShow",this,this.showOverlay);o.EventManager.register("modalOverlayHide",this,this.hideOverlay);o.EventManager.register("modalPanelResize",this,this.resizeOverlay);o.EventManager.register("queuePageReload",this,this.setPageReload);o.EventManager.register("addModalContent",this,this.addContent);o.EventManager.register("setActivePanel",this,function(b){this.activePanel=b;this.elLk.content.filter("#"+b).addClass("active")});o.EventManager.register("modalReload",this,function(b){this.modalReload[b]=true})},open:function(a){var b=f(a),c=(a.className?((a.className.match(/\bmodal_title_(\w+)\b/)||[]).pop()||"").replace("_"," "):"")||this.elLk.caption.html()||a.title||b.text();b=this.el.is(":visible")||b.hasClass("force")?a.rel:this.activePanel.match(/config/)&&a.rel.match(/config/)?this.activePanel:a.rel;b=(b||"").split("-");var g=b[0]?this.elLk.tabs.children("a."+b[0]):[];this.elLk.caption.html(c).show();this.elLk.menu.hide();this.elLk.closeButton.attr({title:"Close",alt:"Close"});this.show();this.getContent(a.href||(g.length?g[0].href:""),b.join("-"));f("body").addClass("modal-open");return true},hide:function(a){this.base();this.elLk.caption.html("");this.hideOverlay();if(a!==true&&!o.EventManager.trigger("updateConfiguration")&&(this.pageReload||this.sectionReload.count)||this.pageReload==="force")this.setPageReload(false,true);else f(".modal_reload",this.el).length&&this.setPageReload(false,true,true);f("body").removeClass("modal-open")},showOverlay:function(a){this.overlayShown=true;this.elLk.overlayContent.children().detach().end().append(a);this.elLk.overlay.show().css({marginLeft:-this.elLk.overlay.outerWidth()/2});this.resizeOverlay();this.elLk.overlayBg.show();this.elLk.closeButton.hide()},hideOverlay:function(){this.overlayShown=false;this.elLk.closeButton.show();this.elLk.overlayBg.add(this.elLk.overlay).hide()},resizeOverlay:function(){if(this.overlayShown){this.elLk.overlayContent.removeClass("overlay_scroll").height("auto");var a=this.el.height(),b=this.elLk.overlay.outerHeight();this.elLk.overlay.offset().top+b>this.el.offset().top+a&&this.elLk.overlayContent.height(a-this.elLk.overlay.position().top*2-(b-this.elLk.overlay.height())).addClass("overlay_scroll")}},getContent:function(a,b){this.xhr&&this.xhr.abort();var c=a.match(/reset=/)||f(".modal_reload",this.el).remove().length,g;if(b&&b.match("-")){g=b.split("-");b=g.shift();g=g.join("-")}else g=(a.match(/#(.+)$/)||[])[1];b=b||(g?this.activePanel:"modal_default");var h=this.elLk.content.filter("#"+b);this.elLk.content.hide();this.activePanel=b;if(this.modalReload[b]){delete this.modalReload[b];c=true}if(c){h.empty();o.EventManager.trigger("resetConfig")}else if(b.match(/config/)&&h.children(":not(.spinner, .ajax_error)").length){o.EventManager.triggerSpecific("showConfiguration",b,g);this.changeTab(this.elLk.content.filter("#"+b).data("tab"));this.elLk.closeButton.attr({title:"Save and close",alt:"Save and close"});return}h.html('<div class="spinner">Loading Content</div>').show();var j=a.match(/decodeURL=1/)||0;j=o.prepareRequestParams(a,j);this.xhr=f.ajax({url:j.requestURL,type:j.requestType,data:j.requestData,dataType:"json",context:this,success:function(l){var p=g?f.extend(l.params||{},{hash:g}):l.params,m,n,q;if(l.redirectURL)return this.getContent(l.redirectURL,b);switch(l.panelType){case"ModalContent":n="Close";break;case"Configurator":n="Save and close";break;default:n="Update options";break}l.activeTab&&this.changeTab(this.elLk.tabs.has("."+l.activeTab));o.EventManager.trigger("destroyPanel",b,"empty");m=f(l.wrapper);if(l.tools)l.nav+=l.tools;if(l.nav)q=['<div class="modal_nav nav">',l.nav,"</div>"].join("");else m.addClass("no_local_context");h.html(l.content).wrapInner(m).prepend(q).find(".tool_buttons > p").show();this.elLk.closeButton.attr({title:n,alt:n});m=f(".modal_reload",h);if(c||m.length)this.setPageReload(f("input.component",h).val(),false,!!m.length,m.attr("href"));if(a.match(/reset=/))p.reset=a.match(/reset=(\w+)/)[1];o.EventManager.trigger("createPanel",b,l.panelType||f((l.content.match(/<input[^<]*class="[^<]*panel_type[^<]*"[^<]*>/)||[])[0]).val(),p)},error:function(l){l.status!==0&&h.html('<div class="error ajax_error"><h3>Ajax error</h3><div class="error-pad"><p>Sorry, the page request failed to load.</p><pre></pre></div></div>').find("pre").text(l.responseText)},complete:function(){this.xhr=false}})},addContent:function(a,b,c,g){g=this.elLk.tabs.children("a."+(g||c));if(a){this.elLk.content.filter(":last").after(a);this.elLk.content=f(".modal_content",this.el);g.data("panels").push(a[0]);a.data("tab",g.parent())}this.getContent(b,c)},changeTab:function(a){if(!a.hasClass("active")){this.elLk.tabs.removeClass("active");a.addClass("active")}this.elLk.caption.hide();this.elLk.menu.show()},setPageReload:function(a,b,c,g){if(a&&o.PanelManager.panels[a]){this.sectionReload[a]=1;this.sectionReload.count=(this.sectionReload.count||0)+1}else if(a!==false)this.pageReload=true;if(c===true)this.pageReload="force";if(g)this.reloadURL=g;if(b===true){o.EventManager.trigger("reloadPage",!!this.pageReload||this.sectionReload,this.reloadURL);o.EventManager.trigger("partialReload");this.sectionReload={}}}});o.Panel.ModalContent=o.Panel.LocalContext.extend({constructor:function(){this.base.apply(this,arguments);o.EventManager.register("modalFormSubmit",this,this.formSubmit)},init:function(){var a=this;this.activeLink=false;this.base();this.elLk.content=f(".modal_wrapper",this.el);f("a",this.elLk.links).on("click",function(){if(!f(this).hasClass("disabled")){var b=f(this).parent();if(!b.hasClass("active")){a.elLk.links.removeClass("active");a.getContent(b.addClass("active"),this.href)}}return false});this.elLk.links.on("click",function(b){b.stopPropagation();return f(this).children("a").trigger("click")});this.elLk.content.on("click","a.delete_bookmark",function(){o.EventManager.trigger("deleteBookmark",this.href.match(/id=(\d+)\b/)[1])}).on("click","form div.select_all input",function(){f(this).parents("fieldset").find("input[type=checkbox]").prop("checked",this.checked)}).on("click","form.wizard input.back",function(){f(this).parents("form.wizard").append('<input type="hidden" name="wizard_back" value="1" />').submit()});this.initialize();this.initFromHash()},initialize:function(){this.addSubPanel();this.setSelectAll();this.elLk.dataTable=f("table.data_table",this.el);if(this.elLk.dataTable.length){this.dataTableInit||f.extend(this,o.DataTable);this.dataTableInit();this.el.togglewrap()}o.EventManager.trigger("validateForms",this.el);this.el.find("._ht").helptip();this.el.find("._stt").selectToToggle({},this.el);this.el.find("._sdd").speciesDropdown()},initFromHash:function(){this.params.hash&&this.elLk.links.filter(":has(a."+this.params.hash+")").trigger("click")},getContent:function(a,b){this.elLk.content.html('<div class="panel"><div class="spinner">Loading Content</div></div>');b=o.prepareRequestParams(b);f.ajax({url:b.requestURL,type:b.requestType,data:b.requestData,dataType:"json",context:this,success:function(c){if(c.redirectURL&&c.redirectType==="modal")return this.getContent(a,c.redirectURL);else if(c.redirectType==="page")return o.redirect(c.redirectURL);else if(c.redirectType==="download"){o.EventManager.trigger("modalClose");D.location.href=c.redirectURL;return}if(typeof a==="undefined"||a.hasClass("active"))this.updateContent(c)},error:function(c){c.status!==0&&this.displayErrorMessage(c.responseText)}})},formSubmit:function(a,b){b=b||a.serialize();f.ajax({url:a.attr("action"),type:a.attr("method"),data:b,dataType:"json",context:this,iframe:!!a.find("input[type=file]").length,form:a,success:function(c){if(c.redirectURL&&c.redirectType==="modal")return c.modalTab?o.EventManager.trigger("modalOpen",{href:c.redirectURL,rel:c.modalTab}):this.getContent(U,c.redirectURL);if(c.redirectType==="download"){o.EventManager.trigger("modalClose");D.location.href=c.redirectURL}else if(c.success===true||c.redirectType==="page")o.EventManager.trigger("reloadPage",false,c.redirectType==="page"?c.redirectURL:false);else this.el.is(":visible")&&this.updateContent(c)},error:function(c){c.status!==0&&this.displayErrorMessage(c.responseText)}});this.elLk.content.html('<div class="panel"><div class="spinner">Loading Content</div></div>');return false},updateContent:function(a){var b=this;a.wrapper&&this.elLk.content.wrapInner(a.wrapper);this.elLk.content.html(a.content);f(".modal_reload",this.el).length&&o.EventManager.trigger("queuePageReload","",false,false,f(".modal_reload",this.el).attr("href"));f(".export_buttons_preview",this.el).length&&f(".export_buttons_preview",this.el).on("click",function(){var c=f('input[name="'+this.name+'"]:hidden',b.el);if(this.name==="uncompressed"){D.location=f(c).val();o.EventManager.trigger("modalClose")}else{this.name==="gz"&&f("form#export",this.el).attr("action",f(c).val()).find('input[name="compression"]').val("gz");f("form#export",this.el).submit()}});this.initialize()},addSubPanel:function(){var a=this,b=[];f(".ajax",this.elLk.content).each(function(){b.push([f(this).parents(".js_panel")[0].id,"Content"])});f(".js_panel",this.elLk.content).each(function(){var g=f("input.subpanel_type",this).val();g&&!(a instanceof o.Panel[g])&&b.push([this.id,g])});for(var c in b){o.EventManager.trigger("destroyPanel",b[c][0],"empty");o.EventManager.trigger("createPanel",b[c][0],b[c][1])}},setSelectAll:function(){f("form div.select_all input",this.elLk.content).prop("checked",function(){return f(this).parents("fieldset").find("input[type=checkbox]:not(:checked)").length-1<=0});this.elLk.content.find("input._selectall").on("change",function(){f(this).parents("div._selectall").find("input[type=checkbox]").prop("checked",this.checked)})},displayErrorMessage:function(a){this.elLk.content.html('<div class="error ajax_error"><h3>Ajax error</h3><div class="error-pad"><p>Sorry, the page request failed to load.</p><pre></pre></div></div>').find("pre").text(a||"")}});o.Panel.MultiSpeciesSelector=o.Panel.MultiSelector.extend({updateSelection:function(){var a=["s","r","g"],b={},c=[],g=[],h,j,l;for(h in o.multiSpecies)b[o.multiSpecies[h].s]=parseInt(h,10);for(h=0;h<this.selection.length;h++){j=b[this.selection[h]];if(typeof j!=="undefined")for(l=a.length;l--;){if(o.multiSpecies[j][a[l]])a[l]==="s"?g.push("s"+(h+1)+"="+o.multiSpecies[j].s):c.push(a[l]+(h+1)+"="+o.multiSpecies[j][a[l]])}else g.push("s"+(h+1)+"="+this.selection[h])}this.selection.join(",")!==this.initialSelection&&f.ajax({url:"/"+o.species+"/Ajax/multi_species?"+g.join(";"),context:this,complete:function(){o.redirect(this.elLk.form.attr("action")+"?"+o.cleanURL(this.elLk.form.serialize()+
";"+g.join(";")+";"+c.join(";")))}});return true}});o.Panel.PopulationGraph=o.Panel.Piechart.extend({init:function(){this.graphColours={A:"#008000",T:"#FF0000",G:"#FF9000",C:"#0000FF","-":"#000000","default":["#008080","#FF00FF","#7B68EE"]};this.base()},toggleContent:function(a){if(a.hasClass("closed")&&!a.data("done")){this.base(a);this.makeGraphs(this.el.find("."+a.attr("rel")+" .pie_chart > div[id^=graphHolder]").map(function(){return this.id.match(/\d+/).pop()}).toArray());a.data("done",true)}else this.base(a);a=null}});o.Panel.RegButtons=o.Panel.Content.extend({constructor:function(a,b){this.base(a,b);o.EventManager.register("partialReload",this,this.partialReload)},partialReload:function(){o.EventManager.triggerSpecific("updatePanel",this.id,null,null,null,null,{background:true})}});o.Panel.TextSequence=o.Panel.Content.extend({constructor:function(){this.base.apply(this,arguments);o.EventManager.register("dataTableRedraw",this,this.initPopups)},init:function(){var a=this;this.base();o.browser.ie||f("pre > [title]",this.el).helptip({track:true});this.el.find(".adornment").each(function(){f(this).adorn(function(b){b=f(b);a.initPopups(b);a.updateKey(b);a.fixKey()})});this.el.on("mousedown",".info_popup",function(){f(this).css("zIndex",++o.PanelManager.zIndex)})},updateKey:function(a){var b=f(".sequence_key_json",a);if(b=JSON.parse(b.html()||false)){a=a.parents(".js_panel").find(".sequence_key");if(a.length){var c=a.data("key")||{};f.extend(true,c,b);a.data("key",c);var g=[];f.each(c,function(h,j){h=="variations"||h=="exons"?f.each(j,function(l){g.push(h+"="+l)}):g.push(h+"="+j)});g.sort();b=this.params.updateURL.replace(/sub_slice\?/,"key?;");b+=g.join(";");a.data("url",b)}}},fixKey:function(){if(!this.elLk.keyBox)this.elLk.keyBox=this.el.parents(".js_panel").find("._adornment_key").first();if(!this.elLk.keyBoxToggler)this.elLk.keyBoxToggler=f('<div class="toggler"><span class="open">&#9660;</span><span>&#9650;</span></div>');this.elLk.keyBoxToggler.parent().length||this.elLk.keyBoxToggler.appendTo(this.elLk.keyBox).off(".textsequence").on("click.textsequence",function(){f(this).parent().removeClass("was_collapsed").toggleClass("collapsed",100)});this.elLk.keyBox.keepOnPage({marginTop:10,onreset:function(){f(this).removeClass("fixed").filter(".collapsed").removeClass("collapsed").addClass("was_collapsed")},onfix:function(){f(this).addClass("fixed").filter(".was_collapsed").removeClass("was_collapsed").addClass("collapsed")}}).keepOnPage("trigger")},initPopups:function(a){a.find(".info_popup").hide();a.find("pre a.sequence_info:not(._zmenu_initalised)").zMenuLink().addClass("_zmenu_initalised")},getContent:function(a,b,c,g,h){h=h||{};h.paced=true;this.elLk.keyBox&&this.elLk.keyBox.keepOnPage("destroy");this.base(a,b,c,g,h)},showFullTextSequence:function(){for(var a=1,b=this.params.chunkLength,c=parseInt(this.params.totalLength/b)*b,g="",h="";b<=this.params.totalLength;){g=this.params.updateURL;g=g.replace(/subslice_start=(\d+);/,"subslice_start="+a+";");g=g.replace(/subslice_end=(\d+);/,"subslice_end="+b+";");g=g.replace(/follow=0/,"");g+=";follow=1";h+='<div class="ajax"><input type="hidden" class="ajax_load" value="'+
g+'" /></div>';if(b==this.params.totalLength)break;a=b+1;b+=this.params.chunkLength;if(b>c)b=this.params.totalLength}return h}});o.Panel.TranscriptHaplotypes=o.Panel.Content.extend({init:function(){var a=this;this.base();this.haplotypeData=JSON.parse(this.params.haplotype_data);delete this.params.haplotype_data;var b=JSON.parse(this.params.population_info);delete this.params.population_info;this.populationStructure=b.population_structure;this.populationDescriptions=b.population_descriptions;this.samplePopulationHash=b.sample_population_hash;this.el.find("a.details-link").on("click",function(){a.renderHaplotypePanel(this.rel)});this.el.find(".tool_buttons a.popup").removeAttr("rel");this.el.find("a.zmenu").on("click",function(g){g.preventDefault();o.EventManager.trigger("makeZMenu",f(this).text().replace(/\W/g,"_"),{event:g,area:{link:f(this)}})});if(D.location.hash){b=D.location.hash.replace(/^\#/,"");var c=b.replace(/\_.+/,"");if(a.fetchHaplotypeByHex(c)){a.renderHaplotypePanel(c);D.location.href="#"+b}}},renderHaplotypePanel:function(a){var b=this,c=f("div.details-view");c.show().empty().append(b.detailsContent(a));c.find("._ht").helptip();c.find(".toggle").on("click",function(g){g.preventDefault();b.el.find("#"+this.rel).toggle();g=f(this);g.hasClass("closed")?g.removeClass("closed").addClass("open"):g.removeClass("open").addClass("closed")});c.find("a.zmenu").on("click",function(g){g.preventDefault();o.EventManager.trigger("makeZMenu",f(this).text().replace(/\W/g,"_"),{event:g,area:{link:f(this)}})})},fetchHaplotypeByHex:function(a){for(var b=0;b<this.haplotypeData.protein_haplotypes.length;b++){var c=this.haplotypeData.protein_haplotypes[b];if(c.hex===a)return c}for(b=0;b<this.haplotypeData.cds_haplotypes.length;b++){c=this.haplotypeData.cds_haplotypes[b];if(c.hex===a)return c}},detailsContent:function(a){var b=this.fetchHaplotypeByHex(a);if(typeof b==="undef")return"Unable to display details";var c=b.type,g=c==="cds"?"protein":"CDS";c="<hr/><h2>Details of "+(c==="cds"?"CDS":"protein")+" haplotype "+b.name.replace(/\,/g,",&#8203;")+"</h2><div>";g=[{id:"pop",title:"Population frequencies",sub:"populationTable"},{id:"seq",title:"Aligned sequence",sub:"alignedSequence"},{id:"raw",title:"Sequence",sub:"rawSequence"},{id:"cds",title:"Corresponding "+g+" haplotypes",sub:"otherHaplotypes"},{id:"sam",title:"Sample data",sub:"sampleTable"}];var h=[],j="";for(var l in g){var p=g[l];h.push('<a href="#'+a+"_"+p.id+'">'+p.title+"</a>");j=j+'<hr style="border-top-color: lightgrey"/><div id="'+a+"_"+p.id+'"><h3>'+p.title+"</h3>"+this[p.sub](b)+"</div>"}return c=c+"<div><i>Jump to: </i>"+h.join(" | ")+"</div>"+j+"</div>"},otherHaplotypes:function(a){a=this.getOtherHaplotypes(a);var b=[];for(var c in a){var g=a[c],h=g.type.substring(0,1),j=g.name.replace(/\,/g,",&#8203;");h='<span id="'+g.hex+'"><b>'+h+".ALT"+(h==="p"?"":parseInt(c)+1)+':</b> <a class="_ht" title="Details for '+(j==="REF"?"reference haplotype":"haplotype "+j)+'" href="'+D.location.href.replace(/\#.+/,"").replace(/\;?ht_type\=[a-z]+/,"")+";ht_type="+g.type+"#"+g.hex+'">'+j+"</a></span>";h=h+"<br/>Observed count: "+g.count+' | <a href="#" class="toggle closed" rel="seq-'+g.hex+'">Show sequence</a>';h=h+'<div class="hidden" style="margin-top: 1em; display: none" id="seq-'+g.hex+'">'+this.rawSequence(g)+"</div>";b.push(h)}return(b.length>1?"<p><i>NB: Each CDS sequence below encodes the same protein sequence</i></p>":"")+"<ul>"+b.map(function(l){return"<li>"+l+"</li>"}).join("")+"</ul>"},populationTable:function(a){var b=this.populationStructure,c=this.populationDescriptions,g='<table class="ss" style="width:500px"><tr><th>Population group</th><th>Population</th><th style="width:220px">Frequency (count)</th></tr>',h=Object.keys(b).sort();for(var j in h){var l=h[j],p=1,m=[];if(b[l].length>0){for(var n in b[l]){var q=b[l][n],t="",v=a.population_counts.hasOwnProperty(q)?a.population_counts[q]:0,x=a.population_frequencies.hasOwnProperty(q)?a.population_frequencies[q]:0;if(v){if(p)p=0;else t+="<tr>";t=t+'<td><span class="ht _ht" title="'+c[q]+'">'+this.shortName(q)+"</span></td><td>";t+='<nobr><div style="width:220px; float: left;">';t=t+'<div style="width:'+Math.round(x*120)+'px; background-color: #8b9bc1; float: left; display: inline; height: 1em;"></div>';t=t+'<div style="width:'+Math.round((1-x)*120)+'px; background-color:lightgrey; float: left; display: inline; height: 1em;"></div>';t=t+"&nbsp;"+x.toPrecision(3)+" ("+v+")</div></nobr>";t+="</td></tr>";m.push(t)}}g=g+'<tr><td rowspan="'+(m.length>0?m.length:1)+'"><b><span class="ht _ht" title="'+c[l]+'">'+this.shortName(l)+"</span></b></td>";g+=m.length?m.join(""):'<td colspan="2"><span style="font-style: italic; color: grey;">No data</span></td></tr>'}else{g+="<tr>";g+="<td>N/A</td>";g=g+'<td><span class="ht _ht" title="'+
c[l]+'">'+this.shortName(l)+"</span></td>";v=a.population_counts.hasOwnProperty(l)?a.population_counts[l]:0;x=a.population_frequencies.hasOwnProperty(l)?a.population_frequencies[l]:0;g+='<td><nobr><div style="width:220px; float: left;">';g=g+'<div style="width:'+Math.round(x*120)+'px; background-color: #8b9bc1; float: left; display: inline; height: 1em;"></div>';g=g+'<div style="width:'+Math.round((1-x)*120)+'px; background-color:lightgrey; float: left; display: inline; height: 1em;"></div>';g=g+
"&nbsp;"+x.toPrecision(3)+" ("+v+")</div></nobr>";g+="</td></tr>"}}g+="</table>";return g=g+"<p><b>Total count:</b> "+a.count+"</p>"},sampleTable:function(a){var b=this,c='<table id="ind-table" class="ss" style="width:500px"><tr><th>Sample name</th><th>Population(s)</th><th>Haplotype copies</th></tr>',g=b.samplePopulationHash,h=b.populationDescriptions,j=b.populationStructure,l={};for(var p in j){l[p]=1;for(var m in j[p])l[j[p][m]]=2}j=Object.keys(a.samples).sort(function(t,v){t=f.grep(Object.keys(g[t]),function(x){return x.match(/ALL/i)},1).map(b.shortName).sort(function(x,z){return l[x]<l[z]}).join("");v=f.grep(Object.keys(g[v]),function(x){return x.match(/ALL/i)},1).map(b.shortName).sort(function(x,z){return l[x]<l[z]}).join("");return t<v?-1:t>v});m=0;for(p in j){var n=j[p],q=a.samples[n];c=c+'<tr class="bg'+(m+1)+'"><td>'+b.shortName(n)+"</td><td>"+f.grep(Object.keys(g[n]),function(t){return t.match(/ALL/i)},1).sort(function(t,v){return l[t]<l[v]}).map(function(t){return'<span class="ht _ht" title="'+
h[t]+'">'+b.shortName(t)+"</span>"}).join(", ")+"</td><td>"+q+"</td></tr>";m=1-m}c+="</table>";return c},alignedSequence:function(a){var b=this;String.prototype.repeat=function(J){return(new Array(J+1)).join(this)};var c,g;if(a.type==="protein"){c=a;g=b.getOtherHaplotypes(a)}else{c=b.getOtherHaplotypes(a)[0];g=[a]}a=c.aligned_sequences[0];var h=c.aligned_sequences[1],j=a.length>=h.length?a.length:h.length;c=b.parseDiffs(c);for(var l=g[0].aligned_sequences[0].replace(/-/g,""),p=g.map(function(J){return J.aligned_sequences[1].replace(/-/g,"")}),m=g.map(function(J){return b.parseDiffs(J)}),n=0,q=0,t=0,v=0,x="",z=1,A=g.length.toString().length,B=["<b>Protein</b>  p.REF "+" ".repeat(A),"         p.ALT "+" ".repeat(A),"<b>CDS</b>      c.REF "+" ".repeat(A)],C=0;C<g.length;C++)B.push('         <a class="_ht" href="#'+g[C].hex+'" title="'+g[C].name.replace(/\,/g,",&#8203;")+" ("+g[C].count+')">c.ALT'+(C+1).toString()+"</a> "+" ".repeat(A-(C+1).toString().length));for(g=B.slice();n<j;){A=a.substr(n,1)||"-";var F=h.substr(n,1)||"-";F=A===F?".":F;g[0]=g[0]+" "+A+" ";var P;P=c.hasOwnProperty(n)?'<span class="ht _ht" style="color:white; background-color:'+c[n].colour+'" title="'+c[n].html+'"> '+F+" </span>":" "+F+" ";g[1]+=P;if(A==="-"){P="-".repeat(3);g[2]+=P}else{P=l.substr(q,3);g[2]+=z?P:'<span style="background-color:#fff9af">'+P+"</span>";z=1-z}for(C in p){for(var K=F==="-"?"-".repeat(3):p[C].substr(t,3),Q="",O=0;O<P.length;O++){var G=P.substr(O,1),I=K.substr(O,1);G=G===I?".":I;if(m[C].hasOwnProperty(q+O))Q=m[C][q+O].hasOwnProperty("variation_feature")?Q+'<a class="sequence_info zmenu" draggable="false" href="/'+o.species+"/ZMenu/Variation?v="+m[C][q+O].variation_feature+"&vf="+m[C][q+O].variation_feature_id+'">'+G+"</a>":Q+'<span class="ht _ht" title="Unable to identify corresponding variant">'+G+"</span>";else Q+=G}g[parseInt(C)+3]=g[parseInt(C)+3]+Q}n++;q+=A==="-"?0:3;t+=F==="-"?0:3;v+=3;if(v>=60){x=x+g.join("\n")+"\n\n";g=B.slice();v=0}}x=x+g.join("\n")+"\n\n";return b.sequenceKey()+"<pre>"+x+"</pre>"},sequenceKey:function(){return'<div class="adornment-key" style="position: static;"><dl><dt>Sequence</dt><dd><ul><li><span style="border: 1px solid lightgrey">.&nbsp;&nbsp;Match</span></li><li><span style="border: 1px solid lightgrey">-&nbsp;&nbsp;Missing sequence</span></li></ul></dd><dt>Codons</dt><dd><ul><li><span>Alternating codons</span></li><li><span style="background-color: #fff9af">Alternating codons</span></li></ul></dd><dt>Protein changes</dt><dd><ul><li><span style="color: white; background-color:red">Deleterious or damaging</span></li><li><span style="color: white; background-color:green">Tolerated or benign</span></li><li><span style="color: white; background-color:#ff69b4">Insertion or deletion</span></li><li><span style="color: white; background-color:red">Stop gain or loss</span></li><li><span style="color: white; background-color:grey">Other</span></li></ul></dd></dl></div>'},parseDiffs:function(a){var b={};for(var c in a.diffs){var g=a.diffs[c],h=g.diff,j=parseInt(h.match(/\d+/g)[0]),l=j;if(h.match(/{(\d+)}/))l=j+parseInt(h.match(/{(\d+)}/)[1])-1;else if(h.match(/[A-Z\*]+$/))l=j+h.match(/[A-Z\*]+$/)[0].length-1;var p="<p><b>"+h+"</b></p>",m="grey";if(h.match(/ins|del/))m="#ff69b4";else if(h.match(/\*/))m="orange";h=["PolyPhen","SIFT"];for(c in h){var n=h[c],q=n.toLowerCase(),t=U,v=U;if(g.hasOwnProperty(q+"_prediction"))t=g[q+"_prediction"];if(g.hasOwnProperty(q+"_score"))v=g[q+"_score"];if(typeof t!=="undefined"){if(t.match(/deleterious$/)||t.match(/probably.damaging/))m="red";else if(m==="grey"&&(t.match(/tolerated$/)||t.match(/benign/)))m="green";p=p+"<b>"+n+"</b>: "+t+" ("+v+")<br/>"}}g.colour=m;g.html=p;for(c=j-1;c<l;c++)b[c]=g}return b},rawSequence:function(a){return this.fastaSequence(a.name,a.seq)},fastaSequence:function(a,b,c){if(typeof c==="undefined")c=60;return"<pre>&gt;"+a+"\n"+b.match(new RegExp("(.{1,"+c+"})","g")).join("\n")+"</pre>"},getOtherHaplotypes:function(a){var b=[];for(var c in a.other_hexes)b.push(this.fetchHaplotypeByHex(c));return b=b.sort(function(g,h){if(g.count<h.count)return 1;if(g.count>h.count)return-1;return 0})},shortName:function(a){return a.replace("1000GENOMES:phase_3:","")}});o.Panel.ComparaOrtholog=o.Panel.Content.extend({init:function(){this.base.apply(this,arguments);o.EventManager.register("dataTableFilterUpdated",this,this.updateWithoutOrthologList)},updateWithoutOrthologList:function(a){var b=0;f("#no_ortho_species li").each(function(){var c=this,g=false,h=a.length;a.forEach(function(j){j=f.trim(j);if(!(h>1&&j==="all"))if(c.className.indexOf(j)>-1)g=true});if(g===true){f(c).show();b+=1}else f(c).hide()});f(".no_ortho_count").text(b);b===0?f("#no_ortho_message_pad").hide():f("#no_ortho_message_pad").show()}});o.Panel.ComparaTree=o.Panel.ImageMap.extend({init:function(){this.base.apply(this,arguments);this.elLk.highlightLink=this.el.find(".switch_highlighting");this.elLk.highlightLink.on("click",function(a){var b=f(this);a.preventDefault();o.cookie.set("gene_tree_highlighting",b.hasClass("on")?"off":"on");o.LayoutManager.reloadPage()})}});o.Panel.ConfigManager=o.Panel.ModalContent.extend({constructor:function(a,b){this.base(a,b)},init:function(){var a=this;this.base();o.EventManager.register("modalPanelResize",a,function(){this.el.togglewrap("update")});var b=f("form",this.el);this.elLk.recordTypes=f(".records .record_type",this.el);this.elLk.tables=f("table",this.elLk.recordTypes);this.elLk.shareConfig=f(".share_config",this.el).detach();this.elLk.editSets=f(".edit_config_set",this.el).detach();this.elLk.saveAll=f(".save_all_config_set",this.el).detach();this.elLk.noRecords=f(".no_records",this.el);this.elLk.resetAll=f(".reset_all",this.el);this.elLk.editTypes=f("div.record_type",this.elLk.editSets);this.elLk.editTable=f("table",this.elLk.editTypes);this.elLk.editRecord=f(".edit_record",this.elLk.editSets);this.elLk.editSelected=f("input.selected",this.elLk.editSets);this.elLk.editId=f(".config_key",this.elLk.editSets);this.elLk.addSet=f(".add_set",this.elLk.editSets);this.elLk.saveToGroup=f(".groups",this.elLk.addSet);this.elLk.addHeader=f(".add_header",this.elLk.editSets);this.elLk.editHeader=f(".edit_header",this.elLk.editSets);this.elLk.setsHeader=f(".config_header",this.elLk.editHeader);this.elLk.saveSets=f(".sets ul",this.elLk.saveAll);this.elLk.saveConfigs=f(".configs ul",this.elLk.saveAll);this.elLk.saveHeader=f(".config_header",this.elLk.saveAll);this.elLk.shareURL=f(".share_url",this.elLk.shareConfig);this.elLk.shareGroups=f(".share_groups",this.elLk.shareConfig);this.elLk.shareGroup=f("input.group",this.elLk.shareConfig);this.elLk.shareId=f(".config_key",this.elLk.shareConfig);this.elLk.shareHeader=f(".config_header",this.elLk.shareConfig);this.elLk.addSet.validate({validate:function(c){if(c)c=!!a.elLk.addSet.find("input.selected:checked").length;return c}});b.on("submit",function(){return a.formSubmit(f(this))});this.elLk.tables.on("click",".expand, .collapse",function(){var c=f(this),g=c.parents("tr");c.add(c.siblings("a")).add(g.siblings("."+
g[0].className.replace(/ /g,"."))).toggle();if(c.hasClass("expand")&&!c.data("hasConfig")){var h=c.parents("table").dataTable();g=g[0];h.fnOpen(g,'<div class="spinner"></div>').className=g.className;c.data("hasConfig",f.ajax({url:this.href,cache:false,success:function(j){c.data("hasConfig",true);var l=f(h.fnOpen(g,j,"details")).addClass(g.className).togglewrap("update").find(".editables_list");l.children().length===0&&l.parent().hide();h.fnUpdate(g.cells[1].innerHTML+'<div class="hidden">'+j+"</div>",g,1);c=g=h=null}}))}else c=g=null;return false});this.elLk.tables.on("click","a.edit",function(c){c.preventDefault();f.ajax({url:this.href,context:this,dataType:"json",success:function(g){if(a[g.func])a[g.func](f(this).parents("tr"),g);else g.redirectURL&&o.EventManager.trigger("modalOpen",{href:g.redirectURL,rel:g.modalTab})}})});this.elLk.tables.on("click","a.share_record",function(){var c=f(this),g=c.data("share"),h=a.params.records[c.parents("tr").data("configId")],j,l;a.elLk.shareHeader.html(h.name);a.elLk.shareId.val(h.id);o.EventManager.trigger("modalOverlayShow",a.elLk.shareConfig);if(g){if(g.groups){a.elLk.shareGroup.prop("checked",function(){return!!g.groups[this.value]});l=true}if(g.url){a.elLk.shareURL.val(g.url).show().select();j=true}}l||a.elLk.shareGroup.prop("checked",false);j||a.elLk.shareURL.hide();a.elLk.shareLink=c;c=null;return false});this.elLk.tables.on("click","a.edit_record",function(){var c=a.params.records[f(this).parents("tr").data("configId")];a.elLk.setsHeader.html(c.name);a.elLk.addSet.add(a.elLk.addHeader).hide();a.elLk.editRecord.add(a.elLk.editHeader).show();a.elLk.editId.val(c.id);a.updateEditTable(c.group+"."+c.groupId,c);o.EventManager.trigger("modalOverlayShow",a.elLk.editSets);return false});this.elLk.tables.on("click","._ht",function(){f(this).data("uiTooltip").close()});this.elLk.editSets.on("click",".add_to_set",function(){var c=f(this).parents("tr");c.hasClass("disabled")||c.toggleClass("added");var g=c.hasClass("added");if(a.params.recordType==="set")c.siblings("."+
(a.params.editables[this.rel].codes.join(", .")||"_")).not(".added")[g?"addClass":"removeClass"]("disabled");a.elLk.editSelected.filter("."+this.rel).prop("checked",g);a.elLk.addSet.filter(function(){return this.style.display!=="none"}).validate();c=null;return false});f("a.create_set",this.el).on("click",function(){var c=a.elLk.editSets.find("input.record_type");if(c.length>1)c=c.first().prop("checked",true);a.updateEditTable(c.val());a.elLk.editRecord.add(a.elLk.editHeader).hide();a.elLk.addSet.find("input[name=name], textarea").val("").end().validate();a.elLk.addSet.find(".save").addClass("disabled").prop("disabled",true);a.elLk.addSet.add(a.elLk.addHeader).show();o.EventManager.trigger("modalOverlayShow",a.elLk.editSets);return false});f("input.record_type",this.elLk.editSets).on("click",function(){a.elLk.saveToGroup[this.value==="group"?"show":"hide"]();a.updateEditTable(this.value+(this.value==="group"?"."+a.elLk.saveToGroup.find("input.group:checked").val():""));o.EventManager.trigger("modalPanelResize")});f("input.group",this.elLk.saveToGroup).on("click",function(){a.updateEditTable((f(this).hasClass("suggested")?"suggested":"group")+"."+this.value);o.EventManager.trigger("modalPanelResize")});f(".make_url",this.elLk.shareConfig).on("click",function(){function c(h){g=g||{};g.url=h;a.elLk.shareURL.val(h).show().select();a.elLk.shareLink.data("share",g)}var g=a.elLk.shareLink.data("share");g&&g.url?c(g.url):f.ajax({url:a.elLk.shareLink[0].href,cache:false,success:c})});f(".cancel, .continue",this.elLk.saveAll).on("click",function(){o.EventManager.trigger("modalOverlayHide");f(this).hasClass("continue")&&a.elLk.saveAllLink.trigger("click")});this.elLk.shareGroup.on("click",function(){var c=a.elLk.shareLink.data("share")||{},g=true;c.groups=c.groups||{};c.groups[this.value]=this.checked;for(var h in c.groups)if(c.groups[h]){g=false;break}a.elLk.shareGroups[g?"addClass":"removeClass"]("disabled").prop("disabled",g);a.elLk.shareLink.data("share",c)});this.elLk.shareConfig.add(this.elLk.editSets).find("form").on("submit",function(){o.EventManager.trigger("modalOverlayHide")});f("form",this.elLk.resetAll).on("submit",function(){a.elLk.resetAll.hide()});b=null},initialize:function(){f(".records table tbody tr",this.el).each(function(){f(this).data("configId",this.className)});this.base()},updateEditTable:function(a,b){a=this.elLk.editTypes.hide().filter("."+a).show().find("table").dataTable();this.elLk.editSelected.filter(":checked").prop("checked",false);a.find("tr").removeClass("added disabled");a.fnDraw();if(b){a=a.find("tbody tr");var c=[];for(var g in b.editables)c.push("."+
g);a.filter(c.join(", ")).addClass("added");a.filter("."+(b.codes.join(", .")||"_")).not(".added").addClass("disabled");this.elLk.editSelected.filter(c.join(", ")).prop("checked",true)}},saveEdit:function(a,b,c){var g=c.parent().data("configId");c.togglewrap("update").find("._ht").helptip();if(a==="name")this.params.records[g].name=b;f.ajax({url:c.find("a.save").attr("href"),data:{param:a,value:b},cache:false,success:function(h){h==="success"&&a==="name"&&o.EventManager.trigger("updateSavedConfig",{changed:{id:g,name:b}})}});c=null},addTableRow:function(a){var b=this;f.ajax({url:this.params.updateURL,data:{config_keys:a.configKeys},traditional:true,cache:false,dataType:"json",success:function(c){var g,h;for(var j in c.tables){h=f(c.tables[j]).find("tbody tr").filter(function(){return!b.params.records[this.className]});if(h.length!==0){g=b.elLk.tables.filter("."+j).dataTable();b.addDataTableRows(g,h,true);b.elLk.recordTypes.filter("."+j).show();g.fnSort(b.params.recordType==="config"?[[0,"asc"],[1,"asc"],[2,"asc"]]:[[0,"asc"]]);g.togglewrap("update")}}b.elLk.noRecords.hide();f.extend(b.params.records,c.data);g=h=null}})},updateTable:function(a){var b=this.params.records[a.id],c=this.elLk.editTable.find("tbody tr"),g=this.elLk.tables.find("."+a.id).find(".editables_list"),h=g.first().children().detach(),j=a.editables.added||[];a=a.editables.removed||[];var l,p,m,n;for(m=0;m<j.length;m++){p=this.params.editables[j[m]];l=this.params.recordType==="config"?[p,b]:[b,p];h=h.add(f(this.params.listTemplate).addClass(j[m]).find(".name").html(p.name).end().find(".conf").html(p.conf).end());b.editables[j[m]]=1;l[0].codes=l[0].codes.concat(f.grep(l[1].codes,function(q){return f.inArray(q,l[0].codes)===-1}))}for(m=0;m<a.length;m++){p=this.params.editables[a[m]];l=this.params.recordType==="config"?[p,b]:[b,p];h=h.not("."+a[m]);delete b.editables[a[m]];for(n in l[1].codes)l[0].codes=f.grep(l[0].codes,function(q){return q!==l[1].codes[n]})}if(this.params.recordType==="config"){c.filter("."+(j.join(", .")||"_")).addClass(b.codes[0]);c.filter("."+(a.join(", .")||"_")).removeClass(b.codes[0])}g.html(h.map(function(){return[[f(this).text().toLowerCase(),this]]}).sort(function(q,t){return q[0]<t[0]?-1:q[0]>t[0]?1:0}).map(function(){return this[1]})).parent()[h.length?"show":"hide"]().siblings(".none")[h.length?"hide":"show"]().parents("td").togglewrap("update");c=g=h=null},activateRecord:function(a){var b=this.params.records[a.data("configId")];a.siblings(".active").stop(true,true).removeClass("active").find(".config_used").stop(true,true).hide();a.addClass("active").find(".config_used").show().delay(1E3).fadeOut(500);this.updatePanels(b);b.codes.length&&this.elLk.resetAll.show()},saveRecord:function(a,b){a=this.elLk.editTypes.filter(".session");var c=this.elLk.editTypes.filter(".user"),g=a.find("table").dataTable();a=c.find("table").dataTable();c=f('<span class="icon_link sprite sprite_disabled _ht save_icon" title="Saved">&nbsp;</span>').helptip();this.elLk.tables.find("tr").filter("."+b.ids.join(", .")).find("a.save_icon").replaceWith(c);c=g.find("tr").filter("."+b.ids.join(", ."));this.addDataTableRows(a,c);c.each(function(){g.fnDeleteRow(this)});a.fnSort(this.params.recordType==="set"?[[0,"asc"],[1,"asc"],[2,"asc"]]:[[0,"asc"]]);a.togglewrap("update");for(var h in b.ids)if(this.params.records[b.ids[h]]){this.params.records[b.ids[h]].group="user";this.params.records[b.ids[h]].groupId=this.params.userId}a=c=a=c=g=a=c=null},saveAll:function(a,b){var c={sets:"",configs:""},g;b.sets=(b.sets||[]).sort();b.configs=(b.configs||[]).sort();for(var h in c){for(g in b[h])c[h]+="<li>"+b[h][g]+"</li>";this.elLk[h==="sets"?"saveSets":"saveConfigs"].html(c[h]).parent()[c[h]?"show":"hide"]()}this.elLk.saveHeader.html(this.params.records[a.data("configId")].name);this.elLk.saveAllLink=a.find("a.save_all");o.EventManager.trigger("modalOverlayShow",this.elLk.saveAll)},deleteRecord:function(a){var b=a.parents("table");b.dataTable().fnDeleteRow(a[0]);if(b.find(".dataTables_empty").length)b.parents(".record_type").hide().siblings(".record_type").filter(":visible").length||this.elLk.noRecords.show();o.EventManager.trigger("updateSavedConfig",{deleted:[a.data("configId")]})},updatePanels:function(a){var b;for(var c in a.codes){b=a.codes[c].split("_")[1];if(o.PanelManager.panels[b]){o.EventManager.trigger("queuePageReload",b,true);o.EventManager.trigger("activateConfig",b)}}},addDataTableRows:function(a,b,c){var g=b.first().children(),h=a.fnAddData(b.map(function(){return f(this).children().map(function(){return this.innerHTML})}).toArray());a=a.fnSettings().aoData;for(var j=h.length;j--;){f(a[h[j]].nTr).addClass(b[j].className).children().addClass(function(l){return g[l].className}).find("._ht").helptip();c&&f(a[h[j]].nTr).data("configId",b[j].className)}a=b=g=null},formSubmit:function(a){f.ajax({url:a.attr("action"),type:a.attr("method"),data:a.serialize(),traditional:true,cache:false,dataType:"json",context:this,success:function(b){this[b.func]&&this[b.func](b)}});return false}});o.Panel.Configurator=o.Panel.ModalContent.extend({constructor:function(a,b){if(b.trackIds){for(var c=b.trackIds.length,g={};c--;)g[b.trackIds[c]]=b.tracks[c];this.tracks=g;delete b.tracks;delete b.trackIds}else b.tracksByType={};this.base(a,b);o.EventManager.register("updateConfiguration",this,this.updateConfiguration);o.EventManager.register("showConfiguration",this,this.show);o.EventManager.register("changeConfiguration",this,this.externalChange);o.EventManager.register("changeTrackOrder",this,this.externalOrder);o.EventManager.register("changeFavourite",this,this.changeFavourite);o.EventManager.register("syncViewConfig",this,this.syncViewConfig);o.EventManager.register("updateSavedConfig",this,this.updateSavedConfig);o.EventManager.register("activateConfig",this,this.activateConfig);o.EventManager.register("resetConfig",this,this.externalReset);o.EventManager.register("refreshConfigList",this,this.refreshConfigList);o.EventManager.register("changeMatrixTrackRenderers",this,this.changeMatrixTrackRenderers)},init:function(){function a(){var p=!f.grep(b.elLk.saveAsRequired.not(".disabled"),function(m){return m.value}).length;b.elLk.saveAsSubmit.prop("disabled",p)[p?"addClass":"removeClass"]("disabled")}var b=this,c,g,h,j,l;this.base();this.el.find(".configuration_search").prependTo(this.el.closest(".modal_content").find(".modal_nav").first());this.elLk.form=f("form.configuration",this.el);this.elLk.headers=f("h1",this.el);this.elLk.search=f(".configuration_search_text",this.el);this.elLk.searchResults=f("a.search_results",this.elLk.links);this.elLk.configDivs=f("div.config",this.elLk.form);this.elLk.configMenus=this.elLk.configDivs.find("ul.config_menu");this.elLk.configs=this.elLk.configMenus.children("li");this.elLk.tracks=this.elLk.configs.filter(".track");this.elLk.favouritesMsg=this.elLk.configDivs.filter(".favourite_tracks");this.elLk.noSearchResults=this.elLk.configDivs.filter(".no_search");this.elLk.trackOrder=this.elLk.configDivs.filter(".track_order");this.elLk.trackOrderList=f("ul.config_menu",this.elLk.trackOrder);this.elLk.viewConfigs=this.elLk.configDivs.filter(".view_config");this.elLk.viewConfigInputs=f(":input:not([name=select_all])",this.elLk.viewConfigs);this.elLk.imageConfigExtras=f(".image_config_notes, .configuration_search",this.el);this.elLk.saveAs=f(".config_save_as",this.el).detach();this.elLk.saveAsInputs=f(".name, .desc, .default, .existing, input.group",this.elLk.saveAs);this.elLk.saveAsRequired=this.elLk.saveAsInputs.filter(".name, .existing");this.elLk.existingConfigs=this.elLk.saveAsInputs.filter(".existing");this.elLk.saveTo=f(".save_to",this.elLk.saveAs);this.elLk.saveAsGroup=f(".groups",this.elLk.saveAs);this.elLk.saveAsSubmit=f(".fbutton",this.elLk.saveAs);this.elLk.popup=f();this.elLk.help=f();this.elLk.configForm=this.el.find("._config_settings");this.elLk.configDropdown=this.elLk.configForm.find("._config_dropdown");this.elLk.configSelector=this.elLk.configDropdown.find("select");this.elLk.configSaveAsLink=f('<a href="#" class="small left-margin"></a>').insertAfter(this.elLk.configSelector).hide().on("click",{panel:this},function(p){p.preventDefault();p.data.panel.configSave(true)});this.elLk.configSaveLink=f('<a href="#" class="small left-margin"></a>').insertAfter(this.elLk.configSelector).hide().on("click",{panel:this},function(p){p.preventDefault();p.data.panel.configSave()});this.elLk.configSaveInput=this.elLk.configDropdown.find("div:has(input)").hide();this.component=f("input.component",this.elLk.form).val();this.sortable=!!this.elLk.trackOrder.length;this.lastQuery=false;this.populated={};this.favourites={};this.externalFavourites={};this.imageConfig={};this.viewConfig={};this.subPanels=[];this.searchCache=[];for(g in this.params.tracksByType){h=this.params.tracksByType[g];for(j=h.length;j--;)for(l in h[j]){c=this.tracks[h[j][l]];if(c.fav){this.favourites[g]||(this.favourites[g]={});this.favourites[g][h[j][l]]=[j,c.html]}}}this.elLk.tracks.each(function(){var p=b.tracks[this.id];p.el=f(this).data("track",p).removeAttr("id");b.imageConfig[p.id]={renderer:p.renderer,favourite:p.fav}});this.elLk.viewConfigInputs.each(function(){b.viewConfig[this.name]=this.type==="checkbox"?this.checked?this.value:"off":this.type==="select-multiple"?f("option:selected",this).map(function(){return this.value}).toArray():this.value});this.sortable&&this.makeSortable();this.elLk.configDivs.not(".view_config").on("click","ul.config_menu > li.track div.track_name, .select_all",f.proxy(this.showConfigMenu,this)).on("click",".popup_menu li",f.proxy(this.setTrackConfig,this)).on("click",".config_header",function(){f("a."+this.parentNode.className.replace(/\s*config\s*/,""),b.elLk.links).trigger("click");return false}).on("click",".matrix_link",function(){f("a.regulatory_features",b.elLk.links).trigger("click");return false}).on("click",".favourite",function(){var p=f(this).parents("li.track").data("track");o.EventManager.trigger("changeFavourite",p.id,p.fav?0:1,p.type,b.id);return false}).on("click",".menu_help",function(){b.toggleDescription(this);return false});this.elLk.viewConfigs.on("change",":input",function(){var p,m;if(this.type==="checkbox"){p=this.checked;m="checked"}else{p=this.value;m="value"}o.EventManager.trigger("syncViewConfig",b.id,f(this).parents(".config")[0].className.replace(/ /g,"."),this.name,m,p)});this.elLk.search.on({keyup:function(){var p=this.value.toLowerCase();if(this.value.length<2)b.lastQuery=p;if(p!==b.lastQuery){b.searchTimer&&clearTimeout(b.searchTimer);b.query=p;b.searchTimer=setTimeout(function(){b.elLk.links.removeClass("active");b.elLk.searchResults.removeClass("disabled").parent().addClass("active");b.elLk.headers.hide().filter(".search_results").show();b.elLk.imageConfigExtras.show();b.elLk.form.addClass("multi").removeClass("single");b.search()},250)}},focus:function(){if(this.value===this.defaultValue)this.value="";this.style.color="#000"},blur:function(){if(!this.value){this.value="Find a track";this.style.color="#999"}}});this.el.find("select[name=species]").on("change",function(){var p=this.value.replace(/^\//,"").split(/\//).shift();p="modal_config_"+(b.component+(p===o.species?"":"_"+p)).toLowerCase();var m=f("#"+p);b.hide();if(!m.length||!m.children().length||m.data("reload")){o.EventManager.trigger("updateConfiguration",true);m=m.length?!m.removeData("reload"):f("<div>",{id:p,"class":"modal_content js_panel active",html:'<div class="spinner">Loading Content</div>'});o.EventManager.trigger("addModalContent",m,this.value,p,"modal_config_"+b.component.toLowerCase())}else m.addClass("active").show().find("select[name=species]").prop("selectedIndex",this.selectedIndex).selectToToggle("trigger").focus();f(b.el).removeClass("active");o.EventManager.trigger("setActivePanel",p);b.updateConfiguration(true)});f(".save_configuration",this.el).on("click",function(p){p.preventDefault()});this.elLk.saveAsInputs.filter(".name").on("keyup blur input",a);this.elLk.existingConfigs.on("change",a);this.elLk.saveTo.on("click",function(){b.elLk.saveAsGroup[this.value==="group"?"show":"hide"]()});this.elLk.saveAsSubmit.on("click",function(){var p={save_as:1};f.each(f(this).parents("form").serializeArray(),function(){var m=this.value.replace(/<[^>]+>/g,"");if(p[this.name]){p[this.name]=f.isArray(p[this.name])?p[this.name]:[p[this.name]];p[this.name].push(m)}else p[this.name]=m});if(p.name||p.overwrite){b.updateConfiguration(true,p);o.EventManager.trigger("modalOverlayHide")}});this.getContent();this.el.externalLinks();this.initConfigList()},initFromHash:function(){if(this.params.hash){var a=this.elLk.links.children("."+this.params.hash);if(a.length){this.elLk.links.removeClass("active");a.parent().addClass("active")}delete this.params.hash}},showConfigMenu:function(a){if(a.target.nodeName==="A")return true;var b=f(a.currentTarget),c=b.hasClass("select_all");if(b.hasClass("track_name"))b=b.parent();if(c&&a.target===a.currentTarget)return false;a=b.data();if(!a.popup||a.popup.parentNode!==b[0]){var g=b.children(".popup_menu");a.popup=g.length?g:f(a.track.popup).prependTo(b);c&&g.children(".current").removeClass("current")}if(a.popup.children().length===2&&!c)a.popup.children(":not(."+a.track.renderer+")").trigger("click");else{this.elLk.popup.not(a.popup.show()).hide();this.elLk.popup=a.popup}if(!c){b=a.popup.children("."+a.track.renderer);b.hasClass(".current")||b.addClass("current").siblings(".current").removeClass("current")}return false},setTrackConfig:function(a,b){var c=f(a.target);if(c.is(".header")||c.filter(".close").parents(".popup_menu").hide().length)return false;var g=a.target.className;c=c.parents("ul.popup_menu").hide().parent();var h=g.match(/\s*current\s*/);a=a.currentTarget.className.match(/\s*subset_(\w+)\s*/);if(h||a)a&&this.elLk.links.children("a."+a[1]).trigger("click");else this.changeTrackRenderer(c.hasClass("select_all")?c.next().find("li.track:not(.hidden)"):c,g,b);return false},changeMatrixTrackRenderers:function(a){var b=this;f.each(a,function(c,g){if(b.tracks[c]){a=f(b.tracks[c].el).data();a.track.renderer=g.renderer||"off"}})},changeTrackRenderer:function(a,b,c,g){var h=this.params.subTracks||{},j=0,l,p;b==="all_on"&&a.each(function(){var m=f(this).data();m.track.newRenderer=(m.popup=m.popup||f(m.track.popup).prependTo(this)).children("li.off +")[0].className});a.each(function(){var m=f(this).data("track"),n=m.el.add(m.linkedEls);n.removeClass(m.renderer+" on");if(m.renderer==="off"^b==="off"){p=b==="off"?-1:1;if(typeof h[m.id]==="number"){j+=p*h[m.id];l=true}else{j+=p;if(c!==false)c=true}}n.each(function(){f(this).data("track").renderer=m.newRenderer||b}).addClass(m.renderer+(m.renderer==="off"?"":" on"));delete m.newRenderer;n=null});if(l&&c!==false)if(o.EventManager.trigger("changeColumnRenderer",f.map(a,function(m){return f(m).data("track").id}),b,true))c=false;c!==false&&this.elLk.links.children(a.data("track").links).siblings(".count").children(".on").html(function(m,n){return parseInt(n,10)+j});a=null;this.configSettingChanged(g)},addTracks:function(a){if(!(this.populated[a]||!this.params.tracksByType[a])){for(var b=this.params.tracksByType[a],c=this.tracks,g=this.elLk.configDivs.filter("."+a).find("ul.config_menu").each(function(v){f.data(this,"index",v)}),h=this.elLk.popup.length?this.elLk.popup.parent().data("track"):false,j=f(),l={imageConfigs:[],html:[],submenu:[]},p=b.length,m,n,q,t;p--;){m=b[p].length;q=g.eq(p);l.html[p]=[];l.imageConfigs[p]=[];for(l.submenu[p]=false;m--;){n=c[b[p][m]];if(c[n.id].el){c[n.id].el.remove();l.html[p].unshift(['<li class="',c[n.id].el[0].className,'" id="',n.id,'">',c[n.id].el[0].innerHTML,"</li>"].join(""))}else l.html[p].unshift(n.html);l.imageConfigs[p][m]=n.id}if(q[0].innerHTML){q.children(":has(.config_menu)").each(function(){l.html[p].push('<li class="',this.className,'" id="',this.id,'">');f.each(f(this).children(".config_menu"),function(){var v=f.data(this,"index"),x;if(typeof v==="undefined")x=this.innerHTML;else{x=l.html[v];l.html[v]="";l.submenu[p]=true}l.html[p].push("<",this.nodeName,' class="',this.className,'">',x,"</",this.nodeName,">")});l.html[p].push("</li>")});l.submenu[p]&&j.push(q[0])}l.html[p]=l.html[p].join("")}for(p=b.length;p--;)if(l.html[p])g[p].innerHTML=l.html[p];for(p=0;p<b.length;p++){q=g.eq(p);m=l.imageConfigs[p].length;q.parents(".subset").attr("class").replace(/subset|active|first|\s/g,"");t=q.children();l.submenu[p]&&t.children("ul.config_menu").each(function(v){g[p+v+1]=this});for(t.filter(".track").each(function(){f.data(this,"track",c[this.id])}).removeAttr("id");m--;){q=t.eq(m);n=l.imageConfigs[p][m];c[n].el=q;this.imageConfig[n]||(this.imageConfig[n]={renderer:"off",favourite:!!this.favourites[a]&&this.favourites[a][n]});this.externalFavourite(n,q)}}if(h)this.elLk.popup=c[h.id].el.children(".popup_menu");this.updateElLk(a,j);this.populated[a]=1;g=j=q=t=q=null}},updateElLk:function(a,b){if(b&&b.length)this.elLk.configMenus=this.elLk.configMenus.add(b.find("ul.config_menu")).filter(function(){return f(this).parents("body").length});this.elLk.configs=a?this.elLk.configs.add(typeof a==="string"?this.elLk.configMenus.filter("."+a).children("li"):a).filter(function(){return this.parentNode&&this.parentNode.nodeName==="UL"}):this.elLk.configMenus.children("li");this.elLk.tracks=this.elLk.configs.filter(".track")},show:function(a){this.elLk.popup.hide();a&&this.elLk.links.removeClass("active").find("."+a).parent().addClass("active");this.base();this.getContent()},getContent:function(){function a(){var n,q,t;q=f.extend({},j.externalFavourites);var v=[];for(n in q)if(q[n])j.addTracks(q[n][1]);else delete j.favourites[q[n][1]][n];for(t in j.favourites)for(n in j.favourites[t])if(!j.imageConfig[n]){q=f(j.favourites[t][n][1]).appendTo(j.elLk.configDivs.filter("."+t).find("ul.config_menu").eq(j.favourites[t][n][0]));j.tracks[n].el=q.data("track",j.tracks[n]);j.imageConfig[n]={renderer:"off",favourite:1};v.push(q[0])}v.length&&j.updateElLk(v);j.elLk.favouritesMsg[j.elLk.configs.hide().filter(".track.fav").show().parents("li, div.subset, div.config").show().length?"hide":"show"]()}function b(){var n=j.elLk.trackOrderList,q=n.children(),t=["f","r"],v=[],x,z,A,B,C,F;j.elLk.tracks.filter(".on").each(function(){var P=f(this);z=P.data("track");B=z.fav?" fav":"";C=j.params.order[z.id];if(typeof C!=="undefined"&&!q.filter("."+z.id).length)v.push([C,P,z.id]);else for(x in t){C=j.params.order[z.id+"."+t[x]];if(typeof C!=="undefined"&&!q.filter("."+z.id+"."+t[x]).length)v.push([C,P,z.id+" "+t[x]+B,'<div class="strand" title="'+(t[x]==="f"?"Forward":"Reverse")+' strand"></div>'])}});v=v.sort(function(P,K){return P[0]-K[0]});q.length?f.each(v,function(){A=this[2].split(" ")[0];x=q.length;for(F=this[1].clone(true).data({order:this[0],trackName:this[2],trackId:A}).removeAttr("id").removeClass("track").addClass(this[2]).children(".controls").prepend(this[3]).end();x--;)if(f(q[x]).data("order")<this[0]){F.insertAfter(q[x]);break}x===-1&&F.insertBefore(q[0]);j.tracks[A].linkedEls=(j.tracks[A].linkedEls||f()).add(F);F=null}):f.each(v,function(){A=this[2].split(" ")[0];j.tracks[A].linkedEls=(j.tracks[A].linkedEls||f()).add(this[1].clone(true).data({order:this[0],trackName:this[2],trackId:A}).removeAttr("id").addClass(this[2]).children(".controls").prepend(this[3]).end().appendTo(n).children(".popup_menu").hide().end())});v.length&&j.updateElLk("track_order");j.elLk.trackOrder.show().find("ul.config_menu li").filter(function(){return this.style.display==="none"}).show();n=q=null}function c(n){n.html('<div class="spinner">Loading Content</div>');f.ajax({url:p,cache:false,dataType:"json",success:function(q){var t=n.width();n.detach().html(q.content).insertAfter(j.elLk.form);var v=f(".js_panel",n);if(v.length){o.EventManager.trigger("createPanel",v[0].id,q.panelType,f.extend(q.params,{links:j.elLk.links.filter(".active").parents("li.parent").andSelf(),parentTracks:j.tracks,width:t}));j.subPanels.push(v[0].id)}else{j.elLk.viewConfigInputs=f(":input:not([name=select_all])",j.elLk.viewConfigs);j.setSelectAll();f(":input:not([name=select_all])",n).each(function(){j.viewConfig[this.name]=this.type==="checkbox"?this.checked?this.value:"off":this.value})}}})}function g(){if(this.style.display==="none")this.style.display="block"}function h(){if((" "+this.className+" ").indexOf(" active ")!==-1)return this}var j=this,l=this.elLk.links.filter(".active").children("a")[0],p,m;this.el.animate({scrollTop:0},0);if(l.rel==="multi"^this.elLk.form.hasClass("multi"))this.elLk.form[l.rel==="multi"?"addClass":"removeClass"]("multi")[l.rel!=="multi"?"addClass":"removeClass"]("single");this.elLk.configDivs.filter(function(){return this.style.display!=="none"}).hide();this.elLk.imageConfigExtras.show();this.toggleDescription(this.elLk.help,"hide");this.lastQuery=false;if(f(l).attr("href")!=="#")p=l.href;l=l.className;if(l.indexOf("-")!==-1){l=l.split("-");m=l[1];l=l[0]}this.elLk.headers.hide().filter("."+l).show();this.elLk.configDivs.filter(".functional").find(".hidden-caption").hide();switch(l){case"search_results":this.elLk.search.val(this.query).css("color","#000");this.search();break;case"active_tracks":this.elLk.configs.hide().filter(".on").show().parents("li, div.subset, div.config").show();this.elLk.configDivs.filter(".functional").find(".hidden-caption").show();break;case"favourite_tracks":a();break;case"track_order":b();break;default:this.addTracks(l);l=this.elLk.configDivs.filter("."+l).each(g);if(m)l.children("."+m).addClass("active").each(g).siblings(":not(.config_header)").map(function(){if(this.style.display!=="none")this.style.display="none";return h.call(this)}).removeClass("active");else{l.hasClass("functional")&&!m&&l.children(".subset").each(function(){if(this.className.match(/regulatory_features/))this.childNodes[1].hidden=true});l.children().map(function(){g.call(this);return h.call(this)}).removeClass("active")}if(p){if(!l.children().length){this.addTracks(this.elLk.links.filter(".active").parent().siblings("a").attr("class"));c(l)}l.data("active",true);this.elLk.configDivs.not(l).data("active",false)}else l.find("ul.config_menu > li").each(g);this.elLk.imageConfigExtras.css("display",l.hasClass("view_config")?"none":"block");l=null}},formSubmit:function(){return false},updateConfiguration:function(a,b){if(!f("input.invalid",this.elLk.form).length){var c=this,g=false,h={},j={};f.each(this.subPanels,function(l,p){if(l=o.EventManager.triggerSpecific("updateConfiguration",p,p,true)){f.extend(j,l.viewConfig);f.extend(h,l.imageConfig);g=true}});this.elLk.tracks.each(function(){var l=f(this).data("track");if(l){var p=!c.imageConfig[l.id].favourite&&l.fav?1:c.imageConfig[l.id].favourite&&!l.fav?0:false;if(c.imageConfig[l.id].renderer!==l.renderer){h[l.id]={renderer:l.renderer};g=true}if(p!==false){h[l.id]=h[l.id]||{};h[l.id].favourite=p;g=true}}});this.elLk.viewConfigInputs.each(function(){if(!(j[this.name]&&j[this.name]!=="off")){var l=this.type==="checkbox"||this.type==="radio"?this.checked?this.value:"off":this.type==="select-multiple"?f("option:selected",this).map(function(){return this.value}).toArray():this.value;if(this.name==="image_width"){o.setWidth(parseInt(l,10),1);c.viewConfig.image_width=l;o.EventManager.trigger("changeWidth")}else{j[this.name]=l;g=true;if(this.type==="select-multiple")c.viewConfig[this.name]=l}}});if(g===true||typeof b!=="undefined"){if(b===true)return{imageConfig:h,viewConfig:j};f.extend(true,this.imageConfig,h);f.extend(true,this.viewConfig,j);this.updatePage(f.extend(b,{image_config:JSON.stringify(h),view_config:JSON.stringify(j)}),a);return g}}},updatePage:function(a,b){var c=this;a.submit=1;a.reload=this.params.reset?1:0;this.params.reset=false;f.ajax({url:this.elLk.form.attr("action"),type:this.elLk.form.attr("method"),data:f.extend(a,o.coreParams),traditional:true,dataType:"json",async:false,success:function(g){g.existingConfig&&c.updateSavedConfig(g.existingConfig);if(g.updated)o.EventManager.trigger("queuePageReload",c.component,!b);else g.redirect&&o.redirect(g.redirect)}})},updateSavedConfig:function(a){a.deleted&&this.elLk.existingConfigs.children("."+a.deleted.join(", .")).remove();if(a.saved)for(var b in a.saved)this.elLk.existingConfigs.children("."+a.saved[b].value).length||f("<option>",a.saved[b]).appendTo(this.elLk.existingConfigs);a.changed&&this.elLk.existingConfigs.children("."+
a.changed.id).html(a.changed.name);a=this.elLk.existingConfigs.children("[class]").length;this.elLk.existingConfigs[a?"removeClass":"addClass"]("disabled").parent()[a?"show":"hide"]()},activateConfig:function(a){if(!a||a===this.component){o.EventManager.trigger("modalReload",this.id);this.params.species===o.species?this.el.addClass("active"):this.el.removeClass("active").data("reload",true)}},makeSortable:function(){var a=this;for(var b in this.params.order)this.params.order[b]=parseFloat(this.params.order[b],10);this.elLk.trackOrderList.sortable({axis:"y",containment:"parent",update:function(c,g){c=g.item.data("trackName").replace(" ",".");g=f.makeArray(g.item.prevAll().map(function(h,j){return(f(j).data("trackName")||"").replace(" ",".")}));o.EventManager.triggerSpecific("changeTrackOrder",a.component,a.params.species,c,g)}})},search:function(){function a(A,B,C,F){if((x=B.indexOf(b.query)!==-1)||C.indexOf(b.query)!==-1){if(!b.imageConfig[A]){F=f(F).appendTo(m);b.imageConfig[A]={renderer:"off",favourite:!!b.favourites[z]&&b.favourites[z][A]};j.push(F[0]);b.externalFavourite(A,F);b.tracks[A].el=F.data("track",b.tracks[A])}x||g.showDesc.push(F[0]);b.searchCache.push([A,B,C,F,z]);g.show.push(F[0],F.parents("li").toArray());p=true;c="hide"}else b.imageConfig[A]&&g.hide.push(F[0],F.find("div.desc").toArray())}var b=this,c="show",g={show:[],hide:[],showDesc:[]},h=f.extend([],this.searchCache),j=[],l,p,m,n,q,t,v,x,z;this.searchCache=[];if(this.lastQuery.length>=2&&this.query.indexOf(this.lastQuery)!==-1){v=h.length;for(l={};v--;){z=h[v][4];p=false;if(typeof l[z]==="undefined")l[z]=false;a.apply(this,h[v]);if(p)l[z]=true}for(z in l)l[z]||g.hide.push(this.elLk.configDivs.filter("."+z).toArray())}else{g.hide.push(this.elLk.configDivs.toArray(),this.elLk.configDivs.children(".subset").toArray());for(z in this.params.tracksByType){p=false;h=this.elLk.configDivs.filter("."+z);n=h.find("ul.config_menu");q=this.params.tracksByType[z];for(v=q.length;v--;){m=n.eq(v);for(l in q[v]){t=this.tracks[q[v][l]];a(t.id,t.name,t.desc,t.el||t.html)}}p&&g.show.push(h[0],h.children(".subset").toArray())}}j.length&&this.updateElLk(j);this.lastQuery=this.query;f([].concat.apply([],g.hide)).filter(function(){return this.style.display!=="none"}).css("display","none");f([].concat.apply([],g.show)).filter(function(){return!this.style.display||this.style.display==="none"}).css("display","block");this.toggleDescription(g.showDesc,"show");this.elLk.noSearchResults[c]();g=h=m=n=null},toggleDescription:function(a,b){var c=f(),g=f();if(typeof a.length==="undefined")a=[a];var h=a.length;if(h){for(;h--;)switch(a[h].nodeName){case"LI":c.push(f(a[h]).children("div.desc")[0]);g.push(f(".menu_help",a[h])[0]);break;case"DIV":c.push(f(a[h]).parent().siblings("div.desc")[0]);g.push(a[h]);break;default:break}switch(b){case"hide":c.css("display","none");g.removeClass("open");break;case"show":c.css("display","block");g.addClass("open");break;default:c.toggle();g.toggleClass("open")}g.attr("title",function(){return f(this).hasClass("open")?"Hide information":"Click for more information"});c.find("._dyna_load").removeClass("_dyna_load").dynaLoad({complete:function(){this.externalLinks()}});this.elLk.help=this.elLk.help.add(g).filter(".open")}},changeFavourite:function(a,b,c,g){var h;if(this.tracks[a].el){h=this.tracks[a].el.toggleClass("fav");this.tracks[a].fav=!this.tracks[a].fav}this.sortable&&this.elLk.trackOrderList.children("."+a).toggleClass("fav");if(this.elLk.links.filter(".active").children("a")[0].className==="favourite_tracks"){h=h.hide().parents("div.config");h.find("li:visible").length||h.hide();this.elLk.tracks.filter(".fav").length||this.elLk.favouritesMsg.show()}if(this.id!==g){if(c)this.externalFavourites[a]=[b,c];if(this.imageConfig[a])this.imageConfig[a].favourite=b}},externalFavourite:function(a,b){if(typeof this.externalFavourites[a]!=="undefined"){this.imageConfig[a].favourite=this.externalFavourites[a][0];if(this.tracks[a].fav!==this.imageConfig[a].favourite){b[this.imageConfig[a].favourite?"addClass":"removeClass"]("fav");this.tracks[a].fav=this.imageConfig[a].favourite}delete this.externalFavourites[a]}},externalChange:function(a,b){var c={};if(typeof a!=="object")c[a]=b;else c=a;for(var g in c)if(this.tracks[g]){this.changeTrackRenderer(this.tracks[g].el,c[g]);this.imageConfig[g].renderer=c[g]}},syncViewConfig:function(a,b,c,g,h){var j=this;if(this.id!==a){a=this.elLk.viewConfigs.filter("."+b).find(":input[name="+c+"]").prop(g,h);if(this.viewConfig[c])this.viewConfig[c]=g==="checked"?h?a[0].value:"off":h;a.attr("name")==="select_all"&&a.parents("fieldset").find("input[type=checkbox]").prop("checked",h).each(function(){j.viewConfig[this.name]=h?this.value:"off"});a=null}},externalOrder:function(a,b){if(!this.elLk.trackOrderList.children().length){var c=this.elLk.links.filter(".active").children("a")[0].className;this.show("track_order");this.getContent();this.show(c)}a=this.elLk.trackOrderList.find("."+a);b=b?this.elLk.trackOrderList.find("."+b):false;if(a.length)b&&b.length?a.insertAfter(b):a.parent().prepend(a)},externalReset:function(){this.el.empty().removeClass("active")},initConfigList:function(){this.elLk.configSelector.off().on("change",{panel:this},function(a){var b=f(this),c=b.val();if(c!=="current"){if(b.find("option[value=current]").prop("disabled")||D.confirm("Your current configuration is unsaved and will be lost if you continue."))if(c==="public")a.data.panel.openPublicConfigs();else{b.data("selected",c);a.data.panel.setConfig(c);return}b.find("option[value="+b.data("selected")+"]").prop("selected",true)}});this.elLk.configSaveInput.last().append('<a class="left-margin" href="#">Cancel</a>').find("a").on("click",{panel:this},function(a){a.preventDefault();a.data.panel.elLk.configSaveInput.find("input").trigger("reset").end().hide();a.data.panel.elLk.configSelector.parent().show()}).end().end().first().find("input").on("keydown mousedown",function(){if(this.value===this.defaultValue)this.value=""});this.elLk.configForm.on("submit",{panel:this,input:this.elLk.configSaveInput.find("input[type=text]")[0]},function(a){a.preventDefault();a.data.input.value===a.data.input.defaultValue?f(a.data.input).selectRange(0,a.data.input.defaultValue.length):a.data.panel.configSave(true,a.data.input.value)});this.refreshConfigList()},refreshConfigList:function(){this.elLk.configDropdown.removeClass("hidden").css("opacity",0.5);this.elLk.configSelector.parent().show();this.elLk.configSaveLink.add(this.elLk.configSaveAsLink).hide();this.elLk.configSaveInput.hide();f.ajax({url:this.params.config_selector_url,dataType:"json",context:this,success:function(a){this.elLk.configSelector.empty().prop("disabled",false);this.elLk.configSelector.append('<option value="default">Default</option>');this.elLk.configSelector.append(f('<option value="current">Current unsaved</option>').prop("disabled",a.selected!=="current").on("select",{link:this.elLk.configSaveAsLink,selector:this.elLk.configSelector},function(b){b.data.selector.data("selected","current");this.disabled=false;this.selected=true;b.data.link.html("Save current configuration").show()}).on("unselect",{link:this.elLk.configSaveAsLink,selector:this.elLk.configSelector,persistent:a.selected==="current"},function(b){var c=b.data.selector.data("selected");b.data.selector.find("option[value="+c+"]").prop("selected",true);if(!b.data.persistent){b.data.link.hide();this.disabled=true}}));a.configs&&a.configs.length&&this.elLk.configSelector.append(f('<optgroup label="Saved configurations">').append(f.map(a.configs,function(b){return f('<option value="'+b.value+'">'+b.name+"</option>")})).find("option").on("select",{links:[this.elLk.configSaveLink,this.elLk.configSaveAsLink]},function(b,c){if(!c){b.data.links[0].html("Save existing").show();b.data.links[1].html("Create new").show()}this.selected=true}).on("unselect",{links:this.elLk.configSaveLink.add(this.elLk.configSaveAsLink)},function(b){b.data.links.hide()}).end());this.elLk.configSelector.data("selected",a.selected).find("option[value="+a.selected+"]").triggerHandler("select",true)},error:function(){this.elLk.configSelector.empty().append("<option>Error</option>").prop("disabled",true)},complete:function(){this.elLk.configDropdown.css("opacity",1)}})},configSettingChanged:function(a){a=a?this.updateConfiguration(this.id):this.updateConfiguration(true,true);this.elLk.configSelector.find(this.elLk.configSelector.val()==="default"?"option[value=current]":":selected").trigger(f.isEmptyObject(a.imageConfig)&&f.isEmptyObject(a.viewConfig)?"unselect":"select")},configSave:function(a,b){var c=this.updateConfiguration(true,true);if(!(f.isEmptyObject(c.imageConfig)&&f.isEmptyObject(c.viewConfig)&&this.elLk.configSelector.data("selected")!=="current")){if(a)if(b)c.configName=b;else{this.elLk.configSaveInput.show().first().find("input").val(function(){return this.defaultValue}).selectRange(0,function(){return this.defaultValue.length});this.elLk.configSelector.parent().hide();return}else{c.configId=this.elLk.configSelector.val();c.configName=this.elLk.configSelector.find("option:selected").html()}this.elLk.configSelector.empty().append("<option>Applying...</option>").prop("disabled",true);f.ajax({url:this.params.config_save_url,dataType:"json",method:"post",context:this,data:{config:JSON.stringify(c)},success:function(g){if(g.updated){this.refreshConfigList();o.EventManager.trigger("queuePageReload",this.component,false,true)}else this.showError("Error: Configuration settings could not be saved.")},error:function(){this.showError("Error: Configuration settings could not be saved.")},complete:function(){this.elLk.configSelector.prop("disabled",false)}})}},openPublicConfigs:function(){},setConfig:function(a){f.ajax({url:this.params.config_apply_url,dataType:"json",context:this,data:{apply:a},success:function(b){if(b.updated){this.elLk.configSelector.empty().append("<option>Applying...</option>").prop("disabled",true);this.elLk.configSaveLink.add(this.elLk.configSaveAsLink).remove();o.redirect()}else this.showError("Error: Configuration settings could not be applied.")},error:function(){this.showError("Error: Configuration settings could not be applied.")}})},showError:function(a){alert(a)},destructor:function(){this.imageConfig=this.searchCache=this.tracks=null;this.base.apply(this,arguments)}});o.Panel.DataExport=o.Panel.extend({init:function(){var a=this;this.base();this.elLk.form=this.el.find("form").first();this.elLk.buttons=this.elLk.form.find("input.export_buttons");this.elLk.images=this.elLk.form.find("div._export_formats div");this.elLk.images.length==1?this.elLk.buttons.removeClass("disabled").prop("disabled",0):this.elLk.images.on("click",function(){a.selectOption(this.firstChild.innerHTML)});this.elLk.dropdown=this.elLk.form.find("select._export_formats").on("change",function(){a.selectOption(this.value,true)});this.elLk.compression=this.elLk.form.find('input[name="compression"]');this.elLk.buttons.on("click",function(){if(a.elLk.images.length==1||a.elLk.dropdown.val()!==""){a.elLk.compression.val(this.name);a.elLk.form.trigger("submit")}});this.elLk.dropdown.trigger("change")},selectOption:function(a,b){this.elLk.images.removeClass("selected").filter(function(){return this.firstChild.innerHTML==a}).addClass("selected");b||this.elLk.dropdown.find("option[value="+a+"]").prop("selected",true).end().selectToToggle("trigger");this.elLk.buttons.toggleClass("disabled",a==="").prop("disabled",a==="");a==="RTF"&&this.elLk.buttons.filter("[name=preview]").prop("disabled",true).addClass("disabled")}});o.Panel.EQTLTable=o.Panel.Content.extend({init:function(){this.base();this.eQTLRestURL=this.params.eqtl_rest_endpoint;this.geneURLTemplate=decodeURIComponent(this.params.eqtl_gene_url_template);this.elLk.eQTLTable=this.el.find("._variant_eqtl_table");this.fetchEQTLTable()},fetchEQTLTable:function(){this.elLk.eQTLTable.children().hide().end().removeClass("hidden").append("<p>Loading "+this.elLk.eQTLTable.find("h2").text()+
" ...</p>");f.ajax({url:this.eQTLRestURL,dataType:"json",context:this,success:function(a){this.showEQTLTable(a);this.elLk.eQTLTable.children("p").remove()},error:function(a){this.showError((a.responseJSON||{}).error)}})},showEQTLTable:function(a){for(var b=this.geneURLTemplate,c=this.elLk.eQTLTable.children().filter("h3").remove().end().show().find("table").dataTable(),g=c.fnSettings().aoData.length-1;g>=0;g--)c.fnDeleteRow(g,false);var h={};f.each(a,function(j,l){j=l.gene+"-"+l.tissue;j in h||(h[j]=l);h[j][l.statistic]=l.statistic==="beta"?l.value:l.minus_log10_p_value});a=null;c.fnAddData(f.makeArray(f.map(h,function(j){return[['<a href="'+o.populateTemplate(b,{geneId:j.gene})+'">'+j.gene+"</a>",j["p-value"],j.beta,j.tissue]]})),false);c.fnDraw()},showError:function(a){if(a){if(a.match(/not recognize/))a=""}else a="Error loading eQTL data from REST";this.elLk.eQTLTable.children("h3").show().end().children("p").html(a).show()}});o.Panel.Exporter=o.Panel.ModalContent.extend({init:function(){var a=this;this.base();this.config={};f.each(f("form.configuration",this.el).serializeArray(),function(){a.config[this.name]=this.value})},formSubmit:function(a){var b=this,c=f.extend({},this.config),g={},h={},j;f("input[type=hidden], input.as-param",a).each(function(){g[this.name]=this.value});var l={};f("input.as-param",a).each(function(){l[this.name]=1});if(a.hasClass("configuration")){f.each(a.serializeArray(),function(){if(!l[this.name]&&b.config[this.name]!==this.value)h[this.name]=this.value;delete c[this.name]});for(j in c)h[j]="no";g.view_config=JSON.stringify(h);f.extend(true,this.config,h)}return this.base(a,g)}});o.Panel.Glossary=o.Panel.extend({init:function(){var a=this;this.base();this.glossaryRestURL=this.params.glossary_search_endpoint;this.elLk.glossaryForm=this.el.find("._glossary_search");this.elLk.glossaryInput=this.el.find('input[name="query"]');this.elLk.glossaryButton=this.el.find("._rest_search");this.elLk.glossaryResults=this.el.find("._glossary_results");this.elLk.glossaryButton.on("click",function(b){a.fetchGlossary();b.preventDefault()})},fetchGlossary:function(){this.elLk.glossaryResults.children().remove().end().removeClass("hidden").append('<p class="_loading">Loading ...</p>');f.ajax({url:this.glossaryRestURL+"&rows=100&q="+this.elLk.glossaryInput.val(),dataType:"json",context:this,success:function(a){this.showGlossaryResults(a);this.elLk.glossaryResults.children("._loading").remove()},error:function(a){this.showError((a.responseJSON||{}).error)}})},showGlossaryResults:function(a){var b=a.response.numFound;a=a.response.docs;if(b>0){var c='<p class="top-margin">Found '+b+" matching terms";if(b>100)c+=" - showing first 100";c+=":</p>";this.elLk.glossaryResults.append(c);var g=this.elLk.glossaryResults.append("<dl>"),h=new RegExp("("+this.elLk.glossaryInput.val()+")","ig");f.each(a,function(j,l){j=l.label.replace(h,'<span class="hl">$1</span>');l=l.description[0].replace(h,'<span class="hl">$1</span>');g.append("<dt>"+j+"</dt><dd>"+l+"</dd>")})}else this.elLk.glossaryResults.append("<p>No results found.</p>")},showError:function(a){if(a){if(a.match(/not recognize/))a=""}else a="Error loading glossary results from OLS";this.elLk.glossaryResults.append("<p>"+a+"</p>")}});o.Panel.ImageExport=o.Panel.extend({init:function(){var a=this;this.base();this.elLk.form=this.el.find("form").first();this.elLk.extSwitch=this.elLk.form.find("select[name=image_format]").on("change",function(){a.updateExtension(this.value)});this.elLk.pdfSwitch=this.elLk.form.find("input[name=format]").on("change",function(){if(this.value=="pdf")a.updateExtension(this.value);else this.value!="custom"&&a.updateExtension("png")})},updateExtension:function(a){this.elLk.fileName=this.elLk.form.find("input[name=filename]");this.elLk.fileName.val(this.elLk.fileName.val().replace(/\.(\w)*$/i,"."+a))}});o.Panel.ManageConfigs=o.Panel.ModalContent.extend({initialize:function(){var a=this;this.base.apply(this,arguments);this.elLk.table=this.el.find("._manage_configs");this.elLk.table.find("span").each(function(){var b={},c=f(this);c.closest("tr").find("input[type=hidden]").each(function(){b[this.name.replace(/saved_config_/,"")]=this.value});b.account=!!b.account;c.data(b).filter(function(){return b.account}).closest("tr").addClass("user-config");a.setHelptip(c)}).on("click",{panel:this},function(b){b.preventDefault();var c=f(this),g=c.data();switch(this.className){case"save":o.isLoggedInUser&&!g.account&&b.data.panel.moveConfig(g.code);break;case"edit":b.data.panel.showEditDesc(c.closest("td"));break;case"delete":f.when(b.data.panel.deleteConfig(g.code)).done(function(){o.EventManager.trigger("refreshConfigList")});break;case"share":o.isLoggedInUser&&g.account&&b.data.panel.showShareURL(b,D.location.href.replace(/(\&|\;)time=[^\;\&]+/,"")+";share_config="+g.name+"/"+g.code);break}})},setHelptip:function(a){a.helptip({content:function(b,c){switch(b.prop("className")){case"save":return o.isLoggedInUser?c.account?"Already saved":"Save to account":"Please login to save configuration to your user account";case"edit":return"Edit description";case"delete":return"Delete configuration";case"share":return o.isLoggedInUser?c.account?"Share configuration":"Please save this configuration before sharing it.":"Please login and save this configuration before sharing it."}}(a,a.data())})},showEditDesc:function(a){a.find("span, div").hide().end().append(f("<textarea>"+(a.find("div").attr("class").match("empty")?"":a.find("div").html())+"</textarea>")).append(f('<a href="#" class="button left-margin">Save</a>').on("click",{panel:this},function(b){b.preventDefault();this.className.match(/disabled/)||b.data.panel.saveEditDesc(f(this).closest("td"))})).append(f('<a href="#" class="small left-margin">Cancel</a>').on("click",{panel:this},function(b){b.preventDefault();this.className.match(/disabled/)||b.data.panel.cancelEditDesc(f(this).closest("td"))}))},saveEditDesc:function(a){a.find("textarea").prop("disabled",true).end().find("a").addClass("disabled");this._ajax({url:this.params.save_desc_url,context:{panel:this,td:a},data:{code:a.closest("tr").find("input[name=saved_config_code]").val(),desc:a.find("textarea").val()},complete:function(){this.td.find("textarea").prop("disabled",false).end().find("a").removeClass("disabled")}})},cancelEditDesc:function(a){a.find("span, div").show().end().find("textarea, a").remove()},moveConfig:function(a){return this._ajax({url:this.params.move_config_url,data:{code:a}})},deleteConfig:function(a){return this._ajax({url:this.params.delete_config_url,data:{code:a}})},showShareURL:function(a,b){a.stopPropagation();if(!this.elLk.shareURLHolder)this.elLk.shareURLHolder=f('<div class="manage-config-copy-url"><p>Copy this link:</p><input type="string" /></div>').appendTo(N.body);this.elLk.shareURLHolder.show().css({left:a.clientX,top:a.clientY}).on("click",function(c){c.stopPropagation()}).find("input").val(b).selectRange(0,b.length);f(N).off(".hideShareURL").on("click.hideShareURL",{popup:this.elLk.shareURLHolder},function(c){if(c.which===1){c.data.popup.hide();f(N).off(".hideShareURL")}})},_ajax:function(a){return f.ajax(f.extend({context:{panel:this},dataType:"json",success:function(b){b.updated&&this.panel.getContent(U,this.panel.params.url)}},a))}});o.Panel.TaxonSelector=o.Panel.extend({constructor:function(a,b){this.base(a);this.dataUrl=b.dataUrl;this.taxonTreeData=null;this.imagePath=o.speciesImagePath;this.lastSelected=null;this.activeTreeKey="";this.selectionLimit=b.selectionLimit;this.defaultKeys=[];this.multiHash={};if(b.defaultKeys)this.defaultKeys=b.defaultKeys;if(b.caller)this.caller=b.caller;if(b.allOptions)this.allOptions=b.allOptions;if(b.includedOptions)this.includedOptions=b.includedOptions;if(b.multiselect)this.multiSelect=b.multiselect;if(b.align)this.alignId=b.align;if(b.alignLabel)this.alignLabel=b.alignLabel.replace(/\s/g,"_");this.isCompara=this.caller==="Compara_Alignments";o.EventManager.register("modalPanelResize",this,this.resize)},init:function(){var a=this;a.base();a.elLk.form=f("form",a.el);a.elLk.tree=f(".taxon_selector_tree .vscroll_container",a.el);a.elLk.list=f(".taxon_selector_list .vscroll_container ul",a.el);a.elLk.buttons=f(".ss-buttons",a.el);a.elLk.mastertree=f(".taxon_tree_master",a.el);a.elLk.finder=f(".finder input",a.el);a.elLk.divisions=f(".species_division_buttons",a.el);a.elLk.breadcrumbs=f(".ss_breadcrumbs",a.el);a.elLk.count=f(".taxon_selector_list .ss-count",a.el);a.elLk.msg=f(".ss-msg span",a.el);a.elLk.finder.focus();f(".modal_close").hide();f(".modal_close").unbind().bind("click",function(){o.EventManager.trigger("modalClose",true);return a.updateConfiguration()});f("#ss-reset",a.elLk.buttons).click(function(){return a.resetConfiguration()});f("#ss-cancel",a.elLk.buttons).click(function(){o.EventManager.trigger("modalClose",true)});f("#ss-submit",a.elLk.buttons).click(function(){o.EventManager.trigger("modalClose",true);return a.updateConfiguration()});f(N).ajaxError(function(b,c,g,h){console.log(h)});f.ajax({url:a.dataUrl,async:false,dataType:"JSON",success:function(b){if(b.json[0]){a.taxonTreeData=b.json[0];a.initialize()}},error:function(b,c,g){console.log("Error loading json: ",g);a.elLk.tree.html("Couldn't load species tree")}});a.resize();a.updateCount()},updateCount:function(){this.elLk.count.html(this.getCurrentSelectionCount());this.elLk.count.removeClass("warn");var a=this.getCurrentSelectionCount();if(a==0){this.disableButton(true);return false}if(this.selectionLimit&&a>this.selectionLimit){this.elLk.msg.html("Selection limit of "+this.selectionLimit+" species exeeded!").show();this.elLk.count.addClass("warn");this.disableButton(true);return false}else this.elLk.msg.hide();this.disableButton(false)},resetConfiguration:function(){this.initialize()},getCurrentSelectionCount:function(){return f("li",this.elLk.list).length||0},initialize:function(){var a=this;this.elLk.tree.html("");this.elLk.list.html("");this.updateCount();if(this.taxonTreeData){this.initAutoComplete();this.addBreadcrumbs();this.createMenu(this.taxonTreeData.children);this.defaultKeys&&this.populateDefaultSpecies();this.isCompara&&this.createMultipleAlignmentsHash()}this.elLk.list.sortable({containment:this.elLk.list.parent(),start:function(b,c){f(c.item).addClass("ss-drag-active")},stop:function(b,c){f(c.item).removeClass("ss-drag-active");a.startSort()}})},createMultipleAlignmentsHash:function(){var a=this;this.multiHash={};f.each(this.taxonTreeData.children,function(b,c){c.key==="Multiple"&&f.each(c.children,function(g,h){a.multiHash[h.key]={};f.each(h.children,function(j,l){a.multiHash[h.key][l.key]="yes"})})})},updateMultipleAlignmentsHash:function(a,b){b=!b?"yes":"off";this.multiHash[a.parent.data.key]=!this.multiHash[a.parent.data.key]&&{};this.multiHash[a.parent.data.key][a.data.key]=b},startSort:function(){return true},createMenu:function(a,b){var c=this,g=[];f.each(a,function(h,j){h="";if(j.title===b)h="active";h=f("<a/>",{"class":"division_button btn "+
h,text:j.title});f(h).off().on("click",function(){var l=c.elLk.mastertree.dynatree("getTree").getNodeInTree(j.key);l.data.is_submenu&&c.addBreadcrumbs(l);if(j.is_submenu){if(j.children){c.createMenu(j.children);c.hideTree()}}else{c.highlightElement(this);c.displayTree(l.data.title,true)}});g.push(h)});c.elLk.divisions.html(g)},highlightElement:function(a){f(a).siblings().removeClass("active");f(a).addClass("active")},addBreadcrumbs:function(a){var b=this;if(!a){a=b.elLk.mastertree.dynatree("getRoot").getChildren()[0];if(!a)return}var c=[],g=a.getKeyPath(false,"key"),h=false;if(g){g=g.split("/");f.each(g,function(j,l){if(l){h=j===g.length-1?true:false;c.push(b.createListElement(l,h))}})}b.elLk.breadcrumbs.html(c)},getPath:function(a){var b="",c=function(g,h,j){for(var l in h)if(h.hasOwnProperty(l))if(h[l].title===j)return h[l].is_submenu?g+h[l].title:g;else if(typeof h[l]==="object"){if(h.title)g+=h.title+",";var p=c(g,h[l],j);if(p)return p}return false};return b=(b=c(b,a,key))&&b.replace(/(,$)/g,"")},createListElement:function(a,b){var c=this;b=f("<li/>",{"class":b?"active":""});var g=c.elLk.mastertree.dynatree("getTree").getNodeInTree(a);f("<a/>",{text:g.data.title,href:"javascript:void(0);"}).appendTo(b);f(b).on("click",function(){if(g.data.children){c.addBreadcrumbs(g);c.hideTree();c.createMenu(g.data.children)}else c.displayTree(g,true)});return b},initAutoComplete:function(){var a=this;a.elLk.mastertree.dynatree({children:[a.taxonTreeData]});a.elLk.mastertree.hide();var b=[],c=[];a.elLk.mastertree.dynatree("getRoot").visit(function(h){if(!h.data.is_submenu&&h.data.searchable){var j="";j=h.data.isFolder?h.data.title:h.data.title===h.data.key?h.data.title:h.data.title+" ("+h.data.key+")";b.push(j);c[j]={key:h.data.key,multi:h.parent.data.key==="Multiple"};c[h.data.key]={key:h.data.key,multi:h.parent.data.key==="Multiple"}}});var g=a.elLk.finder;g.autocomplete({minLength:3,classes:{"ui-autocomplete":"ss-autocomplete"},source:function(h,j){j(a.filterArray(f.unique(b),h.term))},select:function(h,j){c[j.item.value].multi&&a.elLk.mastertree.dynatree("getTree").reload();a.locateNode(c[j.item.value].key,a.activeTreeKey==="Multiple");if(!a.multiSelect){h=a.elLk.tree.dynatree("getTree").getSelectedNodes();if(h.length&&a.activeTreeKey!=="Multiple")a.lastSelected=h[0]}},open:function(){f(".ui-menu").css("z-index",1E9)}}).focus(function(){if(f(this).val()==f(this).attr("title")){g.val("");g.removeClass("inactive")}else f(this).val()!=""&&g.autocomplete("search")}).blur(function(){g.removeClass("invalid");g.addClass("inactive");g.val(f(this).attr("title"))}).keyup(function(){if(g.val().length>=3){var h=a.filterArray(b,g.val());h&&h.length?g.removeClass("invalid"):g.addClass("invalid")}else g.removeClass("invalid")}).data("ui-autocomplete")._renderItem=function(h,j){h.addClass("ss-autocomplete");var l=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+f.ui.autocomplete.escapeRegex(this.term)+")(?![^<>]*>)(?![^&;]+;)","gi");j.label=j.label.replace(l,"<span class='ss-ac-highlight'>$1</span>");return f("<li/>").data("ui-autocomplete-item",j).addClass("ss-ac-result-li").append("<a class='ss-ac-result'>"+
j.label+"</a>").appendTo(h)}},hideTree:function(){f(this.elLk.tree).children().hide()},displayTree:function(a){var b=this,c=b.elLk.mastertree.dynatree("getTree").getNodeInTree(a);if(!c||!c.data.isFolder)console.log("master tree is null");else{b.elLk.tree.dynatree({children:[c.toDict(true)],imagePath:b.imagePath,checkbox:true,selectMode:b.isCompara&&a!=="Multiple"?1:3,activeVisible:true,onSelect:function(g,h){if(b.isCompara&&a==="Multiple"){var j;if(!h.data.isFolder&&h.parent.data.key!=="Multiple"){j=h.parent;b.updateMultipleAlignmentsHash(h,g)}else j=h;b.lastSelected&&b.lastSelected.data&&b.lastSelected.data.key!==j.data.key?b.setSelection(h,g,true,true):b.setSelection(h,g);b.lastSelected=j}else if(b.isCompara&&!b.multiSelect){b.lastSelected=g?h:null;b.setSelection(h,g,true,true)}else{b.disableButton(!g);b.setSelection(h,g)}},onDblClick:function(g){g.toggleSelect()},onKeydown:function(g,h){if(h.which==32){g.toggleSelect();return false}}});this.activeTreeKey=a}},populateDefaultSpecies:function(){var a=this,b=a.elLk.mastertree.dynatree("getTree"),c=a.isCompara&&a.alignLabel,g,h;if(a.defaultKeys&&a.defaultKeys.length>0){f.each(a.defaultKeys.reverse(),function(j,l){g=b.getNodeByKey(l);h=l;if(!g)if((sp=l.match(/(.*)--\w+$/))&&sp[1]){g=b.getNodeInTree(sp[1]);h=sp[1]}if(g){g.select();!c&&g.makeVisible();a.setSelection(g,true);a.lastSelected=a.isCompara&&a.alignLabel?b.getNodeByKey(a.alignLabel):g}});c?a.locateNode(a.alignLabel):a.locateNode(h)}},getTree:function(a,b){for(b=b||"isInternalNode";a.parent;){if(a.data[b])return a;a=a.parent}return false},getNodeFromTaxonTree:function(a,b){var c=function(g,h,j){if(h.key===g)return h.isInternalNode?h:true;if(h.isFolder){if(h.isInternalNode)j=h;for(var l in h.children){var p=c(g,h.children[l],j);if(p)return p===true?j:p}}return false};return c(a,b,b)},resize:function(){var a=f(this.el).height()-80;this.elLk.tree.parent(".content").height(a);this.elLk.list.closest(".vscroll_container").height(a-29)},getSelectedItems:function(a){if(!a)a=this.elLk.mastertree;a=this.elLk.mastertree.dynatree("getTree").getSelectedNodes();var b=[],c={};f.each(a,function(g,h){h.data.isFolder||(c[h.data.title]={key:h.data.key,title:h.data.title,value:h.data.value})});f.each(f("li",this.elLk.list),function(){b.push(c[f(".selected-sp-title",this).text()])});return b},getAllLeaves:function(a){function b(g){if(g.childList)for(var h in g.childList)b(g.childList[h]);else if(g.data.unselectable!==1)c[c.length]=g;return c}var c=[];return b(a)},setSelection:function(a,b,c,g){var h=this,j=[];if(a.hasChildren())j=h.getAllLeaves(a);else j.push(a);if(c)if(h.isCompara&&h.activeTreeKey==="Multiple"){h.elLk.mastertree.dynatree("getTree").visit(function(l){l&&l.select(false)});h.elLk.tree.dynatree("getTree").visit(function(l){l&&l.select(false)});a.select(b)}else h.elLk.mastertree.dynatree("getTree").reload();g&&h.elLk.list.children().remove();f.each(j,function(l,p){h.elLk.mastertree.dynatree("getTree").selectKey(p.data.key,b);if(b){if(!f("li."+p.data.key,h.elLk.list).length){l=(p.data.special_type?p.data.special_type:p.data.key)+".png";p.data.img_url=p.data.img_url||h.imagePath+l;l='<span class="selected-sp-img"><img src="'+p.data.img_url+'"></span>';f("<li/>",{"class":p.data.key}).data(p.data).append(l,'<span class="selected-sp-title">'+p.data.title+'</span><span class="remove">x</span>').prependTo(h.elLk.list)}}else f("li."+p.data.key,h.elLk.list).length&&f.each(f("li",h.elLk.list),function(m,n){f(n).data("key")===p.data.key&&f(n).remove()})});f("li span.remove",h.elLk.list).off().on("click",function(){h.removeListItem(f(this).parent());h.updateCount()});h.updateCount();f("h2",h.elLk.taxon_selector_list).removeClass("active").addClass("active")},disableButton:function(a){f("#ss-submit",this.elLk.buttons).attr("disabled",a);!a?f("#ss-submit",this.elLk.buttons).addClass("active"):f("#ss-submit",this.elLk.buttons).removeClass("active")},locateNode:function(a,b){var c=this.elLk.mastertree.dynatree("getTree").getNodeInTree(a);if(c){c.data.isFolder||this.setSelection(c,true,this.isCompara,this.isCompara);var g=this.getTree(c,"isInternalNode");if(c=this.getTree(c,"is_submenu")){this.createMenu(c.data.children,g.data.title);this.addBreadcrumbs(c)}this.displayTree(g.data.title);(a=this.elLk.tree.dynatree("getTree").getNodeInTree(a))&&a.activate();a&&!a.data.isFolder&&b&&a.select();if(!this.isCompara)this.lastSelected=a}},removeListItem:function(a){var b=this,c=f(a).attr("class");if(c!=""){var g=[];g=b.elLk.mastertree.dynatree("getTree").getSelectedNodes();f.each(g,function(h,j){if(j.data.key==c){if(f("ul",b.elLk.tree).length)(tree_node=b.elLk.tree.dynatree("getTree").getNodeInTree(c))&&tree_node.toggleSelect();j.toggleSelect();f(a).remove()}})}},filterArray:function(a,b){b=b.replace(/[^a-zA-Z0-9 ]/g,"").toUpperCase();var c=new RegExp(f.ui.autocomplete.escapeRegex(b),"i");a=f.grep(a,function(g){return g&&c.test(g.replace(/[^a-zA-Z0-9 ]/g,""))});a.sort(function(g,h){var j=g.toUpperCase().substr(0,b.length)==b,l=h.toUpperCase().substr(0,b.length)==b;if(g.match(/reference/i))return-1;if(h.match(/reference/i))return 1;if(j==l){if(g==h)return 0;return g<h?-1:1}return j?-1:1});return a},updateConfiguration:function(){var a=[],b=this.activeTreeKey==="Multiple";a=this.multiSelect?this.getSelectedItems(this.elLk.mastertree):this.lastSelected?[this.lastSelected]:[];if(!a.length)return false;for(var c=[],g=0;g<a.length;g++)if(this.isCompara)a[g]&&c.push(a[g].data.key);else a[g]&&c.push(a[g].key);if(!this.approveSelection(c))return false;if(this.caller==="Blast")o.EventManager.trigger("updateTaxonSelection",a);else if(this.isCompara){a=a[0];b?o.EventManager.trigger("updateMultipleAlignmentSpeciesSelection",a):o.EventManager.trigger("updateAlignmentSpeciesSelection",a)}else if(this.caller==="Multi"){b=[];for(g=0;g<a.length;g++)a[g]&&b.push("s"+(g+1)+"="+a[g].key);a=this.elLk.form.prop("action").replace(/[s,r]\d+=.*(;)?/,"");o.redirect(a+o.cleanURL(this.elLk.form.serialize()+";"+b.join(";")))}return true},approveSelection:function(a){return a.length&&this.defaultKeys&&a.join(",")!==this.defaultKeys.join(",")}});o.Panel.ConfigMatrix=o.Panel.Configurator.extend({constructor:function(a,b){this.base(a,b);o.EventManager.remove(a);o.EventManager.register("mouseUp",this,this.dragStop);o.EventManager.register("updateConfiguration",this,this.updateConfiguration);o.EventManager.register("changeColumnRenderer",this,this.changeColumnRenderer);o.EventManager.register("modalPanelResize",this,this.setScrollerSize)},init:function(){var a=this,b;o.Panel.prototype.init.call(this);this.startCell=[];this.dragCell=[];this.imageConfig={};this.elLk.links=this.params.links.find("> .count > .on");this.elLk.wrapper=this.el.children(".config_matrix_wrapper");this.elLk.scroller=this.el.children(".config_matrix_scroller").add(this.elLk.wrapper).on("scroll",function(){a.elLk.scroller.not(this).scrollLeft(this.scrollLeft)});this.elLk.filterWrapper=this.el.children(".filter_wrapper");this.elLk.tableWrapper=this.elLk.wrapper.children(".table_wrapper");this.elLk.noResults=this.elLk.wrapper.children(".no_results");this.elLk.table=this.elLk.tableWrapper.children("table.config_matrix");this.elLk.headers=this.elLk.table.children("thead").children("tr:first").children("th");this.elLk.axisLabels=this.elLk.headers.filter(".axes").find("i");this.elLk.configMenus=this.elLk.table.children("thead").children("tr.config_menu").children("th");this.elLk.rows=this.elLk.table.children("tbody").children("tr");this.elLk.columnHeaders=this.elLk.headers.add(this.elLk.configMenus).not(".first");this.elLk.cols=[].slice.call(f.map(this.elLk.table[0].rows[0].cells,function(j,l){if(l)return[[]]}));this.elLk.popup=f();this.elLk.subtracks=f();this.elLk.hiddenCells=f();this.elLk.configForm=this.el.closest(".panel").find("._config_settings");this.elLk.configDropdown=this.elLk.configForm.find("._config_dropdown");this.elLk.configSelector=this.elLk.configDropdown.find("select");this.elLk.tableWrapper.data("maxWidth",this.elLk.tableWrapper[0].style.width).width("auto");b=this.elLk.columnHeaders.children("p");var c=Math.max.apply(Math,b.map(function(){return f(this).width()}).toArray()),g=b.addClass("rotate").first().width(),h=this.elLk.headers.filter(".axes").height();if(o.browser.ie){b.css({width:c,bottom:c-g});c>h&&this.elLk.tableWrapper.css("marginTop",c-h)}else{g=(c-g)/2;b.css({lineHeight:c+"px",top:g});c>h&&this.elLk.tableWrapper.css("marginTop",-g/2)}b=null;this.elLk.axisLabels.each(function(){var j=f(this),l=j.clone().addClass("clone").insertAfter(this);l.width()>j.width()&&j.data("fullLabel",f('<em class="floating_popup">'+this.innerHTML+"</em>").css(f(this).position()).appendTo(j)).on({mouseenter:function(){f(this).data("fullLabel").show()},mouseleave:function(){f(this).data("fullLabel").hide()}});l.remove();j=l=null});for(c=0;c<this.elLk.table[0].rows.length;c++)for(b=this.elLk.cols.length;b--;)this.elLk.cols[b].push(this.elLk.table[0].rows[c].cells[b+1]);this.elLk.options=this.elLk.rows.children(".opt").each(function(){var j=f(this);this.configCode=a.id+"_"+this.title.replace(":","_");this.searchTerms=f.trim(this.parentNode.className+" "+a.elLk.headers.eq(j.index()).children("p").html()+" "+this.title).toLowerCase();a.imageConfig[this.configCode]={renderer:j.hasClass("on")?"on":"off"}});this.elLk.tracks=this.elLk.configMenus.not(".select_all").each(function(){var j=a.tracks[this.id];a.imageConfig[this.id]={renderer:j.renderer};f.extend(j,{el:f(this),linkedEls:a.params.parentTracks[this.id].el});f(this).data("track",j);j.renderer!==a.params.parentTracks[this.id].renderer&&a.changeColumnRenderer(f(this),a.params.parentTracks[this.id].renderer)}).removeAttr("id");this.setEventHandlers();this.tutorial();this.setScrollerSize();if(o.browser.ie67){this.elLk.headers.css("zIndex",function(j){return 200-
j});this.elLk.configMenus.css("zIndex",function(j){return 100-j})}},setEventHandlers:function(){var a=this;this.el.children(".header_wrapper").children(".help").on("click",function(){f(this).toggleClass("open").attr("title",function(b,c){return c==="Hide information"?"Click for more information":"Hide information"}).siblings(".desc").width(f(this).parent().width()-25).toggle();return false});this.elLk.filterWrapper.children("select.filter").on("change",function(){a.elLk.rows.removeClass("hidden");this.value&&a.elLk.rows.not("."+this.value).addClass("hidden");a.afterFilter()});this.elLk.filterWrapper.children("input.filter").on({keyup:function(){var b=this.value;if(b&&b.length<2)this.lastQuery=b;if(b!==this.lastQuery){this.searchTimer&&clearTimeout(this.searchTimer);this.searchTimer=setTimeout(function(){a.filter(b)},250)}},focus:function(){this.value="";this.style.color="#000"},blur:function(){if(!this.value){a.filter();this.value=this.defaultValue;this.style.color="#999"}}});o.browser.ie||this.elLk.table.on("mousedown",function(b){if((!b.which||b.which===1)&&/^(TD|P|SPAN)$/.test(b.target.nodeName))a.dragStart(b);return false});this.elLk.table.children("thead").children("tr.config_menu").on("click","th",f.proxy(this.showConfigMenu,this)).on("click",".popup_menu li",f.proxy(this.setColumnConfig,this));this.elLk.headers.not(".axes").on({mouseenter:function(){a.mousemove||a.selectAllCol(f(this).children("div").show())},mouseleave:function(){f(this).children("div").hide()}}).children(".select_all_column").find("input").on("click",function(){var b=this.className,c=a.elLk.rows.children("."+this.name);switch(b){case"":break;case"none":c.removeClass("on");break;case"all":c.addClass("on");break;default:c.filter("."+b).addClass("on").end().not("."+b).removeClass("on")}a.resetSelectAll(c)});this.elLk.rows.children("th").on({mouseenter:function(){if(!a.mousemove){var b=f(this).find(".select_all_row").show();if(!b.data("selectAll")){b.children("input").prop("checked",a.allOnRow(this));b.data("selectAll",true)}}},mouseleave:function(){f(this).find(".select_all_row").hide()}}).find(".select_all_row").on("click",function(){var b=f("input",this),c=f(this).parents("th"),g=a.allOnRow(c[0]);a.resetSelectAll(c.siblings(".opt")[g?"removeClass":"addClass"]("on"));b.prop("checked",!g)});this.elLk.configMenus.filter(".select_all").children(".popup_menu").children("li:not(.header)").on("click",function(){a.changeColumnRenderer(f(this).parent().hide().parent().siblings().filter(function(){return this.style.display!=="none"}),this.className);return false});this.elLk.table.children("tbody").on("click",".opt",function(){var b=f(this).toggleClass("on"),c=a.params.cellTracks?f.trim(a.params.cellTracks[this.title]):false,g,h;if(c&&b.hasClass("on")){a.removePopups();g=b.data("subtracks");if(!g){g=f(c);f(".popup_menu li",g).on("click",f.proxy(a.setTrackConfig,a));f("> ul.config_menu > li.track, .select_all",g).on("click",f.proxy(a.showConfigMenu,a)).not(".select_all").each(function(){f(this).data({track:f.extend(a.tracks[this.id],{el:f(this)}),popup:f(this).children(".popup_menu")})}).removeAttr("id");g.children(".close").on("click",function(){a.removePopups(f(this).parent());return false});h=a.elLk.configMenus.eq(b.index()).data("track");a.setDefaultRenderer(g.data({cell:b,colTrack:h}),h.renderer);b.data("subtracks",g);a.elLk.subtracks.push(g[0]);a.elLk.tracks.push.apply(a.elLk.tracks,g.find(".track").each(function(){var j=f(this).data("track");a.imageConfig[j.id]={renderer:j.renderer}}).toArray())}g.appendTo(a.elLk.wrapper).position({of:this,within:a.elLk.wrapper,my:"left top",collision:"flipfit"})}c?a.updateLinkCount():a.resetSelectAll(b);b=g=null;return false})},showConfigMenu:function(a){var b=f(a.currentTarget),c=b.data("popup");this.base(a);if(c)c.position({of:b,within:this.elLk.wrapper,my:b.hasClass("select_all")?"left bottom+2":"left+8 top",at:b.hasClass("select_all")?"left top":"left center",collision:"flipfit"});return false},setColumnConfig:function(a){a=f(a.target);!a.is(".header")&&!a.filter(".close").parents(".popup_menu").hide().length&&this.changeColumnRenderer(a.parent().hide().parent(),a[0].className);return false},setTrackConfig:function(a){var b=f(a.target);if(b.is(".header")||b.filter(".close").parents(".popup_menu").hide().length)return false;var c=b.parents(".subtracks"),g=c.data("cell"),h=c.data("colTrack"),j=a.currentTarget.className==="default";if(j)a.target=a.currentTarget;this.base(a,false);if(j)b.parents(".track").add(b.parents(".select_all").siblings("ul.config_menu").children(".track"))[h.renderer==="off"?"removeClass":"addClass"]("on").children("div").removeClass().addClass(h.renderer);this.params.defaultRenderers[g[0].title]=f("> ul.config_menu > li.default",c).length;g.find("span.on").html(c.find("li.track.on").length);this.updateLinkCount();return false},changeColumnRenderer:function(a,b,c){var g=this;if(c)a=f(f.map(a,function(h){return g.tracks[h]?g.tracks[h].el[0]:U}));a.length&&this.changeTrackRenderer(a,b,true);a=null;return true},changeTrackRenderer:function(a,b,c){var g=this,h=a.map(function(){return f(this).hasClass("on")}).toArray(),j=b==="off"?-1:1,l;this.base(a,b,false,true);if(c){this.params.defaultRenderers&&a.each(function(p){l=f(this);l.hasClass("on")!==h[p]&&g.elLk.options.filter("."+l.data("track").colClass).find(".on").html(function(m,n){return parseInt(n,10)+g.params.defaultRenderers[f(this).parents("td.opt")[0].title]*j})});this.setDefaultRenderer(this.elLk.subtracks.filter(function(){return a.filter(f(this).data("colTrack").el[0]).length}),a.data("track").renderer);this.updateLinkCount()}a=l=null},setDefaultRenderer:function(a,b){a.find("li.default").filter(".track")[b==="off"?"removeClass":"addClass"]("on").end().children("div").removeClass().addClass(b)},updateLinkCount:function(){var a=0,b=this.elLk.links.last(),c=parseInt(b.html(),10);if(this.params.cellTracks)this.elLk.options.filter(".on").find(".on").each(function(){a+=parseInt(this.innerHTML,10)});else a=this.elLk.configMenus.filter(".on").length;b.html(a);this.elLk.links.first().html(function(g,h){return parseInt(h,10)+(a-c)});b=null},removePopups:function(a){(a||this.elLk.subtracks.filter(function(){return this.parentNode})).detach().each(function(){var b=f(this);b.find("li.track.on").length||b.data("cell").removeClass("on")})},tutorial:function(){var a=this;if(!o.browser.ie67){this.showTutorial=o.cookie.get("config_matrix_tutorial")!=="off";this.elLk.tutorial=f(".tutorial",this.el);this.showTutorial&&this.elLk.tutorial.css("display","block");this.elLk.tutorialToggle=this.el.find(".toggle_tutorial, span.close").on("click",function(){a.showTutorial=!a.showTutorial;a.elLk.tutorial.css("display",a.showTutorial?"block":"none");a.el.find(".toggle_tutorial")[a.showTutorial?"addClass":"removeClass"]("on");o.cookie.set("config_matrix_tutorial",a.showTutorial?"on":"off");return false})[a.showTutorial?"addClass":"removeClass"]("on")}},setScrollerSize:function(){if(this.el.parent().data("active")){var a=o.browser.ie?parseInt(this.elLk.tableWrapper.data("maxWidth"),10)>this.params.width:this.elLk.table.width()>this.el.width();this.elLk.wrapper[a?"addClass":"removeClass"]("wide");this.elLk.tableWrapper.width(a?this.elLk.tableWrapper.data("maxWidth"):"auto");o.browser.ie||this.elLk.scroller.eq(0).children().width(a?this.elLk.wrapper[0].scrollWidth:"auto")}},allOnRow:function(a){a=f(a).siblings(".opt");return a.length===a.filter(".on").length},selectAllCol:function(a){if(!(!a.length||a.data("selectAll"))){var b=a.find("input"),c=this.elLk.rows.children("."+b[0].name),g=c.filter(".on"),h,j,l,p;if(c.length===c.filter(".default").length)h=".default";else if(g.length){if(c.length===g.length)h=".all"}else h=".none";if(h)b.filter(h).prop("checked",true);else{h=b.filter(":checked");b=b.not(".all, .none");for(j=b.length;j--;){l=b[j].className;p=c.filter("."+l);if(p.length===g.length&&p.length===g.filter("."+l).length){b[j].checked="checked";break}}j===-1&&h.prop("checked",false)}a.data("selectAll",true)}},resetSelectAll:function(a){var b={row:{},col:{}},c,g,h,j,l;a.each(function(){b.row[f(this).parent().index()]=1;b.col[f(this).index()]=1});for(c in b.row)f("th .select_all_row",this.elLk.rows[c]).data("selectAll",false);for(c in b.col){g=f(".select_all_column",this.elLk.headers[c]).data("selectAll",false).parent().attr("class");h=this.elLk.configMenus.filter("."+g);j=h.data();l=!!this.elLk.rows.children(".on."+g).length;g=j.track.renderer==="off";if(g===l){j.popup=j.popup||f(j.track.popup).prependTo(h);j.popup.children().removeClass("current").filter("li.off"+(l?" +":"")).trigger("click")}}a.find(".on").length&&this.updateLinkCount();a=h=null},updateConfiguration:function(a,b){if(a===this.id){var c=this,g={},h=false,j;this.elLk.options.each(function(){j=f(this).hasClass("on")?"on":"off";if(c.imageConfig[this.configCode].renderer!==j||b){g[this.configCode]={renderer:j};h=true}});this.elLk.tracks.each(function(){var l=f(this).data("track");if(c.imageConfig[l.id].renderer!==l.renderer||b){g[l.id]={renderer:l.renderer};h=true}});if(h){f.extend(true,this.imageConfig,g);return{imageConfig:g}}}},dragStart:function(a){var b=a.target.nodeName==="P"?f(a.target.parentNode):a.target.nodeName==="SPAN"?f(a.target.parentNode.parentNode):f(a.target);if(b[0].nodeName==="TD"){this.mousemove={x:a.pageX,y:a.pageY};this.startCell=[b.index(),b.parent().index()+
2];this.elLk.table.on("mousemove",f.proxy(this.drag,this));this.removePopups()}},dragStop:function(){if(this.mousemove){this.elLk.table.off("mousemove");var a=f(".highlight",this.elLk.table).removeClass("highlight");if(a.length>1){a=a.filter(".opt");a.length===1?a.trigger("click"):this.resetSelectAll(a.toggleClass("on"))}this.mousemove=false;this.dragCell=[]}},drag:function(a){if(!(Math.abs(a.pageX-this.mousemove.x)<3&&Math.abs(a.pageY-this.mousemove.y)<3)){a=a.target.nodeName==="P"?f(a.target.parentNode):a.target.nodeName==="SPAN"?f(a.target.parentNode.parentNode):f(a.target);if(a[0].nodeName!=="TD")a=null;else{a=[a.index(),a.parent().index()+2];if(!(a[0]===this.dragCell[0]&&a[1]===this.dragCell[1])){var b=[a[0],this.startCell[0]].sort(function(l,p){return l-p}),c=[a[1],this.startCell[1]].sort(function(l,p){return l-p}),g=[],h,j;for(h=c[0];h<=c[1];h++)if(this.elLk.table[0].rows[h].style.display!=="none"&&this.elLk.table[0].rows[h].className!=="gap")for(j=b[0];j<=b[1];j++)g.push(this.elLk.table[0].rows[h].cells[j]);f(".highlight",this.elLk.table).not(g).removeClass("highlight");f(g).not(".highlight").addClass("highlight").not(":has(p)").append("<p></p>");this.dragCell=a;a=g=null}}}},filter:function(a){var b=[],c=[],g={},h={},j,l,p,m,n,q;if(a){p=this.elLk.options.filter(function(){return this.style.display!=="none"});a=a.toLowerCase();j=(l=a.match(/(?:"[^"]+"|'[^']+')/g))?f.map(l,function(t){return t.replace(/^["']/,"").replace(/["']$/,"")}):[a];for(n in j){a=f.trim(j[n]);if(a!==""){a=a.split(" ");p.each(function(){l=true;for(q in a)if(this.searchTerms.indexOf(a[q])===-1){l=false;break}if(l){b.push(this);g[f(this.parentNode).index()]=h[f(this).index()-1]=true}})}}if(b.length){m={show:f(),hide:f()};for(n in g)c.push(this.elLk.rows[n]);this.elLk.rows.not(c).css("display","none");this.elLk.options.filter(".filter").removeClass("filter");f(b).addClass("filter");f(c).show().each(function(){for(n=1;n<this.cells.length;n++)m[h[n-1]?"show":"hide"].push(this.cells[n])});this.elLk.columnHeaders.each(function(){m[h[f(this).index()-
1]?"show":"hide"].push(this)});m.show.css("display","");m.hide.css("display","none");this.elLk.hiddenCells=this.elLk.hiddenCells.add(m.hide.not(this.elLk.hiddenCells))}else this.elLk.rows.css("display","none")}else{this.elLk.options.filter(".filter").removeClass("filter");this.elLk.rows.filter(function(){return this.style.display==="none"}).add(this.elLk.hiddenCells).css("display","");this.elLk.hiddenCells=f()}this.afterFilter()},afterFilter:function(){var a=this.elLk.rows.filter(function(){return this.style.display!=="none"&&this.className.indexOf("hidden")===-1}).length;a||this.elLk.popup.hide();this.showTutorial&&this.elLk.tutorialToggle.trigger("click");this.elLk.table[a<4?"addClass":"removeClass"]("short");this.elLk.noResults[a?"hide":"show"]();this.setScrollerSize()}});o.Panel.ConfigMatrixForm=o.Panel.Configurator.extend({constructor:function(a,b){this.base(a,b);o.EventManager.remove(a)},init:function(){var a=this;o.Panel.prototype.init.call(this);o.EventManager.register("modalPanelResize",this,this.resize);o.EventManager.register("updateConfiguration",this,this.updateConfiguration);o.EventManager.register("updateFromTrackLabel",this,this.updateFromTrackLabel);o.EventManager.register("modalOpen",this,this.modalOpen);this.disableYdim=D.location.href.match("Regulation/Summary")?1:0;this.elLk.dx={};this.elLk.dx.container=f("div#dx-content",this.el);this.elLk.dy={};this.elLk.dy.container=f("div#dy-content",this.el);this.elLk.buttonTab=this.el.find("div.track-tab");this.elLk.breadcrumb=this.el.find("div.large-breadcrumbs li");this.elLk.trackPanel=this.el.find(".track-panel#track-content");this.elLk.matrixContainer=this.el.find("div.matrix-container");this.elLk.trackConfiguration=this.el.find(".track-panel#configuration-content");this.elLk.resultBox=this.el.find(".result-box");this.elLk.filterList=this.el.find("ul.result-list");this.elLk.displayButton=this.el.find("button.showMatrix");this.elLk.clearAll=this.el.find("span.clearall");this.localStoreObj={};this.localStorageKey="RegMatrix-"+o.species;this.elLk.lookup={};this.buttonOriginalWidth=this.elLk.displayButton.outerWidth();this.buttonOriginalHTML=this.elLk.displayButton.html();this.matrixLoadState=true;this.rendererConfig={normal:"normal",peak:"compact",signal:"signal","peak-signal":"signal_feature"};this.resize();a.el.find("div#dy-tab div.search-box").hide();f.ajax({url:"/Json/RegulationData/data?species="+o.species,dataType:"json",context:this,success:function(b){this.json=b;this.trackTab();this.populateLookUp();this.loadState();this.setDragSelectEvent();this.registerRibbonArrowEvents();this.updateRHS();this.addExtraDimensions();this.goToUserLocation();this.resize();this.updateSelectAll()},error:function(){this.showError()}});this.elLk.buttonTab.on("click",function(b){var c=a.getActiveTab();if(b.target.nodeName!=="INPUT"&&b.currentTarget.id!==c+"-tab"){a.elLk.trackPanel.find('input[name="matrix_search"]').val("");a.resetFilter()}a.toggleTab({selectElement:this,container:a.el.find("div.track-menu")});a.resize()});this.elLk.breadcrumb.on("click",function(b){a.toggleBreadcrumb(this);b.preventDefault()});this.clickSearchIcon();this.clickSubResultLink();this.showHideFilters();this.clickCheckbox(this.elLk.filterList,1);this.clearAll(this.elLk.clearAll);this.resetTracks();this.resetMatrix();a.el.on("click",function(b){if(!f(b.target).parent().closest("div").hasClass("track-popup")&&a.trackPopup){a.el.find("div.matrix-container div.xBoxes.track-on, div.matrix-container div.xBoxes.track-off").removeClass("mClick");a.trackPopup.hide()}});this.el.find(".view-track, button.showMatrix").on("click",function(){if(f(this).hasClass("_edit")||f(this).hasClass("view-track active")){a.addExtraDimensions();o.EventManager.trigger("modalClose")}});this.clickDisplayButton(this.elLk.displayButton,this.el.find("li._configure"));this.elLk.trackPanel.find('input[name="matrix_search"]').on("input",function(){var b=f(this).val().trim();if(a.resetFilter(b)){var c=a.getActiveTab(),g=new RegExp(b,"gi");b=Object.keys(a.elLk.lookup).filter(function(j){return j.match(g)&&a.elLk.lookup[j].parentTabId===c});if(b.length){var h="."+b.join(",.");b=a.elLk.lookup[b[0]].parentTab.find("li").not(h);f.each(b,function(j,l){f(l).css("display")!=="none"&&f(l).addClass("_search_hide").hide()})}else a.elLk[c].container.find("li").addClass("_search_hide").hide();a.updateAvailableTabsOrRibbons(c,true)}});if(this.disableYdim){a.el.find("h5.result-header._dyHeader, div#dy, div._dyMatrixHeader").hide();a.el.find("button.reset-button._matrix").css("margin-top","0");a.el.find("div#dy-tab").addClass("inactive").attr("title","No Experimental evidence is available for this view")}else{a.el.find("h5.result-header._dyHeader, div#dy").show();a.el.find("div#dy-tab").removeClass("inactive").attr("title","")}},modalOpen:function(){this.emptyMatrix();this.displayMatrix();this.toggleButton()},resetFilter:function(a,b){this.getActiveTabContainer().find("li._search_hide").removeClass("_search_hide");var c=this.getActiveTabContainer().find("li._filtered");c.length?c.show():this.getActiveTabContainer().find("li").show();this.updateAvailableTabsOrRibbons(this.getActiveTab(),true,b);return a&&a.length<3?0:1},updateAvailableTabsOrRibbons:function(a,b,c){var g=this,h=g.elLk[a];if(h.haveSubTabs){var j,l=[];f.each(Object.keys(g.elLk[a].tabs),function(p,m){if(h.tabs[m]){if(f(h.tabs[m]).hasClass("active"))j=m;var n=f("#"+m+"-content",g.el.trackPanel),q=0;f(h.tabs[m]).addClass("inactive");f("li",n).each(function(v,x){if(f(x).css("display")!=="none"){q=1;return false}});if(q==1){q=0;f(h.tabs[m]).removeClass("inactive");l.push(m)}g.json.data[g[a]].data[m].listType==="alphabetRibbon"&&g.activateAlphabetRibbon(n,b,c);var t=0;f("li",n).each(function(v,x){f(x).css("display")!=="none"&&t++});g.updateTrackPanelSelectAllCount(m,t)}g.updateSelectAll(n)});if(l.length&&j)if(!j||l.indexOf(j)<0)g.toggleTab({selectElement:f(h.tabs[l[0]]),container:f(h.tabs[l[0]]).parent(),searchTriggered:true})}else{g.activateAlphabetRibbon(h.container,b,c);g.updateSelectAll(h.container)}},activateAlphabetRibbon:function(a,b,c){var g,h,j=0,l=a.find(".ribbon-banner .alphabet-div");a.find(".ribbon-content .alphabet-content");var p=a.find(".ribbon-content .alphabet-content.active");f(l).removeClass("active").addClass("inactive");var m=a.find("li");m=f(m).closest(".alphabet-content");var n={};f.each(m,function(q,t){f("li",t).each(function(v,x){if(f(x).css("display")!=="none"){j=1;return false}});if(j==1){j=0;activeRibbonData=f(t).data("ribbon");h="."+activeRibbonData;g=l.not(':not("'+h+'")');g.removeClass("inactive");n[activeRibbonData]=g}});p=p.data("ribbon");b={container:a,selByClass:1,resetRibbonOffset:b,searchTriggered:true};b.resetFilter=c&&true;b.selectElement=n[p]?n[p]:n[Object.keys(n).sort()[0]];this.toggleTab(b);c=this.getActiveAlphabets(a);b=a.find(".ribbon-banner .larrow");a=a.find(".ribbon-banner .rarrow");f(b,a).removeClass("inactive active");if(c.length<=0){f(b).addClass("inactive");f(a).addClass("inactive")}else{if(f(c[0]).hasClass("active")){f(b).addClass("inactive");c.length>1&&f(a).addClass("active")}else f(b).removeClass("inactive").addClass("active");if(f(c[c.length-1]).hasClass("active")){f(a).addClass("inactive");c.length>1&&f(b).addClass("active")}else f(a).removeClass("inactive").addClass("active")}},updateSelectAll:function(a){var b=this;if(a)(f(a).find("li._filtered").length?f(a).find("li._filtered span.fancy-checkbox").not(".selected"):f(a).find("li span.fancy-checkbox").not(".selected")).length?f(a).find("div.all-box span.fancy-checkbox").removeClass("selected"):f(a).find("div.all-box span.fancy-checkbox").addClass("selected");else f.each(b.selectedTracksCount,function(c){b.selectedTracksCount[c].selected.length===b.selectedTracksCount[c].available?f("div#allBox-"+c+"-content span.fancy-checkbox").addClass("selected"):f("div#allBox-"+c+"-content span.fancy-checkbox").removeClass("selected")})},addExtraDimensions:function(){var a=this;a.json.extra_dimensions&&a.json.extra_dimensions.forEach(function(b){a.elLk.lookup[b]=a.json.data[b]})},updateConfiguration:function(){var a=this,b={},c,g=[];a.elLk.searchIcon.parent().find("input.configuration_search_text").val("");a.resetFilter("",true);a.localStoreObj.userLocation&&a.setUserLocation();if(!(Object.keys(a.localStoreObj).length<=0||!a.localStoreObj.dx)){f.each(a.json.extra_dimensions,function(h,j){a.localStoreObj[j]&&f.each(a.localStoreObj[j],function(l,p){if(l.match(/_sep_/))if(p.state){c="";g=l.split("_sep_");l=a.elLk.lookup[g[0]].set.replace(/_non_core/,"_core");c=l+"_"+a.elLk.lookup[g[1]].label;b[c]={renderer:p.state==="track-on"?"on":"off"};if(a.localStoreObj.dy&&a.localStoreObj.dy[g[0]]){c=l+"_"+a.elLk.lookup[g[1]].label+"_"+a.elLk.lookup[g[0]].label;b[c]={renderer:p.state==="track-on"?a.rendererConfig[p.renderer]:"off"}}}})});if(a.localStoreObj.matrix){f.each(a.localStoreObj.matrix,function(h,j){if(h.match(/_sep_/))if(j.state){c="";g=h.split("_sep_");h=a.elLk.lookup[g[0]].set.replace(/_non_core/,"_core");c=h+"_"+a.elLk.lookup[g[1]].label;b[c]={renderer:j.state==="track-on"?"on":"off"};if(a.localStoreObj.dy&&a.localStoreObj.dy[g[0]]){c=h+"_"+a.elLk.lookup[g[1]].label+"_"+a.elLk.lookup[g[0]].label;b[c]={renderer:j.state==="track-on"?a.rendererConfig[j.renderer]:"off"}}}});o.EventManager.trigger("changeMatrixTrackRenderers",b);f.extend(this.imageConfig,b);return{imageConfig:b}}}},updateFromTrackLabel:function(a){var b=a[0];a=a[1];if(b){var c,g;if(this.localStoreObj.epigenomic_activity&&b.match(/^reg_feat/)){c="epigenomic_activity";g=b.split(/_/).pop()}else if(this.localStoreObj.segmentation_features&&b.match(/^seg_Segmentation/)){c="segmentation_features";g=b.split(/_/).pop()}b=c+"_sep_"+g;if(a=="off"){this.localStoreObj[c][c].state.on--;this.localStoreObj[c][c].state.off++;this.localStoreObj[c][b].state="track-off"}else{this.localStoreObj[c][c].state.off--;this.localStoreObj[c][c].state.on++;this.localStoreObj[c][b].state="track-on";this.localStoreObj[c][b].renderer=a}}},getNewPanelHeight:function(){return f(this.el).closest(".modal_content.js_panel").outerHeight()-160},resize:function(){var a=this;a.elLk.resultBox.outerHeight(this.getNewPanelHeight());if(a.elLk[this.getActiveTab()].haveSubTabs){f.each(a.elLk[this.getActiveTab()].tabContentContainer,function(b,c){f("ul",c).outerHeight(a.getNewPanelHeight()-145)});a.elLk.trackPanel.find(".ribbon-content ul").outerHeight(a.getNewPanelHeight()-
190)}else a.elLk.trackPanel.find(".ribbon-content ul").outerHeight(this.getNewPanelHeight()-140);a.elLk.matrixContainer.outerHeight(this.getNewPanelHeight()-100)},getActiveTabContainer:function(){return f("div#dx-content.active, div#dy-content.active",this.el)},getActiveTab:function(){return f("div#dx-content.active span.rhsection-id, div#dy-content.active span.rhsection-id",this.el).html()},getActiveSubTab:function(){return f("div#dx-content.active .tab-content.active span.rhsection-id, div#dy-content.active .tab-content.active span.rhsection-id",this.el).html()},populateLookUp:function(){var a=this;this.elLk.dx.ribbonBanner=f(".ribbon-banner .letters-ribbon .alphabet-div",this.elLk.dx.container);this.elLk.dx.tabContents=f(".ribbon-content li",this.elLk.dx.container);this.elLk.dx.haveSubTabs=false;this.elLk.dy.haveSubTabs=true;this.elLk.dy.tabs={};this.elLk.dy.tabContents={};a.elLk.dy.tabContentContainer={};var b=f(".tabs.dy div.track-tab",this.elLk.dy.container);f.each(b,function(c,g){c=f(g).attr("id").split("-")[0]||f(g).attr("id");a.elLk.dy.tabs[c]=g;a.elLk.dy.tabContentContainer[c]=a.elLk.dy.container.find("#"+c+"-content");g=f("span.content-id",g).html();a.elLk.dy.tabContents[c]=f("div#"+g+" li",a.elLk.dy.container)})},loadState:function(){var a=this;this.loadingState=true;this.localStoreObj=this.getLocalStorage();if(Object.keys(this.localStoreObj).length){if(this.localStoreObj.dx){var b;f.each(this.localStoreObj.dx,function(g){b=a.elLk.dx.tabContents.not(":not(."+g+")");a.selectBox(b)});a.filterData(f(b).data("item"))}if(this.localStoreObj.dy){var c;f.each(this.localStoreObj.dy,function(g){c=a.elLk.lookup[g].subTab;b=a.elLk.dy.tabContents[c].filter(function(){return f(this).hasClass(g)});a.selectBox(b)});!this.localStoreObj.dx&&this.localStoreObj.dy&&a.filterData(f(b).data("item"))}a.updateRHS()}this.loadingState=false},setUserLocation:function(){if(this.localStoreObj.userLocation){this.localStoreObj.userLocation.view=this.elLk.breadcrumb.filter(".active").attr("id");this.localStoreObj.userLocation.tab=this.elLk.trackPanel.hasClass("active")?this.elLk.trackPanel.find("div.track-menu div.track-tab.active").attr("id"):"";this.setLocalStorage()}},goToUserLocation:function(){if(!f.isEmptyObject(this.localStoreObj.userLocation)){this.toggleBreadcrumb("#"+this.localStoreObj.userLocation.view);this.localStoreObj.userLocation.tab&&this.toggleTab({selectElement:"#"+this.localStoreObj.userLocation.tab,container:this.el.find("div.track-menu")})}},setDragSelectEvent:function(){var a=this;if(!this.dragSelect)this.dragSelect=new mb({elements:"li span",zone:"._drag_select_zone",onSelect:function(b){a.selectBox(b.parentElement,1);this.el=b.parentElement},stop:function(){var b=f(this.el).data("item");if(b&&a.elLk.lookup[b].parentTabId===a.getActiveTab()){a.filterData(b);a.updateRHS()}}})},clearAll:function(a){var b=this;a.on("click",function(){f.each(b.el.find("div.result-box").find("li").not(".noremove"),function(c,g){b.selectBox(g)})})},clickSearchIcon:function(){var a=this;a.elLk.searchIcon=a.el.find("img.search-icon");a.elLk.searchIcon.click("on",function(b){a.elLk.searchIcon.parents("div.search-box:visible").find("input.configuration_search_text, span.search-cross-icon").animate({width:"toggle"},350);a.elLk.searchIcon.parents("div.search-box:visible").find("input.configuration_search_text").focus();a.elLk.searchIcon.parents("div.search-box:visible").find("img.search-icon").hide();b.stopPropagation()});a.closeSearch()},closeSearch:function(){var a=this;a.elLk.searchCrossIcon=a.elLk.searchIcon.parents("div.search-box").find("span.search-cross-icon");a.elLk.searchCrossIcon.click("on",function(){a.elLk.searchIcon.parents("div.search-box:visible").find("input.configuration_search_text, span.search-cross-icon").toggle("slide",function(){a.elLk.searchIcon.parents("div.search-box:visible").find("input.configuration_search_text").val("");a.resetFilter("");a.elLk.searchIcon.parents("div.search-box:visible").find("img.search-icon").show()})})},enableConfigureButton:function(a){var b=f(a).length,c=0;f(a).each(function(g,h){f(h).find("li").length&&f(h).find("span.fancy-checkbox.selected").length&&c++});if(c===b){this.el.find("button.view-track").addClass("active");this.el.find("li._configure").removeClass("inactive");this.elLk.displayButton.addClass("active")}else{this.el.find("button.view-track").removeClass("active");this.el.find("li._configure").addClass("inactive");this.elLk.displayButton.removeClass("active")}},trackError:function(a){f(a).each(function(b,c){b="_"+f(c).attr("id");f(c).find("li").length&&f(c).find("span.fancy-checkbox.selected").length?f("span."+b).hide():f("span."+b).show()})},updateCurrentCount:function(a,b,c){if(a){f("#"+a+" span.current-count",this.elLk.resultBox).html(b);f("#"+a+" span.total",this.elLk.resultBox).html(c)}},updateTrackPanelSelectAllCount:function(a,b){a&&f("#allBox-"+a+"-content ._num").html("("+b+")")},clickCheckbox:function(a,b,c,g){var h=this,j="li";if(a[0].nodeName==="DIV")j="";f(a).off().on("click",j,function(l){h.selectBox(this);if(f(this).closest("ul.result-list").children("li").length>1)h.removeFromMatrix(f(this).data("item"));else{h.toggleButton();f(this).closest(".result-content").find(".sub-result-link").click()}var p=f(this).data("item");if(f(this).hasClass("all-box")){p=f(this).closest(".tab-content").find("li")[0];p=f(p).data("item")}h.filterData(p);h.updateRHS();if(g&&j==="li")a.find("span.fancy-checkbox.selected").length===a.find("span.fancy-checkbox").length?g.find("span.fancy-checkbox").addClass("selected"):g.find("span.fancy-checkbox").removeClass("selected");l.stopPropagation()})},removeFromMatrix:function(a){var b=this;if(a){b.elLk.trackConfiguration.find(".matrix-container ."+
a+", .matrix-container ._emptyBox_"+a).remove();var c=f.extend({},b.localStoreObj.matrix);f.each(b.json.extra_dimensions,function(g,h){f.extend(c,b.localStoreObj[h])});Object.keys(c).map(function(g){if(g.match(a+"_sep_")||g.match("_sep_"+a)){var h=b.itemDimension(g),j=b.localStoreObj[h][g].state.replace("track-",""),l=b.localStoreObj[h][g].renderer;f.each(g.split("_sep_"),function(p,m){if(m!=a){p=b.itemDimension(m);if(b.localStoreObj[p][m].total>0)b.localStoreObj[p][m].total-=1;if(b.localStoreObj[p][m].state[j]>0){b.localStoreObj[p][m].state[j]-=1;b.localStoreObj[p][m].state["reset-"+j]-=1}if(b.localStoreObj[p][m].renderer[l]>0){b.localStoreObj[p][m].renderer[l]-=1;b.localStoreObj[p][m].renderer["reset-"+l]-=1}}});delete b.localStoreObj[h][g]}});delete b.localStoreObj[b.itemDimension(a)][a];b.setLocalStorage()}},updateRHS:function(a){this.updateSelectedTracksPanel(a);this.updateShowHideLinks(a);this.setLocalStorage();this.trackError("div#dx, div#source");this.enableConfigureButton("div#dx, div#source");if(Object.keys(this.localStoreObj).length>0&&this.localStoreObj.dx){this.emptyMatrix();this.displayMatrix()}},selectBox:function(a){var b=this,c=f("span.fancy-checkbox",a),g=c.hasClass("selected");if(f(a).hasClass("all-box")){var h="";if(f(a).closest(".tab-content").find("li._filtered").length)h="._filtered";a=f(a).closest(".tab-content").find("li"+h+':not("._search_hide")');h=a.find("span.fancy-checkbox");if(g){c.removeClass("selected");h.removeClass("selected");a.removeClass("_selected")}else{c.addClass("selected");h.addClass("selected");a.addClass("_selected")}a.map(function(){b.elLk.lookup[f(this).data("item")].selected=!g})}else{c=f(a).data("item");b.elLk.lookup[c].selected=!g;a=f("."+c,b.el);g?f(a).removeClass("_selected").find("span.fancy-checkbox").removeClass("selected"):f(a).addClass("_selected").find("span.fancy-checkbox").addClass("selected");c=f(a).closest(".tab-content").find("li._filtered").length?f(a).closest(".tab-content").find("li._filtered span.fancy-checkbox").not(".selected"):f(a).closest(".tab-content").find("li span.fancy-checkbox").not(".selected");a=f(a).closest(".tab-content").find(".all-box span.fancy-checkbox");c.length?a.removeClass("selected"):a.addClass("selected")}},updateSelectedTracksPanel:function(){var a=this,b=[];this.selectedTracksCount={};this.totalSelected=0;["dx","dy"].forEach(function(h){var j,l;if(a.elLk[h].haveSubTabs)f.each(a.elLk[h].tabContents,function(p,m){j=m.has(".selected")||[];l=m.has("._filtered")||[];_search_hide=m.has("._search_hide")||[];l=l.length||m.filter(function(){return f(this).css("display")!=="none"||f(this).hasClass("_search_hide")});a.selectedTracksCount[p]=a.selectedTracksCount[p]||{};a.selectedTracksCount[p].selected=a.selectedTracksCount[p].selected||[];f(j).map(function(){a.selectedTracksCount[p].selected.push(f(this).data("item"))});a.selectedTracksCount[p].available=l.length;a.totalSelected+=j.length;a.updateCurrentCount(p,j.length,l.length);_search_hide.length&&this.updateTrackPanelSelectAllCount(h,j.length);j.length&&b.push(j)});else{j=a.elLk[h].tabContents.has(".selected")||[];l=a.elLk[h].tabContents.has("._filtered")||[];l=l.length||a.elLk[h].tabContents.filter(function(){return f(this).css("display")!=="none"||f(this).hasClass("_search_hide")});a.selectedTracksCount[h]=a.selectedTracksCount[h]||{};a.selectedTracksCount[h].selected=a.selectedTracksCount[h].selected||[];f(j).map(function(){a.selectedTracksCount[h].selected.push(f(this).data("item"))});a.selectedTracksCount[h].available=l.length;a.totalSelected+=j.length;a.updateCurrentCount(h,j.length,l.length);j.length&&b.push(j)}});var c={};f(b).each(function(h,j){f(j).each(function(l,p){l=f(p).data("item");c[l]=f(p).clone().removeClass("noremove _search_hide").show()})});a.updateSelectedTracks(c);var g=Object.keys(c);!a.loadingState&&a.addToStore(g);a.setLocalStorage()},updateSelectedTracks:function(a){var b=this;f('li:not(".noremove")',b.elLk.filterList).remove();f.each(a,function(c,g){f("#"+b.elLk.lookup[c].subTab+".result-content ul",b.el).append(g)})},setLocalStorage:function(){localStorage.setItem(this.localStorageKey,JSON.stringify(this.localStoreObj))},getLocalStorage:function(){return JSON.parse(localStorage.getItem(this.localStorageKey))||{}},addToStore:function(a){this.localStoreObj={};if(a.length){var b=this,c;f.each(a,function(g,h){c=b.elLk.lookup[h].parentTabId;b.localStoreObj[c]=b.localStoreObj[c]||{};b.localStoreObj[c][h]=1});b.localStoreObj.matrix=b.getLocalStorage().matrix||{};f.each(b.json.extra_dimensions,function(g,h){b.localStoreObj[h]=b.getLocalStorage()[h]||{}});b.localStoreObj.userLocation=b.getLocalStorage().userLocation||{}}},removeFromStore:function(a,b){if(b!=="dx")a&&b&&delete this.localStoreObj.dy[b][a];else a&&b&&delete this.localStoreObj[b][a]},clickDisplayButton:function(a,b){var c=this;a.on("click",function(){if(a.hasClass("_edit")){c.toggleTab({selectElement:c.el.find("li._configure"),container:c.el.find("div.large-breadcrumbs")});c.toggleButton()}else if(a.hasClass("active")){c.toggleTab({selectElement:b,container:c.el.find("div.large-breadcrumbs")});c.toggleButton()}c.emptyMatrix();c.displayMatrix()})},clickSubResultLink:function(){var a=this;a.el.find("div.sub-result-link").on("click",function(){var b="div#"+a.el.find(this).parent().attr("id")+"-tab",c="div#"+a.el.find(b).find("span.content-id").html(),g=a.el.find(this).parent().find("span._parent-tab-id").html();a.el.find(".track-tab.active").first().removeClass("active");a.el.find(".tab-content.active").first().removeClass("active");a.elLk.resetTrackButton.show();if(a.el.find("div#configuration-content:visible").length){a.toggleTab({selectElement:a.el.find("li._track-select"),container:a.el.find("div.large-breadcrumbs")});a.toggleButton()}if(g){g="div#"+g;var h="div#"+a.el.find(g).find("span.content-id").html();a.el.find(h+" .track-tab.active").removeClass("active");a.el.find(h+" .tab-content.active").removeClass("active");a.el.find(g).addClass("active");a.el.find(h).addClass("active");if(f(g).find("div.search-box").length){a.el.find(".search-box").hide();f(g).find("div.search-box").show()}}if(f(b).find("div.search-box").length){a.el.find(".search-box").hide();f(b).find("div.search-box").show()}a.el.find(b).addClass("active");a.el.find(c).addClass("active")})},updateShowHideLinks:function(){f.each(this.elLk.filterList,function(a,b){if(!f(b).siblings("div.show-hide:visible").length&&f("li",b).length){a=f(b).css("display")==="none"?"._show":"._hide";f(b).siblings(a).show()}else f(b).siblings("div.show-hide:visible").length&&f("li",b).length===0&&f(b).siblings("._hide, ._show").hide()})},showHideFilters:function(){var a=this;a.el.find("div.show-hide").on("click",function(){a.el.find(this).parent().find("div.show-hide, ul.result-list").toggle()})},trackTab:function(){var a=this,b=a.el.find("div#dx-content"),c=b.data("rhsection-id");a.dx=a.json.dimensions[0];a.dy=a.json.dimensions[1];var g=a.json.data[a.dx],h=a.json.data[a.dy];this.displayCheckbox({data:Object.keys(g.data),container:"div#dx-content",listType:g.listType,parentTabContainer:b,rhSectionId:c,noFilter:true});var j='<div class="tabs dy">',l="";Object.keys(h.data).sort().forEach(function(n){var q=h.data[n];delete h.data[n];h.data[n]=q});var p=0;f.each(h.data,function(n,q){var t="";if(p===0)t="active";j+='<div class="track-tab '+t+'" id="'+n+'-tab">'+q.name+'<span class="hidden content-id">'+n+"-content</span></div>";l+='<div id="'+n+'-content" class="tab-content '+t+'" data-rhsection-id="'+n+'""><span class="hidden rhsection-id">'+n+"</span></div>";p++});j+="</div>";var m=a.el.find("div#dy-content");m.append(j).append(l);c=m.data("rhsection-id");h.subtabs?f.each(h.data,function(n,q){a.displayCheckbox({data:q.data,container:"div#"+n+"-content",listType:q.listType,parentTabContainer:m,rhSectionId:c,noFilter:true,set:q.set})}):this.displayCheckbox({data:h.data,container:"div#dy-content",listType:h.listType,parentTabContainer:m,rhSectionId:c,noFilter:true});a.addRelationData();this.el.find("div.dy div.track-tab").on("click",function(){a.toggleTab({selectElement:this,container:a.el.find("div.dy")});a.resize()})},toggleTab:function(a){var b=a.selectElement,c=a.container,g=a.selByClass,h=a.resetRibbonOffset,j=a.searchTriggered,l=a.resetFilter,p=this;if(!f(b).hasClass("active")&&!f(b).hasClass("inactive")){if(f(b).find("div.search-box").length){p.el.find(".search-box").hide();f(b).find("div.search-box").show()}a=c.find(".active span.content-id").html();c.find(".active").removeClass("active");g?c.find("div."+a).removeClass("active"):p.el.find("#"+a).removeClass("active");a=f(b).find("span.content-id").html();f(b).addClass("active");activeAlphabetContentDiv=g?c.find("div."+a):p.el.find("#"+a);activeAlphabetContentDiv.addClass("active");g=f(".content-id",b).html();c=f("#"+g+" .tabs div.track-tab",p.elLk.trackPanel);if(c.length&&!c.hasClass("active"))if(c.not(".inactive").length){c=c.not(".inactive")[0];g=f(".content-id",c).html();g=f("#"+g,p.elLk.trackPanel);f(c).addClass("active");f(g).addClass("active")}h&&f(b).closest(".letters-ribbon").data({reset:true});activeAlphabetContentDiv=p.elLk.trackPanel.find("div.ribbon-content .alphabet-content.active");f.each(activeAlphabetContentDiv,function(m,n){m=f(n).closest(".tab-content").find("div.alphabet-div.active");if(f(m).closest(".letters-ribbon").data("reset")&&(f(b).hasClass("track-tab")||j)&&!l){var q=p.getActiveAlphabets().filter(function(){return f(this).hasClass("active")});q=f(m).parent().children().index(q);var t=f(m).closest(".ribbon-banner").offset();if(f(m).closest(".ribbon-banner").closest(".tab-content").css("display")!=="none"){newOffset=t.left-q*22+10;f(m).closest(".letters-ribbon").offset({left:newOffset});f(m).closest(".letters-ribbon").removeData("reset")}}m.offset()&&!l&&f(n).offset({left:m.offset().left-2})})}},toggleBreadcrumb:function(a){this.toggleTab({selectElement:a,container:this.el.find("div.large-breadcrumbs")});this.toggleButton();this.elLk.resetTrackButton.show();if(f(a).hasClass("_configure")&&!f(a).hasClass("inactive")){this.emptyMatrix();this.displayMatrix();this.elLk.resetTrackButton.hide()}},toggleButton:function(){this.el.find("div.track-configuration:visible").length?this.el.find("button.showMatrix").addClass("_edit").outerWidth("100px").html("View tracks"):this.el.find("button.showMatrix").outerWidth(this.buttonOriginalWidth).html(this.buttonOriginalHTML).removeClass("_edit")},displayCheckbox:function(a){var b=a.data,c=a.container,g=a.listType,h=a.parentTabContainer,j=a.rhSectionId,l=a.noFilter,p=a.set||"",m=this,n={},q=0;if(g&&g==="alphabetRibbon"){f.each(b.sort(),function(x,z){x=z.charAt(0).toLowerCase();n[x]||(n[x]=[]);n[x].push(z)});m.alphabetRibbon(n,c,h,j,l,p)}else{c=m.el.find(c);var t='<div class="_drag_select_zone"> <ul class="letter-content list-content">',v=c.find("span.rhsection-id").html();b=b.sort();f.each(b,function(x,z){if(z){var A=z.replace(/[^\w\-]/g,"_");t+='<li class="noremove '+A+'" data-parent-tab="'+v+'" data-item="'+A+'"><span class="fancy-checkbox"></span><text>'+
z+"</text></li>"}q++;m.elLk.lookup[A]={label:z,parentTab:h,parentTabId:j,subTab:v,selected:false,set:p||""}});t+="</ul></div>";t='<div class="content-wrapper"><div class="all-box list-all-box" id="allBox-'+f(c).attr("id")+'"><span class="fancy-checkbox"></span>Select all<text class="_num">('+q+")</text></div>"+t+"</div>";c.append(t);f.each(b,function(x,z){if(z){x=z.replace(/[^\w\-]/g,"_");m.elLk.lookup[x].el=c.find("."+x)}});m.el.find("div#"+v+" span.total").html(q);m.clickCheckbox(c.find("div.all-box"))}},addRelationData:function(){var a=this;f.each(a.json.data[a.dx].data,function(b,c){var g=b.replace(/[^\w\-]/g,"_");a.elLk.lookup[g].data=c;var h="";f.each(c,function(j,l){j=l.val.replace(/[^\w\-]/g,"_");h+=j+" ";(l=a.el.find("li."+j).attr("data-filter"))?a.el.find("li."+j).attr("data-filter",l+" "+g):a.el.find("li."+j).attr("data-filter",g);a.el.find("li."+j).attr("data-filtercontainer")||a.el.find("li."+j).attr("data-filtercontainer","dx-content")});a.el.find("li."+g).attr("data-filter",h).attr("data-filtercontainer","dy-content")})},filterData:function(a){if(a){var b=f(this.elLk.lookup[a].parentTab,this.el),c="#"+f("."+a,this.elLk.trackPanel).data("filtercontainer"),g=this.el.find(c).find("li"),h={};b.find("li span.fancy-checkbox.selected").parent().map(function(){f(this).data("filter")&&f(this).data("filter").split(" ").map(function(l){if(l!=="")h[l]=1})});g.hide();b="";if(Object.keys(h).length){b="li."+Object.keys(h).join(", li.");var j=this.elLk.trackPanel.find(c).find("li._selected");this.elLk.trackPanel.find(c).find(b).addClass("_filtered").show();f(j).addClass("_filtered").show();g.not("._filtered").find("span.fancy-checkbox").removeClass("selected")}else g.removeClass("_filtered").show();this.updateAvailableTabsOrRibbons({dx:"dy",dy:"dx"}[this.elLk.lookup[a].parentTabId],true)}},getActiveAlphabets:function(a){a=a||this.getActiveTabContainer();return f(a).find(".ribbon-banner div.alphabet-div").not(".inactive")},alphabetRibbon:function(a,b,c,g,h,j){var l=this,p="",m="",n=0;b=l.el.find(b);var q=b.find("span.rhsection-id").html();f.each(new Array(26),function(t){var v=String.fromCharCode(t+97),x="",z="";if(t===0)x="active";if(a[v]&&a[v].length){z='<ul class="letter-content">';f.each(a[v],function(A,B){n++;A=B.replace(/[^\w\-]/g,"_");z+='<li class="noremove '+A+'" data-parent-tab="'+q+'" data-item="'+A+'"><span class="fancy-checkbox"></span><text>'+B+"</text></li>";l.elLk.lookup[A]={label:B,parentTab:c,parentTabId:g,subTab:q,selected:false,set:j}});z+="</ul>"}else x="inactive";p+='<div class="ribbon_'+v+" alphabet-div "+x+'">'+v.toUpperCase()+
'<span class="hidden content-id">'+v+"_content</span></div>";m+='<div data-ribbon="ribbon_'+v+'" class="'+v+"_content alphabet-content "+x+'">'+z+"</div>"});b.append('<div class="all-box '+(h?"no-filter":"")+'" id="allBox-'+f(b).attr("id")+'"><span class="fancy-checkbox"></span>Select all<text>(A-Z)</text></div><div class="cell-listing _drag_select_zone"><div class="ribbon-banner"><div class="larrow inactive">&#x25C0;</div><div class="alpha-wrapper"><div class="letters-ribbon"></div></div><div class="rarrow">&#x25B6;</div></div><div class="ribbon-content"></div></div>');b.find("div.letters-ribbon").append(p);b.find("div.ribbon-content").append(m);f.each(new Array(26),function(t){t=String.fromCharCode(t+97);a[t]&&a[t].length&&f.each(a[t],function(v,x){n++;v=x.replace(/[^\w\-]/g,"_");l.elLk.lookup[v].el=b.find("."+v)})});l.el.find("div#"+q+" span.total").html(n);l.clickCheckbox(b.find("div.all-box"));b.find("div.alphabet-div").on("mousedown",function(){f(b,l.el).hasClass("active")&&f.when(l.toggleTab({selectElement:this,container:b,selByClass:1})).then(l.selectArrow(b))})},selectArrow:function(a){var b=this.getActiveAlphabets(a),c=f(b.get(0)).html().charAt(0),g=f(b.get(-1)).html().charAt(0);if(b.length)if(f("div.alphabet-div.active",a).html().match(c)){f("div.larrow",a).removeClass("active").addClass("inactive");f("div.rarrow",a).removeClass("inactive").addClass("active")}else if(f("div.alphabet-div.active",a).html().match(g)){f("div.rarrow",a).removeClass("active").addClass("inactive");f("div.larrow",a).removeClass("inactive").addClass("active")}else f("div.larrow, div.rarrow",a).removeClass("inactive").addClass("active")},registerRibbonArrowEvents:function(){var a=this;a.elLk.arrows=f("div.rarrow, div.larrow",a.elLk.trackPanel);a.elLk.arrows.off().on("mousedown",function(b){container=f(b.target).closest(".tab-content");var c=container.find(".letters-ribbon"),g=container.find(".ribbon-content"),h=a.getActiveAlphabets(container),j=h.filter(function(){return f(this).hasClass("active")}),l=h.index(j);j=j.html().charAt(0).toLowerCase();var p=a.getActiveTab()+"-tab";if(f(container).hasClass("active")||f("#"+p,a.elLk.trackPanel).hasClass("active"))if(!this.className.match(/inactive/gi)){if(this.className.match(/larrow/gi)){if(!h[l-1])return;var m=f(h[l-1]).html().charAt(0).toLowerCase();p=j.charCodeAt(0)-m.charCodeAt(0);f.when(a.toggleTab({selectElement:c.find("div.ribbon_"+m),container:container,selByClass:1})).then(a.selectArrow(container));if(c.find(".ribbon_"+m).offset().left<=f(b.target).offset().left+22){c.offset({left:c.offset().left+22*p});m=g.find("div."+m+"_content.alphabet-content");m.offset({left:m.offset().left+22*p})}c.find(".ribbon_a").offset().left>f(b.target).offset().left+22&&a.activateAlphabetRibbon(container,true)}if(this.className.match(/rarrow/gi))if(h[l+1]){h=f(h[l+1]).html().charAt(0).toLowerCase();p=h.charCodeAt(0)-j.charCodeAt(0);f.when(a.toggleTab({selectElement:c.find("div.ribbon_"+h),container:container,selByClass:1})).then(a.selectArrow(container));if(c.find(".ribbon_"+h).offset().left>=f(b.target).offset().left-44){c.offset({left:c.offset().left-22*p});b=g.find("div."+h+"_content.alphabet-content");b.offset({left:b.offset().left-22*p})}}}})},itemDimension:function(a){if(a.match("_sep_"))a=a.split("_sep_")[0];return this.json.extra_dimensions.indexOf(a)>=0?this.json.extra_dimensions[this.json.extra_dimensions.indexOf(a)]:"matrix"},displayMatrix:function(){var a=this;if(!f.isEmptyObject(a.localStoreObj)){a.trackPopup=a.el.find("div.track-popup");var b='<div  class="xContainer">',c=a.localStoreObj.dy?Object.keys(a.localStoreObj.dy):[];a.localStoreObj.dy&&c.unshift("");a.json.extra_dimensions.sort().reverse().forEach(function(l){c.unshift(l)});f.each(c,function(l,p){l=a.elLk.lookup[p]?a.elLk.lookup[p].label:p;if(p===""&&!a.disableYdim)b+='<div class="xLabel x-label-gap">'+l+"</div>";else{a.localStoreObj[a.itemDimension(p)][p]||(a.localStoreObj[a.itemDimension(p)][p]={total:0,state:{on:0,off:0,"reset-on":0,"reset-off":0},renderer:{peak:0,"peak-signal":0,signal:0,normal:0,"reset-peak":0,"reset-peak-signal":0,"reset-signal":0,"reset-normal":0}});if(a.disableYdim){if(p==="epigenomic_activity"||p==="segmentation_features")b+='<div class="xLabel '+p+'">'+l+"</div>"}else b+='<div class="xLabel '+p+'">'+l+"</div>"}});b+="</div>";a.el.find("div.matrix-container").append(b);var g='<div class="yContainer">',h='<div class="boxContainer">';f.each(a.localStoreObj.dx,function(l){var p=a.elLk.lookup[l].label||l,m=0,n=0,q=0,t=0;if(!a.localStoreObj[a.itemDimension(l)][l])if(a.itemDimension(l)==="matrix")a.localStoreObj[a.itemDimension(l)][l]={total:0,state:{on:0,off:0,"reset-on":0,"reset-off":0},renderer:{peak:0,signal:0,normal:0,"peak-signal":0,"reset-peak":0,"reset-peak-signal":0,"reset-signal":0}};g+='<div class="yLabel _ht '+l+'" title="'+l+'">'+p+"</div>";var v='<div class="rowContainer">';f.each(c,function(x,z){if(z===""&&!a.disableYdim)v+='<div class="xBoxes _emptyBox_'+l+'"></div>';else{var A="",B="",C="peak-signal",F="",P="",K=z+"_sep_"+l,Q,O,G=a.itemDimension(K),I=a.itemDimension(z);x=G==="matrix"?G:"";if(a.localStoreObj[G][K]){A=a.localStoreObj[G][K].state;B=a.localStoreObj[G][K].renderer;C=a.localStoreObj[G][K].popupType||C;P="render-"+B;F="_hasData"}else f.each(a.json.data[a.dx].data[p],function(J,M){if(M.val.replace(/[^\w\-]/g,"_").toLowerCase()===z.toLowerCase()){F="_hasData";O=M.dimension;C=a.json.data[O].popupType||C;Q=a.json.data[O].renderer;A=M.defaultState||a.elLk.lookup[z].defaultState;B=Q||a.elLk.lookup[z].renderer;P="render-"+B;a.localStoreObj[G][K]={state:A,renderer:B,popupType:C,"reset-state":A,"reset-renderer":B};a.localStoreObj[I][z].total+=1;a.localStoreObj[I][z].renderer[B]+=1;a.localStoreObj[I][z].renderer["reset-"+B]+=1;a.localStoreObj[I][z].state[A.replace("track-","")]++;a.localStoreObj[I][z].state["reset-"+A.replace("track-","")]++;if(a.json.extra_dimensions.indexOf(z)===-1){m++;n++;if(A==="track-on")q++;else t++}}});if(a.disableYdim){if(z==="epigenomic_activity"||z==="segmentation_features")v+='<div class="xBoxes '+A+" "+x+" "+P+" "+F+" "+l+" "+z+'" data-track-x="'+z+'" data-track-y="'+l+'" data-popup-type="'+C+'"></div>'}else v+='<div class="xBoxes '+A+" "+x+" "+
P+" "+F+" "+l+" "+z+'" data-track-x="'+z+'" data-track-y="'+l+'" data-popup-type="'+C+'"></div>'}});a.localStoreObj.matrix[l].total+=m;a.localStoreObj.matrix[l].state.on+=q;a.localStoreObj.matrix[l].state["reset-on"]+=q;a.localStoreObj.matrix[l].state.off+=t;a.localStoreObj.matrix[l].state["reset-off"]+=t;a.localStoreObj.matrix[l].renderer["peak-signal"]+=n;a.localStoreObj.matrix[l].renderer["reset-peak-signal"]+=n;v+="</div>";h+=v});g+="</div>";h+="</div>";var j='<div class="yBoxWrapper">'+g+h+"</div>";a.el.find("div.matrix-container").append(j);j=c.length*32;a.el.find("div.matrix-container .xContainer, div.matrix-container .yBoxWrapper").width(j);a.cellClick();a.cleanMatrixStore();a.setLocalStorage();this.elLk.matrixContainer.find("._ht").helptip({position:{at:"right center",using:function(l,p){l.left-=20;f(this).removeClass("helptip-top helptip-bottom helptip-middle").addClass("helptip-"+p.vertical).css(l)}}})}},emptyMatrix:function(){this.el.find("div.matrix-container").html("")},cleanMatrixStore:function(){var a=this,b=f.extend({},a.localStoreObj.dy);f.map(a.json.extra_dimensions,function(c){b[c]=1});f.each(f.merge(["matrix"],a.json.extra_dimensions),function(c,g){f.each(a.localStoreObj[g],function(h){h.match("_sep_")||!b[h]&&!a.localStoreObj.dx[h]&&a.removeFromMatrix(h)})})},resetMatrix:function(){var a=this;this.elLk.resetMatrixButton=a.elLk.trackConfiguration.find("button.reset-button._matrix");this.elLk.resetMatrixButton.click("on",function(){var b=f.extend({},a.localStoreObj.matrix);f.each(a.json.extra_dimensions,function(c,g){f.extend(b,a.localStoreObj[g])});Object.keys(b).map(function(c){var g=a.itemDimension(c);if(c.match("_sep_")){var h=b[c].state,j=b[c].renderer,l=b[c]["reset-state"],p=b[c]["reset-renderer"];a.elLk.matrixContainer.find("div.xBoxes."+c.split("_sep_")[0]+"."+c.split("_sep_")[1]).removeClass(h).addClass(l);a.elLk.matrixContainer.find("div.xBoxes."+c.split("_sep_")[0]+"."+c.split("_sep_")[1]).removeClass("render-"+j).addClass("render-"+p);a.localStoreObj[g][c].state=l;a.localStoreObj[g][c].renderer=p}else{a.localStoreObj[g][c].state.on=b[c].state["reset-on"];a.localStoreObj[g][c].state.off=b[c].state["reset-off"];a.localStoreObj[g][c].renderer.peak=b[c].renderer["reset-peak"];a.localStoreObj[g][c].renderer.signal=b[c].renderer["reset-signal"];a.localStoreObj[g][c].renderer["peak-signal"]=b[c].renderer["reset-peak-signal"];a.localStoreObj[g][c].renderer.normal=b[c].renderer["reset-normal"]}})})},resetTracks:function(){var a=this;this.elLk.resetTrackButton=a.elLk.resultBox.find("button.reset-button._track");this.elLk.resetTrackButton.click("on",function(){a.localStoreObj.dx={};a.localStoreObj.dy={};a.localStoreObj.matrix={};a.setLocalStorage();a.emptyMatrix();a.resetFilter();f.each(a.el.find("div.result-box").find("li").not(".noremove"),function(b,c){a.selectBox(c);a.filterData(f(c).data("item"))});a.updateRHS()})},cellClick:function(){var a=this;a.elLk.rowContainer=this.elLk.matrixContainer.find("div.rowContainer");a.popupType="";a.TrackPopupType="";a.xLabel="";a.yLabel="";a.xName="";a.yName="";a.boxObj="";a.el.find("div.matrix-container div.xBoxes.track-on, div.matrix-container div.xBoxes.track-off").on("click",function(b){a.el.find("div.matrix-container div.xBoxes.track-on.mClick, div.matrix-container div.xBoxes.track-off.mClick").removeClass("mClick");a.trackPopup.hide();a.boxObj=f(this);a.popupType=f(this).data("popup-type");a.TrackPopupType=a.el.find("div.track-popup."+a.popupType);a.xName=f(this).data("track-x");a.yName=f(this).data("track-y");a.xLabel=f(a.elLk.rowContainer.find("div.xLabel."+
a.xName));a.yLabel=f(a.elLk.rowContainer.find("div.yLabel."+a.yName));a.cellKey=a.xName+"_sep_"+a.yName;a.cellStateKey=a.itemDimension(a.cellKey)||"";a.dyStateKey=a.itemDimension(a.yName)||"";a.dxStateKey=a.itemDimension(a.xName)||"";var c=a.localStoreObj[a.cellStateKey][a.cellKey].state,g=a.localStoreObj[a.cellStateKey][a.cellKey].renderer,h=a.localStoreObj[a.dyStateKey][a.yName].state.off===a.localStoreObj[a.dyStateKey][a.yName].total?"track-off":"track-on",j=a.localStoreObj[a.dxStateKey][a.xName].state.off===a.localStoreObj[a.dxStateKey][a.xName].total?"track-off":"track-on";j=a.localStoreObj[a.dxStateKey][a.xName].state.off===a.localStoreObj[a.dxStateKey][a.xName].total?"track-off":a.localStoreObj[a.dxStateKey][a.xName].state.on===a.localStoreObj[a.dxStateKey][a.xName].total?"track-on":"track-off";var l="";f.map(a.localStoreObj[a.dyStateKey][a.yName].renderer,function(m,n){if(!n.match("reset-")&&m===a.localStoreObj[a.dyStateKey][a.yName].total)l=n});var p="";f.map(a.localStoreObj[a.dxStateKey][a.xName].renderer,function(m,n){if(!n.match("reset-")&&m===a.localStoreObj[a.dxStateKey][a.xName].total)p=n});f(this).addClass("mClick");j==="track-on"?a.TrackPopupType.find('ul li label.switch input[name="column-switch"]').prop("checked",true):a.TrackPopupType.find('ul li label.switch input[name="column-switch"]').prop("checked",false);p?a.TrackPopupType.find("ul li input[name=column-radio]._"+p).prop("checked",true):a.TrackPopupType.find("ul li input[name=column-radio]").prop("checked",false);h==="track-on"?a.TrackPopupType.find('ul li label.switch input[name="row-switch"]').prop("checked",true):a.TrackPopupType.find('ul li label.switch input[name="row-switch"]').prop("checked",false);l?a.TrackPopupType.find("ul li input[name=row-radio]._"+l).prop("checked",true):a.TrackPopupType.find("ul li input[name=row-radio]").prop("checked",false);c==="track-on"?a.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').prop("checked",true):a.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').prop("checked",false);g?a.TrackPopupType.find("ul li input[name=cell-radio]._"+
g).prop("checked",true):a.TrackPopupType.find("ul li input[name=cell-radio]").prop("checked",false);a.TrackPopupType.attr("data-track-x",f(this).data("track-x")).attr("data-track-y",f(this).data("track-y")).css({top:f(this)[0].offsetTop-f("div.matrix-container")[0].scrollTop+15,left:f(this)[0].offsetLeft-f("div.matrix-container")[0].scrollLeft+15}).show();a.popupFunctionality();b.stopPropagation()})},updateTrackStore:function(a,b,c,g,h,j){var l=this,p=c?"state":"renderer",m=c?c.replace("track-",""):h,n=g?g.replace("track-",""):j,q=l.itemDimension(b);if(b.match("_sep_")){a[p]=c?c:h;f.each(b.split("_sep_"),function(t,v){if(l.localStoreObj[l.dxStateKey][v][p][m]<l.localStoreObj[l.dxStateKey][v].total)l.localStoreObj[l.dxStateKey][v][p][m]+=1;if(l.localStoreObj[l.dxStateKey][v][p][n]>0)l.localStoreObj[l.dxStateKey][v][p][n]-=1;if(q!="matrix")return false})}else{f.each(a[p],function(t){if(t===m)a[p][t]=a.total;else t.match("reset-")||(a[p][t]=0)});Object.keys(l.localStoreObj[q]).filter(function(t){if(t.match(b)&&t.match("_sep_")){q==="matrix"&&f.grep(t.split("_sep_"),function(v){var x=l.localStoreObj[q][t][p],z=c?c:h;x=x.replace("track-","");z=z.replace("track-","");if(v!=b&&x!=z){if(l.localStoreObj[q][v][p][m]<l.localStoreObj[q][v].total)l.localStoreObj[q][v][p][m]+=1;if(l.localStoreObj[q][v][p][x]>0)l.localStoreObj[q][v][p][x]-=1}});l.localStoreObj[q][t][p]=c?c:h}})}l.setLocalStorage()},popupFunctionality:function(){var a=this;a.TrackPopupType.find("ul li label.switch input[type=checkbox]").off().on("click",function(b){var c=f(this).attr("name"),g=f(this).is(":checked")?"track-on":"track-off",h=g==="track-on"?"track-off":"track-on",j=false;if(c==="column-switch"){a.elLk.rowContainer.find("div.xBoxes."+a.xName+"."+h).removeClass(h).addClass(g);a.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').prop("checked",g==="track-on"?true:false);a.updateTrackStore(a.localStoreObj[a.dxStateKey][a.xName],a.xName,g,h);j=a.localStoreObj[a.dxStateKey][a.xName]&&a.localStoreObj[a.dxStateKey][a.xName].state.on===a.localStoreObj[a.dxStateKey][a.xName].total;a.TrackPopupType.find('ul li label.switch input[name="row-switch"]').prop("checked",j)}else{if(c==="row-switch"){a.elLk.rowContainer.find("div.xBoxes.matrix."+a.yName+"."+h).removeClass(h).addClass(g);a.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').prop("checked",g==="track-on"?true:false);a.updateTrackStore(a.localStoreObj[a.dxStateKey][a.yName],a.yName,g,h);j=a.localStoreObj[a.dxStateKey][a.xName]&&a.localStoreObj[a.dxStateKey][a.xName].state.on===a.localStoreObj[a.dxStateKey][a.xName].total}else{a.boxObj.removeClass(h).addClass(g);c=a.xName+"_sep_"+a.yName;a.updateTrackStore(a.localStoreObj[a.dxStateKey][c],c,g,h);var l,p;if(a.localStoreObj[a.dyStateKey][a.yName])p=a.localStoreObj[a.dyStateKey][a.yName];if(a.localStoreObj[a.dyStateKey][a.xName])l=a.localStoreObj[a.dyStateKey][a.xName];else if(a.localStoreObj[a.xName][a.xName])l=a.localStoreObj[a.xName][a.xName];j=p.state.on===p.total;a.TrackPopupType.find('ul li label.switch input[name="row-switch"]').prop("checked",j);j=l.state.on===l.total}a.TrackPopupType.find('ul li label.switch input[name="column-switch"]').prop("checked",j)}b.stopPropagation()});a.TrackPopupType.find("ul li input[type=radio]").off().on("change",function(b){a.updateRenderer(f(this));b.stopPropagation()})},updateRenderer:function(a){var b=a.attr("name");a=a.attr("class").replace(/^_/,"");var c=this.localStoreObj.matrix[this.cellKey].renderer,g=b==="column-radio"?this.xName:this.yName,h=this.itemDimension(this.xName);if(b==="column-radio"||b==="row-radio"){this.TrackPopupType.find("ul li input[name=cell-radio]._"+a).prop("checked",true);this.elLk.rowContainer.find("div.xBoxes._hasData."+g+(b==="row-radio"?".matrix":"")).removeClass(function(j,l){return(l.match(/(^|\s)render-\S+/g)||[]).join(" ")}).addClass("render-"+a);this.updateTrackStore(this.localStoreObj[h][g],g,"","",a,c)}else{this.boxObj.removeClass("render-"+c).addClass("render-"+a);this.updateTrackStore(this.localStoreObj[h][this.cellKey],this.cellKey,"","",a,c)}this.localStoreObj[this.dxStateKey][this.xName].renderer[a]===this.localStoreObj[this.dxStateKey][this.xName].total?this.TrackPopupType.find("ul li input[name=column-radio]._"+a).prop("checked",true):this.TrackPopupType.find("ul li input[name=column-radio]").prop("checked",false);this.localStoreObj[this.dyStateKey][this.yName].renderer[a]===this.localStoreObj[this.dyStateKey][this.yName].total?this.TrackPopupType.find("ul li input[name=row-radio]._"+a).prop("checked",true):this.TrackPopupType.find("ul li input[name=row-radio]").prop("checked",false)}});o.Panel.ManageData=o.Panel.ModalContent.extend({init:function(){var a=this;this.base();this.elLk.table=this.el.find("#ManageDataTable");this.el.find("._mu_button").each(function(){f(this).on({click:function(){a.elLk.url=f(this).attr("href");a.elLk.table.find(".mass_update").each(function(){if(f(this).is(":checked"))a.elLk.url+=";record="+f(this).val()});f(this).attr("href",a.elLk.url)}})});this.elLk.selectAll=this.el.find("#selectAllFiles");this.elLk.selectAll.on({click:function(){a.elLk.table.find(".mass_update").each(function(){a.elLk.selectAll.is(":checked")?f(this).prop("checked",true):f(this).prop("checked",false)})}})}});o.Panel.SiteGallery=o.Panel.Content.extend({init:function(){this.base.apply(this,arguments);this.stickyMenu();this.el.find(".embiggen").each(function(){f(this).on({mouseover:function(){f(this).addClass("zoom")}});f(this).on({mouseout:function(){f(this).removeClass("zoom")}});f(this).on({click:function(){var a=f(this).next();a.removeClass("hide");var b=a.width()-225;b>0&&a.css("right",b+"px")}});f(this).next().children(":first").on({click:function(){f(this).parent().addClass("hide")}})})},stickyMenu:function(){if(!this.elLk.menuBar)this.elLk.menuBar=this.el.find("#gallery-toc");this.elLk.menuBar.keepOnPage({marginTop:10,onreset:function(){f(this).removeClass("sticky")},onfix:function(){f(this).addClass("sticky")}}).keepOnPage("trigger")}});o.Panel.SiteGalleryHome=o.Panel.Content.extend({init:function(){this.base.apply(this,arguments);this.elLk.form=this.el.find("form[name=gallery_home]").remove(".js_param");this.elLk.dataType=this.elLk.form.find("input[name=data_type]");this.elLk.identifier=this.elLk.form.find("input[name=identifier]");this.elLk.species=this.elLk.form.find("select[name=species]");this.formAction=this.elLk.form.attr("action");this.initSelectToToggle();this.updateIdentifier();this.elLk.dataType.add(this.elLk.species).on("change",{panel:this},function(a){a.data.panel.updateIdentifier()});this.geneCache={};this.geneIDCache={};this.elLk.identifier.on("focus",{panel:this},function(a){a.data.panel.autocompleteGene()})},initSelectToToggle:function(){var a=this;this.elLk.species.find("option").addClass(function(){return a.params.sample_data[this.value].variation?"_stt__var":"_stt__novar"});this.elLk.dataType.parent().addClass(function(){return f(this).find("[value=variation]").length?"_stt_var":"_stt_var _stt_novar"});this.elLk.species.selectToToggle()},updateIdentifier:function(){var a=this.elLk.species.val();this.elLk.dataType.filter(":visible:checked").length||this.elLk.dataType.filter(":visible").first().prop("checked",true);this.elLk.identifier.val((this.params.sample_data[a]||{})[this.elLk.dataType.filter(":checked").val()]||"");this.elLk.form.attr("action",this.formAction.replace("Multi",a))},autocompleteGene:function(){var a=this;this.elLk.identifier.autocomplete({minLength:3,source:function(b,c){var g={panel:a,term:b.term,key:b.term.substr(0,3).toUpperCase(),callback:function(h,j){var l=new RegExp("^"+f.ui.autocomplete.escapeRegex(h),"i");return c(f.map(j,function(p,m){return l.test(m)?p.label:null}))}};if(g.key in a.geneCache)return g.callback(b.term,a.geneCache[g.key]);f.ajax({url:o.speciesPath+"/Ajax/autocomplete",cache:true,data:{q:g.key,species:a.elLk.species.val()},dataType:"json",context:g,success:function(h){this.panel.geneCache[this.key]=h},complete:function(){return this.callback(this.term,this.panel.geneCache[this.key])}})}})}});"console"in D?function(){if(!D.console.time){D._timerCache={};D.console.time=function(a){D._timerCache[a]=(new Date).getTime()};D.console.timeEnd=function(a){console.log(a+": "+((new Date).getTime()-D._timerCache[a])+"ms");delete D._timerCache[a]}}}():function(){var a=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];D.console={};for(var b=0;b<a.length;b++)D.console[a[b]]=f.noop}();D.addLoadEvent=function(a){o.extend({initialize:function(){this.base();a()}})};f(function(){D.JSON?o.initialize():f.getScript("/components/json2.js",function(){o.initialize()})});if(!this.JSON)this.JSON={};(function(){function a(n){return n<10?"0"+n:n}function b(n){h.lastIndex=0;return h.test(n)?'"'+n.replace(h,function(q){var t=p[q];return typeof t==="string"?t:"\\u"+("0000"+q.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function c(n,q){var t,v,x=j,z,A=q[n];if(A&&typeof A==="object"&&typeof A.toJSON==="function")A=A.toJSON(n);if(typeof m==="function")A=m.call(q,n,A);switch(typeof A){case"string":return b(A);case"number":return isFinite(A)?String(A):"null";case"boolean":case"null":return String(A);case"object":if(!A)return"null";j+=l;z=[];if(Object.prototype.toString.apply(A)==="[object Array]"){v=A.length;for(n=0;n<v;n+=1)z[n]=c(n,A)||"null";q=z.length===0?"[]":j?"[\n"+j+z.join(",\n"+j)+"\n"+x+"]":"["+z.join(",")+"]";j=x;return q}if(m&&typeof m==="object"){v=m.length;for(n=0;n<v;n+=1){t=m[n];if(typeof t==="string")if(q=c(t,A))z.push(b(t)+(j?": ":":")+q)}}else for(t in A)if(Object.hasOwnProperty.call(A,t))if(q=c(t,A))z.push(b(t)+(j?": ":":")+q);q=z.length===0?"{}":j?"{\n"+j+z.join(",\n"+j)+"\n"+x+"}":"{"+z.join(",")+"}";j=x;return q}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var g=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j,l,p={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;if(typeof JSON.stringify!=="function")JSON.stringify=function(n,q,t){var v;l=j="";if(typeof t==="number")for(v=0;v<t;v+=1)l+=" ";else if(typeof t==="string")l=t;if((m=q)&&typeof q!=="function"&&(typeof q!=="object"||typeof q.length!=="number"))throw new Error("JSON.stringify");return c("",{"":n})};if(typeof JSON.parse!=="function")JSON.parse=function(n,q){function t(v,x){var z,A,B=v[x];if(B&&typeof B==="object")for(z in B)if(Object.hasOwnProperty.call(B,z)){A=t(B,z);if(A!==U)B[z]=A;else delete B[z]}return q.call(v,x,B)}n=String(n);g.lastIndex=0;if(g.test(n))n=n.replace(g,function(v){return"\\u"+("0000"+v.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){n=eval("("+n+")");return typeof q==="function"?t({"":n},""):n}throw new SyntaxError("JSON.parse");}})();if(!this.sh_languages)this.sh_languages={};var Ga={};if(!this.sh_languages)this.sh_languages={};sh_languages.perl=[[[/\b(?:import)\b/g,"sh_preproc",-1],[/(s)(\{(?:\\\}|[^}])*\}\{(?:\\\}|[^}])*\})([ixsmogce]*)/g,["sh_keyword","sh_regexp","sh_keyword"],-1],[/(s)(\((?:\\\)|[^)])*\)\((?:\\\)|[^)])*\))([ixsmogce]*)/g,["sh_keyword","sh_regexp","sh_keyword"],-1],[/(s)(\[(?:\\\]|[^\]])*\]\[(?:\\\]|[^\]])*\])([ixsmogce]*)/g,["sh_keyword","sh_regexp","sh_keyword"],-1],[/(s)(<.*><.*>)([ixsmogce]*)/g,["sh_keyword","sh_regexp","sh_keyword"],-1],[/(q(?:q?))(\{(?:\\\}|[^}])*\})/g,["sh_keyword","sh_string"],-1],[/(q(?:q?))(\((?:\\\)|[^)])*\))/g,["sh_keyword","sh_string"],-1],[/(q(?:q?))(\[(?:\\\]|[^\]])*\])/g,["sh_keyword","sh_string"],-1],[/(q(?:q?))(<.*>)/g,["sh_keyword","sh_string"],-1],[/(s)\/([^A-Za-z0-9 \t])(.*\2.*\2)([ixsmogce]*(?=[ \t]*(?:\)|;)))/g,["sh_keyword","sh_regexp","sh_regexp","sh_keyword"],-1],[/(s)\/([^A-Za-z0-9 \t])(.*\2[ \t]*)([^A-Za-z0-9 \t])(.*\4)([ixsmogce]*(?=[ \t]*(?:\)|;)))/g,["sh_keyword","sh_regexp","sh_regexp","sh_regexp","sh_regexp","sh_keyword"],-1],[/#/g,"sh_comment",1],[/\b[+-]?(?:(?:0x[A-Fa-f0-9]+)|(?:(?:[\d]*\.)?[\d]+(?:[eE][+-]?[\d]+)?))u?(?:(?:int(?:8|16|32|64))|L)?\b/g,"sh_number",-1],[/(?:m|qr)(?=\{)/g,"sh_keyword",2],[/(?:m|qr)(?=#)/g,"sh_keyword",4],[/(?:m|qr)(?=\|)/g,"sh_keyword",6],[/(?:m|qr)(?=@)/g,"sh_keyword",8],[/(?:m|qr)(?=<)/g,"sh_keyword",10],[/(?:m|qr)(?=\[)/g,"sh_keyword",12],[/(?:m|qr)(?=\\)/g,"sh_keyword",14],[/(?:m|qr)(?=\/)/g,"sh_keyword",16],[/"/g,"sh_string",18],[/'/g,"sh_string",19],[/</g,"sh_string",20],[/\/[^\n]*\//g,"sh_string",-1],[/\b(?:chomp|chop|chr|crypt|hex|i|index|lc|lcfirst|length|oct|ord|pack|q|qq|reverse|rindex|sprintf|substr|tr|uc|ucfirst|m|s|g|qw|abs|atan2|cos|exp|hex|int|log|oct|rand|sin|sqrt|srand|my|local|our|delete|each|exists|keys|values|pack|read|syscall|sysread|syswrite|unpack|vec|undef|unless|return|length|grep|sort|caller|continue|dump|eval|exit|goto|last|next|redo|sub|wantarray|pop|push|shift|splice|unshift|split|switch|join|defined|foreach|last|chop|chomp|bless|dbmclose|dbmopen|ref|tie|tied|untie|while|next|map|eq|die|cmp|lc|uc|and|do|if|else|elsif|for|use|require|package|import|chdir|chmod|chown|chroot|fcntl|glob|ioctl|link|lstat|mkdir|open|opendir|readlink|rename|rmdir|stat|symlink|umask|unlink|utime|binmode|close|closedir|dbmclose|dbmopen|die|eof|fileno|flock|format|getc|print|printf|read|readdir|rewinddir|seek|seekdir|select|syscall|sysread|sysseek|syswrite|tell|telldir|truncate|warn|write|alarm|exec|fork|getpgrp|getppid|getpriority|kill|pipe|qx|setpgrp|setpriority|sleep|system|times|x|wait|waitpid)\b/g,"sh_keyword",-1],[/^\=(?:head1|head2|item)/g,"sh_comment",21],[/(?:\$[#]?|@|%)[\/A-Za-z0-9_]+/g,"sh_variable",-1],[/(->)((?:[A-Za-z]|_)[A-Za-z0-9_]*)(?=[ \t]*\(?)/g,["sh_symbol","sh_function"],-1],[/~|!|%|\^|\*|\(|\)|-|\+|=|\[|\]|\\|:|;|,|\.|\/|\?|&|<|>|\|/g,"sh_symbol",-1],[/\{|\}/g,"sh_cbracket",-1]],[[/$/g,null,-2]],[[/\{/g,"sh_regexp",3]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\\{|\\\}|\}/g,"sh_regexp",-3]],[[/#/g,"sh_regexp",5]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\#|#/g,"sh_regexp",-3]],[[/\|/g,"sh_regexp",7]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\\||\|/g,"sh_regexp",-3]],[[/@/g,"sh_regexp",9]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\@|@/g,"sh_regexp",-3]],[[/</g,"sh_regexp",11]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\<|\\>|>/g,"sh_regexp",-3]],[[/\[/g,"sh_regexp",13]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\]|\]/g,"sh_regexp",-3]],[[/\\/g,"sh_regexp",15]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\\\|\\/g,"sh_regexp",-3]],[[/\//g,"sh_regexp",17]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\\/|\//g,"sh_regexp",-3]],[[/$/g,null,-2],[/\\(?:\\|")/g,null,-1],[/"/g,"sh_string",-2]],[[/$/g,null,-2],[/\\(?:\\|')/g,null,-1],[/'/g,"sh_string",-2]],[[/$/g,null,-2],[/>/g,"sh_string",-2]],[[/\=cut/g,"sh_comment",-2]]];if(!this.sh_languages)this.sh_languages={};sh_languages.sh=[[[/\b(?:import)\b/g,"sh_preproc",-1],[/\b[+-]?(?:(?:0x[A-Fa-f0-9]+)|(?:(?:[\d]*\.)?[\d]+(?:[eE][+-]?[\d]+)?))u?(?:(?:int(?:8|16|32|64))|L)?\b/g,"sh_number",-1],[/\\"|\\'/g,"sh_normal",-1],[/"/g,"sh_string",1],[/'/g,"sh_string",2],[/function[ \t]+(?:[A-Za-z]|_)[A-Za-z0-9_]*[ \t]*(?:\(\))?|(?:[A-Za-z]|_)[A-Za-z0-9_]*[ \t]*\(\)/g,"sh_function",-1],[/[\-]+\b[A-Za-z0-9_]+\b/g,"sh_name",-1],[/(?:[A-Za-z]*[-\/]+[A-Za-z]+)+/g,"sh_normal",-1],[/\b(?:alias|bg|bind|break|builtin|caller|case|command|compgen|complete|continue|declare|dirs|disown|do|done|elif|else|enable|esac|eval|exec|exit|export|false|fc|fg|fi|for|getopts|hash|help|history|if|in|jobs|let|local|logout|popd|printf|pushd|read|readonly|return|select|set|shift|shopt|source|suspend|test|then|times|trap|true|type|typeset|umask|unalias|unset|until|wait|while)\b/g,"sh_keyword",-1],[/\b(bgzip|brew|cat|cd|chmod|cp|cpan|cpanm|curl|docker|echo|git|grep|gunzip|gzip|head|install|ln|make|mkdir|mv|perl|rm|sh|sort|tabix|tar|unzip|vep|wget|zip)\b\s+/g,"sh_keyword",-1],[/\.\/(vep|filter_vep)/g,"sh_keyword",-1],[/\b[A-Z_]+\b:\s+/g,"sh_variable",-1],[/(?:[A-Za-z]|_)[A-Za-z0-9_]*(?==)|\$\{(?:[^ \t']+)\}|\$\((?:[^ \t']+)\)|\$(?:[A-Za-z]|_)[A-Za-z0-9_]*|\$(?:[^ \t']{1})/g,"sh_variable",-1],[/~|!|%|\^|\*|\(|\)|\+|=|\[|\]|\\|:|;|,|\.|\/|\?|&|<|>|\||%%|(?:##){2}(?!#)/g,"sh_symbol",-1],[/#/g,"sh_comment",3]],[[/"/g,"sh_string",-2],[/\\./g,"sh_specialchar",-1]],[[/'/g,"sh_string",-2],[/\\./g,"sh_specialchar",-1]],[[/$/g,null,-2]]];f(function(){f("body.static").length&&wb()});o.GA={eventConfigs:[],domainCodes:{},verbose:false,logAjaxLoadTimes:true,reportErrors:true,code:function(){return this.domainCodes[D.location.hostname]},init:function(){if(this.code()&&!this.initialised){(function(a,b,c,g,h,j,l){a.GoogleAnalyticsObject=h;a[h]=a[h]||function(){(a[h].q=a[h].q||[]).push(arguments)};a[h].l=1*new Date;j=b.createElement(c);l=b.getElementsByTagName(c)[0];j.async=1;j.src=g;l.parentNode.insertBefore(j,l)})(D,N,"script","//www.google-analytics.com/analytics.js","ensGA");this.urlSpeciesRegex=new RegExp("/("+o.allSpeciesList.join("|")+")/");ensGA("create",this.code(),"auto");ensGA("set","anonymizeIp",true);ensGA("set","page",this.filterURL(D.location));ensGA("set","dimension1",o.species);ensGA("set","dimension2",o.isLoggedInUser?"yes":"no");ensGA("set","dimension3",D.location.pathname+D.location.search);ensGA("send","pageview");ensGA("require","linkid","linkid.js");this.initialised=true;this.registerConfigs(this.eventConfigs)}},filterURL:function(a){if(typeof a==="string")a=f("<a>").attr("href",a)[0];return a.hostname===D.location.hostname?"/"+(a.pathname.replace(this.urlSpeciesRegex,"/").replace(/^\/+/,"")||"index.html"):a.hostname},sendEvent:function(a,b,c){if(this.initialised){a=a.instantiate(b,{label:"",value:1},c);b=[a.category,a.action,a.label,a.value,{nonInteraction:!!a.nonInteraction}];if(a.category&&a.action){this.verbose&&console.log(b);ensGA.apply(D,["send","event"].concat(b))}o.GA.EventConfig.destroy(a)}},getConfig:function(a){if(this.initialised===true)throw"Can not get hold of a config after Ensembl.GA has been initialised";for(var b=0;b<this.eventConfigs.length;b++)if(this.eventConfigs[b].id&&this.eventConfigs[b].id===a)return this.eventConfigs[b]},deleteConfig:function(a){if(a=this.getConfig(a))a.deleted=true},registerConfigs:function(a){if(this.initialised){a=f.makeArray(f.map(a,function(b){return b.deleted||b.url&&!D.location.href.match(b.url)?null:new o.GA.EventConfig(b)}));this.addMouseEvents(a);if(!this._eventConfigs)this._eventConfigs=[];f.merge(this._eventConfigs,a);if(!this.ajaxEventsInitiated){this.ajaxEventsInitiated=true;f.ajaxPrefilter(function(b,c){f.each(o.GA._eventConfigs,function(){this.event==="ajax"&&c.url.match(this.ajaxUrl)&&o.GA.sendEvent(this,{currentOptions:c})})})}}},addMouseEvents:function(a){f.each(a,function(){if(this.event!=="ajax"){if(typeof this.selector==="function")this.selector=this.selector();if(this.wrapper&&typeof this.wrapper==="function")this.wrapper=this.wrapper();if(this.wrapper&&typeof this.selector!=="string")console.log("If 'wrapper' key is provided, 'selector' can only be a string.");else{var b=[(this.event||"click")+".ga"];this.wrapper&&b.push(this.selector);b.push({config:this},function(c){o.GA.sendEvent(c.data.config,{currentTarget:this},c)});f.fn.on.apply(f(this.wrapper||this.selector),b)}}})}};o.GA.EventConfig=function(a){f.extend(this,a)};o.GA.EventConfig.prototype.getURL=function(a){return o.GA.filterURL(a||this.currentTarget||this.currentOptions.url)};o.GA.EventConfig.prototype.getText=function(a){return f(a||this.currentTarget).text().trim()};o.GA.EventConfig.prototype.instantiate=function(a,b,c){var g=f.extend({},b,this,a);g.data=f.extend({},this.data);f.each(g.data,function(h){o.GA.EventConfig.resolve(g,c,g.data,h)});f.each(["category","action","label","value","nonInteraction"],function(h,j){o.GA.EventConfig.resolve(g,c,g,j)});return g};o.GA.EventConfig.resolve=function(a,b,c,g){if(typeof c[g]==="function")c[g]=c[g].call(a,b)};o.GA.EventConfig.destroy=function(a){a.data&&this.destroy(a.data);for(var b in a)a[b]=null};o.extend({initialize:function(){o.setSpecies();o.setUserFlag&&o.setUserFlag();var a=f("#hidden_species_list").val()||"";this.allSpeciesList=f.merge(["Multi"],a.split("|"));o.GA.init();this.base.apply(this,arguments)}});o.GA.eventConfigs.push({id:"SpeciesIcon",url:/^http:\/\/[^\/]+\/index.html/,wrapper:"._species_fav_container",selector:"a",event:"click",category:"SpeciesIcon",action:function(){return this.getURL()}},{id:"SpeciesDropdown",url:/^http:\/\/[^\/]+\/index.html/,selector:"select._all_species",event:"change",category:"SpeciesDropdown",action:function(){return this.getText(f(this.currentTarget).find("option:selected"))}},{id:"HomepageLink-SaveFavourites",url:/^http:\/\/[^\/]+\/index.html/,selector:"div.static_favourite_species p.customise-species-list",event:"click",category:"PageLink",action:"SaveFavourites",label:function(){return this.getText()}},{id:"HomepageLink-FullListSpeciesLink",url:/^http:\/\/[^\/]+\/index.html/,selector:"div.static_all_species > p > a, div.trackhub-ad a, p.othersites a, ._grch37_info_box a",event:"click",category:"PageLink",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"SpeciesTab",url:/.+/,selector:"#masthead div.dropdown.species a",event:"click",category:"SpeciesTab",action:function(){return this.getURL()}},{id:"MastheadLink",url:/.+/,selector:"#masthead div.logo_holder a, #masthead div.tools_holder ul.tools a",event:"click",category:"MastheadLink",action:function(){return this.getURL()},label:function(){return this.getText()||"LogoClick"}},{id:"AccountsLink",url:/.+/,selector:"._accounts_dropdown a, a._accounts_no_user",wrapper:"#masthead ._account_holder",event:"click",category:"AccountsLink",action:function(){return this.getURL()}},{id:"DynamicPageLink",url:/.+/,selector:"div.summary_panel a.dynamic-link",event:"click",data:{url:function(){return this.getURL()}},category:"DynamicPageLink",action:function(){return this.data.url},label:function(){return this.getText().replace(/\d|:|,|-/g,"").replace(/^(\s+)|(\s+)$/,"")}},{id:"LocalContext-LeftButton",url:/.+/,selector:".local_context a, .tool_buttons a",event:"click",data:{url:function(){return this.getURL()}},category:function(){return this.currentTarget.parentNode.nodeName==="LI"?"LocalContext":"LeftButton"},action:function(){return this.data.url.match("/Config/")?this.data.url.replace(/\/[^\/]+$/,""):this.data.url},label:function(){return this.currentTarget.parentNode.nodeName==="LI"?this.getText():""}},{id:"HelpHeader",url:/.+/,selector:"h1 a.help-header",event:"click",category:"HelpHeader",action:function(){return f(this.currentTarget).attr("href")},label:function(){return this.getText()}},{id:"ThumbnailIcon",url:/^http:\/\/[^\/]+\/index.html|\/Info\/Index/,selector:"#static .tool-box a, .homepage-icon a:has(img)",event:"click",category:"ThumbnailIcon",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"ThumbnailIconPlotGallery",url:/^http:\/\/[^\/]+\/index.html|\/Info\/Index/,selector:"#static ._plot_gallery_box a img",event:"click",category:"ThumbnailIcon",action:function(){return f(this.currentTarget.parentNode).attr("href")},label:function(){return f(this.currentTarget).closest("._plot_gallery_box").find("._title a").html()}},{id:"ThumbnailIconPlotGalleryLinks",url:/^http:\/\/[^\/]+\/index.html|\/Info\/Index/,selector:"#static ._plot_gallery_box p a",event:"click",category:"InPageButton",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"CarrouselIcon",url:/^http:\/\/[^\/]+\/index.html/,selector:"a.bx-prev, a.bx-next, a.bx-stop, a.bx-start, a.bx-pager-link",event:"click",category:"CarrouselIcon",action:function(){return this.getText().replace(/\d/,"")||"Pager"}},{id:"CarrouselLink",url:/^http:\/\/[^\/]+\/index.html/,selector:"ul.bxslider a",event:"click",category:"CarrouselLink",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"HomepageLink-WhatsNew",url:/^http:\/\/[^\/]+\/index.html/,selector:"div.whats-new a",event:"click",category:"PageLink",action:function(){return this.currentTarget.hostname===D.location.hostname?"NewsLink":"BlogLink"},label:function(){return this.getText()}},{id:"HomepageLink-ProjectLinks",url:/.+/,selector:"div.footer-ack a",event:"click",category:"PageLink",action:function(){return this.getURL()},label:function(){return this.getText()||f(this.currentTarget).find("img").attr("alt")+" (logo)"}},{id:"FooterLink",url:/.+/,selector:"div#footer a, div#wide-footer a",event:"click",category:"PageLink",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"InfoPageLink",url:/^http:\/\/[^\/]+\/info\//,selector:"div#content a",event:"click",category:"PageLink",action:function(){return this.getURL()},label:function(){return(this.getText()||"[No text]")+(this.action.match(/\/Help\/(Movie|View)/)?" - "+(this.currentTarget.href.match(/id=([0-9]+)/)||[""]).pop():"")}},{id:"ImageToolbar-Button",url:/.+/,selector:".image_toolbar a:not(.popup)",wrapper:".ajax.initial_panel",event:"click",data:{panelId:function(){return f(this.currentTarget).closest(".js_panel").prop("id")}},category:"ImageToolbar",action:function(){return this.currentTarget.className.match(/mr-reset/)?this.data.panelId+"-MarkingOnOff":this.getURL().replace(this.data.panelId,"").replace(/\/$/,"")},label:function(){return this.getURL(D.location.href)}},{id:"ImageToolbar-ResizeMenu",url:/.+/,selector:">div.image_resize_menu a",wrapper:"body",event:"mousedown",category:"ImageToolbar",action:function(){return"/Resize/"+
this.getURL().split("/")[1]+"/"+this.getText().replace(" ","")},label:function(){return f(this.currentTarget).closest(".image_resize_menu").attr("rel")}},{id:"ImageToolbar-SwitchGenoverse",url:"Location/View",event:"ajax",ajaxUrl:"/Genoverse/switch_image",category:"ImageToolbar",action:"/Genoverse/switch_image",label:"ViewTop"},{id:"ImageToolbar-ShareButton",url:/.+/,event:"ajax",ajaxUrl:/\/Share\/.+share_type\=image/,category:"ImageToolbar",data:{url:function(){return this.getURL()}},action:function(){return this.data.url.replace(/\/[^\/]+$/,"")},label:function(){return this.data.url.split("/").pop()}},{id:"SpeciesTree-Button",url:/.+/,selector:".toolbar_menu div:not(.header)",wrapper:".js_panel",event:"click",category:"ImageToolbar",action:function(){return"SpeciesTree/"+this.currentTarget.parentNode.className.replace("toolbar_menu ","").replace("_menu","")},label:function(){return this.getText()}},{id:"TrackMenu-Open",url:/.+/,selector:"._label_layer",wrapper:".ajax.initial_panel",event:"click",category:"TrackMenu-Open",action:function(){var a,b=f(this.currentTarget).closest(".js_panel").attr("id");f(f(this.currentTarget).children(".hover_label")).attr("class").split(/\s+/).map(function(c){if(c=c.match(/^_track_(.*)/))a=c[1]});return f(this.currentTarget).children(".hover_label").css("display")==="block"?b+"-"+a:""},label:function(){return this.getURL(D.location.href)}},{id:"TrackMenu-HighlightIcon-Click",url:/.+/,selector:"._label_layer .hover_label .hl-buttons a.hl-icon-highlight",wrapper:".ajax.initial_panel",event:"mousedown",category:"TrackMenu-HighlightIcon-Click",action:function(){return f(this.currentTarget).closest(".js_panel").attr("id")+"-"+f(this.currentTarget).data("highlight-track")},label:function(){return this.getURL(D.location.href)}},{id:"TrackMenu-Close",url:/.+/,selector:"._label_layer .hover_label .close",wrapper:".ajax.initial_panel",event:"mousedown",category:"TrackMenu-Close",action:function(){return f(this.currentTarget).closest(".js_panel").attr("id")+"-"+f(this.currentTarget).siblings(".hl-buttons").find(".hl-icon-highlight").data("highlight-track")},label:function(){return this.getURL(D.location.href)}},{id:"MarkedBox",url:/.+/,selector:".mrselector .mrselector-close",wrapper:".ajax.initial_panel",event:"mouseup",category:"MarkedBox",action:function(){return f(this.currentTarget).closest(".js_panel").attr("id")+"-MarkingOnOff"},label:function(){return this.getURL(D.location.href)}},{id:"TranscriptTableLink",url:/.+/,selector:".transcripts_table a",wrapper:".panel.js_panel",event:"click",category:"TranscriptTableLink",action:function(){return this.getURL()},label:function(){return this.getURL(D.location.href)}},{id:"ExonTableLink",url:/.+/,selector:"#ExonsSpreadsheet table a",wrapper:".ajax.initial_panel",event:"click",category:"ExonTableLink",action:function(){return this.getURL()},label:function(){return this.getURL(D.location.href)}},{id:"LocalButton",url:/\/(Sequence|Exon|Compara_Alignments)/,selector:"div.component-tools > a",wrapper:".ajax.initial_panel",event:"click",category:"LocalButton",action:function(){return this.getURL()}},{id:"DisplayFullAlignment",url:/\/Compara_Alignments/,selector:"div.display_full_message_div > a",wrapper:".ajax.initial_panel",event:"click",category:"DisplayFullAlignmentLink",action:function(){return this.getURL(D.location.href)},label:function(){return this.getText()==="Hide full alignment"?"Show":"Hide"}},{id:"SiteGalleryNav",url:/\/Info\/[Gene|Location|Variation]+Gallery/,selector:".gallery-nav a",event:"click",category:"ThumbnailIcon",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"SiteGalleryUpdateButton",url:/\/Info\/[Gene|Location|Variation]+Gallery/,selector:"form.gallery-header .fbutton",event:"click",category:"UpdateButton",action:function(){return this.getURL(D.location.href).match(/\/Info\/(.*Gallery)/)[1]},label:function(){var a=f(this.currentTarget).siblings("input").attr("id");a=f(this.currentTarget).closest("div.form-field").find('label[for="'+a+'"]');return f(a).html().split("displays")[0].replace(/&amp;/g,"&")||""}},{id:"SiteGallery-Preview-ThumbnailImage",url:/\/Info\/[Gene|Location|Variation]+Gallery/,selector:".gallery-preview .page-preview a",event:"click",category:"ThumbnailImage",action:function(){return this.getURL()},label:function(){return f(this.currentTarget.closest("div.page-preview")).siblings("._title").html()}},{id:"SiteGallery-Preview-PageLink",url:/\/Info\/[Gene|Location|Variation]+Gallery/,selector:".gallery-preview p.button a",event:"click",category:"InPageButton",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"SiteGallery-Preview-FormSubmit",url:/\/Info\/[Gene|Location|Variation]+Gallery/,selector:".gallery-preview form",event:"submit",category:"FormSubmit",action:function(){return this.getURL(f(this.currentTarget).attr("action"))},label:function(){return f(this.currentTarget.closest("div.gallery-preview")).find(".page-preview ").siblings("._title").html()}},{id:"DisplayFullAlignment",url:/\/Compara_Alignments/,selector:"div.display_full_message_div > a",wrapper:".ajax.initial_panel",event:"click",category:"DisplayFullAlignmentLink",action:function(){return this.getURL(D.location.href)},label:function(){return this.getText()==="Hide full alignment"?"Show":"Hide"}},{id:"TabLink",url:/.+/,selector:"#masthead ul.tabs li a:not(.toggle)",event:"click",category:"TabLink",action:function(){return this.getURL()}},{id:"TabHistory",url:/.+/,selector:"#masthead div.dropdown:not(.species) ul li a",event:"click",category:"TabHistory",action:function(){return this.getURL()},label:function(){return this.getText(f(this.currentTarget).closest("div.dropdown").find(">h4"))}},{id:"NavBar-Inputs",url:"Location/View",selector:".navbar form._nav_loc, .navbar form._nav_gene",wrapper:".ajax.initial_panel",event:"submit",category:"NavBar",action:function(){return this.currentTarget.className.match(/_nav_loc/)?"LocationSubmit":"GeneSubmit"}},{id:"NavBar-Slider",url:"Location/View",selector:".navbar .image_nav a",wrapper:".ajax.initial_panel",event:"mousedown",category:"NavBar",action:function(){return this.currentTarget.className.match("slider")?"slider":this.currentTarget.className.replace(/constant|disabled/g,"").trim()}},{id:"NavBar-ExploreIcon",url:"Gene/Summary",selector:".navbar a",wrapper:".panel.js_panel",event:"click",category:"ExploreIcon",action:function(){return this.getURL()}},{id:"NavBar-Link",url:"Gene/Summary",selector:".navbar a.no-visit",wrapper:".panel.js_panel",event:"click",category:"NavLink",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"ExploreIcon",url:/(Variation\/Explore|Gene\/Compara[^_]+|Location\/Compara[^_]+|Regulation)/,selector:".portal a",event:"click",category:"ExploreIcon",action:function(){return this.getURL()},label:function(a){return a.target.nodeName==="SPAN"?"count":"image"}},{id:"ZMenuOpen",url:/.+/,event:"ajax",ajaxUrl:/\/[^\/]+\/ZMenu\//,category:"ZMenuOpen",action:function(){return this.getURL()},label:function(){if(this.action.match("TextSequence"))return"text_sequence";var a=this.currentOptions.url.match(/(\?|;)config=([^;]+)/);if(a)return a.pop();if(this.action.match("/Label"))return(decodeURIComponent(this.currentOptions.url).match(/\"image_config\"\s*\:\s*\"([^\"]+)\"/)||[""]).pop();if(D.location.href.match("Tools/VEP/Results")&&this.action.match(/\/ZMenu\/(Gene|Transcript)/))return"vep_results_table";return""}},{id:"ZMenuLink",url:/.+/,event:"mouseup",selector:"div.zmenu_holder .info_popup a",wrapper:"body",category:"ZMenuLink",action:function(){return this.currentTarget.className.match(/_location_mark|_action_mark/)?"MarkingOnOff":this.currentTarget.className.match(/_location_change/)?"JumpToRegion":this.getURL()},label:function(){return this.getURL(o.PanelManager.panels[f(this.currentTarget).closest(".zmenu_holder").prop("id")].href)}},{id:"SearchInput-Inputs",url:/.+/,selector:".search_holder form, .search-form",event:"submit",category:"SearchInput",action:function(){return this.currentTarget.className.match("search-form")?D.location.href.match("index.html")?"HomepageSearch":"SpeciesPageSearch":"TopRightSearch"},label:function(){return f(this.currentTarget).find('input[name="q"]').val()||""}},{id:"SearchInput-SearchPageSearch",url:"/Search/Results",event:"ajax",ajaxUrl:"/Ajax/psychic",category:"SearchInput",action:"SearchPageSearch",label:function(){return this.currentOptions.data.q?this.currentOptions.data.q:""}},{id:"SearchInput-ExampleLink",url:/^http:\/\/[^\/]+\/index.html|\/Info\/Index/,event:"click",selector:"#SpeciesSearch .search-example a",category:"SearchInput",action:"ExampleLink",label:function(){return D.location.pathname.match(/Info/)?"SpeciesPage":"HomePage"}},{id:"SearchInput-Species",url:/.+/,selector:".search-form select#species",event:"change",category:"SearchInputSpecies",action:"HomepageSearch",label:function(){return f(this.currentTarget).val()||""}},{id:"InpageConfig",url:/\/Variation_Gene\/Table/,event:"click",selector:"li.prec_pri",wrapper:"div.initial_panel",category:function(a){return a.target.offsetParent&&a.target.offsetParent.className.match(/prec_pri/)?"InpageConfig":""},action:function(){return f(this.currentTarget).find("div[class*='newtable_filtertype']").not(":hidden").length?"Close":"Open"},label:function(){return f(this.currentTarget).find("div:nth-of-type(2) span").html()+": "+f(this.currentTarget).find("div:nth-of-type(2) span:nth-of-type(2)").html()}},{id:"InpageConfigSelector",url:/\/Variation_Gene\/Table/,event:"click",selector:"div.baked, div.use_cols li, div.newtable_filtertype_more li",wrapper:"div.initial_panel",category:"InpageConfigSelector",action:function(){if(this.currentTarget.className.match("baked"))return f(this.currentTarget).find("li.disabled").html();if(f(this.currentTarget).parents()[1].className.match("use_cols")){var a=f(this.currentTarget).attr("class")?f(this.currentTarget).attr("class"):"off";return(f(this.currentTarget).find("div.coltab-text").length?f(this.currentTarget).find("div.coltab-text").text():f(this.currentTarget).find("div.main").text())+": "+a}if(this.currentTarget.className.match("newtable_filtertype_more"))return"filter"},label:function(){return f(this.currentTarget).parentsUntil("div.m").find("div.title").text()}},{id:"InpageConfigApply",url:/\/Variation_Gene\/Table/,event:"click",selector:"li.apply, li.cancel",wrapper:"div.initial_panel",category:function(){return this.currentTarget.className.match("cancel")?"InpageConfigCancel":"InpageConfigApply"},action:function(){if(this.currentTarget.className.match("cancel"))return"cancel";if(!f(this.currentTarget).hasClass("unchanged")&&f(this.currentTarget).parentsUntil("div.m").find("div.newtable_range").length)return f(this.currentTarget).parentsUntil("div.m").find("div.slider_feedback").html();if(!f(this.currentTarget).hasClass("unchanged")&&f(this.currentTarget).parentsUntil("div.m").find("ul.bakery li.disabled").length)return f(this.currentTarget).parentsUntil("div.m").find("ul.bakery li.disabled").html();else if(!f(this.currentTarget).hasClass("unchanged")){var a="";(f(this.currentTarget).parentsUntil("div.m").find("div.use_cols li.on div.coltab-text").length?f(this.currentTarget).parentsUntil("div.m").find("div.use_cols li.on div.coltab-text"):f(this.currentTarget).parentsUntil("div.m").find("div.use_cols li.on div.main")).each(function(){if(f(this).html())a+=f(this).text()+","});return a.slice(0,-1)}},label:function(){return f(this.currentTarget).parentsUntil("div.m").find("div.title").html()}},{id:"SpeciesSelectorLink",url:/.+/,event:"click",selector:"a._species_selector",wrapper:".panel.js_panel",data:{url:function(){return this.getURL(D.location.href)}},category:"SpeciesSelectorLink",action:function(){return this.data.url}});o.extend({initialize:function(){if(o.GA.logAjaxLoadTimes){this.ajaxLoadTimerConfig=new o.GA.EventConfig({category:"AjaxLoadTimer",action:function(){return this.getURL()},nonInteraction:true,value:function(){return(new Date).getTime()-this.currentOptions._ensGA_StartTime}});f.ajaxPrefilter(function(a){a._ensGA_StartTime=(new Date).getTime()});f(N).ajaxComplete(function(a,b,c){c._ensGA_StartTime&&!c.url.match(/\.js(\?|$)/)&&o.GA.sendEvent(o.ajaxLoadTimerConfig,{currentOptions:c})})}this.base.apply(this,arguments)}});o.extend({initialize:function(){if(o.GA.reportErrors)this.reportErrorConfig=new o.GA.EventConfig({category:"ErrorReport",label:function(){return this.getURL(D.location.href)},nonInteraction:true});f(N).ajaxComplete(function(a,b,c){o.GA.reportErrors&&!c.url.match(/\.js(\?|$)/)&&f(N).find("div.ajax.initial_panel").each(function(){f(this).text().match(/Ajax error/i)&&o.GA.sendEvent(o.reportErrorConfig,{action:"Ajax Error"})})});this.base.apply(this,arguments)}});o.LayoutManager.extend({makeZMenu:function(a,b){if(D.location.href.match(/Transcript\/ProteinSummary/)&&!b.area.a.attrs.href&&b.area.a.attrs.title&&b.imageId){if(!this.nonAjaxZmenuGAEvent)this.nonAjaxZmenuGAEvent=new o.GA.EventConfig({category:"ZMenuOpen"});var c=b.area.a.attrs.title.split(/;/)[0].split(/:/)[0],g=c?f("#"+b.imageId).find("input.image_config").val():"";c&&g&&o.GA.sendEvent(this.nonAjaxZmenuGAEvent,{action:c,label:g})}return this.base(a,b)}});o.Panel.ImageMap=o.Panel.ImageMap.extend({initHoverLabels:function(){this.base.apply(this,arguments);o.GA.registerConfigs([{selector:this.elLk.hoverLabels.find("a.config"),event:"click",data:{id:this.id,type:function(){return this.currentTarget.className.match(/closetrack|favourite/)?this.currentTarget.className.match(/closetrack/)?"off":"favourite":this.currentTarget.parentNode.className.replace(/\s*current\s*/,"")}},category:function(){return this.data.type!=="favourite"?this.currentTarget.className.match(/closetrack/)?"Image-TrackOff":"Image-TrackStyle":"Image-TrackFav"},action:function(){var a=this.currentTarget.href.match(new RegExp("([^;&]+)="+this.data.type));return a?this.data.id+"-"+a[1]:false},label:function(){return this.data.type==="favourite"?this.currentTarget.className.match(/selected/)?"On":"Off":this.data.type}},{wrapper:this.elLk.hoverLabels.find("div._hl_tab:not(.config)"),selector:"a:not(.config)",event:"click",category:"Image-TrackDescLink",data:{id:this.id},action:function(){return this.data.id+"-"+f(this.currentTarget).closest(".hover_label").attr("class").replace(/hover_label|floating_popup/g,"").replace(/(^|\s+)[a-z0-9]{8}(\s+|$)/i,"")},label:function(){return this.getURL()}}])},navClick:function(a,b){if(!this.navClickEventConfig)this.navClickEventConfig=new o.GA.EventConfig({category:"ComparisonNavClick",action:function(){return this.areaAttrs.alt},label:function(){var c=parseInt((this.areaAttrs.href.match(/;id=([0-9]+)/)||[]).pop()||0);return c?"Secondary species - "+c:"Primary species"},nonInteraction:true});o.GA.sendEvent(this.navClickEventConfig,{areaAttrs:a.a.attrs},b);this.base(a,b)}});o.Panel.ModalContainer=o.Panel.ModalContainer.extend({init:function(){this.base.apply(this,arguments);o.GA.registerConfigs([{selector:this.elLk.tabs.children("a"),event:"click",category:"Modal-TabLink",data:{url:function(){return this.getURL()}},action:function(){return this.data.url.match(/\/Config\//)?this.data.url.replace(/\/[^\/]+$/,""):this.data.url},label:function(){return this.data.url.match(/\/Config\//)?this.data.url.split("/").pop():""}}])}});o.Panel.Exporter=o.Panel.Exporter.extend({init:function(){this.base.apply(this,arguments);o.GA.registerConfigs([{selector:this.el.find("#export_configuration"),event:"submit",category:"Exporter",action:"Export/Configure",label:function(){return f(this.currentTarget).find("select[name=output]").val()}}])}});o.Panel.ModalContent=o.Panel.ModalContent.extend({init:function(){this.base.apply(this,arguments);o.GA.registerConfigs([{selector:this.elLk.links.add(this.elLk.links.children("a")),event:"click",data:{link:function(){return f(this.currentTarget.childNodes).add(this.currentTarget).filter("a")}},category:function(a){return a.originalEvent?"Modal-LocalContext":false},action:function(){return this.getURL(this.data.link[0])},label:function(){return this.data.link.html()}}]);if(!this.textAlignmentEvent)this.textAlignmentEvent={format:new o.GA.EventConfig({category:"TextAlignment-DownloadFormat",nonInteraction:true}),compression:new o.GA.EventConfig({category:"TextAlignment-Compression",nonInteraction:true})}},formSubmit:function(a,b){this.base(a,b);if(f(a).attr("action").match(/DataExport\/Output/)){var c={};a.serializeArray().forEach(function(g){c[g.name]=g.value});if(c.export_action&&c.export_action=="TextAlignments"&&c.compression!=="preview"){o.GA.sendEvent(this.textAlignmentEvent.format,{action:c.component,label:c.format});o.GA.sendEvent(this.textAlignmentEvent.compression,{action:c.component,label:c.compression})}}return false},updateContent:function(a){this.base(a);o.GA.registerConfigs([{selector:this.el.find('#DataExport_Results .export_buttons_div input[name="uncompressed"]'),event:"click",category:"TextAlignment-DownloadFormat",data:{format:this.getParam("format",this.el.find('input[name="uncompressed"]:hidden').val())},action:function(){return"Compara_Alignments"},label:function(){return this.data.format}},{selector:this.el.find('#DataExport_Results .export_buttons_div input[name="uncompressed"]'),event:"click",category:"TextAlignment-Compression",data:{compression:this.getParam("compression",this.el.find('input[name="uncompressed"]:hidden').val())},action:function(){return"Compara_Alignments"},label:function(){return this.data.compression||"uncompressed"}}])},getParam:function(a,b){b=(b||"").replace(/;/g,"&");return(a=(new RegExp("[?&]"+a+"=([^&#]*)","i")).exec(b))?a[1]:null}});o.Panel.SiteGalleryHome=o.Panel.SiteGalleryHome.extend({init:function(){var a=this;this.base.apply(this,arguments);if(!this.siteGalleryEvent)this.siteGalleryEvent={species:new o.GA.EventConfig({category:"Species",nonInteraction:true}),datatype:new o.GA.EventConfig({category:"Datatype",nonInteraction:true})};this.elLk.form.on("submit",{panel:this},function(){o.GA.sendEvent(a.siteGalleryEvent.species,{action:a.elLk.species.val()||""});o.GA.sendEvent(a.siteGalleryEvent.datatype,{action:a.elLk.dataType.filter(":checked").val()||""})})}});o.Panel.Configurator=o.Panel.Configurator.extend({init:function(){this.base.apply(this,arguments);o.GA.registerConfigs([{selector:this.elLk.links.add(this.elLk.links.children("a")),event:"click",data:{component:this.component,link:function(){return f(this.currentTarget.childNodes).add(this.currentTarget).filter("a")}},category:function(a){return a.originalEvent?"Config-LocalContext":false},action:function(){return this.data.component+"-"+this.data.link.attr("class")},label:function(){return this.data.link.html()}},{selector:this.el.find(".tool_buttons p a"),event:"click",category:"Config-LeftButton",data:{component:this.component},action:function(){var a=this.currentTarget.href.match(/reset\=([^;&]+)/);return a?a[1]==="track_order"?"/Ajax/order_reset":"/Ajax/config_reset":this.getURL()},label:function(){return this.data.component}},{selector:".config_header",wrapper:this.elLk.configDivs.not(".view_config"),event:"click",data:{component:this.component},category:"Config-HeaderLink",action:function(){return this.data.component+"-"+this.currentTarget.parentNode.className.replace(/\s*config\s*/,"")},label:function(){return this.currentTarget.innerHTML}},{selector:this.elLk.viewConfigInputs,event:"change",data:{component:this.component},category:"Config-ViewConfig",action:function(){return this.data.component+"-"+this.currentTarget.name},label:function(){return this.currentTarget.type==="checkbox"?this.currentTarget.checked?"true":"false":this.currentTarget.value}},{selector:this.elLk.search,event:"blur",data:{component:this.component},category:"Config-Search",action:function(){return this.currentTarget.value===this.currentTarget.defaultValue?false:this.data.component},label:function(){return this.currentTarget.value}},{selector:"a",wrapper:this.elLk.imageConfigExtras,event:"click",data:{component:this.component},category:"Config-TextLink",action:function(){return this.data.component},label:function(){return this.getURL()}},{selector:"div.select_all li:not(.header)",wrapper:this.elLk.configDivs.not(".view_config"),event:"click",data:{component:this.component},category:"Config-TrackStyleAll",action:function(){var a=f(this.currentTarget).closest(".subset")[0],b=a.className.replace(/\s*(subset|first)\s*/g,"");return this.data.component+"-"+a.parentNode.className.replace(/\s*config\s*/,"")+(b?"-"+b:"")},label:function(){return this.currentTarget.className}},{selector:".favourite, .menu_help, .popup_menu li:not(.header), .desc a",wrapper:this.elLk.configDivs.not(".view_config"),event:"click",data:{component:this.component,data:function(){var a=f(this.currentTarget).closest("li.track").data();if(!a)return{};var b=this.currentTarget.className;b=this.currentTarget.nodeName!=="A"?b.match(/favourite|menu_help/)?b.match(/favourite/)?{category:"Config-TrackFav",label:a.track.fav?"On":"Off"}:{category:"Config-InfoIcon",label:b.match(/open/)?"Open":"Close"}:{category:"Config-TrackStyle",label:a.track.renderer}:{category:"Config-TrackDescLink",label:this.getURL()};b.action=this.data.component+"-"+a.track.id;return b}},category:function(){return this.data.data.category},action:function(){return this.data.data.action},label:function(){return this.data.data.label}},{selector:this.elLk.configSelector,event:"change",data:{component:this.component},category:"SaveConfig",action:function(){return this.data.component},label:"Select DropDown"},{selector:"a",wrapper:this.elLk.configDropdown,event:"click",category:"SaveConfig",action:this.component,label:function(){return this.currentTarget.innerHTML}},{id:"SaveConfigSubmit",url:/.+/,event:"ajax",ajaxUrl:"/save_config",category:"SaveConfig",action:this.component,label:"Save-Ajax"}])},updatePage:function(a,b){var c=this;this.base(a,b);if(!this.configAppliedEventConfig)this.configAppliedEventConfig={trackStyle:new o.GA.EventConfig({category:"Config-Applied-TrackStyle",nonInteraction:true}),trackFav:new o.GA.EventConfig({category:"Config-Applied-TrackFav",nonInteraction:true})};a=f.parseJSON(a.image_config);f.each(a,function(g,h){"renderer"in h&&o.GA.sendEvent(c.configAppliedEventConfig.trackStyle,{action:c.component+"-"+g,label:h.renderer});if("favourite"in h)o.GA.sendEvent(c.configAppliedEventConfig.trackFav,{action:c.component+"-"+g,label:h.favourite?"On":"Off"})})}});o.Panel.ImageExport=o.Panel.ImageExport.extend({init:function(){var a=this;this.base.apply(this,arguments);if(!this.configAppliedEventConfig)this.configAppliedEventConfig={format:new o.GA.EventConfig({category:"ImageExportFormat",nonInteraction:true}),custom:new o.GA.EventConfig({category:"ImageExportCustom",nonInteraction:true})};this.elLk.form.submit(function(){if(f('input[name="format"]:checked').val()!=="custom"){var b=f('input[name="format"]:checked',a.elLk.form).val()||"";b!==""&&o.GA.sendEvent(a.configAppliedEventConfig.format,{action:"format",label:b})}else{b=f('select[name="image_format"] option:selected',a.elLk.form).val()||"";if(b!=="")o.GA.sendEvent(a.configAppliedEventConfig.format,{action:"format",label:b});else return false;var c=f('input[name="contrast"]',a.elLk.form).is(":checked");o.GA.sendEvent(a.configAppliedEventConfig.custom,{action:"contrast",label:c});if(b==="png"){b=f('select[name="resize"] option:selected',a.elLk.form).val();c=f('select[name="scale"]  option:selected',a.elLk.form).val();o.GA.sendEvent(a.configAppliedEventConfig.custom,{action:"resize",label:b});o.GA.sendEvent(a.configAppliedEventConfig.custom,{action:"scale",label:c})}}return false})}});o.DataTable.orig_DataTableInit=o.DataTable.dataTableInit;o.DataTable.dataTableInit=function(){o.DataTable.orig_DataTableInit.apply(this,arguments);o.GA.registerConfigs([{selector:this.el.find(".dataTables_export a"),event:"click",category:"TableIcon",action:function(){return f(this.currentTarget).closest(".dataTables_top").parent().find("table.data_table").prop("id")||"MissingTableID"},label:function(){return this.currentTarget.innerHTML.match(/whole/)?"whole":"see"}}])};o.Panel.CellTypeSelector=o.Panel.CellTypeSelector.extend({init:function(){var a=this;this.base.apply(this,arguments);o.GA.registerConfigs([{selector:this.elLk.content.find(".cloud_multi_selector_list li"),event:"click",category:"Config-CellTypeSelector",action:function(){return a.params.image_config+"-"+f(this.currentTarget).data("key")},label:function(){return f(this.currentTarget).hasClass("off")?"off":"on"}},{selector:f(".cloud_filter .cloud_all_none span",this.el),event:"click",category:"Config-CellTypeSelector",action:function(){return a.params.image_config+"-All"},label:function(){return f(this.currentTarget).hasClass("all")?"on":"off"}}]);this.configAppliedEventConfig={selection:new o.GA.EventConfig({category:"ConfigApplied-CellTypeSelector",nonInteraction:true})}},updateSelection:function(){var a=this;this.base.apply(this,arguments);var b=a.params.image_config+"-All";if(this.changed)if(this.userInteraction&&this.userInteraction=="all-on")o.GA.sendEvent(a.configAppliedEventConfig.selection,{action:b,label:"on"});else this.userInteraction&&this.userInteraction=="all-off"?o.GA.sendEvent(a.configAppliedEventConfig.selection,{action:b,label:"off"}):["off","on"].forEach(function(c){f.each(a["changed_"+c],function(g,h){o.GA.sendEvent(a.configAppliedEventConfig.selection,{action:b+"-"+h,label:c})})})}});o.Panel.EvidenceSelector=o.Panel.EvidenceSelector.extend({init:function(){var a=this;this.base.apply(this,arguments);o.GA.registerConfigs([{selector:this.elLk.content.find(".cloud_multi_selector_list li"),event:"click",category:"Config-EvidenceSelector",action:function(){return a.params.image_config+"-"+f(this.currentTarget).data("key")},label:function(){return f(this.currentTarget).hasClass("off")?"off":"on"}},{selector:f(".cloud_filter .cloud_all_none span",this.el),event:"click",category:"Config-EvidenceSelector",action:function(){return a.params.image_config+"-All"},label:function(){return f(this.currentTarget).hasClass("all")?"on":"off"}}]);this.configAppliedEventConfig={selection:new o.GA.EventConfig({category:"ConfigApplied-EvidenceSelector",nonInteraction:true})}},updateSelection:function(){var a=this;this.base.apply(this,arguments);var b=a.params.image_config+"-All";if(this.changed)if(this.userInteraction&&this.userInteraction=="all-on")o.GA.sendEvent(a.configAppliedEventConfig.selection,{action:b,label:"on"});else this.userInteraction&&this.userInteraction=="all-off"?o.GA.sendEvent(a.configAppliedEventConfig.selection,{action:b,label:"off"}):["off","on"].forEach(function(c){f.each(a["changed_"+c],function(g,h){o.GA.sendEvent(a.configAppliedEventConfig.selection,{action:b+"-"+h,label:c})})})}});o.Panel.ConfigMatrix=o.Panel.ConfigMatrix.extend({init:function(){var a=this;this.base.apply(this,arguments);o.GA.registerConfigs([{selector:"select.filter",wrapper:this.elLk.filterWrapper,event:"change",category:"ConfigMatrix-Filter",action:function(){return a.id+"-Dropdown"},label:function(){return f("option:selected",this.currentTarget).val()}},{selector:"input.filter",wrapper:this.elLk.filterWrapper,event:"blur",category:"ConfigMatrix-Filter",action:function(){return a.id+"-FilterInputBox"},label:function(){return f(this.currentTarget).val()}},{selector:"div.select_all_column input",wrapper:this.elLk.columnHeaders,event:"click",category:"Config-ConfigMatrix-SelectAllColumn",action:function(){return a.id+"-"+this.currentTarget.name},label:function(){return f(this.currentTarget).attr("class")}},{selector:"th.first .select_all_row",wrapper:this.elLk.rows,event:"click",category:"Config-ConfigMatrix-SelectAllRow",action:function(){return a.id+"-"+f(this.currentTarget).closest("th.first").parent().prop("classList")[0]},label:function(){return f(this.currentTarget).find("input").prop("checked")}},{selector:f("li",this.elLk.configMenus[0]),event:"click",category:"Config-ConfigMatrix-TrackStyleAll",action:function(){return a.id},label:function(){return this.currentTarget.className}}]);this.eventConfig={config:new o.GA.EventConfig({category:"Config-ConfigMatrix",nonInteraction:true})}},dragStop:function(){this.dragCell.length&&o.GA.sendEvent(this.eventConfig.config,{action:"drag"});this.base.apply(this,arguments)}});o.Panel.MultiSpeciesSelector=o.Panel.MultiSpeciesSelector.extend({init:function(){this.base.apply(this,arguments)},updateSelection:function(){var a=this;this.base();if(!this.configAppliedEventConfig)this.configAppliedEventConfig={selectSpecies:new o.GA.EventConfig({category:"SelectSpecies",nonInteraction:true})};this.selection.join(",")!==this.initialSelection&&f(this.selection).each(function(b,c){o.GA.sendEvent(a.configAppliedEventConfig.selectSpecies,{action:a.panelType,label:c})})}});o.Panel.TextSequence=o.Panel.TextSequence.extend({init:function(){this.base.apply(this,arguments);o.GA.registerConfigs([{selector:f(this.el).parent().prev("div.info").find("div.view_full_text_seq a"),event:"click",category:"FullTextAlignment",action:function(){return this.getURL(D.location.href)}}])}});o.Panel.TaxonSelector=o.Panel.TaxonSelector.extend({init:function(){var a=this;this.base.apply(this,arguments);o.GA.registerConfigs([{selector:this.elLk.finder,event:"click",category:"SpeciesSelect-Search",data:{url:function(){return this.getURL(D.location.href)}},action:function(){return this.data.url},label:function(){return this.data.url}},{selector:f("button",this.elLk.buttons),event:"click",category:"SpeciesSelect-ButtonCLick",data:{url:function(){return this.getURL(D.location.href)}},action:function(){return f(this.currentTarget).attr("type")},label:function(){return this.data.url}},{selector:this.elLk.breadcrumbs,event:"click",category:"SpeciesSelect-Breadcrumbs",data:{url:function(){return this.getURL(D.location.href)}},action:function(){return f(this.currentTarget).children().last().text()},label:function(){return this.data.url}},{selector:this.elLk.divisions,event:"click",category:"SpeciesSelect-DivisionButton",data:{url:function(){return this.getURL(D.location.href)}},action:function(){return f(this.currentTarget).children(".active").length?f(this.currentTarget).children(".active").text():f("li.active",a.elLk.breadcrumbs).find("a").html()},label:function(){return this.data.url}}])},startSort:function(){var a=new o.GA.EventConfig({category:"SpeciesSelector-Sort",nonInteraction:true});o.GA.sendEvent(a,{action:function(){return this.getURL(D.location.href)}})}});o.extend({initialize:function(){this.base.apply(this,arguments);this.setUserFlag()},setUserFlag:function(){if(!this.hasOwnProperty("isLoggedInUser"))this.isLoggedInUser=f("div._account_holder").hasClass("_logged_in")}});o.Panel.Masthead=o.Panel.Masthead.extend({constructor:function(a){this.base(a);o.EventManager.register("refreshAccountsDropdown",this,this.refreshAccountsDropdown)},init:function(){this.base();this.elLk.accountHolder=this.el.find("div._account_holder");this.accountsBookmarkData=this.accountsRefreshURL="";this.refreshAccountsDropdown()},refreshAccountsDropdown:function(){var a=this;if(this.elLk.accountHolder.length&&!this.elLk.accountHolder.find("._accounts_no_user").length){var b=function(g){if(!g.which||g.which===1){a.toggleAccountsDropdown(false);f(N).off("click",b)}};if(!this.accountsRefreshURL){var c=this.elLk.accountHolder.find("form");this.accountsRefreshURL=c.attr("action");this.accountsBookmarkData=c.serialize()}f.ajax({url:this.accountsRefreshURL,context:this,data:this.accountsBookmarkData,type:"POST",success:function(g){this.elLk.accountHolder.html(g);this.elLk.accountLink=this.el.find("._accounts_link").on({click:function(h){h.preventDefault();if(!f(this).hasClass("selected")){h.stopPropagation();a.toggleAccountsDropdown(true);f(N).on("click",b)}}});this.elLk.accountDropdown=this.el.find("._accounts_dropdown").on({click:function(h){h.target.nodeName!=="A"&&h.target.parentNode.nodeName!=="A"&&h.stopPropagation()}}).find("a").on("click",b).end();this.elLk.accountHolder.find("._accounts_no_userdb").helptip().on({click:function(h){h.preventDefault()}})},dataType:"html"})}},toggleAccountsDropdown:function(a){this.elLk.accountLink.toggleClass("selected",a);this.elLk.accountDropdown.toggle(a);a&&!this.elLk.accountDropdown.data("initiated")&&this.elLk.accountDropdown.data("initiated",true).find("p").each(function(){var b=f(this),c=b.children("a").hide().end().append("<a>abc</a>").height();b.children("a").last().remove().end().show();b.height()>c&&b.addClass("acc-bookmark-overflow")})}});o.Panel.ModalContainer=o.Panel.ModalContainer.extend({hide:function(){this.base.apply(this,arguments);this.el&&this.el.find("._needs_refresh_on_hide").removeClass("_needs_refresh_on_hide").length&&o.EventManager.trigger("refreshAccountsDropdown")}});o.Panel.ModalContent=o.Panel.ModalContent.extend({initialize:function(){this.base();this.el.find("a._jconfirm").on("click",function(){var a=f(this);return!a.next().hasClass("_jconfirm")||D.confirm(a.next().html())});this.el.find("input._jcancel").on("click",function(){var a=f(this.form).find("input[name=_jcancel]").val();a&&o.EventManager.trigger("modalOpen",{href:a,rel:""})})},getContent:function(a,b){b.match(/\/Bookmark/)&&this.el.addClass("_needs_refresh_on_hide");return this.base(a,b)}});o.Panel.Consent=o.Panel.ModalContent.extend({init:function(){var a=this;this.base();this.elLk.noThanks=this.el.find("#consent_warning");this.elLk.message=this.el.find("#consent_message");this.elLk.noThanks.on({click:function(b){if(f(this).attr("type")!="submit"){a.elLk.message.replaceWith('<div id="consent_warning_2"><p>If you do not accept our privacy policy, your account will be disabled and will be deleted after 30 days unless you contact us.</p><p>Are you sure you wish to do this?</div>');f(this).val("Yes, disable my account");f(this).attr("type","submit");b.preventDefault()}}})}});o.Panel.Register=o.Panel.ModalContent.extend({init:function(){var a=this;this.base();this.elLk.form=this.el.find("form#registration");this.elLk.button=this.el.find("#pre_consent");this.elLk.checkbox=this.el.find("#consent_checkbox");this.elLk.checkbox.on("click",function(){a.elLk.button.hasClass("disabled")?a.elLk.button.removeClass("disabled"):a.elLk.button.addClass("disabled")});this.elLk.button.on("click",function(){a.elLk.button.hasClass("disabled")||a.formSubmit(a.elLk.form)})}});o.Panel.AccountForm=o.Panel.extend({init:function(){var a=this;this.base();this.elLk.email=this.el.find("._openid_email");this.elLk.hideIfTuststed=this.el.find("._hide_if_trusted");this.elLk.passwordAuth=this.el.find("input._password_auth");this.elLk.passwordField=this.el.find("div._password_auth");this.elLk.changeEmailEls=this.el.find("._change_email");if(parseInt(this.el.find("._trusted_provider").val())){this.elLk.email.on({change:function(){a.toggleEmail()},click:function(){a.toggleEmail()},keyup:function(){a.toggleEmail()}});this.toggleEmail()}this.elLk.passwordAuth.parents("div").first().find("input").on({change:function(){a.togglePassword()}});this.togglePassword();this.initChangeEmail()},toggleEmail:function(){var a=this.elLk.email[0];this.elLk.hideIfTuststed.toggle(a.defaultValue!=a.value);this.togglePassword()},togglePassword:function(){this.elLk.passwordField.toggle(!!(this.elLk.passwordAuth.is(":visible")&&this.elLk.passwordAuth.attr("checked"))).find("input").focus()},initChangeEmail:function(){var a=this;this.elLk.changeEmailEls.filter("a").on({click:function(b){b.preventDefault();b=a.elLk.changeEmailEls.find("input")[0];b.value=b.defaultValue;a.elLk.changeEmailEls.toggleClass("hidden")}})}});o.Panel.Masthead=o.Panel.Masthead.extend({init:function(){this.base();this.elLk.toolsTabs=this.el.find(".tabs .tools");this.elLk.toolsDropdown=this.el.find(".dropdown.tools");this.recentJobs=f.makeArray(this.elLk.toolsDropdown.find("li a").map(function(a,b){return(b.href.match(/tl\=([a-z0-9_\-]+)/i)||[]).pop()||null}));this.fetchURL="/"+(o.species||"Multi")+"/Ajax/tools_tab";this.elLk.toolsTabs.length&&this.fetchToolsTab()},fetchToolsTab:function(){f.ajax({url:this.fetchURL,context:this,data:{recent:this.recentJobs.join(","),tl:o.coreParams.tl||""},type:"POST",dataType:"JSON",success:function(a){this.populateToolsTab(a)}})},populateToolsTab:function(a){if(a.empty)this.elLk.toolsTabs.find("a:not(:first-child)").remove().end().find(".dropdown").removeClass("dropdown");else{this.elLk.toolsTabs.filter(":not(.final)").addClass("final").find("a:first-child").html(a.caption).attr("href",a.url);this.elLk.toolsDropdown.find("ul.recent").remove().end().find("h4").first().html("Recent jobs").after(f("<ul>").append(f.map(a.tools,function(b){return f("<li>").append(f("<a>").attr("href",b.url).html(b.caption)).append(f.map(b.jobs,function(c){return f("<a>").attr("href",c.url).html(c.caption).appendTo("<li>").parent().appendTo('<ul class="recent">').parent()}))})))}this.elLk.toolsTabs.filter(".final").removeClass("hidden")}});o.Panel.Content=o.Panel.Content.extend({init:function(){this.base.apply(this,arguments);this.blastButtonEnabled=false;o.EventManager.register("enableBlastButton",this,this.enableBlastButton);o.EventManager.register("runBlastSeq",this,this.runBlastSeq)},enableBlastButton:function(a){var b=this;if(!this.blastButtonEnabled){this.elLk.blastButton=this.el.find("._blast_button").removeClass("modal_link").filter(":not(._blast_no_button)").removeClass("hidden").end().on("click",function(c){c.preventDefault();b.runBlastSeq()});if((a=this.elLk.blastButton.prop("rel")||a)&&this.elLk.blastButton.length){this.elLk.blastForm=f("<form>").appendTo(N.body).hide().attr({action:this.elLk.blastButton.attr("href"),method:"post"}).append(f.map(o.coreParams,function(c,g){return f('<input type="hidden" name="'+g+'" value="'+c+'" />')})).append(f('<input type="hidden" name="query_sequence" value="'+this.filterBlastSeq(a)+'" />'));this.blastButtonEnabled=true}}return this.blastButtonEnabled},runBlastSeq:function(a){if(this.elLk.blastForm){a&&this.elLk.blastForm.find("input[name=query_sequence]").val(this.filterBlastSeq(a));this.elLk.blastForm.submit()}},filterBlastSeq:function(a){return a.replace(/\[[^\]]+\]/g,"")}});o.Panel.ContentTools=o.Panel.Content.extend({init:function(){var a=this;this.base();this.el.find("a._json_link").on("click",function(b){b.preventDefault();b=f(this).find("._confirm").html();if(!b||D.confirm(b))a.ajax({url:this.href,spinner:true})});this.el.find("a._change_location").on("click",function(){a.updateLocation(this.href)})},ajax:function(a){var b=this;f.ajax(f.extend({type:"get"},a,{dataType:"json",context:b,beforeSend:function(c,g){b.ajaxBeforeSend(c,a);a.beforeSend&&typeof a.beforeSend==="function"&&a.beforeSend.call(this,c,g)},success:function(c){var g=this.ajaxSuccess(c,a);a.success&&typeof a.success==="function"&&a.success.call(this,c,g)},error:function(c,g,h){this.ajaxError(c,g,h,a);a.error&&typeof a.error==="function"&&a.error.call(this,c,g,h)},complete:function(c,g){this.ajaxComplete(c,g,a);a.complete&&typeof a.complete==="function"&&a.complete.call(this,c,g)}}))},ajaxBeforeSend:function(a,b){if(b.spinner){b.spinner=Math.random().toString().replace(/0\./,"");this.toggleSpinner(true,"",b.spinner)}},ajaxSuccess:function(a){if(!this.parseJSONResponseHeader(a))return"header_status";if(a.panelMethod){var b=a.panelMethod.shift();if(b in this){this[b].apply(this,a.panelMethod);a.panelMethod.unshift(b);return"method_applied"}this.showError("Requested method '"+b+"' could not be found.","Javascript Error");return"method_missing"}return true},ajaxError:function(a,b,c){a=c?"Server error":"Error";if(!c)switch(b){case"timeout":c="The request took longer than expected. The may happen due to an issue with your Internet connection.";break;case"abort":c="The request was aborted, or the connection was closed unexpectedly.";break;case"parsererror":default:c="An unknown error occurred"}this.showError(c,a)},ajaxComplete:function(a,b,c){c.spinner&&this.toggleSpinner(false,"",c.spinner)},parseJSONResponseHeader:function(a){var b=a.header||{};switch(parseInt(b.status)){case 200:return true;case 302:b.location?this.ajax({url:b.location,async:false}):this.showError("Redirect URL is missing","Redirection Error");return false;case 404:this.showError("The requested page could not be found.","Not found");return false;case 500:a=a.exception||{};this.showError(a.message,"Server Error: "+a.type);return false;default:this.showError();return false}},showError:function(a,b){b=b||(a?"Error":"Unknown Error");a=a||"An unknown error has occurred.";if(!this.elLk.errorDiv){var c=this;this.elLk.errorDiv=f("<div>").append('<div class="error-overlay"></div><div class="error-popup error"><h3 class="_error_heading"></h3><div class="error-pad"><p class="_error_message"></p><p class="center"><a href="#" class="_error_hide button">Close</a></p></div></div>').appendTo(N.body).find("a._error_hide").on("click",function(g){g.preventDefault();c.hideError()}).end()}this.elLk.errorDiv.find("._error_heading").html(b).end().find("._error_message").html(a).end().show()},toggleSpinner:function(a,b,c){if(!this.elLk.spinnerDivs)this.elLk.spinnerDivs=f('<div class="tools-overlay"></div><div class="overlay-spinner spinner"></div>').appendTo(this.el.css("position","relative"));if(a){c&&this.elLk.spinnerDivs.addClass("_active_"+c);this.elLk.spinnerDivs.show().last().empty().html(b?"<div>"+b+"</div>":"")}else{c&&this.elLk.spinnerDivs.removeClass("_active_"+
c);this.elLk.spinnerDivs.filter(function(){return!this.className.match(/_active_/)}).hide()}},hideError:function(){this.elLk.errorDiv&&this.elLk.errorDiv.hide()},scrollIn:function(a){a=f.extend({margin:16,speed:400},a);var b=this.el.offset().top-a.margin;f("html,body").animate({scrollTop:b},a.speed)},updateLocation:function(a){a&&a!==D.location.href&&D.history&&D.history.pushState&&D.history.pushState({},"",a)}});o.Panel.ActivitySummary=o.Panel.ContentTools.extend({constructor:function(){this.base.apply(this,arguments);o.EventManager.register("toolsRefreshActivitySummary",this,this.refresh);o.EventManager.register("toolsToggleEmptyTable",this,this.toggleEmptyTable);this.POLL_INTERVAL=10;this.MAX_POLLS=-1;this.pollCounter=0},init:function(){var a=this;this.base();this.refreshURL=this.el.find("input[name=_refresh_url]").remove().val();this.ticketsDataHash=this.el.find("input[name=_tickets_data_hash]").remove().val();this.elLk.noJobsMessage=this.el.find("div._no_jobs");this.elLk.refreshButton=this.el.find("a._tickets_refresh").on("click",function(b){b.preventDefault();a.clearTimer();a.refresh(false,false,true)});this.elLk.refreshButtonReload=this.elLk.refreshButton.children().eq(0);this.elLk.refreshButtonTimer=this.elLk.refreshButton.children().eq(1);this.elLk.refreshButtonText=this.elLk.refreshButton.children().eq(2);this.el.find("._ticket_edit").on("click",function(){var b=(this.href.match(/tl=([a-z0-9_-]+)/i)||[]).pop();o.EventManager.trigger("toolsHideTicket");return!!b&&!o.EventManager.trigger("toolsEditTicket",b)});this.el.find("._ticket_view").on("click",function(){var b=(this.href.match(/tl=([a-z0-9_-]+)/i)||[]).pop();o.EventManager.trigger("toolsToggleForm",false);return!!b&&!o.EventManager.trigger("toolsViewTicket",b)});this.el.find("._ticket_share").each(function(){var b=f(this).find(".ticket-share-input").val();b=f("<a/>",{href:b}).prop("href");f(this).find(".ticket-share-input").attr("value",b);f(this).helptip({content:f(this).html(),close:function(c,g,h){h&&f(this).helptip("option","content",f(this).html()).helptip("close")},open:function(c,g){g.tooltip.find("input[type=checkbox]").on("change",{icon:f(this)},function(h){var j=f(this).parents("form").on("submit",function(){return false});f.ajax({url:j.prop("action"),type:"get",data:j.serialize(),dataType:"json",context:{tooltip:g.tooltip,icon:h.data.icon},success:function(l){this.tooltip.find("._ticket_share_url").toggle(!!l.shared);this.icon.find("._ticket_share_url").toggle(!!l.shared).end().find("input[type=checkbox]")[l.shared?"attr":"removeAttr"]("checked","checked")}})})}})});this.toggleEmptyTable();this.updateTicketList(false,!!this.el.find("input[name=_auto_refresh]").remove().val())},refresh:function(a,b,c){this.pollCounter=!b?c?this.pollCounter:this.pollCounter+1:0;this.toggleLoadingMessage(true);this.updateRefreshButton("refreshing");this.ajax({url:this.refreshURL,data:{tickets:a?"":this.ticketsDataHash},cache:false,spinner:true,success:function(g,h){if(h!="method_applied"){this.updateRefreshButton("cleartimer");this.clearTimer()}},error:function(){this.updateRefreshButton("cleartimer");this.clearTimer()},complete:function(){this.toggleLoadingMessage(false)}})},updateRefreshButton:function(a){var b=this;this.elLk.refreshButtonReload.toggle(a==="cleartimer");this.elLk.refreshButtonText.html(a==="refreshing"?"Refreshing now&#8230;":"Refresh");if(a==="refreshing")this.elLk.refreshButtonTimer.hide();else{this.elLk.refreshButtonTimer.toggle(a!=="cleartimer");if(a==="inittimer"){b.elLk.refreshButtonTimer.text(this.POLL_INTERVAL);o.Panel.ActivitySummary.counter=setInterval(function(){b.elLk.refreshButtonTimer.text(parseInt(b.elLk.refreshButtonTimer.text())-
1)},1E3)}}},updateTicketList:function(a,b){var c=this;this.clearTimer();if(a){a=this.params.updateURL;a=a.replace(/\;?mcache\=[0-9]+/,"");a+=";mcache="+(new Date).getTime();this.getContent(a);o.EventManager.trigger("toolsRefreshTicket",false)}if((this.autoRefresh=!!b)&&(this.MAX_POLLS<0||this.pollCounter<this.MAX_POLLS)){o.Panel.ActivitySummary.poll=setTimeout(function(){c.refresh(false,false,false)},this.POLL_INTERVAL*1E3);this.updateRefreshButton("inittimer")}else this.updateRefreshButton("cleartimer")},toggleEmptyTable:function(){var a=this.el.find("div._ticket_table"),b=!a.find(".dataTables_empty").length;a.toggle(b);this.elLk.noJobsMessage.toggle(!b);b||o.EventManager.trigger("toolsToggleForm",true,false)},toggleLoadingMessage:function(a){this.elLk.noJobsMessage.find("p").length===1&&this.elLk.noJobsMessage.append(f("<p>Loading...</p>").hide());this.elLk.noJobsMessage.find("p").each(function(b){f(this).toggle(b===0?!a:a)})},clearTimer:function(){clearTimeout(o.Panel.ActivitySummary.poll);clearInterval(o.Panel.ActivitySummary.counter)},destructor:function(){this.clearTimer();this.base.apply(this,arguments)}});o.Panel.TicketDetails=o.Panel.ContentTools.extend({constructor:function(){this.base.apply(this,arguments);o.EventManager.register("toolsViewTicket",this,this.viewTicket);o.EventManager.register("toolsRefreshTicket",this,this.refresh);o.EventManager.register("toolsHideTicket",this,this.hide)},init:function(){this.base();var a=this;this.el.find("._ticket_edit").on("click",function(){var b=(this.href.match(/tl=([a-z0-9_-]+)/i)||[]).pop(),c=b.split("-")[0];if(c!==a.currentTicket){o.EventManager.trigger("toolsToggleForm",false,true);a.currentTicket=c}return!!b&&!o.EventManager.trigger("toolsEditTicket",b)});this.el.find("._ticket_hide").on("click",function(b){b.preventDefault();a.el.empty();a.hide()});this.el.find("._ticket_delete").on("click",function(){f(this).data("redirect-url")&&o.redirect(f(this).data("redirect-url"))})},refresh:function(a){this.getContent();a&&o.EventManager.trigger("toolsRefreshActivitySummary",false,false,true)},viewTicket:function(a){var b=this.params.updateURL.replace(/tl\=[a-z0-9_-]+/i,"");b.match(/\?/)||(b+="?");this.getContent(b,this.el.show(),{updateURL:b,updateData:{tl:a,view:1}});this.scrollIn();return true}});o.Panel.ToolsForm=o.Panel.ContentTools.extend({constructor:function(){this.base.apply(this,arguments);o.EventManager.register("toolsToggleForm",this,this.toggleForm);o.EventManager.register("toolsEditTicket",this,this.loadTicket)},init:function(){var a=this;this.base.apply(this,arguments);this.loadTicketURL=this.params.load_ticket_url;this.defaultSpecies=this.params.species;this.elLk.buttonDiv=this.el.find("._tool_new").show().on("click","a",function(b){b.preventDefault();o.EventManager.trigger("toolsHideTicket");a.toggleForm(true,true)});this.elLk.formDiv=this.el.find("._tool_form_div");this.elLk.form=this.elLk.formDiv.find("form._tool_form").on({submit:function(b){f('input[type="file"]',this).filter(function(){return!this.value}).prop("disabled",true);b.preventDefault();if(f(this).data("valid",true).trigger("validate").data("valid"))D.FormData?a.ajax(f.extend({url:this.action,method:"post",spinner:true},{data:new FormData(this),cache:false,contentType:false,processData:false})):a.ajax(f.extend({url:this.action,method:"post",spinner:true},{iframe:true,form:f(this)}));f('input[type="file"]',this).filter(function(){return!this.value}).prop("disabled",false)}});this.elLk.cancelButton=this.el.find("a._tools_form_reset, a._tools_form_cancel").on("click",function(b){var c=!!this.className.match(/cancel/);b.preventDefault();a.toggleSpinner(true);if(c){a.toggleForm(false);a.toggleSpinner(false)}else D.setTimeout(function(){a.reset();a.toggleSpinner(false)},100)}).filter("._tools_form_cancel");this.elLk.adjustableDivs=this.elLk.form.find("div._adjustable_height").css("minHeight",function(){return f(this).height()});o.EventManager.trigger("toolsToggleEmptyTable")},editExisting:function(a){var b=this.params.edit_jobs;if(b&&b.length){this.populateForm(b,a);return true}return false},populateForm:function(a,b){if(a&&a.length){b||this.reset();for(var c in a[0]){var g=f.isArray(a[0][c])?a[0][c]:[a[0][c]];b=function(){return f.inArray(this.value,g)>=0};this.elLk.form.find("[name="+c+"]").filter("input[type=text], textarea").val(g[0]).end().filter("[type=checkbox], [type=radio]").prop("checked",b).end().filter("select").find("option").prop("selected",b);this.toggleForm(true)}this.resetSelectToToggle()}},ticketSubmitted:function(){o.EventManager.trigger("toolsRefreshActivitySummary",true,true,false);this.toggleForm(false,true)},ticketNotSubmitted:function(a){this.showError(a.message,a.heading);a.stage==="dispatcher"&&o.EventManager.trigger("toolsRefreshActivitySummary",true,true,false)},toggleForm:function(a,b){a||this.reset();this.elLk.buttonDiv.toggle(!a);this.el.find("div.tool-header").toggle(a);this.elLk.formDiv[a?"slideDown":"slideUp"](200);if(typeof b==="boolean"){this.elLk.cancelButton.toggle(b);this.el.find("div.tool-header span.right-button").toggle(b)}},loadTicket:function(a){this.ajax({url:this.loadTicketURL.replace("TICKET_NAME",a),spinner:true});this.scrollIn();return true},reset:function(){this.elLk.form[0].reset()},resetSelectToToggle:function(){this.elLk.form.find("._stt").selectToToggle("trigger")},adjustDivsHeight:function(){this.elLk.adjustableDivs.clearQueue().each(function(){f(this).css({minHeight:f(this).height()}).animate({minHeight:0},"1000","easeInExpo",function(){f(this).css({minHeight:f(this).height()})})})}});o.Class.ToolsFormSubElement=ga.extend({constructor:function(){this.elLk={}},destructor:function(){var a;for(a in this.elLk){this.elLk[a].remove();this.elLk[a]=null}for(a in this)this[a]=null}});o.Panel.VEPResults=o.Panel.ContentTools.extend({init:function(){var a=this;this.base();this.el.find("a._zmenu").zMenuLink();this.el.find("a.filter_toggle").on("click",function(b){b.preventDefault();a.el.find("."+this.rel).toggle()});this.el.find("input.autocomplete").on("focus",function(){var b=this.name.replace("field","").replace("value",""),c=a.el.find("select[name=field"+b+"] option:selected").val();b=a.el.find("input[name=value"+
b+"]");var g=f.parseJSON(a.params.auto_values);if(g[c]&&g[c].length)b.autocomplete({minLength:0,source:g[c]});else b.hasClass("ui-autocomplete-input")&&b.autocomplete("destroy");b.attr("placeholder",c==="Location"?"chr:start-end":"defined")});this.el.find("form._apply_filter").on("submit",function(b){b.preventDefault();var c=f(this);b=c.find("input[name=ajax_url]").remove().val();c=f.map(c.serializeArray(),function(g){return g.name+"="+g.value}).sort().join(";");a.reload(D.location.href.split("?")[0]+
"?"+c,b+(b.match(/\?/)?";":"?")+c)});this.el.find("a._reload").on("click",function(b){b.preventDefault();a.reload(this.href,f(this).find("input").val())});this.el.find("select._operator_dd").on("change",function(){f(this).parent().find("input._value_switcher").toggle(this.value!=="in");f(this).parent().find("span._value_switcher").toggle(this.value==="in")});this.el.find(".data_table").scrollyTable()},reload:function(a,b){this.toggleSpinner(true);this.updateLocation(a);this.getContent(b,this.el.addClass("no-spinner"),null,true,{background:true})},destructor:function(){this.toggleSpinner(false);this.base.apply(this,arguments)}});o.Panel.VEPResultsSummary=o.Panel.Piechart.extend({init:function(){this.base();this.graphColours=JSON.parse(this.params.cons_colours.replace(/\'/g,'"'));this.graphColours["default"]=["#222222","#FF00FF","#008080","#7B68EE"]},toggleContent:function(a){if(a.hasClass("closed")&&!a.data("done")){this.base(a);this.makeGraphs(f(".pie_chart > div","."+a.attr("rel")).map(function(){return this.id.replace("graphHolder","")}).toArray());a.data("done",true)}else this.base(a);a=null}});o.Panel.TextSequence=o.Panel.TextSequence.extend({init:function(){this.base.apply(this,arguments);var a=this,b=o.EventManager.trigger("enableBlastButton",this.el.clone().find("._seq").text());if(typeof b!=="boolean")b=!!f.grep(f.map(b,function(c){return c}),function(c){return c}).length;if(b){this.el.find("span._seq").removeClass("_seq").filter(function(){return!f(this).text().match(/\.+/)}).addClass("_seq").on({mousedown:function(){a.blastSeq="";a.resetSelection();a.toggleBlastPopup(false);f(N.body).addClass("sequence_selection");f(N).on("mouseup.TextSequence",function(c){a.blastSeq=a.getSelection();a.toggleBlastPopup(!!a.blastSeq,c);f(N.body).removeClass("sequence_selection")})},mouseup:function(c){a.blastSeq&&c.stopPropagation()}});this.elLk.blastPopup=f('<div class="blast-popup"><p><a href="#">BLAST selected sequence</a></p></div>').hide().appendTo(N.body).on("click","a",function(c){c.preventDefault();o.EventManager.trigger("runBlastSeq",a.blastSeq)})}},toggleBlastPopup:function(a,b){var c=this;f(N).off("mouseup.TextSequence");if(a){this.elLk.blastPopup.css({left:b.pageX,top:b.pageY}).show();f(N).on("mouseup.TextSequence",function(){c.toggleBlastPopup(false)})}else this.elLk.blastPopup.hide()},resetSelection:function(){if(N.selection&&N.selection.empty)N.selection.empty();else D.getSelection&&D.getSelection().removeAllRanges()},getSelection:function(){var a;if(N.selection&&N.selection.createRange)a=f("<div>").html(N.selection.createRange().htmlText).find("._seq").text();else if(D.getSelection){var b=D.getSelection();if(b.rangeCount>0)a=f(b.anchorNode).parents("._seq")[0]===f(b.focusNode).parents("._seq")[0]?f("<div>").append(b.getRangeAt(0).cloneContents()).text():f("<div>").append(b.getRangeAt(0).cloneContents()).find("._seq").text()}if(a&&a.match(/^\.+/))a="";return a}});o.Panel.AssemblyConverterForm=o.Panel.ToolsForm.extend({init:function(){this.base.apply(this,arguments);this.elLk.speciesDropdown=this.elLk.form.find("select[name=species]");this.editExisting();this.resetSpecies()},populateForm:function(a){if(a&&a.length){this.base(a);if(a[0].input_file_type)this.elLk.form.find("input[name=file]").parent().append('<p class="_download_link">'+(a[0].input_file_type==="text"?'Click <a href="'+a[0].input_file_url+'">here</a> to download the previously uploaded file.':"You previously uploaded a compressed file to run this job.")+"</p>");a[0].mapping&&this.elLk.form.find("select[name=mappings_for_"+a[0].species+"]").find("option[value="+a[0].mapping+"]").prop("selected",true)}},reset:function(){this.base.apply(this,arguments);this.resetSpecies();this.elLk.form.find("._download_link").remove()},resetSpecies:function(){this.elLk.speciesDropdown.find("option[value="+this.defaultSpecies+"]").prop("selected",true).end().selectToToggle("trigger")}});o.Panel.BlastForm=o.Panel.ToolsForm.extend({constructor:function(){this.base.apply(this,arguments);this.sequences=[];this.selectedQueryType=false;o.EventManager.register("resetSearchTools",this,this.resetSearchTools);o.EventManager.register("resetSourceTypes",this,this.resetSourceTypes)},init:function(){var a=this;this.base.apply(this,arguments);this.combinations=this.params.valid_combinations;this.restrictions=this.params.restrictions;this.missingSources=this.params.missing_sources;this.blatAvailability=this.params.blat_availability;this.sensitivityConfigs=this.params.sensitivity_configs;this.maxSequenceLength=this.params.max_sequence_length;this.maxNumSequences=this.params.max_number_sequences;this.dnaThresholdPercent=this.params.dna_threshold_percent;this.readFileURL=this.params.read_file_url;this.fetchSequenceURL=this.params.fetch_sequence_url;this.blat_value="BLAT_BLAT";this.sourceRemoved=[];if(!this.combinations||!this.maxSequenceLength||!this.dnaThresholdPercent||!this.maxNumSequences)this.showError("JavaScript error occurred while initiating the Blast form.","Blast form error");else{this.elLk.sequences=this.elLk.form.find("div._sequence");this.elLk.sequenceField=this.elLk.form.find("div._sequence_field");this.rnaMessageDisplayed=false;var b=function(){var c=f(this).off("blur change paste");setTimeout(function(){c.trigger("finish").trigger("blur").on("blur change paste",b);c=null},100)};this.elLk.sequenceInput=this.elLk.form.find("textarea[name=query_sequence]").on({focus:function(){if(!this.value||this.value===this.defaultValue)f(this).val("").removeClass("inactive")},finish:function(){if((this.value=this.value.trim())&&this.value!==this.defaultValue)a.addSequenceByID(this.value)||a.addSequences(this.value);else f(this).val(this.defaultValue).addClass("inactive")},"blur change paste":b});this.elLk.sequenceInputClose=this.elLk.sequenceInput.prev().on("click",function(){a.toggleSequenceFields(false);a.updateSeqInfo(true)});this.elLk.queryFile=this.elLk.form.find("input[name=query_file]").on({click:function(){a.elLk.sequenceInput.val("")},change:function(){if(D.FileList&&D.File&&D.FileReader){if(!a.fileReader)a.fileReader=new FileReader;a.fileReader.onload=function(c){a.addSequences(c.target.result);a.toggleSpinner(false);a.elLk.queryFile.val("")};a.fileReader.onerror=function(c){pabel.showError(c.target.error.code,"Error reading file");a.toggleSpinner(false)};a.toggleSpinner(true);a.fileReader.readAsText(this.files[0])}else a.ajax({url:a.readFileURL,iframe:true,form:a.elLk.form,spinner:true,success:function(c){if("file_error"in c)this.showError(c.file_error);else"file"in c&&this.addSequences(c.file)},complete:function(){this.elLk.queryFile.val("")}})}});this.elLk.queryType=this.elLk.form.find("input[name=query_type]").on("change",function(){a.setQueryTypeValue(this.value)}).first().prop("checked",true).end();this.elLk.dbType=this.elLk.form.find("input[name=db_type]").on("click",function(){a.resetSearchTools()}).first().prop("checked",true).end();this.elLk.source=this.elLk.form.find("select[name^=source_]").on("change",function(){a.elLk.dbType.filter("[value="+this.name.split("_")[1]+"]").prop("checked",true);a.resetSearchTools()});this.elLk.searchType=this.elLk.form.find("select[name=search_type]").on("change",function(c){a.setSensitivityConfigs(f(this).find("option:selected").val());if(c.originalEvent)a.searchToolUserSelection=f(this).find("option:selected").val()});this.elLk.searchTypeOptions=this.elLk.searchType.find("option").clone();this.elLk.sensitivityOptions=this.elLk.form.find("select[name^=config_set_]").on("change",function(){a.setSensitivityConfigs(f(this))});this.elLk.form.on("validate",function(){a.sequences.length||a.elLk.sequenceInput.trigger("finish");if(a.sequences.length){if(!a.getSelectedSpecies().length){a.showError("Please select a species to run BLAST/BLAT against.","No species selected");f(this).data("valid",false)}}else{a.showError("Please provide a sequence to run BLAST/BLAT.","No sequence found");f(this).data("valid",false)}});this.resetSearchTools(this.blatAvailability[this.defaultSpecies]?this.blat_value:"");this.resetSourceTypes([this.defaultSpecies]);this.resetSpecies([this.defaultSpecies]);this.editExisting(true)}},reset:function(){this.base.apply(this,arguments);for(var a=this.sequences.length-1;a>=0;a--)this.sequences[a].destructor();this.sequences=[];this.updateSeqInfo(false);this.toggleSequenceFields(true);this.selectedQueryType=false;this.elLk.queryType.first().prop("checked",true);this.elLk.dbType.first().prop("checked",true);this.elLk.source.find("option").first().prop("selected",true);this.resetSearchTools();this.searchToolUserSelection="";this.resetSpecies([this.defaultSpecies])},populateForm:function(a){this.reset();var b={},c={};if(a.length)for(var g=a.length-1;g>=0;g--)for(var h in a[g])if(h==="sequence"||h==="species"){h in b||(b[h]=[]);if(h==="species"){!c[a[g][h]]&&b[h].unshift(a[g][h]);c[a[g][h]]=1}else b[h].unshift(a[g][h])}else b[h]=a[g][h];if(!f.isEmptyObject(b)){this.toggleForm(true);if(b.query_type)this.addEditingJobSequences(b.sequence,b.query_type);else this.addSequenceByID(b.sequence[0].sequence)||this.addSequences(b.sequence[0].sequence);this.elLk.form.find("[name=db_type][value="+b.db_type+"]").prop("checked",true);this.elLk.form.find("[name^=source_] option[value="+b.source+"]").prop("selected",true);if(b.search_type)this.searchToolUserSelection=b.search_type;this.resetSearchTools(b.search_type);this.resetSpecies(b.species||[this.defaultSpecies]);b.config_set&&this.elLk.form.find("[name=config_set_"+b.search_type+"]").find('option[value="'+b.config_set+'"]').prop("selected",true).end().selectToToggle("trigger");if(b.configs)for(var j in b.configs)this.elLk.form.find("[name="+b.search_type+"__"+j+"]").filter("input[type=checkbox]").prop("checked",!!b.configs[j]).end().filter("select").find('option[value="'+b.configs[j]+'"]').prop("selected",true).end().selectToToggle("trigger")}},addSequences:function(a,b){a=this.parseRawSequences(a);var c=0,g=!!b,h=a.sequences.length,j=this.sequences.length,l=0,p;l=0;a:for(;l<h;l++){for(p=0;p<j;p++)if(a.sequences[l].string===this.sequences[p].string&&!(b&&this.sequences[p]===b)){c++;g&&h===1&&this.removeSequence(b);continue a}if(g){b.init(a.sequences[l]);g=false}else{if(j>=this.maxNumSequences)break;this.sequences.splice(b&&this.sequences.indexOf(b)+1||j,0,new o.Class.BlastFormSequence(a.sequences[l],this,b||false))}j=this.sequences.length}if(j){this.setQueryTypeValue();this.toggleSequenceFields(false)}this.updateSeqInfo({added:l-c,invalids:a.invalids+c,is_rna:a.is_rna});return l},addSequenceByID:function(a){if(this.fetchSequenceURL&&a.match(/[0-9]+/)&&a.match(/^[a-z]{1}[a-z0-9\.\-\_]{4,30}$/i)){this.ajax({comet:true,url:this.fetchSequenceURL,data:{id:a},spinner:true,update:function(){this.toggleSpinner(true,"Fetching sequence&#8230;")}});return true}return false},parseRawSequences:function(a){var b="ACTUGNX";a=a.replace(/^[\s\n\t]+|[\s\n\t]+$/g,"").split(/(?=>)|\n+[\s\t]*\n+/);var c=[],g=false,h,j,l,p,m,n,q,t=function(v){var x,z=[],A=false,B;if(v.length===1&&v[0].match(/^>/)){for(x=v[0].split(/[\s\t]+/);x.length;){B=x.pop();if(B.match(/^[A-Z\*\-]+$/i)&&(!A||B.length===60))z.unshift(B);else{x.push(B);break}A=true}z.unshift(x.join(" "))}return z.length>1?z:v};n=0;a:for(;n<a.length;n++){h=t(a[n].trim().split(/[\s\t]*\n[\s\t]*/));m=j=0;seqString="";sequence={string:"",description:">",type:""};q=0;b:for(;q<h.length;q++){l=h[q];j=0;if(l.match(/^(>|\;)/)){if(q===0)sequence.description=l.replace(/^(>|\;)(\s\t)+/,"")}else for(l=l.toUpperCase().replace(/[^A-Z\*\-]+/,"");j<l.length;){p=l.charAt(j);if(j===this.maxSequenceLength)break b;if(!p.match(/\d|\s|\t/)){if(b.indexOf(p)>=0){m++;if(p==="U")g=true}sequence.string+=p}j++}}if(sequence.string==="")continue a;sequence.type=100*m/sequence.string.length<this.dnaThresholdPercent?"peptide":"dna";for(q=0;q<c.length;q++)if(c[q].string===sequence.string)continue a;if(!sequence.string.match(/^[A-Z\*]+$/))continue a;if(g===true)sequence.string=sequence.string.replace(/U/g,"T");c.push(sequence);if(c.length>=this.maxNumSequences)break a}b=a=h=j=l=p=m=q=t=null;return{sequences:c,invalids:n-c.length,is_rna:g}},addEditingJobSequences:function(a,b){var c=0;a:for(;c<a.length;c++){for(var g=this.sequences.length-1;g>=0;g--)if(a[c].sequence===this.sequences[g].string)continue a;if(this.sequences.length>=this.maxNumSequences)break;this.sequences.push(new o.Class.BlastFormSequence({string:a[c].sequence,description:">"+(a[c].display_id||""),type:b},this,false))}if(this.sequences.length){this.setQueryTypeValue(b);this.toggleSequenceFields(false)}this.updateSeqInfo({added:this.sequences.length});return this.sequences.length},modifySequence:function(a,b){b&&this.addSequences(b,a)?this.updateSeqInfo(true):this.removeSequence(a)},removeSequence:function(a){this.sequences.splice(this.sequences.indexOf(a),1);a.destructor();a=!!this.sequences.length;this.updateSeqInfo(a);this.toggleSequenceFields(!a);this.setQueryTypeValue()},toggleSequenceFields:function(a){this.elLk.sequenceField.toggle(a);this.elLk.sequenceInput.val("").focus();this.elLk.sequenceInfo&&this.elLk.sequenceInfo.toggle(!a);if(a){this.elLk.sequenceInputClose.toggle(!!this.sequences.length);this.sequences.length||this.elLk.sequences.hide()}this.adjustDivsHeight()},setQueryTypeValue:function(a){if(a)this.selectedQueryType=a;else{a=this.selectedQueryType;if(!a){var b={peptide:0,dna:0};f.each(this.sequences,function(){b[this.guessedType]++});a=b.peptide===b.dna?this.elLk.queryType.filter(":checked").val():b.peptide<b.dna?"dna":"peptide"}}this.elLk.queryType.filter("[value="+a+"]").prop("checked",true);this.resetSearchTools()},isBlatAvailable:function(a){var b=this;a=a||this.getSelectedSpecies();var c=1;f.each(a,function(g,h){if(!b.blatAvailability[h]){c=0;return false}});return c?true:false},resetSearchTools:function(a,b){var c=this,g=this.elLk.queryType.filter(":checked").val(),h=this.elLk.dbType.filter(":checked").val(),j=this.elLk.source.filter("[name=source_"+h+"]").val(),l=[];b=this.isBlatAvailable(b?b:this.getSelectedSpecies());a=a||!this.searchToolUserSelection&&b&&this.blat_value;for(var p=this.combinations.length-1;p>=0;p--)if(this.combinations[p].query_type===g&&this.combinations[p].db_type===h&&this.combinations[p].sources.indexOf(j)>=0)if(this.sequences.length)for(var m=this.sequences.length-1;m>=0;m--)this.sequences[m].string.length>this.combinations[p].min_length&&l.push(this.combinations[p].search_type);else l.push(this.combinations[p].search_type);this.elLk.searchType.empty().append(this.elLk.searchTypeOptions.filter(function(){return l.indexOf(this.value)>=0}).clone()).find("option[value="+(a||c.searchToolUserSelection||"")+"]").prop("selected",true).end().selectToToggle("trigger").trigger("change");!b&&this.elLk.searchType.find("option[value="+this.blat_value+"]").remove();if(c.restrictions[this.elLk.searchType.val()])f.each(c.restrictions[this.elLk.searchType.val()],function(n,q){c.sourceRemoved.push(c.elLk.form.find("[name=source_dna] option[value='"+q.value+"']").replaceWith(""))});else if(c.sourceRemoved.length){f.each(c.sourceRemoved,function(n,q){c.elLk.form.find("[name=source_dna]").append(q)});c.sourceRemoved=[]}},resetSourceTypes:function(a){for(var b=[],c=a.length-1;c>=0;c--)b=b.concat(this.missingSources[a[c]]||[]);this.elLk.source.find("option").prop("disabled",function(){return b.indexOf(this.value)>=0}).end().each(function(){var g=f(this).find("option:enabled");g.filter(":selected").length||g.first().prop("selected",true)})},updateSeqInfo:function(a){var b=this;if(a){if(a.is_rna===true&&this.rnaMessageDisplayed===false){f("[name=query_type]:first").parent().before('<div class="rna_seq_message bottom-margin">You have added a RNA sequence. However, it has been replaced by its DNA equivalent.</div>');this.rnaMessageDisplayed=true}}else{f(".rna_seq_message").remove();this.rnaMessageDisplayed=false}if(!this.elLk.sequenceInfo)this.elLk.sequenceInfo=f('<div class="italic">').appendTo(this.elLk.sequences).on("click","a",function(g){g.preventDefault();b.elLk.sequenceInfo.hide();b.toggleSequenceFields(true)});var c=f.type(a)==="object"?(parseInt(a.added)||"No")+(this.sequences.length-a.added?" more":"")+" sequence"+(a.added>1?"s":"")+" added"+(a.invalids?" ("+a.invalids+" invalid or duplicate sequence"+
(a.invalids>1?"s":"")+" ignored)":"")+", ":"";this.elLk.sequenceInfo.toggle(!!a).html((this.maxNumSequences===this.sequences.length?"":'<a href="#">Add more sequences</a> ')+"("+c+(this.maxNumSequences-this.sequences.length||(c?"no":"No"))+(this.sequences.length?" more":"")+" sequence"+(this.maxNumSequences-this.sequences.length>1?"s":"")+" allowed)")},resetSpecies:function(a){a=f.map(a,function(b){return{key:b,title:b}});o.EventManager.deferTrigger("updateTaxonSelection",a)},getSelectedSpecies:function(){return this.elLk.form.find("input[name=species]").filter(":checked").map(function(){return this.value}).toArray()},setSensitivityConfigs:function(a){var b=this;if(typeof a==="string")a=this.elLk.sensitivityOptions.filter("[name$="+a+"]").first();if(a.length){var c=a.prop("name").replace("config_set_","");a=a.find("option:selected").val();var g=false;if(c in this.sensitivityConfigs)if(a in this.sensitivityConfigs[c])g=this.sensitivityConfigs[c][a];g&&!f.isEmptyObject(g)&&f.each(g,function(h,j){b.elLk.form.find("[name="+c+"__"+h+"]").filter("input").prop("checked",!!j).end().filter("select").find('option[value="'+
j+'"]').prop("selected",true).end().selectToToggle("trigger")});c=a=g=null}}});o.Class.BlastFormSequence=o.Class.ToolsFormSubElement.extend({constructor:function(a,b,c){this.base();var g=this;this.parent=b;this.elLk.input=f("<input>",{type:"hidden",name:"sequence",value:""});this.elLk.close=b.elLk.sequenceInputClose.clone().helptip({content:"Remove sequence"}).show().on("click",function(){g.parent.removeSequence(g)});this.elLk.seqBox=f("<div>",{"class":"fasta-input"}).on({click:function(){f(this).filter(":not(.editable)").addClass("editable").prop({contentEditable:true,spellcheck:false}).focus().data("prevSequence",f(this).text())},"blur keyup":function(h){if(h.type==="blur"||h.type==="keyup"&&h.which===27){var j=f(this).filter(".editable").removeClass("editable").prop("contentEditable",false).find("br").replaceWith("\n").end().end();if(h.type==="keyup")j.text(j.data("prevSequence"));else j.data("prevSequence")!=j.text()&&g.parent.modifySequence(g,j.text())}},keypress:function(h){if(h.which===13)if(D.getSelection){h.preventDefault();h=D.getSelection();var j=h.getRangeAt(0),l=N.createElement("br");j.deleteContents();j.insertNode(l);j.setStartAfter(l);j.setEndAfter(l);j.collapse(false);h.removeAllRanges();h.addRange(j)}}});this.elLk.div=f("<div>",{"class":"seq-wrapper"}).append(this.elLk.input,this.elLk.seqBox,this.elLk.close).appendTo(b.elLk.sequences.show()).insertBefore(c&&c.elLk.div.next()||b.elLk.sequenceInfo).end();this.init(a)},init:function(a){this.string=a.string;this.type=a.type;this.description=a.description;this.guessedType=a.type;a=this.description+"\n"+
this.string.match(/(.{1,60})/g).join("\n");this.elLk.input.val(a);this.elLk.seqBox.text(a)}});o.Panel.BlastSpeciesList=o.Panel.extend({init:function(){this.base();this.elLk.checkboxes=f(".checkboxes",this.el);this.elLk.speciesList=f('.checkboxes input[name="species"]',this.el);this.elLk.list=f(".list",this.el);this.elLk.modalLink=f(".modal_link",this.el);o.species&&o.species!=="Multi"&&this.updateTaxonSelection([{key:o.species,title:o.species}]);o.EventManager.register("updateTaxonSelection",this,this.updateTaxonSelection)},updateTaxonSelection:function(a){var b=this,c,g=[];b.elLk.list.empty();b.elLk.checkboxes.empty();f.each(a,function(l,p){c=p.key.charAt(0).toUpperCase()+p.key.substr(1);l=f("<span/>",{text:"x","class":"ss-selection-delete",click:function(){var q=f(this).parent("li").find("span.ss-selected").html(),t=[];if(q==="Homo_sapiens"||q==="Human")b.el.find("div.assembly_msg").hide();f.each(a,function(v,x){q!==x.title&&t.push(x)});o.EventManager.trigger("updateTaxonSelection",t);f(this).parent("li").remove()}});if(p.title==="Homo_sapiens"||p.title==="Human")b.el.find("div.assembly_msg").show();p.img_url=o.speciesImagePath+p.key+".png";var m=f("<img/>",{src:p.img_url,"class":"nosprite"}),n=f("<span/>",{text:p.title,"data-title":p.title,"data-key":p.key,"class":"ss-selected",title:p.title});f("<li/>",{}).append(m,n,l).appendTo(b.elLk.list);f(b.elLk.checkboxes).append('<input type="checkbox" name="species" value="'+c+'" checked>'+p.title+"<br />");g.push(c)});o.EventManager.trigger("resetSearchTools",null,g);o.EventManager.trigger("resetSourceTypes",g);if(b.elLk.modalLink.length){var h=b.elLk.modalLink.attr("href").split("?")[0],j=f.map(a,function(l){return l.key});j=f.param({s:j,multiselect:1,referer_action:"Blast"},true);b.elLk.modalLink.attr("href",h+"?"+j)}}});o.Panel.FileChameleonForm=o.Panel.ToolsForm.extend({init:function(){var a=this;this.base.apply(this,arguments);this.elLk.speciesDropdown=this.elLk.form.find("._sdd");this.elLk.formatRadio=this.elLk.form.find("input[name=format]");this.elLk.fileList=this.elLk.form.find("select[name=files_list]");this.elLk.chr_filter=this.elLk.form.find("input[name=chr_filter]");this.elLk.add_transcript=this.elLk.form.find("input[name=add_transcript]");this.elLk.remap_patch=this.elLk.form.find("input[name=remap_patch]");this.release_version=this.params.release_version;this.ftp_url=this.params.ftp_url;this.speciesname_map=this.params.speciesname_mapping;this.resetSpecies(this.defaultSpecies);this.editExisting();this.populateFileListing();this.elLk.speciesDropdown.on("change",function(){a.elLk.form.find("p.nofilter_note").hide();a.elLk.form.find("div._remap").hide();if(a.elLk.formatRadio.is(":checked")){a.elLk.fileList.hide();a.populateFileListing();a.elLk.form.find("div._filters").is(":visible")||a.elLk.form.find("p.nofilter_note").show()}else a.elLk.form.find("div._stt_fasta").hide()});this.elLk.formatRadio.on("change",function(){a.elLk.fileList.hide();a.elLk.form.find("p.nofilter_note").hide();a.elLk.form.find("div._remap").hide();a.populateFileListing();a.elLk.speciesDropdown.find("input:checked").hasClass("_stt__chr_filter")||a.elLk.form.find("div._stt_fasta").hide();a.elLk.form.find("div._filters").is(":visible")||a.elLk.form.find("p.nofilter_note").show()});this.elLk.form.find("span.file_link a").on("click",function(b){b.preventDefault();a.elLk.form.find("span._file_text").hide();a.elLk.fileList.show().trigger("focus");a.elLk.form.find("span.file_link").hide()});this.elLk.fileList.on("change",function(){a.elLk.fileList.hide();a.elLk.fileList.find('option[value="'+this.value+'"]').prop("selected",true);a.elLk.form.find("span._file_text").html(a.elLk.form.find("select[name=files_list] option:selected").text()).show();a.elLk.form.find("input[name=file_text]").val(a.elLk.form.find("select[name=files_list] option:selected").text());a.elLk.form.find("span.file_link").show()});this.elLk.form.find("select[name=files_list]:visible")&&a.elLk.fileList.on("focusout",function(){a.elLk.fileList.hide();a.elLk.form.find("span._file_text").html(a.elLk.form.find("select[name=files_list] option:selected").text()).show();a.elLk.form.find("input[name=file_text]").val(a.elLk.form.find("select[name=files_list] option:selected").text());a.elLk.form.find("span.file_link").show()});this.elLk.form.on("validate",function(){if(!a.elLk.formatRadio.is(":checked")){a.showError("Please choose a file format","No format choosen");f(this).data("valid",false)}});a.elLk.formatRadio.is(":checked")||this.elLk.form.find("div._stt_fasta").hide()},populateForm:function(a){if(a&&a.length){this.base(a);this.resetSpecies(a[0].species);if(a[0].file_url){this.elLk.formatRadio.filter("[value="+a[0].format+"]").prop("checked",true);this.populateFileListing(a[0].file_url)}this.elLk.speciesDropdown.find("input:checked").hasClass("_stt__chr_filter")||this.elLk.form.find("div._stt_chr_filter").hide();a[0].chr_filter&&this.elLk.form.find("select[name=chr_filter]").show().find("option[value="+a[0].chr_filter+"]").prop("selected",true);a[0].long_genes&&this.elLk.form.find("select[name=long_genes]").find("option[value="+a[0].long_genes+"]").prop("selected",true);a[0].add_transcript&&this.elLk.form.find("[name=add_transcript][value="+a[0].add_transcript+"]").prop("checked",true);a[0].remap_patch&&this.elLk.form.find("[name=remap_patch][value="+a[0].remap_patch+
"]").prop("checked",true)}},populateFileListing:function(a,b,c){var g=this;g.elLk.fileList.val();var h=b=b?b:this.elLk.form.find("input[name=format]:checked").val().toLowerCase();c=c?c:g.speciesname_map[g.elLk.speciesDropdown.find("input:checked").val()];a=a&&a.match(/(^http:\/\/.*\/)/gi)?a.replace(/(^http:\/\/.*\/)/gi,""):a;var j,l;if(b==="fasta"){c+="/dna";h="fa";j=g.elLk.speciesDropdown.find("input:checked").parent().find("label").html().replace(/\(.*\)/,"")+"genome assembly";a=a?a:"dna\\.toplevel\\."}else{j=g.elLk.speciesDropdown.find("input:checked").parent().find("label").html().replace(/\(.*\)/,"")+"gene set";a=a?a:"(\\d+)\\."+b}var p=g.ftp_url+b+"/"+c+"/";f.ajax({url:p,dataType:"html",beforeSend:function(){g.toggleSpinner(true)},success:function(m){m=m.replace(/<img(.*?)>/g);var n="";f(m).find("a:contains(."+h+")").each(function(){var q=f(this).attr("href");l=(selected=(a=b==="fasta"&&q.match(/dna\.primary_assembly/i)&&!a.match(/http/i)?"dna\\.primary_assembly":a)&&q.match(new RegExp(a,"i"))?'selected="selected"':"")?j+" ("+q+")":q.match(/chr_patch_hapl_scaff/i)?j+" with patches ("+q+")":q;n+='<option value="'+p+q+'"'+selected+">"+l+"</option>"});g.elLk.fileList.html("").append(n);g.elLk.form.find("span._file_text").html(g.elLk.form.find("select[name=files_list] option:selected").text()).show();g.elLk.form.find("input[name=file_text]").val(g.elLk.form.find("select[name=files_list] option:selected").text());g.elLk.form.find("span.file_link").show();g.elLk.fileList.find('option[value*="chr_patch_hapl_scaff"]').length&&b==="gff3"?g.elLk.form.find("div._remap").show():g.elLk.form.find("div._remap").hide();if(g.elLk.form.find("div._remap").is(":visible")&&g.elLk.remap_patch.is(":checked")){g.elLk.fileList.find('option[value*="chr_patch_hapl_scaff"]').prop("selected",true);g.elLk.form.find("span._file_text").html(g.elLk.form.find("select[name=files_list] option:selected").text()).show();g.elLk.form.find("input[name=file_text]").val(g.elLk.form.find("select[name=files_list] option:selected").text())}g.elLk.remap_patch.on("change",function(){g.elLk.form.find("div._remap").is(":visible")&&g.elLk.remap_patch.is(":checked")?g.elLk.fileList.find('option[value*="chr_patch_hapl_scaff"]').prop("selected",true):g.elLk.fileList.find('option[value*="'+("(\\d+)\\."+b)+'"]').prop("selected",true);g.elLk.form.find("span._file_text").html(g.elLk.form.find("select[name=files_list] option:selected").text()).show();g.elLk.form.find("input[name=file_text]").val(g.elLk.form.find("select[name=files_list] option:selected").text())})},complete:function(){g.toggleSpinner(false)},error:function(){g.showError('The files you requested are currently unavailable for download. Please try again later and <a href="/Help/Contact" class="popup">contact us</a> if you are still having problems.',"Files unavailable");f(g.elLk.form).data("valid",false);g.toggleSpinner(false,"","")}})},reset:function(){this.base.apply(this,arguments);this.resetSpecies(this.defaultSpecies);this.elLk.form.find('input[name="format"]').selectToToggle("trigger");this.elLk.form.find("p.nofilter_note").hide()},resetSpecies:function(a){this.elLk.speciesDropdown.find("input[value="+a+"]").first().click();this.elLk.speciesDropdown.speciesDropdown({refresh:true})}});o.Panel.IDMapperForm=o.Panel.ToolsForm.extend({init:function(){this.base.apply(this,arguments);this.elLk.speciesDropdown=this.elLk.form.find("._sdd");this.resetSpecies(this.defaultSpecies);this.editExisting()},reset:function(){this.base.apply(this,arguments);this.resetSpecies(this.defaultSpecies);this.elLk.form.find("._previous_file").remove()},populateForm:function(a){if(a&&a.length){this.base(a);this.resetSpecies(a[0].species);a[0].file&&this.elLk.form.find("input[name=file]").parent().append(f('<p class="_previous_file">').html("You previously uploaded a file named "+a[0].file+" to run this job."))}},resetSpecies:function(a){this.elLk.speciesDropdown.find("input[value="+a+"]").first().click();this.elLk.speciesDropdown.speciesDropdown({refresh:true})}});o.Panel.ThousandGenome=o.Panel.ToolsForm.extend({init:function(){var a=this;this.base.apply(this,arguments);this.elLk.speciesDropdown=this.elLk.form.find("._sdd");this.elLk.collection=this.elLk.form.find("select[name=collection_format]");this.elLk.region=this.elLk.form.find("input[name=region]");this.elLk.sample_url=this.elLk.form.find("input[name=custom_sample_url]");this.elLk.file_url=this.elLk.form.find("input[name=custom_file_url]");this.readSampleFile=this.params.read_sample_file;this.fileRestURL=this.params.genome_file_rest_url;this.filesLocation=this.params.files_location_regex;this.getIndividuals=this.params.get_individuals;this.editExisting();a.elLk.region.on("blur",function(){f(this).data("old",f(this).data("new")||"");f(this).data("new",f(this).val());if(f(this).data("old")!==f(this).data("new")){var b=a.elLk.collection.val(),c=a.elLk.region.val().replace(/\s/g,"").match(/^([^:]+):\s?([0-9\,]+)(-|_|\.\.)([0-9\,]+)$/);if(!(!c||c.length!==5||c[4]-c[2]<0))if(a.elLk.form.find("input[name=region_check]").length&&parseFloat(c[4].replace(/,/gi,""))-parseFloat(c[2].replace(/,/gi,""))+1>parseInt(a.elLk.form.find("input[name=region_check]").val())){a.showError("The region size is too big, maximum region size allowed is "+
parseInt(a.elLk.form.find("input[name=region_check]").val()),"Large region size");f(a.elLk.form).data("valid",false)}else{f(a.elLk.form).data("valid",true);b!="custom"&&!a.elLk.form.find("input[name=bam_file_url]").is(":visible")&&a.getFileURL(c[1],b);if(a.elLk.region.val().match(/y:/gi)&&b==="phase3"){a.elLk.form.find("input[name=no_population]").val()||a.updatePopulation("","_stt_phase3_male");a.elLk.form.find('[class^="_sample_url_"]').hide();a.elLk.form.find("span._sample_url_phase3_male").show()}else{a.elLk.form.find("span._stt_phase3_male").hide();if(b!="custom"){a.elLk.form.find("span._stt_"+b).show();a.elLk.form.find("span._sample_url_phase3_male").hide()}}}}});a.elLk.collection.on("change",function(){var b=a.elLk.region.val().replace(/\s/g,"").match(/^([^:]+):\s?([0-9\,]+)(-|_|\.\.)([0-9\,]+)$/);a.elLk.collection.val()!="custom"&&a.elLk.form.find("div.custom_population").hide();a.elLk.collection.val()==="custom"&&a.elLk.sample_url.val()&&a.elLk.form.find("div.custom_population").show();a.elLk.collection.val()!="custom"&&a.elLk.region.val()&&a.getFileURL(b[1],a.elLk.collection.val());if(a.elLk.collection.val()==="phase3"&&a.elLk.region.val().match(/y:/gi)){a.elLk.form.find("input[name=no_population]").val()||a.updatePopulation("","_stt_phase3_male");a.elLk.form.find('[class^="_sample_url_"]').hide();a.elLk.form.find("span._sample_url_phase3_male").show()}else{a.elLk.form.find("div._stt_phase3_male").hide();a.elLk.form.find("span._sample_url_phase3_male").hide()}});a.elLk.sample_url.on("change",function(){var b=f(this);if(a.elLk.sample_url.val()){b.parents("form").validate();if(b.data("valid"))a.elLk.form.find("input[name=no_population]").val()||a.updatePopulation(a.elLk.sample_url.val().replace(/^\s+|\s+$/g,""),"custom_populations");else{a.elLk.form.find("div.custom_population select").html("");a.elLk.form.find("div.population").hide()}}else{a.showError("Please provide a sample population URL","No sample population URL");f(a.elLk.form).data("valid",false)}});this.elLk.form.on("validate",function(){if(a.elLk.region.val()){var b=a.elLk.region.val().replace(/\s/g,"").match(/^([^:]+):\s?([0-9\,]+)(-|_|\.\.)([0-9\,]+)$/);if(!b||b.length!==5||b[4]-b[2]<0){a.showError("Please enter a valid region e.g: 1:1-50000","Invalid Region Lookup");f(a.elLk.form).data("valid",false)}else{if(a.elLk.form.find("input[name=region_check]").length)if(parseFloat(b[4].replace(/,/gi,""))-parseFloat(b[2].replace(/,/gi,""))+1>parseInt(a.elLk.form.find("input[name=region_check]").val())){a.showError("The region size is too big, maximum region size allowed is "+parseInt(a.elLk.form.find("input[name=region_check]").val()),"Large region size");f(a.elLk.form).data("valid",false);return}if(!a.elLk.form.find("input[name=generated_file_url]").val().match(/^ftp|^http/gi)&&a.elLk.form.find("span._span_url").is(":visible")){a.showError("Genotype file URL missing, Please make sure you entered the correct region","Genotype file URL missing");f(a.elLk.form).data("valid",false)}else{if(a.elLk.collection.is(":visible")&&a.elLk.collection.val()==="custom"){if(!a.elLk.file_url.val()){a.showError("Please provide a file URL","No file URL");f(this).data("valid",false);return}if(a.elLk.sample_url.is(":visible")&&!a.elLk.sample_url.val()){a.showError("Please provide a sample population URL","No sample population URL");f(this).data("valid",false);return}}if(a.elLk.form.find("select.tools_listbox").is(":visible")&&!a.elLk.form.find("select.tools_listbox:visible").val()){a.showError("Please choose at least one population","No population");f(this).data("valid",false)}else if(a.elLk.form.find("input[name=bam_file_url]").is(":visible")&&!a.elLk.form.find("input[name=bam_file_url]").val()){a.showError("Please provide a BAM file url","No file URL");f(this).data("valid",false)}else if(a.elLk.form.find("select.individuals_listbox").is(":visible")&&!a.elLk.form.find("select.individuals_listbox").val()&&a.elLk.form.find("input[name=ind_list]").is(":visible")&&!a.elLk.form.find("input[name=ind_list]").val()){a.showError("Please choose at least one inidividuals","No individuals");f(this).data("valid",false)}else if(a.elLk.form.find("input[name=which_tool]").val()==="data_slicer"&&a.elLk.form.find("select.tools_listbox").is(":visible")){b=a.elLk.form.find("select.tools_listbox:visible option:selected").map(function(){return f(this).text()}).get().join();a.elLk.form.find("input[name=pop_caption]").val(b)}}}}else{a.showError("Please enter a region","No region entered");f(this).data("valid",false)}})},getFileURL:function(a,b){var c=this,g;a=a.match(/^chr/gi)?a:"chr"+a;b="1000 Genomes phase "+b.replace("phase","")+" release";f.ajax({type:"POST",url:c.fileRestURL,data:JSON.stringify({query:{regexp:{url:c.filesLocation}},size:"-1",_source:["url"]}),beforeSend:function(){c.toggleSpinner(true)},success:function(h){if(!h.hits||!h.hits.total){c.elLk.form.find("span._span_url").html('<label class="invalid" style="display: inline;">Genotype file URL: We were unable to retrieve the file, please try again later.(No file obtained)</label>');c.elLk.form.find("input[name=generated_file_url]").val("")}else{f.each(h.hits.hits,function(j,l){if(l._source.url&&!l._source.url.match(/tbi$/gi)&&(l._source.url.match(new RegExp(a+"\\.","i"))||l._source.url.match(new RegExp(a+
"_","i"))))g=l._source.url});c.elLk.form.find("span._span_url").html("Genotype file URL: "+g);c.elLk.form.find("input[name=generated_file_url]").val(g)}},complete:function(){c.toggleSpinner(false);c.elLk.form.find("select.individuals_listbox").is(":visible")&&"updateIndividuals"in c&&c.updateIndividuals()},error:function(){c.toggleSpinner(false);c.elLk.form.find("span._span_url").html('<label class="invalid" style="display: inline;">Genotype file URL: We were unable to retrieve the file, please try again later.</label>');c.elLk.form.find("input[name=generated_file_url]").val("")}})},populateForm:function(a){if(a&&a.length){this.base(a);var b=a[0].upload_type,c=a[0].file_format,g=a[0].vcf_filters;a[0].job_desc&&this.elLk.form.find("input[name=name]").val(a[0].job_desc);if(c){this.elLk.form.find("select[name=file_format]").find("option[value="+c+"]").prop("selected",true).end().selectToToggle("trigger");if(c==="bam"){this.elLk.form.find("input[name=bam_file_url]").val(a[0].file_url);a[0].bai_file&&this.elLk.form.find("input[name=bai_file]").prop("checked",true)}}if(c&&c==="vcf")if(g==="populations")this.populatePopulations(a);else if(g==="individuals"){this.elLk.form.find("select[name=collection_format] option").removeAttr("selected");this.elLk.form.find("select[name=collection_format]").find("option[value="+b+"]").prop("selected",true).end().selectToToggle("trigger");this.elLk.form.find("span._span_url").html("Genotype file URL: "+a[0].file_url);this.elLk.form.find("input[name=generated_file_url]").val(a[0].file_url);this.updateIndividuals(a[0].individuals_box?a[0].individuals_box:"");this.elLk.form.find("input[name=ind_list]").val(a[0].individuals_text)}else{this.elLk.form.find("select[name=collection_format] option").removeAttr("selected");this.elLk.form.find("select[name=collection_format]").find("option[value="+b+"]").prop("selected",true).end().selectToToggle("trigger");this.elLk.form.find("span._span_url").html("Genotype file URL: "+a[0].file_url);this.elLk.form.find("input[name=generated_file_url]").val(a[0].file_url)}else this.populatePopulations(a);this.elLk.form.find("input[name=base]").length&&a[0].base&&this.elLk.form.find("input[name=base][value="+a[0].base+"]").prop("checked",true)}},populatePopulations:function(a){var b=a[0].upload_type;if(b==="custom"){this.elLk.form.find("select[name=collection_format] option").removeAttr("selected");this.elLk.form.find("select[name=collection_format]").find("option[value=custom]").prop("selected",true).end().selectToToggle("trigger");this.elLk.form.find("input[name=custom_file_url]").val(a[0].file_url);this.elLk.form.find("input[name=custom_sample_url]").val(a[0].sample_panel);a[0].population&&this.updatePopulation(a[0].sample_panel,"custom_population",a[0].population)}else{var c=this.elLk.form.find("input[name=region]").val().match(/y:/gi)&&b==="phase3"?"phase3_male":b;this.elLk.form.find("select[name=collection_format] option").removeAttr("selected");this.elLk.form.find("select[name=collection_format]").find("option[value="+b+"]").prop("selected",true).end().selectToToggle("trigger");this.elLk.form.find("span._span_url").html("Genotype file URL: "+
a[0].file_url);this.elLk.form.find("input[name=generated_file_url]").val(a[0].file_url);this.elLk.form.find('[class^="_sample_url_"]').hide();this.elLk.form.find("span._sample_url_"+c).show();a[0].population&&this.updatePopulation("","_stt_"+c,a[0].population)}},reset:function(){this.base.apply(this,arguments);this.elLk.form.find("div.population").hide();this.elLk.form.find("select[name=collection_format]").find("option[value=phase3]").prop("selected",true).end().selectToToggle("trigger");this.elLk.form.find("select[name=phase3_populations]").find("option[value=ALL]").prop("selected",true);this.elLk.form.find("span._span_url").html("Genotype file URL: ").show();this.elLk.form.find("input[name=generated_file_url]").val("")},updatePopulation:function(a,b,c){var g=this,h=g.elLk.form.find("input[name=which_tool]").val()==="data_slicer"?1:0;if(a)f.ajax({comet:true,type:"POST",url:g.readSampleFile,dataType:"json",data:{population_url:a,pop_value:h},beforeSend:function(){g.toggleSpinner(true)},success:function(l){var p="";if(l.error){g.showError("The sample population url is either invalid or not reachable","Invalid sample population URL");g.elLk.form.find("div.custom_population select").html("");g.elLk.form.find("div.population").hide();f(g.elLk.form).data("valid",false);g.ajax.spinner="false"}else if(l.format_error){g.showError(l.format_error,"Wrong sample population file content");g.elLk.form.find("div.custom_population select").html("");g.elLk.form.find("div.population").hide();f(g.elLk.form).data("valid",false);g.ajax.spinner="false"}else{f.each(l.populations,function(m,n){if(n.value){n.value.match(/sample/gi);p+='<option value="'+n.value+'">'+n.caption+"</option>"}});g.elLk.form.find("div.custom_population").show();g.elLk.form.find("div.custom_population select").html("").append(p);c&&f.each(c.split(","),function(m,n){h?g.elLk.form.find("div.custom_population select").find("option:contains("+n+")").prop("selected",true):g.elLk.form.find("div.custom_population select").find("option[value="+n+"]").prop("selected",true)})}},complete:function(){g.toggleSpinner(false)}});else{this.elLk.form.find("div.population").hide();this.elLk.form.find("div."+b).show();if(c){var j=b.replace("_stt_","")+"_populations";this.elLk.form.find("select[name="+j+"] option").removeAttr("selected");f.each(c.split(","),function(l,p){h?g.elLk.form.find("select[name="+j+"]").find("option:contains("+p+")").prop("selected",true):g.elLk.form.find("select[name="+j+"]").find("option[value="+p+"]").prop("selected",true)})}}}});o.Panel.VEPForm=o.Panel.ToolsForm.extend({init:function(){this.base();this.resetSpecies(this.defaultSpecies);this.consequencesData=this.params.consequences_data;delete this.params.consequences_data;this.exampleData=this.params.example_data;delete this.params.example_data;var a=this;a.elLk.form.find("input[name=core_type]").each(function(){if(f(this).val()=="gencode_basic")f(this).parent().addClass("_stt_Homo_sapiens _stt_Mus_musculus");else{var b=f(this).next().html().replace("Ensembl ",'Ensembl<span class="_stt_Homo_sapiens _stt_Mus_musculus">/GENCODE</span> ');f(this).next().html(b)}});this.elLk.form.find("a._example_input").on("click",function(b){b.preventDefault();b=a.elLk.form.find("input[name=species]:checked").val()||a.elLk.form.find("input[name=species]").val();b=a.exampleData[b][this.rel];if(typeof b==="undefined"||!b.length)b="";b=b.replace(/\\n/g,"\n");a.elLk.dataField.val(b).trigger("focus")});this.elLk.previewButton=a.elLk.form.find("[name=preview]").hide().on("click",function(b){b.preventDefault();a.enablePreviewButton(false);a.preview(f(this).data("currentVal"),{left:b.pageX,top:b.pageY})});this.elLk.previewDiv=f('<div class="vep-preview-div">').appendTo(f(N.body));this.elLk.dataField=this.elLk.form.find("textarea[name=text]").on({"paste keyup click change focus scroll":function(b){a.dataFieldInteraction(b.type)}});this.elLk.previewButton.appendTo(this.elLk.dataField.parent());this.elLk.form.find(".plugin_enable").change(function(){a.elLk.form.find(".plugin-highlight").removeClass("plugin-highlight");a.elLk.form.find("._stt_"+this.name).addClass("plugin-highlight",100,"linear")});this.elLk.form.find(".plugin_enable").each(function(){a.elLk.form.find("._stt_"+
this.name).find(":input").change(function(){a.elLk.form.find(".plugin-highlight").removeClass("plugin-highlight")})});this.editExisting();this.resetSelectToToggle()},dataFieldInteraction:function(){var a=this,b=this.elLk.dataField[0].value,c=o.browser.webkit?13:15;this.elLk.dataField.removeClass("focused");this.elLk.previewButton.hide();if(this.elLk.dataField.data("previousValue")!==b){this.elLk.dataField.data("previousValue",b);this.elLk.dataField.data("inputFormat",function(j){j=a.detectFormat(j.split(/[\r\n]+/)[0]);if(j==="id"||j==="vcf"||j==="ensembl"||j==="hgvs"||j==="spdi")return j;return false}(b))}if(!this.dataFieldHeight)this.dataFieldHeight=this.elLk.dataField.height();if(b.length)if(this.elLk.dataField.data("inputFormat")){if(!this.elLk.fakeDataField)this.elLk.fakeDataField=f('<div class="vep-input-div">').appendTo(this.elLk.form);var g=this.elLk.dataField.prop("selectionStart"),h=b.substr(0,g).replace(/.+[\r\n]/g,"")+b.substr(g).replace(/[\r\n].+/g,"");if(h.length){b=this.elLk.fakeDataField.html(b.substr(0,g)+"x").show().height()-c-this.elLk.dataField.scrollTop();this.elLk.fakeDataField.hide();this.elLk.dataField.addClass("focused").css("background-position","0 "+b+"px");this.elLk.previewButton.show().css("margin-top",Math.max(Math.min(b,this.dataFieldHeight-c),0)+1).data("currentVal",h)}}},preview:function(a,b){if(a){this.elLk.previewDiv.empty().removeClass("active").addClass("loading").css(b);this.previewInp={};this.previewInp.input=a;this.previewInp.format=this.detectFormat(a);this.previewInp.species=this.elLk.speciesDropdown.find("input:checked").val();this.previewInp.baseURL=this.params.rest_server_url+"/vep/"+this.previewInp.species;switch(this.previewInp.format){case"id":a=this.previewInp.baseURL+"/id/"+this.previewInp.input;break;case"hgvs":a=this.previewInp.baseURL+"/hgvs/"+encodeURIComponent(this.previewInp.input);break;case"ensembl":var c=this.previewInp.input.split(/\s+/);a=this.previewInp.baseURL+"/region/"+c[0]+":"+c[1]+"-"+c[2]+":"+(c[4]&&c[4].match(/\-/)?-1:1)+"/"+c[3].replace(/[ACGTN-]+\//,"");break;case"vcf":c=this.previewInp.input.split(/\s+/);a=c[0];b=c[3];var g=c[4].split(",")[0];if(!g.match(/[ACGTN]+/i)){this.previewError("allele must be [ACGT]");return}c=parseInt(c[1]);var h=c+(b.length-1);if(b.length!=g.length){c+=1;g=g.length===1?"-":g.substring(1)}a=this.previewInp.baseURL+"/region/"+a+":"+c+"-"+h+":1/"+g;break;case"spdi":c=this.previewInp.input.split(/:/);a=c[0];b=c[2]==""?"-":c[2];g=c[3]==""?"-":c[3];c=parseInt(c[1])+1;h=c+(b.length-1);a=this.previewInp.baseURL+"/region/"+
a+":"+c+"-"+h+":1/"+g;break;default:this.previewError("Failed for "+this.previewInp.format+" format");return}this.elLk.previewDiv.html('<p><img src="/i/ajax-loader.gif"/></p>');f.ajax({url:a,type:"GET",dataType:"json",context:this,success:function(j){this.renderPreviewTable(j)},error:function(j){this.previewError(j.responseJSON?j.responseJSON.error:"Unknown error")}})}},detectFormat:function(a){a=a.split(/\s+/);return a.length===1&&a[0].match(/^(.*?\:){2}([^\:]+|)$/i)?"spdi":a.length===1&&a[0].match(/^([^\:]+)\:.*?([cgmrp]?)\.?([\*\-0-9]+.*)$/i)?"hgvs":a.length===1?"id":a.length>=5&&a[0].match(/(chr)?\w+/)&&a[1].match(/^\d+$/)&&a[3].match(/^[ACGTN\-\.]+$/i)&&typeof a[4]!="undefined"&&a[4].match(/^([\.ACGTN\-]+\,?)+$|^(\<\w+\>)$/i)?"vcf":a.length>=4&&a[0].match(/\w+/)&&a[1].match(/^\d+$/)&&a[2].match(/^\d+$/)&&a[3].match(/(ins|dup|del)|([ACGTN-]+\/[ACGTN-]+)/i)?"ensembl":"unknown"},renderPreviewTable:function(a){var b=this;if(!a||!a.length)this.previewError("Invalid response from "+this.params.rest_server_url);else{a=a[0];var c=function(l,p){return f('<table class="ss">').html("<thead><tr>"+f.map(l,function(m){return"<th>"+m+"</th>"}).join("")+"</tr></thead>").append(f.map(p,function(m,n){return f("<tr>").addClass(n%2?"bg2":"bg1").append(f.map(m,function(q){return f("<td>").html(q)}))}))},g=function(l){return b.consequencesData[l]?f("<nobr>").append(f("<span>").addClass("colour").css("background-color",b.consequencesData[l].colour).html("&nbsp"),f("<span>").html("&nbsp;"),f("<span>").attr({"class":"_ht ht margin-left",title:b.consequencesData[l].description}).html(l)).wrap("<div>").parent().html():""},h=function(l,p,m,n){return f("<a>").attr({"class":"zmenu",href:"/"+l+"/ZMenu/"+p+"?"+p.replace(/[a-z]/g,"").toLowerCase()+"="+m}).html(n).wrap("<div>").parent().html()};this.elLk.previewDiv.removeClass("loading").html('<div class="hint"><h3><img src="/i/close.png" alt="Hide" class="_close_button" title="">Instant results for '+this.previewInp.input+'</h3><div class="message-pad"><div class="warning"><h3>Instant VEP</h3><div class="message-pad"><p>The below is a preview of results using the <i>'+
this.previewInp.species.replace("_"," ")+'</i> Ensembl transcript database and does not include all data fields present in the full results set. To obtain these please <b>close this preview window and submit the job using the <a class="button">Run</a> button below</b>.</p></div></div><p><b>Most severe consequence:</b> '+g(a.most_severe_consequence)+"</p>"+(a.colocated_variants?"<p><b>Colocated variants:</b> "+f.map(a.colocated_variants,function(l){return h(b.previewInp.species,"Variation",l.id,l.id)+
(l.minor_allele_freq?" <i>(MAF: "+l.minor_allele_freq+")</i>":"")}).join(", ")+"</p>":"")+'<div class="vep-preview-table _preview_table"></div></div></div>');var j=[];a.transcript_consequences&&f.merge(j,f.map(a.transcript_consequences,function(l){var p=[];p.push('<p class="no-bottom-margin"><b>'+h(b.previewInp.species,"Gene",l.gene_id,l.gene_symbol||l.gene_id)+"</b>: "+h(b.previewInp.species,"Transcript",l.transcript_id,l.transcript_id)+'</p><p class="small no-bottom-margin"><b>Type: </b>'+l.biotype+
"</p>");p.push(l.consequence_terms.map(function(n){return g(n)}).join(", "));var m=[];l.amino_acids&&m.push("<b>Amino acids:</b> "+l.amino_acids);l.sift_prediction&&m.push("<b>SIFT:</b> "+l.sift_prediction);l.polyphen_prediction&&m.push("<b>PolyPhen:</b> "+l.polyphen_prediction);l.distance&&m.push("<b>Distance to transcript:</b> "+l.distance+"bp");m.length||(m=["-"]);p.push(f.map(m,function(n){return'<p class="no-bottom-margin">'+n+"</p>"}));return[p]}));a.regulatory_feature_consequences&&f.merge(j,f.map(a.regulatory_feature_consequences,function(l){return[["<b>"+h(b.previewInp.species,"RegulatoryFeature",l.regulatory_feature_id,l.regulatory_feature_id)+'</b><br/><span class="small"><b>Type: </b>'+l.biotype+"</span>",l.consequence_terms.map(function(p){return g(p)}).join(", "),"-"]]}));j.length&&this.elLk.previewDiv.find("._preview_table").append(c(["Gene/Feature/Type","Consequence","Details"],j));this.elLk.previewDiv.find("a.zmenu").on("click",function(l){l.preventDefault();o.EventManager.trigger("makeZMenu",this.innerHTML.replace(/\W/g,"_"),{event:l,area:{link:f(this)}})}).end().find("._ht").helptip().end().find("._close_button").on("click",function(){b.elLk.previewDiv.empty();b.enablePreviewButton()});this.elLk.previewDiv.addClass("active")}},previewError:function(a){this.elLk.previewDiv.removeClass("active loading");this.enablePreviewButton();alert("Unable to generate preview:\n"+a)},enablePreviewButton:function(a){a===false?this.elLk.previewButton.addClass("disabled").prop("disabled",true):this.elLk.previewButton.removeClass("disabled").removeAttr("disabled")},populateForm:function(a){if(a&&a.length){a=f.extend({},a[0].config,a[0]);this.base([a]);if(a.input_file_type)this.elLk.form.find("input[name=file]").parent().append('<p class="_download_link">'+(a.input_file_type==="text"?'Click <a href="'+a.input_file_url+'">here</a> to download the previously uploaded file.':"You previously uploaded a compressed file to run this job.")+"</p>");this.elLk.speciesDropdown.find("input:checked").length||this.elLk.speciesDropdown.find("input[type=radio]").first().click();this.resetSpecies(a.species);this.elLk.dataField.trigger("change")}},reset:function(){this.base.apply(this,arguments);this.elLk.form.find("._download_link").remove();this.elLk.dataField.removeClass("focused");this.elLk.previewDiv.empty().removeClass("active loading");this.elLk.previewButton.hide();this.resetSpecies(this.defaultSpecies);this.resetSelectToToggle()},resetSpecies:function(a){if(!this.elLk.speciesDropdown)this.elLk.speciesDropdown=this.elLk.form.find("._sdd");this.elLk.speciesDropdown.find("input[value="+
a+"]").first().click();this.elLk.speciesDropdown.speciesDropdown({refresh:true})}});o.Panel.DataSlicerForm=o.Panel.ThousandGenome.extend({init:function(){var a=this;this.base.apply(this,arguments);this.elLk.vcf_filters_radio=this.elLk.form.find("input[name=vcf_filters]");this.elLk.individuals=this.elLk.form.find("div._individuals");a.elLk.vcf_filters_radio.on("change",function(){if(a.elLk.form.find("input[name=vcf_filters]:checked").val()==="individuals")if(a.elLk.region.val())a.updateIndividuals();else{a.showError("Please choose a region first","Missing region");a.elLk.form.find("input[name=vcf_filters][value=null]").prop("checked",true);a.elLk.form.find("div._stt_individuals").hide()}});a.elLk.form.find("input[name=custom_file_url]").on("change",function(){})},reset:function(){this.base.apply(this,arguments);this.elLk.form.find("div._stt_populations").hide();this.elLk.form.find("div._stt_individuals").hide();this.elLk.form.find("select[name=file_format]").find("option[value=vcf]").prop("selected",true).end().selectToToggle("trigger");this.elLk.form.find("span._span_url").html("Genotype file URL: ").show();this.elLk.form.find("input[name=generated_file_url]").val("")},updateIndividuals:function(a){var b=this;f.ajax({comet:true,type:"POST",dataType:"json",url:b.getIndividuals,beforeSend:function(){b.toggleSpinner(true)},data:{file_url:b.elLk.form.find("input[name=custom_file_url]:visible").val()||b.elLk.form.find("input[name=generated_file_url]").val(),region:b.elLk.region.val()},success:function(c){var g="";if(c.error){b.showError("The file url is either invalid or not reachable","Invalid genotype file URL");b.elLk.form.find("div._individuals select").html("");f(b.elLk.form).data("valid",false);b.toggleSpinner(false)}else if(c.vcf_error){b.showError(c.vcf_error,"VCF file ERROR");b.elLk.form.find("div._individuals select").html("");f(b.elLk.form).data("valid",false);b.toggleSpinner(false)}else{f.each(c.individuals,function(h,j){if(j.value)g+='<option value="'+j.value+'">'+j.value+"</option>"});b.elLk.form.find("div._individuals").show();b.elLk.form.find("div._individuals select").html("").append(g);a&&f.each(a.split(","),function(h,j){b.elLk.form.find("div._individuals select").find("option[value="+j+"]").prop("selected",true)})}},complete:function(){b.toggleSpinner(false)}})}});o.GA&&D.location.href.match(/\/Tools\/[^\/]+\/Results/)&&function(a){a.oldLabel=a.label;a.label=function(){var b=this.oldLabel();if(b&&this.currentTarget.href.match(/\/Tools\/[^\/]+\/Results/))b="Tools Job Result";return b}}(o.GA.getConfig("LocalContext-LeftButton"));if(o.GA)o.Panel.Content=o.Panel.Content.extend({runBlastSeq:function(a){this.elLk.blastForm&&a&&o.GA.sendEvent(new o.GA.EventConfig({category:"LocalButton",action:"BlastSelectedSeq"}));this.base(a)}});(function(){(function(a){var b,c;a.fn.centered=function(g){var h;if(a.type(g)==="string"){if(g==="redo")return this.each(function(){return a(this).trigger("redo")})}else{h=a.extend({},a.fn.centered.defaults,g);return this.each(function(){b(a(this),h);return a(this).on("redo",function(){return b(a(this),h)})})}};b=function(g,h){var j,l,p,m,n;g.find(".centeredinner").length&&g.html(g.find(".centeredinner").html());p=a("<div/>").html(g.html()).css("word-wrap","break-word");g.empty().append(p).css("line-height","normal");p.addClass("centeredinner");n=null;j=l=h.min;m=h.max;for(h=h.inc;h>0?l<=m:l>=m;j=l+=h){p.css("font-size",j+"px");if(c(p))break;n=j}n&&p.css("font-size",n+"px");g=g.height()-p.outerHeight();if(g%2)g-=1;g/=2;return p.css({"margin-top":g,"margin-bottom":g,"text-align":"center"})};c=function(g){return g.height()>g.parent().height()||g.width()>g.parent().width()?true:false};return a.fn.centered.defaults={min:5,max:100,inc:5}})(jQuery)}).call(this);(function(){(function(a){var b,c,g,h,j;a.fn.selbox=function(l,p,m,n){var q;if(a.type(l)==="string")if(l==="activate")return this.each(function(){return a(this).trigger("selboxactivate",[true,p,m,n])});else if(l==="deactivate")return this.each(function(){return a(this).trigger("selboxactivate",[false])});else if(l==="maintext")return this.each(function(){return a(this).trigger("selboxtext",[p])});else{if(l==="select")return this.each(function(){return a(this).trigger("selboxselect",[p])})}else{q=a.extend({},a.fn.selbox.defaults,l);return this.each(function(){a(this).on("selboxtext",function(t,v){return j(a(this),v,q)});a(this).on("selboxselect",function(t,v){t=a(this).data("selboxul");if(t.length)return h(a(this),a('a[href="#'+v+'"]',t),q)});return a(this).on("selboxactivate",function(t,v,x,z,A){return v?b(a(this),x,z,A,q):c(a(this),q)})})}};j=function(l,p,m){l=l.closest(".selboxouter").find(".selboxtext");l.html(p);return m.selchange.call(l)};b=function(l,p,m,n,q){var t,v,x,z,A,B,C;if(!l.closest(".selboxouter").length){l.width();x=l.siblings(".fbutton");A=a(q.template);z=a(".selbox",A);t=a(".selboxnew",A);A.insertBefore(l);t.append(l);t.append(x);a(".replacement_filter",t).width("auto");x.css("margin-top","2px");z.height(l.height());a(".selboxtext",z).height(z.height());q.field!=null&&a("<input/>").attr({type:"hidden",name:q.field}).addClass("selboxfield").appendTo(z);l.selbox("maintext",p);C=a("ul",A).css({display:"none",width:z.width()});p=t.offset();C.appendTo("body").css({top:p.top+t.height()+"px",left:p.left+"px"});l.data("selboxul",C);v=new o.GA.EventConfig({category:"SearchInputFeatureType",nonInteraction:true});z.click(function(){C.toggle();return a(".selboxselected",C).removeClass("selboxselected")});z=C.outerWidth()-C.width();C.width(C.width()-z);t=t.outerWidth()-t.width()-(C.outerWidth()-C.width());x=z=0;for(p=m.length;z<p;x=++z){B=m[x];x=a("<a/>").attr("href","#"+n[x]).html(B).wrap("<li/>").parent();x.css("padding-left",parseInt(x.css("padding-left"))+t+"px").appendTo(C);x.click(function(){D.location.pathname.match(/Search\/Results/)==null&&o.GA.sendEvent(v,{action:a("a",this).text(),label:o.species});return h(l,a("a",this),q)});a("a",x).on("click",function(){return h(l,a(this),q)});x.mouseleave(function(){return a(this).removeClass("selboxselected")});x.mouseenter(function(){var F;C=a(this).closest("ul");C.find("li").removeClass("selboxselected");F=C.find(".selboxforce").removeClass("selboxforce");F.length||(F=a(this));return F.addClass("selboxselected")})}a("html").on("focusin",function(F){if(a(F.target).parents(".selboxlist").length)return true;l.data("selboxul").hide();return true});return a("html").keydown(function(F){switch(F.keyCode){case 27:return C.hide();case 40:F=a(".selboxselected",C).removeClass("selboxselected").next();F.length||(F=a("li",C).first());F.addClass("selboxselected");return g(F);case 38:F=a(".selboxselected",C).removeClass("selboxselected").prev();F.length||(F=a("li",C).last());F.addClass("selboxselected");return g(F);case 13:F=a(".selboxselected a",A);F.length&&h(l,F,q);return C.hide()}})}};h=function(l,p,m){var n;n=p.attr("href");n=n.substring(n.indexOf("#"));m.action.call(l,n.substring(1),p.html(),m);p.closest("ul").hide();a(".selboxfield",l.closest(".selboxnew")).val(n.substring(1));return false};g=function(l){var p,m,n,q;m=l.position().top;p=m+l.outerHeight();q=l.closest("ul");n=q.height();q.find(".selboxforce").removeClass("selboxforce");l.addClass("selboxforce");if(m<0)return q.scrollTop(q.scrollTop()+m-10);else if(p>n)return q.scrollTop(q.scrollTop()+(p-n)+10)};c=function(l){var p;p=l.closest(".selboxouter");if(p.length){l.width(p.width()-(l.outerWidth()-l.width()));l.insertAfter(p);l.data("selboxul").hide();return p.remove()}};return a.fn.selbox.defaults={action:function(){},selchange:function(){},field:null,template:'<div class="selboxouter">\n  <div class="selboxnew">\n    <div class="selbox">\n      <div class="selboxarrow">\n        <div class="selboxtext">\n          Hello\n        </div>\n      </div>\n    </div>\n  </div>\n  <ul class="selboxlist">\n  </ul>\n</div>'}})(jQuery)}).call(this);(function(){var a=[].slice;(function(b){var c,g;b.solr_config=function(){var h,j;h=arguments[0];j=2<=arguments.length?a.call(arguments,1):[];if(b.type(h)==="string")return c(h,j);else{h=b.extend({},b.solr_config.defaults,h);return g(h)}};g=function(h){if(b("html").data("config"))return(new b.Deferred).resolve();return b.ajax({url:h.url,dataType:"json"}).done(function(j){return b("html").data("config",j)})};c=function(h,j){var l,p,m,n,q,t,v,x,z,A;p=b("html").data("config");l=0;z=h.split(".");m=0;for(t=z.length;m<t;m++){q=z[m];if(p!=null)if(q==="%"){p=p[j[l]];l+=1}else if(q.charAt(q.length-1)==="="){q=q.substring(0,q.length-1);A=j[l];l+=1;x=null;n=0;for(v=p.length;n<v;n++){h=p[n];if(h[q]===A)x=h}p=x}else p=p[q]}return p};return b.solr_config.defaults={}})(jQuery)}).call(this);(function(){var a;D.rate_limiter=function(b,c){var g,h,j;h=g=j=null;return function(l){var p,m;p=f.Deferred();if(h){h.reject();clearTimeout(j);h=null}m=(new Date).getTime();if(!g||m-g>c){g=m;p.resolve(l)}else{h=p;g=m;j=setTimeout(function(){return p.resolve(l)},b)}return p}};D.then_loop=function(b){var c;return c=function(g){return(g=b(g))&&f.isFunction(g.promise)?g.then(c):g}};a=function(b,c){var g;g=then_loop(function(){return function(h){var j;j=h[0];if(h[1])return j;return c(j,b).then(function(l){return l===-1?[j,1]:[j+l,0]})}}(this));return f.Deferred().resolve([0,0]).then(g)};D.in_chunks=function(b,c,g){var h;if(b===-1)return a(c,g);h=then_loop(function(){return function(j){var l;if(b-j<=0)return j;l=b-j;if(l>c)l=c;return g(j,l).then(function(p){return j+
p})}}(this));return f.Deferred().resolve(0).then(h)};D.solr_current_species=function(){var b,c;c=D.location.href.split("/")[3].toLowerCase();(b=f.solr_config("spnames.%",c))||(b=c);b=b.toLowerCase();if(!f.solr_config("revspnames.%",b))return null;return b}}).call(this);(function(){var a,b,c,g,h,j,l,p,m,n,q,t,v,x,z,A,B,C,F,P,K,Q,O;t=function(){if(o.GA)return new o.GA.EventConfig({category:function(){return this.ui.item.link.substr(0,13)==="/Multi/Search"?"SrchAuto":"SrchDirect"},action:function(){return f(this.target).parents("#masthead").length?"masthead":"results"},label:function(){return this.ui.item.link},nonInteraction:false})};f.fn.getCursorPosition=function(){var G,I,J;if(G=this.get(0))if(G.selectionStart!=null)return G.selectionStart;else if(N.selection){G.focus();I=N.selection.createRange();J=N.selection.createRange().text.length;I.moveStart("character",-G.value.length);return I.text.length-J}};z=function(){var G;G=f("#species_path").val()+"/Ajax/config";return f.solr_config({url:G})};Q={};K=[];O=function(G,I){if(Q[G]!=null)I(Q[G],K);else return j("/Multi/Ajax/species",{name:G},function(J){var M;if(J.favs!=null)K=J.favs;if((M=J.result)!=null?M[0]:void 0){Q[G]=J.result[0];return I(J.result[0],K)}else return I(void 0,K)})};q=function(G,I){var J;J=false;if(G!=null){G=G.parents("form").find("input[name='site']");if(G.length!==0&&G.val()!=="ensembl"&&G.val()!=="ensembl_all"&&G.val()!=="vega")J=true}if(!J){J=decodeURIComponent(D.location.pathname.split("/")[1]);if(J==null||J==="Multi")J="";return O(J,function(M,T){var W;return M!=null?I([M.common]):I(function(){var $,V,aa;aa=[];$=0;for(V=T.length;$<V;$++){W=T[$];aa.push(W.common)}return aa}())})}};j=function(G,I,J){return f.ajax({url:G,data:I,traditional:true,success:J,dataType:"json",cache:false})};a={};C=function(G,I){var J,M;if(a[G.uid])return a[G.uid];M=f.inArray(G.species,I);M=M>-1?I.length-M+1:0;I=200*M;I+=100*f.inArray(G.feature_type,m);I+=((J=G.location)!=null?J.indexOf("_"):void 0)!==-1?0:10;I+=G.database_type==="core"?40:0;return a[G.uid]=I};P=function(G,I,J,M){var T,W,$,V,aa,da,Y;I.sort(function(ea,ca){return C(ca,J)-C(ea,J)});da=[];$=0;for(aa=I.length;$<aa;$++){T=I[$];W=l[T.feature_type];if(W==null)W=l[""];G={};for(V in W){Y=W[V];G[V]=Y.replace(/\{(.*?)\}/g,function(ea,ca){var ha,na;return(ha=(na=T[ca])!=null?na:T.id)!=null?ha:"unnamed"})}G.link="/"+T.url;da.push(G)}return M(da)};h=function(G,I){var J;I=I.toLowerCase();(J=D.solr_current_species())||(J="all");I=J+"__"+I;return j(G,{q:I,spellcheck:true})};g=function(G,I){var J,M,T;G=(J=G.result)!=null?(M=J.spellcheck)!=null?(T=M.suggestions[1])!=null?T.suggestion:void 0:void 0:void 0;if(G!=null){for(M=[];G.length;){J=G.shift();J=J.replace(/^.*?__/,"");M.push(I.push({left:"Search for '"+J+"'",link:"/Multi/Search/Results?q="+J,text:J}))}return M}};m=["Phenotype","Gene"];l={Phenotype:{left:"{name}",right:"{species} Phenotype"},Gene:{left:"{name}",right:"<i>{species}</i> Gene {id}"},"":{left:"{name}",right:"{id} {feature_type}"}};p={Phenotype:"{ucspecies}/Phenotype/Locations?ph={id}",Gene:"{ucspecies}/Gene/Summary?g={id};{rest}"};n=[{ft:["Phenotype"],fields:["name*","description*"]},{ft:["Gene"],fields:["name*"]},{ft:["Sequence"],fields:["id"],minlen:6},{fields:["id"],minlen:6}];x=[{fields:["id"],minlen:3},{ft:["Gene","Sequence"],fields:["name"]}];c=function(G,I,J,M){return z().then(function(){return function(){var T,W,$,V,aa,da;if(!f.solr_config("static.ui.enable_direct"))return(new f.Deferred).resolve();da=[];W={};T=0;for($=M.length;T<$;T++){V=M[T];V=f.solr_config("spnames.%",V.toLowerCase());da.push(V.toLowerCase());W[V.toLowerCase()]=1}(T=D.solr_current_species())&&W[T.toLowerCase()]==null&&da.push(T.toLowerCase());V=[];W=0;for(T=da.length;W<T;W++){aa=da[W];aa=aa.replace(/_/g,"_-").replace(/\s+/g,"_+");$=J.toLowerCase().replace(/_/g,"_-").replace(/\s+/g,"_+");V.push(aa+"__"+$)}$=V.join(" ");return j(I,{q:$,directlink:true,spellcheck:true})}}(this))};b=function(G,I){var J,M,T,W,$,V,aa,da,Y,ea,ca,ha,na;$=0;G=(W=G.result)!=null?(V=W.spellcheck)!=null?V.suggestions:void 0:void 0;ea=[];W=V=0;for(aa=G.length;V<aa;W=++V){ca=G[W];if(!(!W%2)){if($>=6)break;T=ca.suggestion;T!=null&&ea.push(function(){var sa,Aa,Fa,wa,ya,za;za=[];sa=0;for(Aa=T.length;sa<Aa;sa++){J=T[sa];Y=[];ya=J.split("__");wa=0;for(Fa=ya.length;wa<Fa;wa++){da=ya[wa];Y.push(da.replace(/_\+/g," ").replace(/_\-?/g,"_"))}ha=f.solr_config("revspnames.%",Y[0].toLowerCase());na=Y[0].charAt(0).toUpperCase()+Y[0].slice(1);M={name:Y[4],id:Y[3],species:ha,ucspecies:na,rest:Y[5],feature_type:Y[2]};M.url=p[Y[2]];M.url=M.url.replace(/\{(.*?)\}/g,function(oa,Ka){var Ba;return(Ba=M[Ka])!=null?Ba:""});I.push(M);$+=1;if($>=6)break;else za.push(void 0)}return za}())}}return ea};B=null;A=function(G){if(B)return B(G);return z().then(function(){return function(){var I;I=f.solr_config("static.ui.direct_pause");B=D.rate_limiter(I[0],I[1]);return B(G)}}(this))};v=function(G){return(G=G.parents("form").find("input[name='site']").val())?G==="ensembl"||G==="ensembl_all"||G==="vega":true};F=[{type:"search",label:""},{type:"direct",label:"Direct Links"}];f.widget("custom.searchac",f.ui.autocomplete,{_create:function(){var G,I,J,M,T,W,$,V,aa,da,Y;G=f("body");if(G.hasClass("ie67")||G.hasClass("ie8")||G.hasClass("ie9")||G.hasClass("ie10")){this.element.clone().addClass("solr_ghost").css("display","none").insertAfter(this.element);f.ui.autocomplete.prototype._create.call(this)}else{G=this.element.height();I=this.element.width();G=f("<div></div>").css({position:"relative",display:"inline-block","vertical-align":"bottom"}).width(I).height(G);da=["left","right","top","bottom"];M=0;for(W=da.length;M<W;M++){I=da[M];Y=["margin","padding"];T=0;for($=Y.length;T<$;T++){V=Y[T];G.css(V+"-"+I,this.element.css(V+"-"+I))}$=["style","color","width"];T=0;for(V=$.length;T<V;T++){Y=$[T];G.css("border-"+I+"-"+Y,this.element.css("border-"+I+"-"+Y))}}W=["background-color"];M=0;for(I=W.length;M<I;M++){V=W[M];G.css(V,this.element.css(V))}G.insertAfter(this.element);this.element.css("background-image","url(data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)").css("padding",0).css("margin",0).appendTo(G).css("border","none").css("outline","none").css("background-color","transparent");this.element.css({"z-index":2,position:"absolute"});G=this.element.position();J=this.element.clone().css({left:G.left+"px",top:G.top+"px"}).css({position:"absolute","z-index":1}).css({background:"none"}).val("").addClass("solr_ghost").attr("placeholder","").attr("id","").attr("tabindex","5000").insertBefore(this.element).attr("name","");f.ui.autocomplete.prototype._create.call(this);aa=this.element.val();this.element.on("change keypress paste focus textInput input",function(ea){return function(){var ca;ca=ea.element.val();if(ca!==aa){J.val().substring(0,ca.length)!==ca&&J.val("");return aa=ca}}}(this));return this.element.on("keydown",function(ea){return function(ca){var ha;if(ca.keyCode===39){ha=ea.element.val();if((ca=J.val())&&ca.substring(0,ha.length)===ha&&ea.element.getCursorPosition()===ha.length)return ea.element.val(ca)}}}(this))}},_renderMenu:function(G,I){var J,M,T,W,$,V;W=[];M=0;for(T=F.length;M<T;M++){V=F[M];$=function(){var aa,da,Y;Y=[];aa=0;for(da=I.length;aa<da;aa++){J=I[aa];J.type===V.type&&Y.push(J)}return Y}();V.label&&$.length&&G.append("<li class='search-ac-cat'>"+V.label+"</li>");W.push(f.each($,function(aa){return function(da,Y){return aa._renderItemData(G,Y)}}(this)))}return W},_renderItem:function(G,I){var J;J=f('<a class="search-ac"></a>').html(I.left);I.right&&J.append(f("<em></em>").append(I.right));return f("<li>").append(J).appendTo(G)},options:{source:function(G,I){return v(this.element)?A({q:G.term,response:I,element:this.element}).done(function(){return function(J){var M,T;if(T=f("#se_q").parents("form").attr("action")){T=T.split("/")[1];if(T==="common")T="Multi";T="/"+T+"/Ajax/search";M=J.q;return q(J.element,function(W){return f.when(h(T,M),c(n,T,M,W)).done(function($,V){var aa,da,Y;Y=[];aa=[];da=[];g($[0],Y);if(V!=null?V[0]:void 0)b(V[0],aa);return P(T,aa,W,function(ea){var ca,ha;aa=ea;ea=0;for(ca=Y.length;ea<ca;ea++){ha=Y[ea];ha.type="search"}ca=0;for(ha=aa.length;ca<ha;ca++){ea=aa[ca];ea.type="direct"}da=Y.concat(aa);return J.response(da)})})})}}}(this)):I([])},select:function(G,I){var J;if(D.hub&&D.hub.code_select)if(I.item.text){f(G.target).val(I.item.text);J=t();o.GA&&J&&o.GA.sendEvent(J,{target:G.target,ui:I});D.hub.update_url({q:I.item.text});return false}else I.item.link&&D.hub.spin_up();if(I.item.link){J=t();o.GA&&J&&o.GA.sendEvent(J,{target:G.target,ui:I});return D.location.href=I.item.link}},focus:function(G,I){var J,M,T;J=f(G.target).parent().find("input.solr_ghost");T=f(G.target).val();if(((M=I.item.text)!=null?M:"").substring(0,T.length)===T){J.val(I.item.text);J.css("font-style",f(G.target).css("font-style"))}else J.val("");return false},close:function(G){return f(G.target).parent().find("input.solr_ghost").val("")}}});f(function(){var G,I;G=f("#SpeciesSearch .search-form");if(!G.hasClass("no-sel"))if(I=f("#q",G).parents("form").attr("action")){I=I.split("/")[1];return f.solr_config({url:"/"+I+"/Ajax/config"}).done(function(){var J,M,T,W,$,V,aa,da,Y;da=f("#q",G).parent();J=[];Y=[];$=f.solr_config("static.ui.facets.key=.members","feature_type");M=0;for(T=$.length;M<T;M++){W=$[M];Y.push((V=(aa=W.text)!=null?aa.plural:void 0)!=null?V:W.key);J.push(W.key)}J.unshift("");Y.unshift("Search all categories");return da.selbox({action:function(ea,ca){return da.selbox("maintext",ca)},selchange:function(){return this.centered({max:14,inc:1})},field:"facet_feature_type"}).selbox("activate","",Y,J).selbox("select","")})}});D.sp_names=O;D.solr_jump_to=function(G){var I;if(I=f("#se_q").parents("form").attr("action")){I=I.split("/")[1];if(I==="common")I="Multi";I="/"+I+"/Ajax/search";return q(void 0,function(J){return f.when(c(x,I,G,J)).done(function(M){var T;T=[];b(M,T);if(T.length!==0)return D.location.href="/"+T[0].url})})}}}).call(this);o.Panel.SearchBox=o.Panel.SearchBox.extend({init:function(){this.base();var a=f("input#se_q,input#q",this.el);a.parents("form").hasClass("no-ac")||a.searchac().parents("form").submit(function(){if(a.val().substring(0,2)==="!!"){var b=a.val().substring(2);D.solr_jump_to(b);return false}return true})}});o.Panel.SpeciesSearch=o.Panel.extend({init:function(){this.base();f("input#se_q",this.el);console.log("BOO!")}});o.Panel.GenoverseTest=o.Panel.Content.extend({init:function(){this.base.apply(this,arguments);this.params.updateURL=o.updateURL({genoverse:typeof o.genoverseSupported==="function"?1:0},this.params.updateURL);this.getContent()}});o.Panel.PDB=o.Panel.Content.extend({init:function(){var a=this;this.base.apply(this,arguments);f.getScript("/pdbe/litemol-custom-theme.js");this.species=o.species;this.rest_url_root=this.params.ensembl_rest_url;this.rest_vep_url=this.rest_url_root+"/vep/"+this.species+"/id/";this.rest_pr_url=this.rest_url_root+"/overlap/translation/";this.rest_lookup_url=this.rest_url_root+"/lookup/id/";this.pdbe_url_root=this.params.pdbe_rest_url;this.rest_pdbe_url_root=this.pdbe_url_root+"/api/";this.rest_pdbe_url=this.rest_pdbe_url_root+"pdb/entry/molecules/";this.rest_pdbe_quality_url=this.rest_pdbe_url_root+
"validation/summary_quality_scores/entry/";this.rest_pdbe_sifts_url=this.rest_pdbe_url_root+"mappings/ensembl/";this.protein_sources={Pfam:"http://pfam.xfam.org/family/",PRINTS:"https://www.ebi.ac.uk/interpro/signature/",Gene3D:"http://gene3d.biochem.ucl.ac.uk/Gene3D/search?mode=protein&sterm="};this.protein_features={};this.hexa_to_rgb={red:{r:255,g:0,b:0},blue:{r:0,g:0,b:250},green:{r:0,g:128,b:0},orange:{r:255,g:165,b:0},white:{r:255,g:255,b:255},dark_grey:{r:100,g:100,b:100},darkred:{r:55,g:0,b:0},"#DDD":{r:221,g:221,b:221}};this.ensp_list=[];this.ensp_pdb_list={};this.ensp_pdb_quality_list={};this.ensp_pdb_author_pos={};this.ensp_var_pos={};this.ensp_var_cons={};this.ensp_length={};this.max_feature_per_gp=150;this.mapping_min_percent_length=this.mapping_min_percent=50;this.max_pdb_entries=this.mapping_min_length=10;this.spinner_waiting_time=20;this.pdb_chain_struc_entity={};this.details_header='<th>ID</th><th class="location _ht" title="Position in the selected PDB model"><span>PDB</span></th><th class="location _ht" title="Position in the selected Ensembl protein"><span>ENSP</span></th>';a.addSpinner();f(N).ready(function(){console.log(">>>>> STEP 00: init PDB variables and run document ready");a.addSpinner();if(f("#ensp_id").length){a.ensp_id=f("#ensp_id").val();a.ensp_list.push(a.ensp_id);f.when(a.get_ens_protein_length()).then(function(){a.get_all_pdb_list()})}else{if(f("#variant_use_param").length){a.var_id=f("#var_id").html();f.when(a.get_ensp_from_enst(f("#variant_enst").val())).then(function(){if(a.ensp_list.length){var b=f("#variant_pos").val();if(b.indexOf("-")==-1)b+="-"+
b;a.ensp_var_pos[a.ensp_id]=b;a.ensp_var_cons[a.ensp_id]=f("#variant_cons").val();f("#var_cons").html("("+a.ensp_var_cons[a.ensp_id]+")");a.get_all_pdb_list()}})}else f.when(a.get_var_ensp_data()).then(function(){a.ensp_list.length&&f.when(a.get_ens_protein_length()).then(function(){a.get_all_pdb_list()})});f("#ensp_list").change(function(){a.ensp_id=f(this).val();if(a.ensp_id){f(".var_pos").html(a.ensp_var_pos[a.ensp_id]);f("#var_cons").html("("+a.ensp_var_cons[a.ensp_id]+")");f("#var_ensp_id").html(a.ensp_id);a.display_pdb_list(a.ensp_id)}else{f(".var_pos").html("");f("#var_cons").html("");f("#var_ensp_id").html("");f("#variant_pos_info").hide()}})}f("#pdb_list").change(function(){var b=f(this).val();a.selectPDBEntry(b)});f(N).on("click",".pdb_feature_group",function(){f(this).toggleClass("view_enabled view_disabled");a.selectedFeatureGroupsToHighlight(f(this).attr("id"))});f(N).on("click",".pdb_feature_subgroup",function(){f(this).toggleClass("view_enabled view_disabled");a.selectedFeatureSubGroupsToHighlight(f(this).attr("id"))});f(N).on("click",".pdb_feature_entry",function(){f(this).toggleClass("view_enabled view_disabled");a.selectedFeaturesToHighlight()});f(N).on("click",".view_toggle",function(){var b="#"+f(this).attr("rel")+"_div";f(this).hasClass("closed")?f(b).show():f(b).hide();f(this).toggleClass("open closed")});f(N).on("click",".viewer_reset_btn",function(){f(".view_spinner").show();setTimeout(function(){a.liteMolScope.LiteMolComponent.Bootstrap.Command.Visual.ResetScene.dispatch(a.liteMolScope.LiteMolComponent.plugin.context,void 0);a.setDefaultHighlighting();a.selectedFeatureGroupsToHighlight()},a.spinner_waiting_time)})})},setDefaultHighlighting:function(){f(".view_enabled").switchClass("view_enabled","view_disabled");f("#mapping_group").switchClass("view_disabled","view_enabled");this.var_id&&f("#variant_group").switchClass("view_disabled","view_enabled")},selectPDBEntry:function(a){var b=this;console.log(">>>>> STEP 10: Select PDB entry (selectPDBEntry) - start");b.setDefaultHighlighting();if(a){var c=f("#pdb_list").find("option:selected");b.pdb_id=a;b.pdb_start=Number(c.attr("data-start"));b.pdb_end=Number(c.attr("data-end"));b.pdb_chains=c.attr("data-chain").split(",");b.pdb_hit_start=Number(c.attr("data-hit-start"));b.pdb_author_start=c.attr("data-author-start")?Number(c.attr("data-author-start")):b.pdb_hit_start;b.pdb_author_end=c.attr("data-author-end")?Number(c.attr("data-author-end")):Number(c.attr("data-hit-end"));console.log("    # PDB coords of "+a+" (on ENSP): "+b.pdb_start+"-"+b.pdb_end);f("#mapping_top_ensp").html('Ensembl protein: <a href="'+
b.species+"/Transcript/Summary?t="+b.ensp_id+'">'+b.ensp_id+"</a>");f("#mapping_top_pdb").html('PDBe model: <a href="'+b.pdbe_url_root+"/entry/pdb/"+a+'" rel="external">'+a.toUpperCase()+"</a>");f("#mappings_top").show();f("#mapping_ensp").html(b.ensp_id);f("#mapping_pdb").html(a.toUpperCase());if(b.var_id){a=b.ensp_var_pos[b.ensp_id].split("-");var g=b.ensp_to_pdb_coords(a[0],a[1]);c=b.ensp_to_pdb_coords(a[0],a[1],1);f("#focus_variant_cb").attr("data-value",g[0]+","+g[1]);var h=b.ensp_var_cons[b.ensp_id];if(h&&(h=="stop_gained"||h=="frameshift_variant")){g=Number(g[1])+1;g='<tr>  <td style="border-color:darkred">Altered/missing sequence</td>  <td>from '+c[0]+"</td><td>from "+a[1]+'</td>  <td><span class="pdb_feature_entry float_left view_enabled" id="focus_variant_alt_cb" data-value="'+g+","+b.pdb_end+'" data-group="variant_group" data-name="focus_variant_alt" data-colour="darkred"></span>  </td></tr>';f("#var_details_div > table > tbody").find("tr:gt(0)").remove();f("#var_details_div > table > tbody").append(g)}c=c[0]==c[1]?c[0]:c[0]+"-"+c[1];f("#var_pos_pdb").html(c);a=a[0]==a[1]?a[0]:a[0]+"-"+a[1];f("#var_pos_ensp").html(a);console.log("  >>> STEP 11a: Select PDB entry (selectPDBEntry) - variant setup done")}else console.log("  >>> STEP 11b: Select PDB entry (selectPDBEntry) - done");a=b.ensp_to_pdb_coords(b.pdb_start,b.pdb_end);f("#mapping_cb").attr("data-value",a[0]+","+a[1]);f("#mapping_ensp_pos").html(b.pdb_start+"-"+b.pdb_end);a=b.ensp_to_pdb_coords(b.pdb_start,b.pdb_end,1);f("#mapping_pdb_pos").html(a[0]+
"-"+a[1]);b.load3DWidget();if(b.ensp_id){b.get_exon_data(b.ensp_id);b.get_protein_feature_data(b.ensp_id);b.get_sift_polyphen_data(b.ensp_id)}LiteMol.Bootstrap.Event.Tree.NodeAdded.getStream(b.liteMolScope.LiteMolComponent.plugin.context).subscribe(function(j){if(j.data.ref=="model"){console.log(">>>>> STEP 12: Load 3D widget (selectPDBEntry) - done");j=0;if(!b.var_id){j=b.pdb_end-b.pdb_start+1;j=j>800?800:j<100?100:Math.round(j/10)*10}setTimeout(function(){b.selectedFeatureGroupsToHighlight()},j);f("#litemol_buttons").show()}})}else f("#litemol_buttons").hide()},load3DWidget:function(){this.removeComponents();var a='<pdb-lite-mol id="litemol_pdb_model" pdb-id="\''+this.pdb_id+'\'" hide-controls="true" show-logs="false"></pdb-lite-mol>';f("#litemol_canvas").html(a);a=f("#litemol_pdb_model");angular.bootstrap(a,["pdb.component.library"]);this.liteMolScope=function(b){return angular.element(b).isolateScope()}(f("#litemol_pdb_model"))},removeComponents:function(){f("#litemol_canvas").empty()},selectedFeatureGroupsToHighlight:function(a){var b=this;a||(a="_group");var c=0;if(/(sift|polyphen)/.test(a)){f(".view_spinner").show();c=b.spinner_waiting_time}setTimeout(function(){f("div[id$="+a+"]").each(function(){var g=f(this).attr("id"),h=f("#"+g).hasClass("view_enabled");f('[data-group="'+g+'"]').each(function(){h?f(this).switchClass("view_disabled","view_enabled"):f(this).switchClass("view_enabled","view_disabled")})});b.selectedFeaturesToHighlight();f(".view_spinner").is(":visible")&&f(".view_spinner").hide()},c)},selectedFeatureSubGroupsToHighlight:function(a){var b=this;a||(a="_sg");var c=/(sift|polyphen)/,g=0;if(c.test(a)){f(".view_spinner").show();g=b.spinner_waiting_time}setTimeout(function(){f("div[id$="+a+"]").each(function(){var h=f(this).attr("id"),j=f("#"+h).hasClass("view_enabled");f('[data-sg="'+h+'"]').each(function(){j?f(this).switchClass("view_disabled","view_enabled"):f(this).switchClass("view_enabled","view_disabled")})});b.selectedFeaturesToHighlight();c.test(a)&&f(".view_spinner").hide()},g)},selectedFeaturesToHighlight:function(){var a=this;if(a.liteMolScope){var b={base:a.hexa_to_rgb.dark_grey,entries:[]},c=a.liteMolScope.LiteMolComponent.plugin.context.select("model")[0];if(c){b=LiteMolPluginInstance.CustomTheme.createTheme(c.props.model,b);LiteMolPluginInstance.CustomTheme.applyTheme(a.liteMolScope.LiteMolComponent.plugin,"polymer-visual",b);b=["A"];if(a.pdb_chains&&a.pdb_chain_struc_entity[a.pdb_id])b=a.pdb_chains;c=f(".pdb_feature_entry");var g="";c.each(function(n,q){if(q.classList.contains("pdb_var_entry")){g=n;return false}});if(g!=""){var h=c.splice(g,1);c.push(h[0])}b=a.features2LiteMol(c,b);h=b[0];b=b[1];if(c=a.liteMolScope.LiteMolComponent.plugin.context.select("model")[0]){var j=LiteMolPluginInstance.CustomTheme.createTheme(c.props.model,{base:a.hexa_to_rgb.dark_grey,entries:h});if(b.length>0){h=a.liteMolScope.LiteMolComponent.Transform.build();for(var l=0,p=b.length;l<p;l++){var m=a.liteMolScope.LiteMolComponent.Query.sequence(b[l].entity_id.toString(),b[l].struct_asym_id.toString(),{seqNumber:b[l].start_residue_number},{seqNumber:b[l].end_residue_number});b[l].checked&&h.add(c,a.liteMolScope.LiteMolComponent.Transformer.Molecule.CreateSelectionFromQuery,{query:m,name:"Selection-"+l},{ref:"sequence-selection-"+l}).then(a.liteMolScope.LiteMolComponent.Transformer.Molecule.CreateVisual,{style:a.liteMolScope.LiteMolComponent.Visualization.Molecule.Default.ForType.get("BallsAndSticks")})}a.liteMolScope.LiteMolComponent.applyTransforms(h).then(function(){LiteMolPluginInstance.CustomTheme.applyTheme(a.liteMolScope.LiteMolComponent.plugin,"polymer-visual",j)})}else h.length>0&&LiteMolPluginInstance.CustomTheme.applyTheme(a.liteMolScope.LiteMolComponent.plugin,"polymer-visual",j);console.log(">>>>> STEP 14: Highlight selected features (selectedFeaturesToHighlight) - done")}}}},features2LiteMol:function(a,b){var c=this,g=[],h=[],j={};a.each(function(l,p){l=p.getAttribute("data-group");var m=f(this).hasClass("view_enabled");if(!j[l]){var n=f('[data-group="'+l+'"]'),q=0;n.each(function(){f(this).hasClass("view_enabled")&&q++});if(q==n.length){f("#"+
l).switchClass("view_disabled","view_enabled");f("#"+l+"[data-has-sg]").length&&f('[data-super-group="'+l+'"]').switchClass("view_disabled","view_enabled")}else{f("#"+l).switchClass("view_enabled","view_disabled");f("#"+l+"[data-has-sg]").length&&q==0&&f('[data-super-group="'+l+'"]').switchClass("view_enabled","view_disabled")}j[l]=1}var t=p.getAttribute("data-highlight");if(m||t){var v=p.getAttribute("data-colour").split(";");p=p.getAttribute("data-value").split(";");f.each(p,function(x,z){z=z.split(",");for(var A=Number(z[0]);A<=Number(z[1]);A++)for(var B=A,C=A,F=v[x],P=0;P<b.length;P++){var K=b[P],Q=K,O=1;if(c.pdb_chain_struc_entity[c.pdb_id]&&c.pdb_chain_struc_entity[c.pdb_id][K]){O=c.pdb_chain_struc_entity[c.pdb_id][K].entity_id;Q=c.pdb_chain_struc_entity[c.pdb_id][K].struct_asym_id}K={entity_id:O,struct_asym_id:Q,start_residue_number:B,end_residue_number:C,color:c.hexa_to_rgb[F],checked:m};m&&g.push(K);typeof t!==typeof U&&t!==false&&t!==null&&t.split(";")[x]==1&&h.push(K)}})}});return[g,h]},get_all_pdb_list:function(){var a=this;console.log(">>>>> STEP 06: Get all the PDB lists (get_all_pdb_list) - start");f("#pdb_list_label").hide();f("#pdb_list").hide();f("#right_form").addClass("loader_small");var b=[],c=[];f.each(a.ensp_list,function(g,h){if(a.var_id&&a.ensp_var_pos[h]||!a.var_id){b.push(a.get_pdb_by_ensp(h));c.push(h)}});if(a.ensp_list.length!=c.length)a.ensp_list=c;f.when.apply(U,b).then(function(){var g=[];f.each(a.ensp_list,function(h,j){if(a.protein_features[j].pdb&&a.protein_features[j].pdb.length!=0){var l=a.ensp_var_pos[j];f.each(a.protein_features[j].pdb,function(p,m){p=m.id.split(".")[0];if(f.inArray(p,g)==-1){var n=0;if(l){var q=l.split("-");if(q[0]>=m.start&&q[1]<=m.end)n=1}if(l&&n==1||!l){if(a.ensp_id==U)a.ensp_id=j;g.push(p)}}})}else a.no_pdb_list_available(j)});g.length>0?a.get_pdb_extra_data(g):a.no_mapping_available()})},get_pdb_extra_data:function(a){var b=this;f.when(b.get_pdb_quality_score(a),b.get_pdb_chain_struc_entity(a)).then(function(){var c=[];f.each(b.ensp_list,function(h,j){b.parse_pdb_results(j);b.ensp_pdb_list[j]&&f.each(b.ensp_pdb_list[j],function(l,p){b.pdb_chain_struc_entity[p.id]&&c.push(p.id+"#"+j)})});var g=[];f.each(c,function(h,j){h=j.split("#");g.push(b.get_pdb_author_pos(h[0],h[1]))});f.when.apply(U,g).then(function(){console.log("  >>> STEP 08c: PDB author coordinates (get_pdb_author_pos) - done");b.finish_parse_pdb_results()},function(){b.no_mapping_available()})})},get_pdb_by_ensp:function(a){var b=this;b.protein_features[a]={pdb:[]};return f.ajax({url:b.rest_pr_url+
a+"?feature=protein_feature",method:"GET",contentType:"application/json; charset=utf-8"}).done(function(c){f.each(c,function(g,h){var j=h.type;g=h.end-h.start+1;var l=h.hit_end-h.hit_start+1;if(b.protein_sources[j]||j==null||j=="sifts"){if(j==null||j=="sifts"){j=l/b.ensp_length[a]*100;if(l<b.mapping_min_length||l<b.mapping_min_percent_length&&j<b.mapping_min_percent||g!=l)return true;j="pdb"}if(b.protein_features[a][j])b.protein_features[a][j].push(h);else b.protein_features[a][j]=[h]}});console.log(">>>>> STEP 07: Get list of PDBs by ENSP - "+
a+" (get_pdb_by_ensp) - done")}).fail(function(c,g,h){console.log("ErrorText: "+g+"\n");console.log("thrownError: "+h+"\n")})},get_pdb_quality_score:function(a){var b=this;return f.ajax({type:"POST",url:b.rest_pdbe_quality_url,data:a.join(",")}).done(function(c){f.each(c,function(g,h){b.ensp_pdb_quality_list[g]=h.overall_quality;console.log("    > Quality for "+g+": "+b.ensp_pdb_quality_list[g])});console.log("  >>> STEP 08a: Get PDB quality (get_pdb_quality_score) - done")}).fail(function(c,g,h){console.log("ErrorText: "+
g+"\n");console.log("thrownError: "+h+"\n")})},get_pdb_chain_struc_entity:function(a){var b=this;return f.ajax({type:"POST",url:b.rest_pdbe_url,data:a.join(",")}).done(function(c){f.each(c,function(g,h){f.each(h,function(j,l){var p=l.entity_id;if(l.molecule_type!="polypeptide(L)"||!p)return true;f.each(l.in_chains,function(m,n){var q=l.in_struct_asyms[0];if(l.in_struct_asyms[m]&&m!=0)q=l.in_struct_asyms[m];b.pdb_chain_struc_entity[g]||(b.pdb_chain_struc_entity[g]={});b.pdb_chain_struc_entity[g][n]={struct_asym_id:q,entity_id:p}})})});console.log("  >>> STEP 08b: Get PDB chain info (get_pdb_chain_struc_entity) - done")}).fail(function(c,g,h){console.log("ErrorText: "+g+"\n");console.log("thrownError: "+h+"\n")})},get_pdb_author_pos:function(a,b){var c=this,g;f.each(c.ensp_pdb_list[b],function(j,l){if(l.id==a){g=l.chain[0];return false}});var h=c.pdb_chain_struc_entity[a][g].entity_id;return f.ajax({url:c.rest_pdbe_sifts_url+a,method:"GET"}).done(function(j){var l=0,p,m,n=0,q=0,t,v;f.each(j[a].Ensembl,function(x,z){f.each(z.mappings,function(A,B){if(B.translation_id==b){l=1;if(B.entity_id==h&&B.chain_id==g){A=B.start.residue_number;var C=B.end.residue_number,F=B.start.author_residue_number;B=B.end.author_residue_number;if(F==U)n=1;if(B==U)q=1;if(t==U||A<t){t=A;p=F?F:1}if(v==U||C>v){v=C;m=B?B:v}}}});if(l==1)return false});if(p&&m&&(n==0||q==0)){c.ensp_pdb_author_pos[b]||(c.ensp_pdb_author_pos[b]={pdb_id:{}});c.ensp_pdb_author_pos[b][a]={start:p,end:m}}}).fail(function(j,l,p){console.log("ErrorText: "+
l+"\n");console.log("thrownError: "+p+"\n")})},parse_pdb_results:function(a){var b=this;b.removeSpinner();var c=[],g=[],h={},j=b.protein_features[a].pdb;f.each(j,function(l,p){p=p.id.split(".");l=p[0];p=p[1];if(h[l]&&f.inArray(p,h[l])==-1)h[l].push(p);else h[l]=[p]});f.each(j,function(l,p){l=p.id.split(".")[0];if(f.inArray(l,c)==-1){var m=p.end-p.start+1;g.push({id:l,start:p.start,end:p.end,chain:h[l].sort(),size:m,hit_start:p.hit_start,hit_end:p.hit_end,author_start:U,author_end:U,overall_quality:b.ensp_pdb_quality_list[l]});c.push(l)}});if(g&&g.length!=0){g.sort(function(l,p){return p.size-l.size||p.overall_quality-l.overall_quality});b.ensp_pdb_list[a]=g.slice(0,b.max_pdb_entries)}},finish_parse_pdb_results:function(){var a=this,b=0;console.log("  >>> STEP 09a: Start parse PDBs results (finish_parse_pdb_results)");f.each(a.ensp_pdb_list,function(c,g){var h=[];f.each(g,function(j,l){j=0;if(a.ensp_pdb_author_pos[c]){var p=l.hit_end-l.hit_start;if(a.ensp_pdb_author_pos[c][l.id])if(p==a.ensp_pdb_author_pos[c][l.id].end-
a.ensp_pdb_author_pos[c][l.id].start){l.author_start=a.ensp_pdb_author_pos[c][l.id].start;l.author_end=a.ensp_pdb_author_pos[c][l.id].end;j=1}}j==0&&h.push(l)});h.length&&f.each(h,function(j,l){console.log("    > Entry "+l.id+" removed from the list");a.ensp_pdb_list[c].splice(f.inArray(l,a.ensp_pdb_list[c]),1)});if(Object.keys(a.ensp_pdb_list[c]).length>0){g={value:c,text:c};if(c==a.ensp_id){g.selected="selected";f("#var_cons").html("("+a.ensp_var_cons[a.ensp_id]+")");a.display_pdb_list(c)}f("#ensp_list").append(f("<option>",g));b++}else a.no_pdb_list_available(c)});b==0&&a.no_mapping_available();console.log("  >>> STEP 09b: Finish parse PDBs results (finish_parse_pdb_results) - done")},no_pdb_list_available:function(a){if(a==this.ensp_id&&this.ensp_list.length>1)this.ensp_id=U},no_mapping_available:function(){this.removeSpinner();var a=this.ensp_list.length>1?':<ul class="top-margin bottom-margin"><li>'+this.ensp_list.join("</li><li>")+"</li></ul>":this.ensp_list[0]+".";Object.keys(this.ensp_var_pos).length?this.showNoData("No PDB models overlapping this variant on the following protein(s) have been found/selected: "+
a):this.showNoData("No PDB models mappings have been found/selected for the  protein(s) "+a);console.log(">>>>> STEP 99: No ENSP-PDB mappings found/retained (no_mapping_available)")},display_pdb_list:function(a){var b=this;b.removeSpinner();if(f.isEmptyObject(b.ensp_pdb_list)||!b.ensp_pdb_list[a])b.showNoData();else{if(f(".var_pos").length){f(".var_pos").html(b.ensp_var_pos[a]);f("#var_cons").html("("+b.ensp_var_cons[a]+")");f("#var_ensp_id").html(a)}var c=b.ensp_pdb_list[a],g=c.length;f("#right_form").removeClass("loader_small");f("#pdb_list_label").hide();f("#pdb_list").hide();f("#pdb_list").html("");var h,j=0,l=1;f("#pdb_list").html("");f.each(c,function(p,m){p=Math.round((m.end-m.start+1)/b.ensp_length[a]*100);p={value:m.id,"data-start":m.start,"data-end":m.end,"data-hit-start":m.hit_start,"data-chain":m.chain,text:m.id+(" - Coverage: [ PDBe: "+m.author_start+"-"+m.author_end+" | ENSP: "+m.start+"-"+m.end+" ] => "+p+"% of ENSP length")};if((m.hit_start!=m.author_start||m.hit_end!=m.author_end)&&m.author_start&&m.author_end){p["data-author-start"]=m.author_start;p["data-author-end"]=m.author_end}else p["data-hit-end"]=m.hit_end;if(l==1||g==1){p.selected="selected";h=m.id;l=0}f("#pdb_list").append(f("<option>",p));j=1});if(j){f("#pdb_list_label").show();f("#pdb_list").show();b.selectPDBEntry(h)}else b.showNoData()}f("#ensp_pdb").show()},add_var_link:function(a){return'<a href="/'+this.species+"/Variation/Explore?v="+a+'" target="_blank">'+a+"</a>"},get_var_ensp_data:function(){var a=this,b=this.getParameterByName("v"),c;if(b)c=b;else if(f("#var_id").length)c=f("#var_id").html();a.var_id=c;f("#var_id").html(a.var_id);console.log(">>>>> STEP 01: Get Variant ID (get_var_ensp_data) - done");return f.ajax({url:a.rest_vep_url+a.var_id+"?protein=1",method:"GET",contentType:"application/json; charset=utf-8"}).done(function(g){console.log(">>>>> STEP 02: Get Variant data (get_var_ensp_data) - done");g=g[0].transcript_consequences;if(g.length>0){var h=[];f.each(g,function(j,l){if(l.protein_id){j=l.protein_id;if(f.inArray(j,h)==-1){h.push(j);a.ensp_var_pos[j]=l.protein_start+
"-"+l.protein_end;a.ensp_var_cons[j]=l.consequence_terms[0];console.log("  >>> STEP 03a: Get Variant pos on "+j+" (get_var_ensp_data) - done")}}})}f("#right_form").removeClass("loader_small");f("#ensp_list").html("");f("#pdb_list").html("");if(h.length==0)a.showNoData("No overlapping Ensembl protein found");else{h.sort();a.ensp_list=h;if(!a.ensp_id)a.ensp_id=h[0];console.log(">>>>> STEP 04: Get ENSP list (get_var_ensp_data) - done")}}).fail(function(g,h,j){console.log("ErrorText: "+h+"\n");console.log("thrownError: "+
j+"\n");a.removeSpinner();a.showMsg()})},get_ensp_from_enst:function(a){var b=this;return f.ajax({url:b.rest_lookup_url+a+"?expand=1",method:"GET",contentType:"application/json; charset=utf-8"}).done(function(c){var g=c.Translation.id;b.ensp_id=g;b.ensp_list=[b.ensp_id];console.log("TEST: "+g);b.ensp_length[g]=c.Translation.length;console.log(">>>>> STEP 02: Get corresponding ENSP from ENST (get_ensp_from_enst) - done")}).fail(function(c,g,h){console.log("ErrorText: "+g+"\n");console.log("thrownError: "+
h+"\n");b.removeSpinner();b.showMsg()})},get_ens_protein_length:function(){var a=this;return f.ajax({type:"POST",url:a.rest_lookup_url,data:'{ "ids" : ["'+a.ensp_list.join('","')+'"], "db_type" : "core" }',dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(b){f.each(b,function(c,g){a.ensp_length[c]=g.length});console.log(">>>>> STEP 05: Get ENSP length (get_ens_protein_length) - done")}).fail(function(b,c,g){console.log("ErrorText: "+c+"\n");console.log("thrownError: "+
g+"\n");a.removeSpinner();a.showMsg()})},get_exon_data:function(a){var b=this;f.ajax({url:b.rest_pr_url+a+"?feature=translation_exon",method:"GET",contentType:"application/json; charset=utf-8",success:function(c){console.log("  >>> STEP 13a: Get Exon data (get_exon_data) - done");b.parse_exon_results(c)},error:function(c,g,h){console.log("ErrorText: "+g+"\n");console.log("thrownError: "+h+"\n")}})},parse_exon_results:function(a){var b=this;if(!a.error){var c="";f("#exon_details_div").html("");var g=0,h={};f.each(a,function(p,m){var n=m.start;m=m.end;if(n<b.pdb_start&&m<b.pdb_start||n>b.pdb_end&&m>b.pdb_end){h[p]=1;return true}g++});var j=Object.keys(a).length,l=0;f.each(a,function(p,m){if(h[p])return true;p=p+1;var n=m.start;m=m.end;p==j&&m--;if(n<b.pdb_start&&m>b.pdb_start)n=b.pdb_start;if(m>b.pdb_end&&n<b.pdb_end)m=b.pdb_end;var q=b.ensp_to_pdb_coords(n,m);if(q.length==0)return true;var t=b.ensp_to_pdb_coords(n,m,1),v=q[0];q=q[1];var x=t[0];t=t[1];var z=b.get_hexa_colour(l,g);c+='<tr><td style="border-color:'+
z+'">'+('<a href="/'+b.species+"/Transcript/Exons?t="+b.ensp_id+'">Exon '+p+"</a>")+"</td><td>"+x+"-"+t+"</td><td>"+n+"-"+m+'</td><td><span class="pdb_feature_entry float_left view_disabled" id="exon_'+p+'_cb" data-value="'+(v+","+q)+'" data-group="exon_group" data-name="'+p+'" data-colour="'+z+'"></span></td></tr>';l++});b.render_selection_details("exon","exon",l>1?"Exons":"Exon",l,c)}},get_protein_feature_data:function(a){var b=this,c=0;f.each(b.protein_sources,function(g){if(b.protein_features[a][g]){b.parse_protein_feature_results(b.protein_features[a][g],g);c=1}});c==0&&f("#protein_block").html("<div>No protein annotation found</div>");console.log("  >>> STEP 13b: Get Proteins feature (get_protein_feature_data) - done")},parse_protein_feature_results:function(a,b){var c=this,g="",h=0,j=b.toLowerCase();a.sort(function(p,m){return p.start-m.start});var l=Object.keys(a).length;f.each(a,function(p,m){var n=c.ensp_to_pdb_coords(m.start,m.end);if(n.length==0)return true;var q=c.ensp_to_pdb_coords(m.start,m.end,1),t=n[0],v=n[1];n=q[0];q=q[1];p=c.get_hexa_colour(p,l);t=t+","+v;v=m.id;if(c.protein_sources[b]){v=c.protein_sources[b];v+=b=="Gene3D"?c.ensp_id:m.id;v='<a href="'+v+'" rel="external">'+m.id+"</a>"}g+='<tr><td style="border-color:'+p+'">'+v+"</td><td>"+n+"-"+q+"</td><td>"+m.start+"-"+m.end+'</td><td><span class="pdb_feature_entry float_left view_disabled" id="'+b+'_cb" data-value="'+t+'" data-group="'+j+'_group" data-name="'+m.id+'" data-colour="'+p+'"></span></td></tr>';h++});c.render_selection_details("protein",j,b,h,g)},get_sift_polyphen_data:function(a){var b=this;f.ajax({url:b.rest_pr_url+a+"?feature=transcript_variation",method:"GET",contentType:"application/json; charset=utf-8"}).done(function(c){console.log("  >>> STEP 13c: Get SIFT and PolyPhen data (get_sift_polyphen_data) - done");b.parse_sift_results(c);b.parse_polyphen_results(c)}).fail(function(c,g,h){console.log("ErrorText: "+g+"\n");console.log("thrownError: "+h+"\n")})},parse_sift_results:function(a){var b=this;a.sort(function(l,p){return l.start-p.start||p.sift-l.sift});var c="",g=0,h={score_good:"sift_1_sg",score_bad:"sift_2_sg"},j={};f.each(a,function(l,p){if(p.sift){var m=b.ensp_to_pdb_coords(p.start,p.end);if(m.length==0)return true;l=b.ensp_to_pdb_coords(p.start,p.end,1);var n=m[0],q=m[1];m=l[0];l=l[1];l=n==q?m:m+"-"+l;m=p.start==p.end?p.start:p.start+"-"+p.end;var t=p.sift;n=n+","+q;q=p.residues;if(q.length>5){var v=q.substr(0,2)+"...";q='<span class="ht" title="'+q+'">'+v+"</span>"}v="score_good";var x="green";if(t<=0.05){v="score_bad";x="red"}j[v]=1;var z=b.add_var_link(p.id);c+='<tr><td style="border-color:'+
x+'">'+z+"</td><td>"+l+"</td><td>"+m+"</td><td>"+q+'</td><td><div class="score '+v+'">'+t+'</div></td><td><span class="pdb_feature_entry float_left view_disabled" id="sift_'+p.id+'_cb" data-value="'+n+'" data-group="sift_group" data-name="'+p.id+'" data-colour="'+x+'" data-sg="'+h[v]+'"></span></td></tr>';g++}});a=b.build_legend(j,[{score_good:{id:h.score_good,"class":"score_bg_good",label:"Tolerated",title:"Greater than or equal to 0.05"}},{score_bad:{id:h.score_bad,"class":"score_bg_bad",label:"Deleterious",title:"Less than 0.05"}}],"sift");b.render_selection_details("variant","sift","SIFT",g,c,"Residues;Score",a,1)},parse_polyphen_results:function(a){var b=this;a.sort(function(l,p){return l.start-p.start||l.polyphen-p.polyphen});var c="",g=0,h={score_good:"polyphen_1_sg",score_ok:"polyphen_2_sg",score_bad:"polyphen_3_sg",score_neutral:"polyphen_4_sg"},j={};f.each(a,function(l,p){if(p.polyphen){var m=b.ensp_to_pdb_coords(p.start,p.end);if(m.length==0)return true;l=b.ensp_to_pdb_coords(p.start,p.end,1);var n=m[0],q=m[1];m=l[0];l=l[1];l=n==q?m:m+"-"+l;m=p.start==p.end?p.start:p.start+"-"+p.end;var t=p.polyphen;n=n+","+q;q=p.residues;if(q.length>5){var v=q.substr(0,2)+"...";q='<span class="ht" title="'+q+'">'+v+"</span>"}v="score_neutral";var x="blue";if(t>0.908){v="score_bad";x="red"}else if(t>0.445&&t<=0.908){v="score_ok";x="orange"}else if(t<=0.445){v="score_good";x="green"}j[v]=1;var z=b.add_var_link(p.id);c+='<tr><td style="border-color:'+x+'">'+z+"</td><td>"+l+"</td><td>"+m+"</td><td>"+q+
'</td><td><div class="score '+v+'">'+t+'</div></td><td><span class="pdb_feature_entry float_left view_disabled" id="polyphen_'+p.id+'_cb" data-value="'+n+'" data-group="polyphen_group" data-name="'+p.id+'" data-colour="'+x+'" data-sg="'+h[v]+'"></span></td></tr>';g++}});a=b.build_legend(j,[{score_good:{id:h.score_good,"class":"score_bg_good",label:"Benign",title:"Less than or equal to 0.446"}},{score_ok:{id:h.score_ok,"class":"score_bg_ok",label:"Possibly Damaging",title:"Greater than 0.446 and less than or equal to 0.908"}},{score_bad:{id:h.score_bad,"class":"score_bg_bad",label:"Probably Damaging",title:"Greater than 0.908"}},{score_neutral:{id:h.score_neutral,"class":"score_bg_neutral",label:"Unknown",title:"Unknown"}}],"polyphen");b.render_selection_details("variant","polyphen","PolyPhen",g,c,"Residues;Score",a,1)},render_selection_details:function(a,b,c,g,h,j,l,p){a=a+"_block";var m=b+"_label",n=b+"_row",q=b+"_group";p=p?' data-has-sg="1"':"";var t=b+"_details",v=t+"_div";j=j?"<th>"+j.replace(";","</th><th>")+"</th>":"";view_col="<th></th>";l=l?l:"";if(g){if(f("#"+m).length)b=f("#"+m);else{b=f("<div></div>");b.attr("id",m)}b.html('<div>  <h3 class="float_left">'+c+'</h3>  <div class="float_right view_toggle view_toggle_btn closed" rel="'+t+'"></div>  <div class="float_right pdb_feature_group view_disabled" title="Click to highlight / hide '+c+' on the 3D viewer" id="'+q+'"'+p+'></div>  <div class="float_right view_badge" title="'+g+" "+c+" entr"+(g>1?"ies":"y")+" overlap"+(g>1?"":"s")+' this PDB model">'+g+'</div>  <div style="clear:both"></div></div><div class="'+
t+'">  <div id="'+v+'" class="pdb_features_container toggleable" style="padding-top:5px;display:none">'+l+'    <table class="pdb_features"><thead><tr>'+this.details_header+j+view_col+"</tr></thead><tbody>"+h+"</tbody></table>  </div></div>");if(!f("#"+n).length){c=f("<div></div>");c.attr("id",n);c.append(b);f("#"+a).append(c)}}else f("#"+n).length&&f("#"+n).remove();f("._ht").helptip()},build_legend:function(a,b,c){var g="",h=a.length,j=0;f.each(b,function(l,p){f.each(p,function(m,n){if(a[m]){j++;g+='  <div class="float_left"'+(j==h?"":' style="margin-right:10px"')+'>    <div class="float_left _ht score_legend_left '+n["class"]+'" title="'+n.title+'">'+n.label+'</div>    <div class="float_left score_legend_right">      <div class="pdb_feature_subgroup view_disabled" title="'+("Click to highlight / hide "+n.label+" "+c+" Variant")+'" id="'+n.id+'" data-super-group="'+c+'_group"></div>    </div>    <div style="clear:both"></div>  </div>'}})});if(g=="")return U;return'<div class="pdb_legend">'+
g+'  <div style="clear:both"></div></div>'},ensp_to_pdb_coords:function(a,b,c){a=Number(a);b=Number(b);var g,h,j=this.pdb_start,l=this.pdb_end;if(a<j&&b<j||a>l&&b>l)return[];c=c?this.pdb_author_start:this.pdb_hit_start;var p=c-this.pdb_start;if(a<j&&b>j)g=j+p;if(b>l&&a<l)h=l+p;g||(g=a+p);h||(h=b+p);if(g<c)g=c;return[g,h]},sin_to_hex:function(a,b,c){a=Math.sin(Math.PI/c*2*a+b);a=(Math.floor(a*127)+128).toString(16);return a.length===1?"0"+a:a},get_hexa_colour:function(a,b){var c=this.sin_to_hex(a,0*Math.PI*2/3,b),g=this.sin_to_hex(a,1*Math.PI*2/3,b);a=this.sin_to_hex(a,2*Math.PI*2/3,b);c="#"+c+a+g;this.add_colour(c);return c},add_colour:function(a){if(!this.hexa_to_rgb[a]){var b=a.replace("#","");b=parseInt(b,16);this.hexa_to_rgb[a]={r:b>>16&255,g:b>>8&255,b:b&255}}},isOdd:function(a){return a%2},getParameterByName:function(a,b){if(!b)b=D.location.href;a=a.replace(/[\[\]]/g,"\\$&");a=(new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)")).exec(b);if(!a)return null;if(!a[2])return"";return decodeURIComponent(a[2].replace(/\+/g," "))},showMsg:function(a){a=a?a:"Sorry, we are currently unable to get the data to display this view. Please try again later.";f("#ensp_pdb").html('<span class="left-margin right-margin">'+a+"</span>");f("#ensp_pdb").show()},showNoData:function(a){a||(a="No data available");this.showMsg(a)},addSpinner:function(){f("#pdb_msg").addClass("spinner")},removeSpinner:function(){f("#pdb_msg").removeClass("spinner")}});if("Ensembl"in D&&"GA"in o){o.GA.domainCodes={"useast.ensembl.org":"UA-58710484-4","test-4.ensembl.org":"UA-58710484-1","test-3.ensembl.org":"UA-58710484-11","test-1.ensembl.org":"UA-58710484-7","test.ensembl.org":"UA-58710484-8","mtest.ensembl.org":"UA-58710484-10","uswest.ensembl.org":"UA-58710484-5","asia.ensembl.org":"UA-58710484-3","www.ensembl.org":"UA-58710484-2","m.ensembl.org":"UA-58710484-9","dev.ensembl.org":"UA-58710484-6","grch37.ensembl.org":"UA-58710484-14","grch37-test.ensembl.org":"UA-58710484-15","Jul2018.archive.ensembl.org":"UA-58710484-16"};o.GA.verbose=true;o.GA.logAjaxLoadTimes=true}o.LayoutManager=o.LayoutManager.extend({initialize:function(){this.base.apply(this,arguments);this.showMobileMessage()},showMobileMessage:function(){var a=o.cookie.get("ENSEMBL_MOBILE"),b=o.cookie.get("HIDE_MOBILE_MSG"),c=o.cookie.get("MOBILE_URL");if(!b&&c&&a&&a==="no"){a=D.location.href.replace(D.location.host,c);f(['<a class="mobile-message" href="'+a+'"><div class="message-wrapper">','<img src="/img/mobile/phone-ensembl.png" /><div class="text">Switch to mobile version<div id="close-div" class="modal_close" alt="Close box"></div></div></div></a>'].join("")).prependTo(N.body).slideDown();f("a.mobile-message div.modal_close").on("click",function(g){g.preventDefault();g.stopPropagation();f(".mobile-message").slideToggle("fast");g=new Date;var h=g.getTime()+18E5;g.setTime(h);o.cookie.set("HIDE_MOBILE_MSG","1",g.toUTCString())});f(N).on("click","a.mobile-message",function(){o.cookie.set("ENSEMBL_MOBILE","yes");return true})}f(N).on("click",".mobile-link",function(){o.cookie.set("ENSEMBL_MOBILE","yes");return true});return false}})})(jQuery,this,document);
